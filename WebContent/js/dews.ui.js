/*
 * UI 컨트롤 공통
 */
(function ($, dews, kendo) {
    if (!kendo) {
        throw 'Kendo UI 라이브러리가 필요합니다.';
    }

    var initializers = [],
        readies = [];

    $.extend(true, dews, {
        ready: function (func) {
            if ($.type(func) === 'function') {
                readies.push(func);
            }
        },
        ui: {
            /**
             * 컨트롤 이니셜라이저를 등록합니다.
             * @param {string} name 컨트롤 이름
             * @param {function} init 초기화 함수
             */
            addControlInitializer: function (name, init) {
                initializers.push(function (container) {
                    return $.Deferred(function (deferred) {
                        init(container);

                        deferred.resolve(name);
                    }).done(function (name) {
                        //dews.log('## DEWS Controls: ' + name + ' - 초기화 - 완료 ##');
                    }).promise();
                });
            },

            getDialogMaxZIndex: function () {
                var zIndex = 0;
                $('body > div:visible.k-popup, body > div:visible.postcode-wrapper, body > div:visible.dews-periodpicker-calendars, ' +
                    'body > div:visible.dews-monthperiodpicker-calendars, body > div:visible.dews-weekperiodpicker-calendars, ' +
                    'body > div:visible.k-window').each(function (idx, item) {
                    var $item = $(item);
                    var position = $item.css('position');
                    if (position === 'absolute' || position === 'fixed') {
                        if (parseInt($item.css('zIndex'), 10) > zIndex) {
                            zIndex = parseInt($item.css('zIndex'), 10);
                        }
                    }
                });

                return zIndex;
            }
        }
    });

    $.extend(true, dews, {
        /**
         * @namespace
         */
        date: {
            /**
             * 날짜 형식의 값에 포맷을 적용합니다.
             * @param {string|date} value 포맷을 적용할 값
             * @param {string} format 포맷 문자열 (D: 날짜(yyyy-MM-dd), Y: 연도(yyyy), M: 년월(yyyy-MM), DT: 날짜+시간(yyyy-MM-dd HH:mm:ss), 생략: D)
             * @returns {string} 포맷이 적용된 날짜 문자열
             */
            format: function (value, format) {
                var date;

                if (typeof format === 'undefined') {
                    format = 'D';
                }

                if ($.type(value) === 'string') {
                    date = dews.date.parse(value, format);
                } else if ($.type(value) === 'date') {
                    date = value;
                } else {
                    return value || '';
                }

                format = dews.getFormatFromAlias(format);

                return kendo.toString(date, format) || '';
            },
            /**
             * 문자열이 날짜 형식에 맞는지 여부를 확인합니다.
             * @param {string} value 검사할 문자열
             * @param {string} [format] 문자열을 검사할 포맷
             */
            validate: function (value, format) {
                var valid = false,
                    formats = [],
                    date;

                if (typeof format === 'undefined') {
                    format = 'D';
                }

                if ($.type(value) === 'date') {
                    valid = true;
                } else if ($.type(value) === 'string') {

                    formats.push(dews.getFormatFromAlias(format, true));
                    formats.push(dews.getFormatFromAlias(format, false));
                }

                $.each(formats, function (idx, f) {
                    date = kendo.parseDate(value, f, dews.localize.getLanguage());

                    if (date) {
                        // 값으로 들어왔던 문자열과 변환된 문자열이 동일한지 비교한다.
                        if (dews.date.format(date, f) === value) {
                            valid = true;
                            return false;
                        }
                    }
                });

                return valid;
            },
            /**
             * 문자열을 날자형식으로 변환합니다.
             * @param {string} value 날짜 문자열
             * @param {string} [format] 포맷 문자열 또는 알리아스 (생략시: D)
             */
            parse: function (value, format) {
                var valueFormat, textFormat, date = null;

                if (value) {
                    if (typeof format === 'undefined') {
                        format = 'D';
                    }

                    if (format === 'D' || format === 'Y' || format === 'M' || format === 'DT' || format === 'T') {
                        // 지정한 알리아스가 있을 경우
                        valueFormat = dews.getFormatFromAlias(format, true);
                        textFormat = dews.getFormatFromAlias(format, false);
                    } else {
                        valueFormat = format;
                        textFormat = format;
                    }

                    if (format) {
                        date = kendo.parseDate(value, valueFormat, dews.localize.getLanguage());

                        if (date === null && valueFormat !== textFormat) {
                            date = kendo.parseDate(value, textFormat, dews.localize.getLanguage());
                        }
                    }
                }

                return date;
            }
        },
        /**
         * @namespace
         */
        ui: {
            /**
             * 날짜 형식의 문자열에 포맷을 적용합니다.
             * @param {string|date} value 날짜 형식의 값
             * @param {string} [format] 포맷문자열(옵션 - 생략시 D)
             */
            formatedDate: function (value, format) {
                return dews.date.format(value, format);
            }
        },
        /**
         * 서버 환경 변수를 위한 네임스페이스
         * @namespace
         */
        server: {
            /**
             * 서버 환경 변수를 서버에서 로드합니다.
             */
            loadServerVariables: function () {
                var url;

                if (dews._environments.useServerVariables) {
                    url = dews._environments.serverVariableServiceURL || dews.server._defaultServerVariableServiceURL;

                    dews.log('## 서버 환경 변수 로드 URL : ' + url + ' ##');

                    dews.ajax.data(url, { async: false }).done(function (data) {
                        dews.log('## 서버 환경 변수 로드 성공 ##');
                        dews.log(JSON.stringify(data));
                        // 서버 환경 변수 설정
                        dews.server.setServerVariables(data);
                    }).fail(function (jqXHR) {
                        dews.log('## 서버 환경 변수 로드 실패: \n' + JSON.stringify(jqXHR));
                    });
                }
            }
        },
        /**
         * 현재 프레임이 메인 프레임인지 여부를 반환합니다.
         * @returns {boolean} 메인 프레임인지 여부
         */
        isMainFrame: function () {
            return dews._environments.mainFrame || false;
        },
        /**
         * 현재 프레임을 메인 프레임으로 설정합니다.
         */
        setMainFrame: function () {
            dews._environments.mainFrame = true;
        },
        /**
         * 메인 프레임의 window 객체를 가져옵니다.
         * @param {object} currentWindow 현재 프레임의 window 객체
         * @returns {object} dews 메인 프레임의 window 객체
         */
        getMainFrameWindowObject: function (currentWindow) {
            if (currentWindow.dews && currentWindow.dews.isMainFrame()) {
                return currentWindow;
            } else if (currentWindow !== window.top) {
                return dews.getMainFrameWindowObject(currentWindow.parent); // 메인 프레임이 아니고 부모 프레임이 존재하면 부모 프레임을 검사
            } else {
                return currentWindow; // 어떤 프레임도 메인 프레임이 아닐 경우 현재 프레임 객체를 메인 프레임으로 반환
            }
        }
    });

    $(window).on('load', function () {
        // 서버 환경 변수 로드를 위한 함수 실행
        dews.server.loadServerVariables();

        // 컨트롤 초기화를 위한 이벤트를 발생시킵니다.
        $(document).trigger('inituicontrols');
        dews.log('## DEWS Controls: inituicontrols 이벤트 - 발생 ##');
    });

    $(window).on('langchange', function (e, lang) {
        var kendoUrl;

        // 표시 언어가 변경될 때
        kendo.culture(lang);

        kendoUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', 'kendo/');

        if (lang) {
            kendo.culture(lang);
            // $.getScript 로 수행할 경우 cache 를 활용하지 않으므로 직접 ajax 요청
            $.ajax({
                type: 'GET',
                url: dews.url.getAbsoluteUrl(dews.url.join(kendoUrl, 'cultures/kendo.culture.' + lang + '.min.js')),
                cache: true,
                dataType: 'script'
            }).done(function () {
                kendo.culture(lang);
            });
        }
    });

    $(document).ready(function () {
        dews.log('## document ready 실행 ##');
    });

    $(document).on('inituicontrols', function (e, target, dialog) {
        var inits = [],
            containerName = '',
            context = null,
            callPreReadies = function (context) {
                // dews.preReadies 배열에 등록된 함수들을 모두 실행합니다.
                if (context && $.isArray(dews.preReadies) && dews.preReadies.length > 0) {
                    $.each(dews.preReadies, function(idx, item) {
                        try {
                            item.call(context);
                        } catch (e) {
                            console.log(e);
                        }
                    });
                }
            };

        if (target instanceof  jQuery && target.length > 0) {
            containerName = (target.attr('id') || target.get(0).tagName) + ' - ';
        } else if (typeof target === 'string') {
            containerName = target + ' - ';
        }

        dews.log('## DEWS Controls: inituicontrols 이벤트 - ' + containerName + '시작 ##');

        for (var i = 0; i < initializers.length; i++) {
            inits.push(initializers[i](target));
        }

        // jQuery when을 이용해서 컨트롤들이 모두 초기화 된 후 ready를 실행할 수 있도록 한다.
        $.when.apply(null, inits).done(function () {
            if (dialog) { // 전달된 파라미터 매개변수가 있을 경우에는 다이얼로그
                context = dialog;

                // 컨텍스트의 인스턴스에 컨트롤 ID 이름과 동일한 속성을 제공한다.
                if (dews.ui.page && $.isFunction(dews.ui.page.makeDialogProperties)) {
                    var $target = $(target);
                    if ($target.length > 0) {
                        dews.ui.page.makeDialogProperties(context, $('*[class^=dews-][id]', $target));
                    }
                }

                // dews.preReadies 에 등록된 함수를 모두 실행한다.
                callPreReadies(context);

            } else if (dews.ui.hasOwnProperty('page') && dews.ui.page) {
                // Page Tab이 있을 경우에는 dews.ready의 this를 Page Tab 인스턴스로 설정
                context = dews.ui.page;

                // 컨텍스트의 인스턴스에 컨트롤 ID 이름과 동일한 속성을 제공한다.
                if (context && $.isFunction(context.makeProperties) &&
                    target instanceof jQuery && target.hasClass('tab-page'))
                {
                    context.makeProperties($('*[class^=dews-][id]', target));
                }

                // dews.preReadies 에 등록된 함수를 모두 실행한다.
                callPreReadies(context);
            }

            dews.log('## DEWS Controls: dews.ready - ' + containerName + '실행 ##');
            for (var i = 0; i < readies.length; i++) {
                readies[i].call(context, target);
            }

            // grid, treeview, cardlist 포커서블 셋팅
            setDataControlFocus();

            readies = [];
        });

        dews.log('## DEWS Controls: inituicontrols 이벤트 - ' + containerName + '종료 ##');
    });

    // kendo ui Calender 버그 수정
    (function () {
        var monthView, i;

        if ($.type(kendo.calendar.views) === 'array') {
            for (i = 0; i < kendo.calendar.views.length; i++) {
                if (kendo.calendar.views[i].name === 'month') {
                    monthView = kendo.calendar.views[i];
                    break;
                }
            }

            if (monthView) {
                monthView.title = function (date, min, max, culture) {
                    return kendo.toString(date, "Y", culture);
                };
            }
        }

    })();


    /*
     * 컨트롤 생성시 사용하는 유틸리티 함수
     */
    $.extend(true, dews.ui, {
        util: {
            /**
             * 컨트롤에 readonly, disabled 등의 속성과 클래스명을 매치시킨다.
             * @param {jQuery} $el 컨트롤의 jQuery 객체
             */
            ConvertClassAndProperty: function ($el) {
                if ($el.hasClass('readonly') && !$el.prop('readonly')) {
                    $el.prop('readonly', true);
                } else if ($el.prop('readonly') && !$el.hasClass('readonly')) {
                    $el.addClass('readonly');
                }

                if ($el.hasClass('disabled') && !$el.prop('disabled')) {
                    $el.prop('disabled', true);
                } else if ($el.prop('disabled') && !$el.hasClass('disabled')) {
                    $el.addClass('disabled');
                }
            }
        }
    });

    /*
    *  그리드, 카드리스트, 트리뷰 focus 관련 함수 설정
    */
    function setDataControlFocus () {
        var $content;

        if (dews.ui.dialogPage) {
            $content = dews.ui.dialogPage.$content;
        } else if (dews.ui.page) {
            $content = dews.ui.page.$content;
        } else {
            $content = $(document);
        }

        $content.find('.dews-data-control').each(function (idx, target) {
            var $item = $(target),
                dewsObj = $item.data('dews-control');

            if (idx === 0) {
                dewsObj.focused = true;

                if (!$item.hasClass('dews-ui-treeview')) {
                    dewsObj.setFocus();
                }
            } else {
                dewsObj.focused = false;

                if ($.type(dewsObj._grid) !== 'undefined') {
                    dewsObj._grid.setDisplayOptions({'focusVisible': false});
                }
            }

            dewsObj.on('click', function () {
               removeDataControlFocus(this);
               dewsObj.focused = true;

                if ($.type(dewsObj._grid) !== 'undefined') {
                    dewsObj._grid.setDisplayOptions({'focusVisible': true});
                }
            });
        });
    }

    function removeDataControlFocus (item) {
        var $content;

        if ($(item).closest('.dews-ui-dialog').length !== 0) {
            $content = $(item).closest('.dews-ui-dialog');
        } else if (dews.ui.page) {
            $content = dews.ui.page.$content;
        } else {
            $content = $(document);
        }

        $content.find('.dews-data-control').each(function (idx, target) {
            var $item = $(target),
                dewsObj = $item.data('dews-control');

            dewsObj.focused = false;

            if ($.type(dewsObj._grid) !== 'undefined') {
                dewsObj._grid.setDisplayOptions({'focusVisible': false});
            }
        });
    }


    // jQuery 확장
    /**
     * 내부 HTML 내의 공백 문자를 제거합니다.
     * @returns {jQuery}
     */
    $.fn.htmlClean = function() {
        this.contents().filter(function() {
            if (this.nodeType != 3) {
                $(this).htmlClean();
                return false;
            }
            else {
                this.textContent = $.trim(this.textContent);
                return !/\S/.test(this.nodeValue);
            }
        }).remove();
        return this;
    };
})(jQuery, window.dews, window.kendo);


/**
 * 일반 DOM 요소에 다국어 적용
 */
(function ($, dews) {

    // 인라인 옵션을 가져옵니다.
    function getInlineOptions($el, codeOptions) {
        var inlineOptions = {};

        // 태그에 포함된 옵션을 가져옵니다.
        if ($el.data('dews-localize-lang')) {
            inlineOptions.lang = $el.data('dews-localize-lang');
        }
        if ($el.data('dews-localize-key')) {
            inlineOptions.key = $el.data('dews-localize-key');
            inlineOptions.alternative = $el.text();
        }

        return inlineOptions;
    }

    // 다국어 처리를 수행합니다.
    function render(self) {
        if (!self.$element.hasClass('dews-ui-multilingual')) {
            self.$element.addClass('dews-ui-multilingual');
        }

        if (self.key && self.alternative) {
            var localized = dews.localize.get(self.alternative, self.key, self.lang);
            self.$element.text(localized);
        }

        if (!self.$element.hasClass('dews-control-activate')) {
            self.$element.addClass('dews-control-activate');
        }
    }

    var Multilingual = function ($element, opt) {
        var self = this;
        self.$element = $element;

        var options = opt ? opt : getInlineOptions(self.$element);

        self._lang = options.lang;
        self._key = options.key;
        self._alternative = options.alternative;

        Object.defineProperties(self, {
            'options': {
                get: function() {
                    return options;
                }
            },
            'lang': {
                get: function() { return self._lang; },
                set: function(val) {
                    self._lang = val;
                    render(self);
                }
            },
            'key': {
                get: function() { return self._key; },
                set: function(val) {
                    self._key = val;
                    render(self);
                }
            },
            'alternative': {
                get: function() { return self._alternative; },
                set: function(val) {
                    self._alternative = val;
                    render(self);
                }
            },
            'text': {
                get: function() {
                    return self.$element.text();
                }
            }
        });

        render(self);
    };

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 다국어 지원 요소로 변경하거나 가져옵니다.
             * @param {string|jQuery} selector 다국어 지원요소로 만들 셀렉터 또는 jQuery 객체
             * @param {object} options 다국어 옵션
             */
            multilingual : function (selector, options) {
                var $el, label;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control;

                    control = $this.data('dews-control');

                    if (!control) {
                        control = new Multilingual($this);
                        $this.data('dews-control', control);
                    }

                    label = control;
                });

                return label;
            }
        }
    });

    dews.ui.addControlInitializer('multilingual', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.multilingual($('.dews-ui-multilingual', $container));
    });

})(jQuery, window.dews, window.kendo);


/*
컴포넌트에 공통 포맷 적용하는 함수
 */
(function ($, dews) {
    $.extend(true, dews, {
        getPreDefinedFormat: function ($el) {
            var formatAlias,
                page = dews.ui.page;

            if ($el instanceof jQuery) {
                if (typeof $el.data('dews-format-predefined') !== 'undefined') {
                    if ($el.data('dews-format-predefined') === true) {
                        formatAlias = $el.data('dews-format') ? $el.data('dews-format') : $el.data('dews-mask');

                        return getFormat(formatAlias);
                    }
                }
            } else {
                if ($.type($el.predefined) === 'boolean') {
                    if ($el.predefined) {
                        formatAlias = $el.preFormat;
                    }

                    return getFormat(formatAlias);
                }
            }

            function getFormat(formatAlias) {
                if (page && page.env) {
                    if (page.env.hasOwnProperty(formatAlias)) {
                        for (var property in page.env) {
                            var obj = page.env[property];

                            if (obj && property === formatAlias) {
                                if (obj.format) {
                                    return obj.format;
                                }
                            }
                        }
                    } else {
                        return false;
                    }
                }
            }
        }
    });
})(jQuery, window.dews);


window.daum = window.daum || {},
    function(a) {
        function b() {
            for (var a = 0, b = l.length; b > a; a++) document.write('<script charset="UTF-8" type="text/javascript" src="' + (i + l[a]) + '"></script>');
            h = 2
        }

        function c() {
            for (var a = 0, b = l.length; b > a; a++) {
                var c = document.createElement("script");
                n[l[a]] = !1, c.type = "text/javascript", c.charset = "utf-8", c.src = i + l[a], c.onload = function() {
                    var b = l[a];
                    return function() {
                        var a = b;
                        n[a] || (n[a] = !0), e() && f()
                    }
                }(), c.onreadystatechange = function() {
                    var b = l[a];
                    return function() {
                        /loaded|complete/.test(this.readyState) && (n[b] || (n[b] = !0), e() && f())
                    }
                }(), document.getElementsByTagName("head")[0].appendChild(c)
            }
        }

        function d(a) {
            var b = {};
            return a.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(a, c, d) {
                b[c] = d
            }), b
        }

        function e() {
            for (var a = 0, b = 0, c = l.length; c > b; b++) n[l[b]] && a++;
            return a === l.length ? !0 : !1
        }

        function f() {
            for (h = 2; g[0];) g.shift()()
        }
        a.postcode = {};
        var g = [],
            h = 0,
            i = "https:" == location.protocol ? "https:" : "http:",
            j = document.getElementsByTagName("script"),
            k = j[j.length - 1].src;
        j = null;
        var l = ["//s1.daumcdn.net/svc/attach/U03/cssjs/postcode/1495012223804/170517.js"];
        if (/\/map_js_init\/postcode.v2(\.dev){0,1}(\.update){0,1}\.js\b/.test(k)) {
            var m = d(k);
            "false" !== m.autoload && (b(), h = 2)
        }
        var n = {};
        a.postcode.version = "170517", a.postcode.load = function(a) {
            if (a && "function" == typeof a) switch (g.push(a), h) {
                case 0:
                    h = 1, c();
                    break;
                case 2:
                    f()
            }
        }
    }(window.daum);

(function() { /*VERSION:170517*/
    "object" != typeof JSON && (JSON = {}),
        function() {
            "use strict";

            function f(a) {
                return 10 > a ? "0" + a : a
            }

            function this_value() {
                return this.valueOf()
            }

            function quote(a) {
                return escapable.lastIndex = 0, escapable.test(a) ? '"' + a.replace(escapable, function(a) {
                        var b = meta[a];
                        return "string" == typeof b ? b : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                    }) + '"' : '"' + a + '"'
            }

            function str(a, b) {
                var c, d, e, f, g, h = gap,
                    i = b[a];
                switch (i && "object" == typeof i && "function" == typeof i.toJSON && (i = i.toJSON(a)), "function" == typeof rep && (i = rep.call(b, a, i)), typeof i) {
                    case "string":
                        return quote(i);
                    case "number":
                        return isFinite(i) ? String(i) : "null";
                    case "boolean":
                    case "null":
                        return String(i);
                    case "object":
                        if (!i) return "null";
                        if (gap += indent, g = [], "[object Array]" === Object.prototype.toString.apply(i)) {
                            for (f = i.length, c = 0; f > c; c += 1) g[c] = str(c, i) || "null";
                            return e = 0 === g.length ? "[]" : gap ? "[\n" + gap + g.join(",\n" + gap) + "\n" + h + "]" : "[" + g.join(",") + "]", gap = h, e
                        }
                        if (rep && "object" == typeof rep)
                            for (f = rep.length, c = 0; f > c; c += 1) "string" == typeof rep[c] && (d = rep[c], e = str(d, i), e && g.push(quote(d) + (gap ? ": " : ":") + e));
                        else
                            for (d in i) Object.prototype.hasOwnProperty.call(i, d) && (e = str(d, i), e && g.push(quote(d) + (gap ? ": " : ":") + e));
                        return e = 0 === g.length ? "{}" : gap ? "{\n" + gap + g.join(",\n" + gap) + "\n" + h + "}" : "{" + g.join(",") + "}", gap = h, e
                }
            }
            "function" != typeof Date.prototype.toJSON && (Date.prototype.toJSON = function() {
                return isFinite(this.valueOf()) ? this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z" : null
            }, Boolean.prototype.toJSON = this_value, Number.prototype.toJSON = this_value, String.prototype.toJSON = this_value);
            var cx, escapable, gap, indent, meta, rep;
            "function" != typeof JSON.stringify && (escapable = /[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, meta = {
                "\b": "\\b",
                "	": "\\t",
                "\n": "\\n",
                "\f": "\\f",
                "\r": "\\r",
                '"': '\\"',
                "\\": "\\\\"
            }, JSON.stringify = function(a, b, c) {
                var d;
                if (gap = "", indent = "", "number" == typeof c)
                    for (d = 0; c > d; d += 1) indent += " ";
                else "string" == typeof c && (indent = c);
                if (rep = b, b && "function" != typeof b && ("object" != typeof b || "number" != typeof b.length)) throw new Error("JSON.stringify");
                return str("", {
                    "": a
                })
            }), "function" != typeof JSON.parse && (cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g, JSON.parse = function(text, reviver) {
                function walk(a, b) {
                    var c, d, e = a[b];
                    if (e && "object" == typeof e)
                        for (c in e) Object.prototype.hasOwnProperty.call(e, c) && (d = walk(e, c), void 0 !== d ? e[c] = d : delete e[c]);
                    return reviver.call(a, b, e)
                }
                var j;
                if (text = String(text), cx.lastIndex = 0, cx.test(text) && (text = text.replace(cx, function(a) {
                        return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                    })), /^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) return j = eval("(" + text + ")"), "function" == typeof reviver ? walk({
                    "": j
                }, "") : j;
                throw new SyntaxError("JSON.parse")
            })
        }();
    var postcodeUtils = {};
    postcodeUtils.param = function(a) {
        var b, c = {};
        if ("" === a[0]) return c;
        for (var d = 0, e = a.length; e > d; d++) {
            b = a[d];
            var f = b.indexOf("="),
                g = [];
            g[0] = b.slice(0, f), g[1] = b.slice(f + 1, b.length);
            try {
                c[g[0]] = decodeURIComponent(g[1].replace(/\+/g, " "))
            } catch (h) {
                c[g[0]] = g[1].replace(/\+/g, " ")
            }
        }
        return c
    }(window.location.search.substr(1).split("&")), postcodeUtils.extend = function() {
        if (0 === arguments.length) return null;
        var a = Array.prototype.slice.call(arguments),
            b = a.shift(),
            c = a.slice(0);
        if (c.length >= 1)
            for (var d = 0, e = c.length; e > d; d++) {
                var f = c[d];
                for (var g in f) f.hasOwnProperty(g) && (b[g] = f[g])
            }
        return b
    }, postcodeUtils.isArray = function(a) {
        var b = window.jQuery;
        if (a) {
            var c = Object.prototype.toString.call(a).toLowerCase();
            if ("[object array]" === c || "[object nodelist]" === c || "[object htmlcollection]" === c || b && a instanceof b) return !0
        }
        return !1
    }, postcodeUtils.trim = function(a) {
        var b = /\s*((\S+\s*)*)/,
            c = /((\s*\S+)*)\s*/;
        return a.replace(b, "$1").replace(c, "$1")
    }, postcodeUtils.isUndefined = function(a) {
        return void 0 === a ? !0 : !1
    }, postcodeUtils.isNull = function(a) {
        return null === a ? !0 : !1
    }, postcodeUtils.isAvailable = function(a) {
        return postcodeUtils.isUndefined(a) || postcodeUtils.isNull(a) || "" === postcodeUtils.trim(a) ? !1 : !0
    }, postcodeUtils.event = {
        isTouch: "ontouchstart" in window ? !0 : !1,
        on: function(a, b, c) {
            a && a.addEventListener ? a.addEventListener(b, c, !1) : a && a.attachEvent ? a.attachEvent("on" + b, c) : a && (a["on" + b] = c)
        },
        off: function(a, b, c) {
            a && a.removeEventListener ? a.removeEventListener(b, c, !1) : a && a.detachEvent ? a.detachEvent("on" + b, c) : a && (a["on" + b] = null)
        },
        preventDefault: function(a) {
            a.preventDefault ? a.preventDefault() : a.returnValue = !1
        },
        stopPropagation: function(a) {
            a.stopPropagation ? a.stopPropagation() : a.cancelBubble = !0
        },
        onTouch: function(a, b) {
            var c = b ? b.start : null,
                d = b ? b.move : null,
                e = b ? b.end : null,
                f = !1,
                g = !1,
                h = this,
                i = -1,
                j = -1,
                k = 10;
            a && (this.on(a, "touchstart", function(a) {
                h.stopPropagation(a);
                var b = a.changedTouches && a.changedTouches[0] || a.touches && a.touches[0] || null;
                i = b && b.pageX, j = b && b.pageY, f = !0, c && "function" == typeof c && c(a)
            }), this.on(a, "touchmove", function(a) {
                h.stopPropagation(a);
                var b = a.changedTouches && a.changedTouches[0] || a.touches && a.touches[0] || null,
                    c = b && b.pageX,
                    e = b && b.pageY,
                    f = Math.abs(i - c),
                    l = Math.abs(j - e);
                (f >= k || l >= k) && (g = !0, d && "function" == typeof d && d(a))
            }), this.on(a, "touchend", function(a) {
                h.stopPropagation(a), f && !g ? (f = !1, e && "function" == typeof e && e(a)) : (f = !1, g = !1)
            }))
        }
    }, postcodeUtils.userAgent = function(a) {
        function b(a) {
            var b = {},
                d = /(dolfin)[ \/]([\w.]+)/.exec(a) || /(chrome)[ \/]([\w.]+)/.exec(a) || /(webkit)(?:.*version)?[ \/]([\w.]+)/.exec(a) || /(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a) || /(msie) ([\w.]+)/.exec(a) || a.indexOf("compatible") < 0 && /(mozilla)(?:.*? rv:([\w.]+))?.*firefox/.exec(a) || /(rv):([\w.]+)/.exec(a) || ["", "unknown"];
            return "webkit" === d[1] ? d = /(iphone|ipad|ipod)[\S\s]*os ([\w._\-]+) like/.exec(a) || /(android)[ \/]([\w._\-]+);/.exec(a) || [d[0], "safari", d[2]] : "mozilla" === d[1] ? d[1] = "firefox" : /polaris|natebrowser|([010|011|016|017|018|019]{3}\d{3,4}\d{4}$)/.test(a) ? d[1] = "polaris" : "rv" === d[1] && (d[1] = "msie"), b[d[1]] = !0, b.name = d[1], b.version = c(d[2]), b
        }

        function c(a) {
            var b = {},
                c = a ? a.split(/\.|-|_/) : ["0", "0", "0"];
            return b.info = c.join("."), b.major = c[0] || "0", b.minor = c[1] || "0", b.patch = c[2] || "0", b
        }

        function d(a) {
            var b = {},
                c = (/android/.test(a) ? "android" : !1) || (/like mac os x./.test(a) ? "ios" : !1) || (/(mac os)/.test(a) ? "mac" : !1) || (/polaris|natebrowser|([010|011|016|017|018|019]{3}\d{3,4}\d{4}$)/.test(a) ? "polaris" : !1) || (/(windows)/.test(a) ? "windows" : !1) || (/(linux)/.test(a) ? "linux" : !1) || (/webos/.test(a) ? "webos" : !1) || (/bada/.test(a) ? "bada" : !1) || (/(rim|blackberry)/.test(a) ? "blackberry" : !1) || "unknown";
            return b[c] = !0, b.name = c, b
        }
        var e = a.navigator.userAgent.toString().toLowerCase();
        return {
            ua_string: e,
            browser: b(e),
            os: d(e)
        }
    }(window), postcodeUtils.hasErrorInDefaultBrowser = function(a) {
        for (var b = ["lg-f5", "lg-f4", "lg-f3", "d6503"], c = !1, d = 0, e = b.length; e > d; d++)
            if (a.indexOf(b[d]) > -1) {
                c = !0;
                break
            }
        return c
    }, postcodeUtils.isAndroidWebview = function(a) {
        for (var b = ["version/"], c = !1, d = 0, e = b.length; e > d; d++)
            if (a.indexOf(b[d]) > -1) {
                c = !0;
                break
            }
        return c
    }, postcodeUtils.isAndroidNaverWebview = function(a) {
        for (var b = ["naver(inapp;"], c = !1, d = 0, e = b.length; e > d; d++)
            if (a.indexOf(b[d]) > -1) {
                c = !0;
                break
            }
        return c
    }, postcodeUtils.isIOSWebview = function(a) {
        for (var b = ["version/7", "version/8", "version/9", "version/10"], c = 0, d = 0, e = b.length; e > d; d++) - 1 === a.indexOf(b[d]) && c++;
        return c === b.length
    }, postcodeUtils.isDaumapps = function(a) {
        for (var b = ["daumapps"], c = 0, d = 0, e = b.length; e > d; d++) a.indexOf(b[d]) > -1 && c++;
        return c === b.length
    }, postcodeUtils.isMobileChrome = function(a) {
        for (var b = ["crios", "chrome"], c = 0, d = 0, e = b.length; e > d; d++) a.indexOf(b[d]) > -1 && c++;
        return c > 0
    }, postcodeUtils.encodeData = function(a) {
        var b = "";
        for (var c in a) a.hasOwnProperty(c) && (b += c + "=" + encodeURIComponent(a[c]) + "|");
        return b = b.slice(0, b.length - 1)
    }, postcodeUtils.decodeData = function(a) {
        if (a && "string" == typeof a) {
            for (var b = {}, c = a.split("|"), d = 0; d < c.length; d++) {
                var e = c[d].split("=");
                b[e[0]] = decodeURIComponent(e[1])
            }
            return b
        }
        return null
    }, postcodeUtils.getStringByOptions = function(a, b, c) {
        var d = "";
        for (var e in a) a.hasOwnProperty(e) && (d += e + b + a[e], d += c);
        return d = d.slice(0, d.length - 1)
    }, postcodeUtils.returnEmptyString = function(a) {
        return void 0 === a || null === a ? "" : a
    }, postcodeUtils.isHex = function(a) {
        var b = !1;
        if (a) {
            var c = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
            a = a.replace(c, function(a, b, c, d) {
                return b + b + c + c + d + d
            }), b = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.test(a)
        }
        return b
    }, postcodeUtils.themeStringify = function(a) {
        var b = "-",
            c = ".",
            d = "_",
            e = "";
        try {
            if (a) {
                for (var f in a)
                    if (a.hasOwnProperty(f)) {
                        e += f;
                        var g = a[f];
                        for (var h in g)
                            if (g.hasOwnProperty(h)) {
                                var i = g[h],
                                    j = h + d + i.substr(1);
                                e += c + j
                            }
                        e += b
                    }
                return e = e.substr(0, e.length - 1), encodeURIComponent(e)
            }
        } catch (k) {
            return ""
        }
        return ""
    }, postcodeUtils.themeParse = function(a) {
        var b = "-",
            c = ".",
            d = "_",
            e = {};
        try {
            if (a) {
                a = decodeURIComponent(a);
                for (var f = a.split(b), g = 0, h = f.length; h > g; g++) {
                    var i = f[g].split(c),
                        j = i[0];
                    i = i.slice(1), e[j] = {};
                    for (var k = 0, l = i.length; l > k; k++) {
                        var m = i[k].split(d);
                        e[j][m[0]] = "#" + m[1]
                    }
                }
                return e
            }
        } catch (n) {
            return null
        }
        return null
    };
    var v2 = v2 || {};
    ! function(a, b, c, d, e) {
        var f = b,
            g = f.userAgent;
        a.CONT = {
            MIN_WIDTH: 300,
            MIN_HEIGHT: 400,
            DEFAULT_WIDTH: 500,
            DEFAULT_HEIGHT: 500,
            ID_PREFIX: "__daum__",
            EMPTY_FUNCTION: function() {},
            PROTOCOL: "https:" == e.protocol ? "https:" : "http:",
            FRAME_POPUP: "popup",
            FRAME_LAYER: "layer",
            POPUP_CLOSE_STATE: {
                COMPLETE: "COMPLETE_CLOSE",
                FORCE: "FORCE_CLOSE"
            }
        }, a.MODEL = {
            VIEWER_COUNT: 0,
            ID_MAP: {},
            TARGET_MAP: {},
            POPUP_MAP: {}
        }, a.viewUtils = function() {
            function b(a, b, d, e, f, h) {
                "msie" !== g.browser.name || 7 !== parseInt(g.browser.version.major, 10) || c.postMessage ? "msie" !== g.browser.name || 6 !== parseInt(g.browser.version.major, 10) || c.postMessage || (h += 60, a.document.getElementById(e).style.height = h - 4 + "px", a.document.getElementById(e).style.width = b.offsetWidth - 4 + "px", b.style.height = h + "px", d.style.height = h + "px") : (a.document.getElementById(e).style.height = h - 4 + "px", a.document.getElementById(e).style.width = b.offsetWidth - 4 + "px", b.style.height = h + "px", d.style.height = h + "px")
            }

            function e(a, b, c) {
                var d = !1;
                if (a && !isNaN(a)) a = parseInt(a, 10) < c ? c : parseInt(a, 10);
                else if (a && "string" == typeof a)
                    if (/^\d+%$/.test(a)) d = !0;
                    else if (/^\d+px$/.test(a)) {
                        d = !1;
                        var e = parseInt(a.replace(/^(\d+)px$/, function(a, b, c) {
                            return b
                        }), 10);
                        a = c > e ? c : e
                    } else a = b;
                else a = b;
                return {
                    value: a,
                    isFlexible: d
                }
            }

            function h(a) {
                if (a) {
                    var b = {
                        margin: 0,
                        padding: 0,
                        height: "100%",
                        width: "100%"
                    };
                    f.event.isTouch ? b["-webkit-overflow-scrolling"] = "touch" : b.overflow = "hidden", a.style.cssText = f.getStringByOptions(b, ":", ";")
                }
            }

            function i(a) {
                if (a) {
                    var b = {
                        margin: 0,
                        padding: 0,
                        height: "100%"
                    };
                    f.event.isTouch ? b["-webkit-overflow-scrolling"] = "touch" : b.overflow = "hidden", a.style.cssText = f.getStringByOptions(b, ":", ";"), a.setAttribute && a.setAttribute("lang", "ko")
                }
            }

            function j(a, b) {
                if (b) {
                    var c = null;
                    for (var e in q.TARGET_MAP)
                        if (a === q.TARGET_MAP[e]) {
                            c = e;
                            break
                        }
                    c && k(a, d.getElementById(c)), a ? (a.appendChild(b), q.TARGET_MAP[b.id] = a) : (d.body.appendChild(b), q.TARGET_MAP[b.id] = d.body)
                }
            }

            function k(a, b) {
                b && (a ? q.TARGET_MAP[b.id] === a && (a.removeChild(b), q.TARGET_MAP[b.id] = null) : (d.body.removeChild(b), q.TARGET_MAP[b.id] = null))
            }

            function l(a, b, c) {
                var d = "",
                    e = 2e3,
                    f = a + c;
                return f.length > e ? (f = a + b, d = f.length > e ? a : f) : d = f, d
            }

            function m(a, b) {
                n(a, b) || (q.POPUP_MAP[a] || (q.POPUP_MAP[a] = []), q.POPUP_MAP[a].push({
                    ref: b,
                    data: {
                        closeCallbackTimer: -1
                    }
                }))
            }

            function n(a, b) {
                if (q.POPUP_MAP[a])
                    for (var c = q.POPUP_MAP[a], d = 0, e = c.length; e > d; d++)
                        if (b === c[d].ref) return !0;
                return !1
            }

            function o(a) {
                for (var b in q.POPUP_MAP)
                    if (q.POPUP_MAP.hasOwnProperty(b))
                        for (var c = q.POPUP_MAP[b], d = 0, e = c.length; e > d; d++)
                            if (a === c[d].ref) return c[d];
                return null
            }

            function p(a) {
                var b = "msie" === f.userAgent.browser.name && 7 === parseInt(f.userAgent.browser.version.major, 10) || "msie" === f.userAgent.browser.name && 10 === parseInt(f.userAgent.browser.version.major, 10);
                if (b) try {
                    var c = d.createElement("input");
                    c.style.cssText = "width:1px;height:1px;opacity:0;", a.document.body.appendChild(c), c.focus()
                } catch (e) {}
            }
            var q = a.MODEL;
            return {
                append: j,
                remove: k,
                setPopupMap: m,
                getPopupMap: o,
                setFrameStyle: function(a, b) {
                    i(a), h(b)
                },
                adjustLowIE: b,
                getNormalizeSize: e,
                getValidationUrl: l,
                IE11CompatibleBugFix: p
            }
        }(), a.common = function() {
            function b(a) {
                var b = {},
                    c = "done" === a.action ? !0 : !1;
                for (var d in a) a.hasOwnProperty(d) && "action" !== d && (c ? b[d] = a[d] : b[d] = isNaN(a[d]) ? a[d] : parseInt(a[d], 10));
                return b
            }

            function d(a, b) {
                var c = a + "_" + b,
                    d = h.ID_PREFIX + a + "_" + b;
                return i.ID_MAP[c] = d, d
            }

            function e(a, b) {
                var c = a + "_" + b;
                return i.ID_MAP[c]
            }

            function g(a, d, e) {
                !c.postMessage || "function" != typeof c.postMessage && "object" != typeof c.postMessage ? (a.name = "", clearInterval(e.timer), e.timer = setInterval(function() {
                    try {
                        if ("" !== a.name) {
                            var c = a.name,
                                g = f.decodeData(c),
                                i = g.action,
                                j = b(g);
                            d(i, j), a.name = "", "done" === i && e.autoClose && e.onComplete !== h.EMPTY_FUNCTION && (clearInterval(e.timer), e.timer = null)
                        }
                    } catch (k) {
                        clearInterval(e.timer)
                    }
                }, 200)) : (a.customMessageHandler && f.event.off(a, "message", a.customMessageHandler), a.customMessageHandler = function(c) {
                    var g = c.data,
                        i = f.decodeData(g),
                        j = i.action,
                        k = b(i);
                    d(j, k), "done" === j && e.autoClose && e.onComplete !== h.EMPTY_FUNCTION && f.event.off(a, "message", a.customMessageHandler)
                }, f.event.on(a, "message", a.customMessageHandler))
            }
            var h = a.CONT,
                i = a.MODEL;
            return {
                setReady: g,
                setId: d,
                getId: e
            }
        }()
    }(v2, postcodeUtils, window, document, location);
    var v2 = v2 || {};
    ! function(a, b, c, d, e) {
        var f = b,
            g = a.CONT,
            h = a.viewUtils,
            i = a.MODEL,
            j = a.common;
        a.frame = function() {
            function a(a) {
                var b = {
                        border: "0 none",
                        margin: "0",
                        width: "100%",
                        height: "100%",
                        "min-width": "300px",
                        overflow: "hidden",
                        padding: "0"
                    },
                    c = {
                        indaum: a.indaum ? "on" : "off",
                        banner: a.banner ? "on" : "off",
                        mode: a.isViewerMode ? "view" : "transmit",
                        vt: a.viewType,
                        am: a.autoMapping ? "on" : "off",
                        ani: a.animation ? "on" : "off",
                        sd: a.shorthand ? "on" : "off",
                        plrg: 0 === a.pleaseReadGuide ? "" : a.pleaseReadGuide,
                        plrgt: a.pleaseReadGuideTimer,
                        hmb: a.hideMapBtn ? "on" : "off",
                        heb: a.hideEngBtn ? "on" : "off",
                        smh: a.showMoreHName ? "on" : "off",
                        us: a.useSuggest ? "on" : "off",
                        msi: a.maxSuggestItems,
                        ahs: a.autoHiddenSuggest ? "on" : "off",
                        whas: a.windowHeightAvailableForSuggest
                    };
                a.userQuery && (c.userQuery = a.userQuery, c.cq = a.cq), a.region_name && (c.region_name = a.region_name, c.cq = a.cq, c.intsh = a.intsh), a.theme && "" !== a.theme.themeStr && (c.theme = a.theme.themeStr, c.sit = a.theme.sit, c.sgit = a.theme.sgit, c.sbit = a.theme.sbit, c.pit = a.theme.pit, c.mit = a.theme.mit, c.lcit = a.theme.lcit), a.allAddr ? c.zn = "N" : c.zn = "Y";
                var d = q + "&" + f.getStringByOptions(c, "=", "&"),
                    e = "&" + f.getStringByOptions({
                            fullpath: r
                        }, "=", "&"),
                    g = "&" + f.getStringByOptions({
                            fullpath: r + s
                        }, "=", "&"),
                    i = '<iframe frameborder="0" title="우편번호검색프레임" id="' + j.setId("viewerFrame", a.viewerNo) + '" src="' + h.getValidationUrl(d, e, g) + '" style="' + f.getStringByOptions(b, ":", ";") + '"></iframe>';
                return i
            }

            function b(a) {
                var b = d.createElement("div"),
                    c = null;
                return c = f.userAgent.os.ios && f.isIOSWebview(f.userAgent.ua_string) ? {
                    width: a.isFlexibleWidth ? a.width : a.width + "px",
                    height: a.isFlexibleHeight ? a.height : a.height + "px",
                    "background-color": "#fff",
                    "z-index": "0",
                    "overflow-x": "hidden",
                    "overflow-y": "auto",
                    "min-width": "300px",
                    margin: "0",
                    padding: "0"
                } : {
                    position: "relative",
                    width: a.isFlexibleWidth ? a.width : a.width + "px",
                    height: a.isFlexibleHeight ? a.height : a.height + "px",
                    "background-color": "#fff",
                    "z-index": "0",
                    "overflow-x": "hidden",
                    "overflow-y": "auto",
                    "min-width": "300px",
                    margin: "0",
                    padding: "0"
                }, b.style.cssText = f.getStringByOptions(c, ":", ";"), b
            }

            function e() {
                var a = d.createElement("iframe"),
                    b = null;
                return b = f.userAgent.os.ios && f.isIOSWebview(f.userAgent.ua_string) ? {
                    width: "100%",
                    height: "100%",
                    border: "0 none",
                    margin: "0",
                    padding: "0",
                    overflow: "hidden",
                    "min-width": "300px"
                } : {
                    position: "absolute",
                    left: "0",
                    top: "0",
                    width: "100%",
                    height: "100%",
                    border: "0 none",
                    margin: "0",
                    padding: "0",
                    overflow: "hidden",
                    "min-width": "300px"
                }, a.setAttribute("frameborder", "0"), a.style.cssText = f.getStringByOptions(b, ":", ";"), a
            }

            function k(a, c) {
                if (null === q) return alert("POPUP URL을 셋팅해 주세요.");
                var d = b(a),
                    g = e();
                return d.id = j.setId("layer", a.viewerNo), g.src = "about:blank", d.appendChild(g), h.append(c, d), f.userAgent.os.android && f.isAndroidWebview(f.userAgent.ua_string) ? setTimeout(function() {
                    l(g, d, a, c)
                }, 300) : l(g, d, a, c), d
            }

            function l(b, c, d, e) {
                var f = b.contentWindow;
                f.document.write(a(d)), h.setFrameStyle(f.document.getElementsByTagName("html")[0], f.document.getElementsByTagName("body")[0]), j.setReady(f, function(a, i) {
                    "resize" === a ? d.onResize !== g.EMPTY_FUNCTION && (d.onResize(i), h.adjustLowIE(f, b, c, j.getId("viewerFrame", d.viewerNo), i.width, i.height)) : "done" === a && d.onComplete !== g.EMPTY_FUNCTION && (d.autoClose && (h.IE11CompatibleBugFix(f), h.remove(e, c), d.onClose !== g.EMPTY_FUNCTION && d.onClose(g.POPUP_CLOSE_STATE.COMPLETE)), d.onComplete(i))
                }, d)
            }

            function m(a) {
                if (null === q) return alert("POPUP URL을 셋팅해 주세요.");
                var b = {
                        toolbar: "no",
                        scrollbars: "no",
                        menubar: "no",
                        titlebar: "no",
                        resizable: "no",
                        location: "no",
                        status: "no",
                        top: isNaN(a.top) ? 200 : a.top,
                        left: isNaN(a.left) ? 500 : a.left,
                        width: a.isFlexibleWidth ? g.DEFAULT_WIDTH : a.width,
                        height: a.isFlexibleHeight ? g.DEFAULT_HEIGHT : a.height
                    },
                    d = a.popupName || "_blank",
                    e = c.open("", d, f.getStringByOptions(b, "=", ","));
                j.setId("popup", a.viewerNo), h.setPopupMap(j.getId("popup", a.viewerNo), e);
                try {
                    e.focus()
                } catch (i) {}
                if (a.popupName && o(e), f.userAgent.os.android && f.isAndroidWebview(f.userAgent.ua_string)) {
                    var k = f.isAndroidNaverWebview(f.userAgent.ua_string) ? 500 : 300;
                    setTimeout(function() {
                        n(e, a), p(e, a)
                    }, k)
                } else n(e, a), p(e, a);
                return e
            }

            function n(b, c) {
                var d = b.window;
                d.document.write(a(c)), h.setFrameStyle(d.document.getElementsByTagName("html")[0], d.document.getElementsByTagName("body")[0]);
                try {
                    var e = d.document.head || d.document.getElementsByTagName("head")[0];
                    if (e) {
                        var f = "Daum 우편번호 서비스",
                            i = null,
                            k = null,
                            l = d.document.getElementsByTagName("title")[0];
                        l ? (e.removeChild(l), i = d.document.createElement("title"), i.innerHTML = f, e.appendChild(i)) : (i = d.document.createElement("title"), i.innerHTML = f, k = d.document.createElement("meta"), k.name = "viewport", k.content = "user-scalable=no,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,width=device-width", e.appendChild(i), e.appendChild(k))
                    }
                } catch (m) {}
                j.setReady(d, function(a, d) {
                    if ("done" === a && c.onComplete !== g.EMPTY_FUNCTION && (c.onComplete(d), c.autoClose))
                        if (c.onClose !== g.EMPTY_FUNCTION) {
                            var e = h.getPopupMap(b);
                            e && clearInterval(e.data.closeCallbackTimer), b.close(), c.onClose(g.POPUP_CLOSE_STATE.COMPLETE)
                        } else b.close()
                }, c)
            }

            function o(a) {
                var b = a.window,
                    c = b.document,
                    d = c.body || c.documentElement || null;
                if (d)
                    for (var e = c.getElementsByTagName("iframe"), f = 0, g = e.length; g > f; f++) {
                        var h = e[f].id || null;
                        if (h && "string" == typeof h) {
                            var i = c.getElementById(h);
                            i && d.removeChild(i)
                        }
                    }
            }

            function p(a, b) {
                if (b.onClose !== g.EMPTY_FUNCTION) {
                    var c = h.getPopupMap(a);
                    c && (clearInterval(c.data.closeCallbackTimer), c.data.closeCallbackTimer = setInterval(function() {
                        var d = a.closed === !0 ? !0 : !1;
                        d || void 0 !== a.closed || (d = void 0 === a.window || null === a.window ? !0 : !1), d && (clearInterval(c.data.closeCallbackTimer), b.onClose(g.POPUP_CLOSE_STATE.FORCE))
                    }, 250))
                }
            }
            var q = null,
                r = null,
                s = null;
            return {
                init: function(a, b, c) {
                    q = a, r = b || "", s = c || ""
                },
                popup: {
                    create: function(a) {
                        m(a)
                    }
                },
                layer: {
                    create: function(a, b) {
                        var c = null;
                        b && "string" == typeof b ? c = d.getElementById(b) : b && "object" == typeof b && b.appendChild && (c = b);
                        var e = a.viewerNo - 1;
                        if (e >= 1) {
                            var f = d.getElementById(j.getId("layer", e));
                            f && h.remove(c, f)
                        }
                        var g = j.getId("layer", a.viewerNo);
                        (!g || g && !i.TARGET_MAP[g]) && k(a, c)
                    }
                }
            }
        }()
    }(v2, postcodeUtils, window, document, location);
    var v2 = v2 || {};
    ! function(a, b, c, d, e) {
        var f = b,
            g = "msie" === f.userAgent.browser.name && parseInt(f.userAgent.browser.version.major, 10) <= 6;
        a.themePreprocessor = function() {
            function a(a) {
                for (var b = !1, c = u, d = 0, e = c.length; e > d; d++) {
                    var g = c[d],
                        h = g.key,
                        i = g.match,
                        j = a[h];
                    if (j && f.isHex(j))
                        for (var k = 0, l = i.length; l > k; k++) {
                            var m = i[k].split("."),
                                n = m[0],
                                o = m[1];
                            t[n] || (t[n] = {}), t[n][o] = j, b = !0
                        }
                }
                return {
                    isValid: b
                }
            }

            function b(a) {
                for (var b = v, d = !1, e = 0, g = b.length; g > e; e++)
                    for (var h = b[e], i = h.keys, j = h.match, k = h.modifier, l = 0, m = j.length; m > l; l++) {
                        var n = j[l],
                            o = n[0].split("."),
                            p = o[0],
                            q = o[1],
                            r = n[1],
                            s = c(i, a);
                        if (s && f.isHex(s)) {
                            var u = k(s, r);
                            t[p] || (t[p] = {}), t[p][q] = u
                        }
                        d = !0
                    }
                return {
                    isValid: d
                }
            }

            function c(a, b) {
                for (var c = "", d = 0, e = a.length; e > d && !(c = b[a[d]]); d++);
                return c
            }

            function d(a, b) {
                var c = n(a),
                    d = n(b),
                    e = .2,
                    f = o(c.r, c.g, c.b),
                    g = o(d.r, d.g, d.b);
                Math.abs(f.l - g.l) < e && (f.l >= g.l ? (g.l -= e - Math.abs(f.l - g.l), g.l = g.l < 0 ? g.l + 1 : g.l) : f.l < g.l && (g.l += e - Math.abs(f.l - g.l), g.l = g.l > 1 ? g.l - 1 : g.l));
                var h = p(g.h, g.s, g.l);
                return m(h.r, h.g, h.b)
            }

            function e(a, b) {
                var c = n(a),
                    d = o(c.r, c.g, c.b),
                    e = b >= .5 ? .5 : Math.abs(b),
                    f = d.l - e < 0 ? d.l + e : d.l - e;
                return {
                    h: d.h,
                    s: d.s,
                    l: f
                }
            }

            function h(a) {
                var b = .05,
                    c = e(a, b),
                    d = p(c.h, c.s, c.l);
                return m(d.r, d.g, d.b)
            }

            function i(a, b) {
                var c = .48,
                    d = e(a, c),
                    f = n(b),
                    g = o(f.r, f.g, f.b),
                    h = p(g.h, g.s, d.l);
                return m(h.r, h.g, h.b)
            }

            function j(a) {
                var b = a[s.SEARCH_BG],
                    c = k(b);
                b = a[s.BG];
                var d = k(b);
                b = a[s.CONTENT_BG];
                var e = k(b);
                b = a[s.PAGE_BG];
                var f = k(b);
                b = a[s.CONTENT_BG];
                var g = k(b);
                b = a[s.CONTENT_BG];
                var h = k(b);
                return {
                    search: c,
                    suggest: d,
                    selectbox: e,
                    page: f,
                    more: g,
                    layerClose: h
                }
            }

            function k(a) {
                var b = 1,
                    c = 0;
                if (a && f.isHex(a)) {
                    var d = n(a),
                        e = o(d.r, d.g, d.b);
                    return e.l < .5 ? b : c
                }
                return c
            }

            function l(a) {
                a = Math.round(a);
                var b = a.toString(16);
                return 1 == b.length ? "0" + b : b
            }

            function m(a, b, c) {
                return "#" + l(a) + l(b) + l(c)
            }

            function n(a) {
                var b = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
                a = a.replace(b, function(a, b, c, d) {
                    return b + b + c + c + d + d
                });
                var c = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
                return c ? {
                    r: parseInt(c[1], 16),
                    g: parseInt(c[2], 16),
                    b: parseInt(c[3], 16)
                } : null
            }

            function o(a, b, c) {
                a /= 255, b /= 255, c /= 255;
                var d, e, f = Math.max(a, b, c),
                    g = Math.min(a, b, c),
                    h = (f + g) / 2;
                if (f === g) d = e = 0;
                else {
                    var i = f - g;
                    switch (e = h > .5 ? i / (2 - f - g) : i / (f + g), f) {
                        case a:
                            d = (b - c) / i + (c > b ? 6 : 0);
                            break;
                        case b:
                            d = (c - a) / i + 2;
                            break;
                        case c:
                            d = (a - b) / i + 4
                    }
                    d /= 6
                }
                return {
                    h: d,
                    s: e,
                    l: h
                }
            }

            function p(a, b, c) {
                var d, e, f;
                if (0 === b) d = e = f = c;
                else {
                    var g = .5 > c ? c * (1 + b) : c + b - c * b,
                        h = 2 * c - g;
                    d = q(h, g, a + 1 / 3), e = q(h, g, a), f = q(h, g, a - 1 / 3)
                }
                return {
                    r: 255 * d,
                    g: 255 * e,
                    b: 255 * f
                }
            }

            function q(a, b, c) {
                return 0 > c && (c += 1), c > 1 && (c -= 1), 1 / 6 > c ? a + 6 * (b - a) * c : .5 > c ? b : 2 / 3 > c ? a + (b - a) * (2 / 3 - c) * 6 : a
            }

            function r(a) {
                var b = {},
                    c = !1;
                try {
                    if (!g && "object" === (typeof a).toLowerCase()) {
                        for (var d in s)
                            if (s[d]) {
                                var e = s[d];
                                a[e] && f.isHex(a[e]) && (b[e] = a[e])
                            }
                        for (var h in b) b.hasOwnProperty(h) && (c = !0)
                    }
                } catch (i) {
                    c = !1, b = {}
                }
                return {
                    isValid: c,
                    userData: b
                }
            }
            var s = {
                    BG: "bgColor",
                    SEARCH_BG: "searchBgColor",
                    CONTENT_BG: "contentBgColor",
                    PAGE_BG: "pageBgColor",
                    TEXT: "textColor",
                    QUERY_TEXT: "queryTextColor",
                    POSTCODE_TEXT: "postcodeTextColor",
                    EMPH_TEXT: "emphTextColor",
                    OUTLINE: "outlineColor"
                },
                t = {},
                u = [{
                    key: s.BG,
                    match: ["BODY.bg"]
                }, {
                    key: s.SEARCH_BG,
                    match: ["SEARCH.bg"]
                }, {
                    key: s.CONTENT_BG,
                    match: ["SEARCH_GUIDE.bg", "FILTER_ADDRESS.bg", "RESULT_ADDRESS.bg", "INFO.bg", "INFO.iOSTouchGuideBoxBg", "LAYER.bg", "SUGGEST.bg"]
                }, {
                    key: s.PAGE_BG,
                    match: ["PAGING.bg"]
                }, {
                    key: s.TEXT,
                    match: ["SEARCH_GUIDE.text", "FILTER_ADDRESS.text", "RESULT_ADDRESS.addrText", "RESULT_ADDRESS.engMapBtnText", "RESULT_ADDRESS.autoMappingDontknowText", "RESULT_ADDRESS.moreRelAddrLabelText", "PAGING.curPageNumText", "INFO.text", "INFO.iOSTouchGuideBoxText", "LAYER.text", "SUGGEST.text"]
                }, {
                    key: s.QUERY_TEXT,
                    match: ["SEARCH.query"]
                }, {
                    key: s.POSTCODE_TEXT,
                    match: ["RESULT_ADDRESS.postcode"]
                }, {
                    key: s.EMPH_TEXT,
                    match: ["INFO.moveDaumMapText", "SEARCH_GUIDE.emphText", "RESULT_ADDRESS.hangJungDongText", "RESULT_ADDRESS.autoMappingGuideText", "RESULT_ADDRESS.buildingDetailText", "RESULT_ADDRESS.addrTypeLabelText", "SUGGEST.emphText"]
                }, {
                    key: s.OUTLINE,
                    match: ["SEARCH_GUIDE.topInfoBottomLine", "RESULT_ADDRESS.outline", "RESULT_ADDRESS.dividingLine", "RESULT_ADDRESS.relAddrDividingLine", "INFO.bottomLine", "INFO.iOSTouchGuideBoxOutline", "LAYER.outline", "SUGGEST.bottomLine", "SUGGEST.dividingLine"]
                }],
                v = [{
                    keys: [s.SEARCH_BG],
                    match: [
                        ["SEARCH.placeHolder", "#bbb"]
                    ],
                    modifier: d
                }, {
                    keys: [s.SEARCH_BG],
                    match: [
                        ["SEARCH.bottomLine", "#363636"]
                    ],
                    modifier: i
                }, {
                    keys: [s.CONTENT_BG],
                    match: [
                        ["RESULT_ADDRESS.addrTypeLabelOutline", "#d4e2ef"],
                        ["RESULT_ADDRESS.moreRelAddrBtnBg", "#959595"],
                        ["RESULT_ADDRESS.engMapBtnDividingLine", "#cfcfcf"]
                    ],
                    modifier: d
                }, {
                    keys: [s.CONTENT_BG],
                    match: [
                        ["SUGGEST.itemOver", "#f4f4f4"],
                        ["FILTER_ADDRESS.focusBg", "#efefef"]
                    ],
                    modifier: h
                }, {
                    keys: [s.PAGE_BG],
                    match: [
                        ["PAGING.totalPageNumText", "#959595"]
                    ],
                    modifier: d
                }, {
                    keys: [s.BG],
                    match: [
                        ["LOGO.text", "#888"],
                        ["LOGO.logoTextDividingLine", "#dcdcdc"]
                    ],
                    modifier: d
                }, {
                    keys: [s.TEXT],
                    match: [
                        ["INFO.exampleText", "#008bd3"],
                        ["SEARCH_GUIDE.exampleText", "#008bd3"]
                    ],
                    modifier: d
                }];
            return {
                getPreprocessResult: function(c) {
                    var d = r(c);
                    if (d.isValid) {
                        var e = d.userData;
                        t = {};
                        var g = a(e),
                            h = b(e),
                            i = j(e),
                            k = g && h;
                        if (k) return {
                            themeStr: f.themeStringify(t),
                            sit: i.search,
                            sgit: i.suggest,
                            sbit: i.selectbox,
                            pit: i.page,
                            mit: i.more,
                            lcit: i.layerClose
                        }
                    }
                    return null
                }
            }
        }()
    }(v2, postcodeUtils, window, document, location);
    var v2 = v2 || {};
    ! function(a, b, c, d, e) {
        function f(a, b) {
            var c = a;
            if (b) {
                var d = b.q,
                    e = !0;
                d && "string" == typeof d && "" !== k.trim(d) && (c = e === !0 ? k.extend(a, {
                    region_name: encodeURIComponent(d),
                    cq: encodeURIComponent(d),
                    intsh: "on"
                }) : k.extend(a, {
                    userQuery: encodeURIComponent(d),
                    cq: encodeURIComponent(d)
                }))
            }
            return c
        }

        function g(a, b) {
            var c = a;
            if (b) {
                var d = b.left,
                    e = b.top;
                if (!isNaN(d) && !isNaN(e)) {
                    var f = parseInt(d, 10),
                        g = parseInt(e, 10);
                    c = k.extend(a, {
                        left: 0 > f ? 0 : f,
                        top: 0 > g ? 0 : g
                    })
                }
            }
            return c
        }

        function h(a, b) {
            var c = a;
            if (b) {
                var d = b.popupName;
                d && "string" == typeof d && "" !== k.trim(d) && (c = k.extend(a, {
                    popupName: d
                }))
            }
            return c
        }

        function i(a, b) {
            var c = a;
            if (b) {
                var d = b.autoClose;
                void 0 !== d && null !== d && "boolean" == typeof d && (c = k.extend(a, {
                    autoClose: d
                }))
            }
            return c
        }

        function j(a) {
            var b = ++m.VIEWER_COUNT,
                c = {
                    width: l.DEFAULT_WIDTH,
                    height: l.DEFAULT_HEIGHT,
                    top: 50,
                    left: 100,
                    onComplete: l.EMPTY_FUNCTION,
                    oncomplete: l.EMPTY_FUNCTION,
                    onResize: l.EMPTY_FUNCTION,
                    onresize: l.EMPTY_FUNCTION,
                    onClose: l.EMPTY_FUNCTION,
                    onclose: l.EMPTY_FUNCTION,
                    autoMapping: !0,
                    animation: !1,
                    shorthand: !0,
                    hideMapBtn: !1,
                    hideEngBtn: !1,
                    showMoreHName: !1,
                    pleaseReadGuide: 0,
                    pleaseReadGuideTimer: 1.5,
                    theme: null,
                    allAddr: !1,
                    useSuggest: !0,
                    maxSuggestItems: 10,
                    autoHiddenSuggest: !1,
                    windowHeightAvailableForSuggest: 500
                };
            k.extend(c, a, {
                viewerNo: b,
                timer: null,
                isFlexibleWidth: !1,
                isFlexibleHeight: !1,
                isLayerAutoPositioning: !0,
                isLayerDimmedClick: !0,
                indaum: !1,
                isViewerMode: !1,
                viewType: "none",
                banner: !0,
                autoClose: !0,
                useSuggest: !0,
                autoHiddenSuggest: !1
            });
            var d = n.getNormalizeSize(c.width, l.DEFAULT_WIDTH, l.MIN_WIDTH),
                e = n.getNormalizeSize(c.height, l.DEFAULT_HEIGHT, l.MIN_HEIGHT);
            if (c.width = d.value, c.isFlexibleWidth = d.isFlexible, c.height = e.value, c.isFlexibleHeight = e.isFlexible, c.onComplete && "function" == typeof c.onComplete && c.onComplete !== l.EMPTY_FUNCTION ? c.onComplete = c.onComplete : c.oncomplete && "function" == typeof c.oncomplete && c.oncomplete !== l.EMPTY_FUNCTION ? c.onComplete = c.oncomplete : (c.onComplete = l.EMPTY_FUNCTION, c.oncomplete = l.EMPTY_FUNCTION, c.isViewerMode = !0), c.onResize && "function" == typeof c.onResize && c.onResize !== l.EMPTY_FUNCTION ? c.onResize = c.onResize : c.onresize && "function" == typeof c.onresize && c.onresize !== l.EMPTY_FUNCTION ? c.onResize = c.onresize : (c.onResize = l.EMPTY_FUNCTION, c.onresize = l.EMPTY_FUNCTION), c.onClose && "function" == typeof c.onClose && c.onClose !== l.EMPTY_FUNCTION ? c.onClose = c.onClose : c.onclose && "function" == typeof c.onclose && c.onclose !== l.EMPTY_FUNCTION ? c.onClose = c.onclose : (c.onClose = l.EMPTY_FUNCTION, c.onclose = l.EMPTY_FUNCTION), "boolean" != typeof c.autoMapping && (c.autoMapping = !0), "boolean" != typeof c.animation && (c.animation = !1), "boolean" != typeof c.shorthand && (c.shorthand = !0), "boolean" != typeof c.hideMapBtn && (c.hideMapBtn = !1), "boolean" != typeof c.hideEngBtn && (c.hideEngBtn = !1), "boolean" != typeof c.showMoreHName && (c.showMoreHName = !1), "boolean" != typeof c.useSuggest && (c.useSuggest = !0), "boolean" != typeof c.autoHiddenSuggest && (c.autoHiddenSuggest = !1), isNaN(c.pleaseReadGuide) || "number" != typeof c.pleaseReadGuide ? c.pleaseReadGuide = 0 : (c.pleaseReadGuide = parseInt(c.pleaseReadGuide, 10), c.pleaseReadGuide <= 2 && (c.pleaseReadGuide = 0), c.pleaseReadGuide > 20 && (c.pleaseReadGuide = 20)), isNaN(c.pleaseReadGuideTimer) || "number" != typeof c.pleaseReadGuideTimer ? c.pleaseReadGuideTimer = 1.5 : (c.pleaseReadGuideTimer = parseFloat(c.pleaseReadGuideTimer), c.pleaseReadGuideTimer <= 0 && (c.pleaseReadGuideTimer = 1.5), c.pleaseReadGuideTimer > 60 && (c.pleaseReadGuideTimer = 1.5)), isNaN(c.maxSuggestItems) || "number" != typeof c.maxSuggestItems ? c.maxSuggestItems = 10 : (c.maxSuggestItems = parseInt(c.maxSuggestItems, 10), (c.maxSuggestItems < 1 || c.maxSuggestItems > 10) && (c.maxSuggestItems = 10)), c.windowHeightAvailableForSuggest = 45 * c.maxSuggestItems + 50, c.theme) {
                var f = p.getPreprocessResult(c.theme);
                null === f ? c.theme = null : c.theme = f
            }
            "boolean" != typeof c.allAddr && (c.allAddr = !1), this._opt_ = c
        }
        var k = b,
            l = a.CONT,
            m = a.MODEL,
            n = a.viewUtils,
            o = a.frame,
            p = a.themePreprocessor,
            q = "http:" === l.PROTOCOL ? "http://postcode.map.daum.net/search" : "https://spi.maps.daum.net/postcode/search",
            r = encodeURIComponent(l.PROTOCOL + "//" + e.host),
            s = encodeURIComponent(e.pathname),
            t = encodeURIComponent(e.search),
            u = q + "?origin=" + r;
        o.init(u, s, t), j.prototype = {
            open: function(a) {
                var b = k.extend({}, this._opt_);
                b = f(b, a), b = g(b, a), b = h(b, a), b = i(b, a), b = k.extend(b, {
                    viewType: "popup"
                }), o.popup.create(b)
            },
            embed: function(a, b) {
                var c = k.extend({}, this._opt_);
                c = f(c, b), c = i(c, b), c = k.extend(c, {
                    viewType: "layer"
                }), o.layer.create(c, a)
            }
        }, c.daum.Postcode = j
    }(v2, postcodeUtils, window, document, location);
})();

/*
 * 아코디언
 */
(function ($, dews, kendo) {
    var DEFAULT_ROW = 1;
    var DEFAULT_ITEM_BOOLEAN = false;

    /**
     * 설정 값을  가져옵니다.
     * @param {HTMLElement} list 아코디언 아이템 요소
     * @param {object} arco 아코디언 객체
     */
    var ListItem = function (list, arco) {
        var self = this,
            $listItem = $(list);
        var options = {};

        self._item = $listItem;
        self.arcodien = arco;
        self._item.opened = DEFAULT_ITEM_BOOLEAN;
        self._item.hidden = DEFAULT_ITEM_BOOLEAN;

        options = getItemOptions($listItem);
        self.options = options;

        self._initItem();
        self._bindEvent();

        return self;
    };

    /**
     * 설정 값을  가져옵니다.
     * @param {jQuery} $listItem 대상 요소의 jQuery 객체
     */
    function getItemOptions($listItem) {
        var $element = $listItem;
        var options = {
            useIcon : DEFAULT_ITEM_BOOLEAN
        };
        //icon 사용 여부 옵션 체크
        if($element.is('[class*="ico-"]') || $element.data('dews-ico')) {
            options.useIcon = true;
        }
        //open 상태 옵션
        if($element.data('dews-item-open') && $element.data('dews-item-open')===true) {
            options.openStatus = true;
        }
        //숨김 상태 옵션
        if($element.data('dews-item-hide') && $element.data('dews-item-hide')===true) {
            options.hideStatus = true;
        }

        return options;
    }

    /**
     * 아코디언 아이템의 구조를 설정합니다.
     * @private
     */
    ListItem.prototype._initItem = function () {
        var self = this,
            title = self._item.find('>p.dews-arcodien-item-title'),
            content = self._item.find('>div.dews-arcodien-contents'),
            contents,
            innerHTML = self._item.html(),
            titleText;

        self._item.empty();

        // 초기 open 상태 값 설정
        if(self.options.openStatus) {
            self._item.opened = true;
        }

        // 초기 숨김 상태 값 설정
        if(self.options.hideStatus) {
            self._item.hidden = true;
        }

        if (title.length === 0) {
            if(self._item.data('dews-localize-key')) {
                titleText = dews.localize.get(self._item.data('dews-item-title'), self._item.data('dews-localize-key'), self._item.data('dews-localize-lang') || null)
            } else {
                titleText = self._item.data('dews-item-title');
            }

            title = $('<p class="dews-arcodien-item-title">' + titleText + '</p>');
        } else {
            if(self._item.data('dews-localize-key')) {
                title[0].innerText = dews.localize.get(title[0].innerText, title.data('dews-localize-key'), title.data('dews-localize-lang') || null);
            }
        }

        self._item.append(title);

        if (content.length === 0) {
            contents = innerHTML.replace(/<p class=\s?(?:"|')dews-arcodien-item-title[^<]+<\/p>/gi, '');
            content = $('<div class="dews-arcodien-contents"/>');
            content.append($(contents));
        }

        self._item.append(content);

        // 아코디언 내 아이템 높이 지정
        setItemHeight(self);

        // 아코디언 내 아이템 타이틀 문구 지정
        if (self._item.data('dews-item-title')) {
            title.innerText = titleText;
        }
        // 아코디언 내 아이템 아이콘 지정
        if (self._item.data('dews-ico')) {
            self._item.addClass(self._item.data('dews-ico'));
        }
        // 아코디언 타이틀 아이콘 공간 설정
        if(self.options.useIcon){
            title.addClass('icon-space');
        }
    };
    /**
     * 아코디언 아이템의 텍스트 값을 설정 및 반환 합니다.
     * @param {string} text 아코디언 아이템 title
     */
    ListItem.prototype.title = function (text) {
        var self = this;

        if (text) {
            self._item.find('> p.dews-arcodien-item-title').text(text);
        } else {
            return self._item.find('> p.dews-arcodien-item-title').text();
        }
    };
    /**
     * 아코디언 아이템을 open 합니다.
     */
    ListItem.prototype.open = function () {
        var self = this;

        if(self.arcodien.options.useMulti || (self.arcodien._element.find('> ul > li.selected > .dews-arcodien-contents').length === 0)) {
            self.arcodien._open(self);
        } else {
            self.arcodien._element.find('> ul > li.selected > .dews-arcodien-contents').slideUp(300, 'linear', function () {
                self.arcodien._element.find('> ul > li.selected').removeClass('selected');
                self.arcodien._open(self);
            });
        }
    };
    /**
     * 아코디언 아이템을 close 합니다.
     */
    ListItem.prototype.close = function () {
        var self = this;

        self.arcodien._close(self);
    };
    //
    /**
     * 아코디언 아이템의 활성화 여부를 설정합니다
     * @param {boolean} value 아코디언 아이템의 활성화 여부
     */
    ListItem.prototype.enable = function (value) {
        var self = this;

        if ($.type(value) === 'undefined') {
            return self._item.attr('disabled');
        } else if ($.type(value) === 'boolean') {
            if (value) {
                self._item.attr('disabled', !value);
                self._item.removeClass('dews-state-disabled');
            } else {
                self.close();
                self._item.attr('disabled', !value);
                self._item.addClass('dews-state-disabled');
            }
        }
    };
    /**
     * 아이템 on 이벤트
     */
    ListItem.prototype.on = function () {
        var self = this;

        self._item.find('p.dews-arcodien-item-title').on.apply(self._item.find('p.dews-arcodien-item-title'), arguments);
    };
    //
    /**
     * 아이템 off 이벤트
     */
    ListItem.prototype.off = function () {
        var self = this;

        self._item.find('p.dews-arcodien-item-title').off.apply(self._item.find('p.dews-arcodien-item-title'), arguments);
    };
    /**
     * 아코디언 아이템 이벤트
     * @private
     */
    ListItem.prototype._bindEvent = function () {
        var self = this, event, parameter = {
            item: self,
            status: ''
        };
        // 아코디언 내 아이템 클릭 이벤트
        self._item.on('click', function (e) {
            if (e.target.tagName === 'P') {
                if (self._item.hasClass('selected')) {
                    parameter.status = 'close';
                    self.close();
                } else {
                    parameter.status = 'open';
                    self.open();
                }

                event = $.Event('click', parameter);
                self._item.trigger(event);

                e.stopPropagation();
            }
        });
    };

    /**
     * 아코디언 아이템을 숨깁니다.
     */
    ListItem.prototype.hide = function () {
        var self = this;
        self._item.hidden = true;
        if(self._item.hidden) {
            self._item.css('display', 'none');
        }
    };

    /**
     * 아코디언의 숨겨진 아이템을 보여줍니다.
     */
    ListItem.prototype.show = function () {
        var self = this;
        self._item.hidden = false;
        if(self._item) {
            if(!self._item.hidden) {
                self._item.css('display', '');
            }
        }
    };

    /**
     * 아코디언 아이템이 열려있는지 확인합니다.
     */
    ListItem.prototype.isOpened = function () {
        var self = this;
        return self._item.opened;
    };

    /**
     * 아코디언 내 아이템의 길이 설정 (일괄/개별)
     */
    function setItemHeight(self) {
        if(self.arcodien.options.useMulti ||
            (!self.arcodien.options.useMulti && !self.arcodien._element.data('dews-arcodien-height'))) {
            // 아코디언 내 아이템 높이 일괄 지정
            if (self.arcodien._element.data('dews-item-height')) {
                self._item.find('>div.dews-arcodien-contents').css('height', self.arcodien._element.data('dews-item-height') - self._item.height() + 'px');
            }
            // 아코디언 내 아이템 높이 개별 지정
            if (self._item.data('dews-item-height')) {
                self._item.find('>div.dews-arcodien-contents').css('height', self._item.data('dews-item-height') - self._item.height() + 'px');
            }
        }
    }

    /**
     * 아코디언의 기본 옵션을 가져옵니다.
     */
    function getOptions($el, opt) {
        var $element = $el,
            options = {
                useMulti : false,
            };

        if($element.data('dews-arcodien-type') === 'multiple') {
            options.useMulti = true ;
        }

        options = $.extend(true, options, opt);

        return options;
    }

    /**
     * 아코디언 객체
     */
    var Arcodien = function ($el, opt) {
        var self = this, options;

        options = getOptions($el, opt);

        self._element = $el;
        self.options = options;
        self.items = [];

        nthCreate(self);
        // 아코디언 내 아이템에 아이디 값으로 접근 가능
        self.items.getById = function (id) {
            // this는 listItem 객체들이 담겨있는 self.items
            for (var i = 0; i < this.length; i+=1) {
                if (this[i]._item.attr('ID') === id) {
                    return this[i];
                }
            }
            return null;
        };

        self._initArcodienHeight();
        self._bindEvent();
        self._initItemOpen();
        self._initItemHide();

        return self;
    };

    /**
     * 아코디언 아이템를 객체화 합니다.
     * @param arcodien {object} arcodien 아코디언 객체
     */
    function nthCreate (arcodien) {
        var self = arcodien;

        for (var i = 0; i < arcodien._element.find('> ul > li').length; i+=1) {
            self.items.push(new ListItem(arcodien._element.find('> ul > li')[i], self));
        }
    }

    /**
     * 아코디언의 길이를 초기화합니다.
     * @private
     */
    Arcodien.prototype._initArcodienHeight = function () {
        var self = this;

        if (self._element.data('dews-arcodien-height')) {
            self._element.css('height', self._element.data('dews-arcodien-height') + 'px');
        }
    };

    /**
     * 아코디언에서 설정된 아이템을 열어줍니다.
     * @private
     */
    Arcodien.prototype._initItemOpen = function () {
        var self = this,
            $items = self.items;
        var openItemLength = DEFAULT_ROW;
        var openedItemCount = 0;

        if(self.options.useMulti === true) {
            if($items.length && ($items.length !== 0))
                openItemLength = $items.length;
        }

        for(var itemOrder = 0; itemOrder < $items.length; itemOrder++) {
            if(openedItemCount < openItemLength) {
                if($items[itemOrder]._item.opened) {
                    self._open($items[itemOrder]);
                    openedItemCount++;
                }
            }
        }
    };

    /**
     * 아코디언에서 설정된 아이템을 숨김 처리합니다.
     * @private
     */
    Arcodien.prototype._initItemHide = function () {
        var self = this;
        var itemListLength = DEFAULT_ROW;

        if(self.options.useMulti === true) {
            if(self.items.length && (self.items.length !== 0))
                itemListLength = self.items.length;
        }

        for(var itemOrder = 0; itemOrder < itemListLength; itemOrder++) {
            if(self.items[itemOrder]._item.hidden) {
                self.items[itemOrder].hide()
            }
        }
    };

    /**
     * 아코디언 활성화 유무 설정합니다.
     * @param {boolean} value 아코디언 활성화 여부
     */
    Arcodien.prototype.enable = function (value) {
        var self = this;

        if ($.type(value) === 'undefined') {
            return self._element.attr('disabled');
        } else if ($.type(value) === 'boolean') {
            if (value) {
                self._element.attr('disabled', !value);
                self._element.removeClass('dews-state-disabled');
            } else {
                self._element.find('> ul > li > .dews-arcodien-contents').css('display', 'none');
                self._element.find('> ul > li.selected').removeClass('selected');
                self._element.attr('disabled', !value);
                self._element.addClass('dews-state-disabled');
            }
        }
    };
    /**
     * 아코디언 on 이벤트
     */
    Arcodien.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'click') {
            Array.prototype.splice.apply(arguments, [0, 1, '_click']);
        }

        self._element.on.apply(self._element, arguments);
    };
    /**
     * 아코디언 off 이벤트
     */
    Arcodien.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'click') {
            Array.prototype.splice.apply(arguments, [0, 1, '_click']);
        }

        self._element.off.apply(self._element, arguments);
    };

    /**
     * 아코디언 열기
     * @param {jQuery} item 아코디언 아이템 jQuery 객체
     * @private
     */
    Arcodien.prototype._open = function (item) {
        var self = this,
            $item = item._item;

        var parameter = {
            arcodien: self,
            $arcodien: self._element,
            item: item,
            $item: $item,
            multiple: self.options.useMulti
        };

        var openEvent = $.Event("open", parameter);
        self._element.trigger(openEvent);

        $item.not('.dews-state-disabled').find('> div.dews-arcodien-contents').slideDown(300, 'linear', function () {
            $item.addClass('selected');
            $item.opened = true;
            var grid = $item.find('.dews-ui-grid'), innerGrid;
            for (var i = 0; i < grid.length; i++) {
                innerGrid = dews.ui.grid($(grid[i]));
                innerGrid._grid.resetSize();
            }
        });
    };

    //
    /**
     * 아코디언 닫기
     * @param {jQuery} item 아코디언 아이템 jQuery 객체
     * @private
     */
    Arcodien.prototype._close = function (item) {
        var self = this;
        var $item = item._item;

        var parameter = {
            arcodien: self,
            $arcodien: self._element,
            item: item,
            $item: $item,
            multiple: self.options.useMulti
        };

        var closeEvent = $.Event("close", parameter);
        self._element.trigger(closeEvent);

        $item.find('> div.dews-arcodien-contents').slideUp(300, 'linear', function () {
            $item.removeClass('selected');
            $item.opened = false;
        });
    };

    /**
     * 아코디언 이벤트
     * @private
     */
    Arcodien.prototype._bindEvent = function () {
        var self = this,
            event,
            parameter = {
                arcodien: self,
                openItem: '',
                closeItem: ''
            };

        self._element.on('click', function (e) {
            parameter.openItem = e.item;
            if (self._element.find('li.selected').length !== 0) {
                parameter.closeItem = self.items[self._element.find('li.selected').index()];
            }
            event = $.Event('_click', parameter);
            self._element.trigger(event);

            e.stopPropagation();
        });
    };

    /**
     * 아코디언 모든 아이템 열기
     */
    Arcodien.prototype.openAll = function () { //this = arcodien
        var self = this;
        var $contents = self._element.find('> ul > li > .dews-arcodien-contents');

        if(self.options.useMulti || ($contents.length === 0)) {
            for(var i=0; i<self.items.length; i+=1) {
                if(!self.items[i]._item.hasClass('selected')) {
                    self._open(self.items[i]);
                }
            }
        }
    };

    /**
     * 아코디언 모든 아이템 닫기
     */
    Arcodien.prototype.closeAll = function () {
        var self = this;

        for(var i=0; i<self.items.length;i+=1) {
            if (self.items[i]._item.hasClass('selected')) {
                self._close(self.items[i]);
            }
        }
    };

    $.extend(true, dews, {
        ui: {
            arcodien: function (selector, options) {
                var $ctl, arcodien;

                if (selector instanceof jQuery) {
                    $ctl = selector;
                } else if ($.type(selector) === 'string') {
                    $ctl = $(selector);
                } else {
                    throw '아코디언을 생성할 대상이 제공되지 않았습니다.';
                }

                $ctl.each(function () {
                    var $this = $(this);

                    arcodien = $this.data('dews-control');

                    if (!arcodien) {

                        arcodien = new Arcodien($this, options);

                        if (!$this.hasClass('dews-ui-arcodien')) {
                            $this.addClass('dews-ui-arcodien');
                        }
                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', arcodien);
                    }
                });

                return arcodien;
            }
        }
    });

    dews.ui.addControlInitializer('arcodien', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.arcodien($('div.dews-ui-arcodien', $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 컨디션패널
 */
(function ($, dews) {
    var COMPONENT_NAME = 'dews-ui-condition-panel';
    var COMPONENT_TYPE = 'dews-container-control';
    var ACTIVATED_STATUS = 'dews-control-activate';
    var EXPAND_BUTTON_CLASS_NAME = 'dews-condition-panel-expand-button';
    var DEFAULT_COLUMN_SIZE = 3;    // 기본 컬럼 갯수
    var MAX_COLUMN_SIZE = 5;        // 최대 컬럼 갯수
    var MIN_COLUMN_SIZE = 1;        // 최소 컬럼 갯수

    /**
     * 컨디션패널에 포함된 항목의 요소를 나타내는 클래스입니다.
     * @constructor
     */
    function PanelItem($li) {
        var self = this;
        self._$element = $li;
        self.label = self._$element.find('> label').get(0);
        self.container = self._$element.find('> span').get(0);
    }

    /**
     * 컨디션패널 항목의 라벨에 설정된 텍스트를 가져오거나 텍스트를 설정합니다.
     * @param text 설정할 라벨의 텍스트 (생략하면 설정되어있는 텍스트를 가져옵니다.)
     * @returns {string | undefined}
     */
    PanelItem.prototype.text = function (text) {
        var self = this;

        if (typeof text === 'undefined') {
            return $(self.label).text();
        } else {
            $(self.label).text(text);
            setLabelTitleWhenEllipsis(self.label, text);
        }
    };

    // 기본 옵션 값
    var defaultOptions = {
        columns: DEFAULT_COLUMN_SIZE,
        collapsed: true,
        labelAlign: 'right'
    };

    // HTML 요소에 지정된 옵션을 가져옵니다.
    function getInlineOptions($el) {
        var options = {};
        /*
         * data-dews-columns: 컬럼 개수 (MIN_COLUMN_SIZE ~ MAX_COLUMN_SIZE) - 기본값: 3
         * data-dews-label-width: 라벨 영역의 너비 - 기본값: 스타일시트에 정의된 값
         * data-dews-item-width: 컨디션 패널 개별 항목의 영역 너비 (라벨 너비 + 컨트롤 영역 너비) - 기본값: 스타일시트에 정의된 값
         * data-dews-optional-collapsed: 초기화 시 옵션 영역 접혀있는지 여부 (true/false) - 기본값: true
         * data-dews-label-align: 라벨의 텍스트 정렬 방식 (left, center, right) - 기본값: right
         */

        if ($el.data('dews-columns')) {
            options.columns = parseInt($el.data('dews-columns'), 10);
        }
        if ($el.data('dews-label-width')) {
            options.labelWidth = parseInt($el.data('dews-label-width'), 10);
        }
        if ($el.data('dews-item-width')) {
            options.itemWidth = parseInt($el.data('dews-item-width'), 10);
        }
        if (typeof $el.data('dews-optional-collapsed') !== 'undefined') {
            options.collapsed = /true/i.test($el.data('dews-optional-collapsed'));
        }
        if ($el.data('dews-label-align')) {
            options.labelAlign = $el.data('dews-label-align');
        }

        return options;
    }

    // 컨디션패널을 생성합니다.
    function createPanel(panel) {
        var $form;
        var formName = 'dews-condition-panel-form';

        // 이미 생성되어 있다면 생성 로직을 태우지 않습니다.
        if (panel.$element.hasClass(COMPONENT_TYPE)) {
            return;
        }

        // 스크립트 코드에서 동적으로 생성되었다면 컴포넌트 기본 클래스를 추가해줌
        if (!panel.$element.hasClass(COMPONENT_NAME)) {
            panel.$element.addClass(COMPONENT_NAME);
        }

        if (panel._options.columns &&
            panel._options.columns >= MIN_COLUMN_SIZE && panel.options.columns <= MAX_COLUMN_SIZE) {
            panel.$element.addClass('col-' + panel._options.columns.toString());
        } else {
            throw '컨디션패널의 컬럼 갯수가 잘못 지정되었습니다.';
        }

        // 라벨의 정렬 너비
        switch (panel._options.labelAlign) {
            case 'center':
                panel.$element.find('ul.required-area > li > label, ul.optional-area > li > label')
                    .css('textAlign', 'center');
                break;
            case 'left':
                panel.$element.find('ul.required-area > li > label, ul.optional-area > li > label')
                    .css('textAlign', 'left');
                break;
            case 'right':
                panel.$element.find('ul.required-area > li > label, ul.optional-area > li > label')
                    .css('textAlign', 'right');
                break;
            default:
                break;
        }

        // 폼 요소를 확인하고 누락되어 있다면 추가합니다.
        $form = panel.$element.find('> .' + formName);

        if ($form.length === 0) {
            // 기존 코드에는 .dews-condition-panel-form 을 기본으로 요구하였으므로 하위호환성 확보
            $form = $('<form class="' + formName + '"></form>');
            $form.append(panel.$element.find('> ul').detach());
            panel.$element.append($form);
        }

        $form.on('submit', function (e) { e.preventDefault(); }); // Enter 키에 의한 폼 submit 방지

        panel.$element.addClass(COMPONENT_TYPE);

        panel.$element.find('ul').each(function(idx, item) {
            var $ul = $(item);
            var requiredAreaName = 'required-area';
            var optionalAreaName = 'optional-area';

            if (idx === 0) {
                if (!$ul.hasClass(requiredAreaName)) {
                    $ul.addClass(requiredAreaName);
                }
            } else {
                if (!$ul.hasClass(optionalAreaName)) {
                    $ul.addClass(optionalAreaName);
                }
            }

            retouchItems(panel, $ul);
        });

        // 항목 너비가 지정되어 있다면 컨테이너의 상태에 따라 재계산하여 설정
        if (panel._options.itemWidth) {
            var itemRightMargin = parseInt(panel.$element.find('li').eq(0).css('margin-right'), 10);
            var containerPaddingLeft = parseInt(panel.$element.find('ul').eq(0).css('padding-left'), 10);
            var containerPaddingRight = parseInt(panel.$element.find('ul').eq(0).css('padding-right'), 10);
            var borderWidth = parseInt(panel.$element.css('border-width'), 10);
            var itemGroupMinWidth = panel._options.itemWidth * panel._options.columns + (panel._options.columns - 1) * itemRightMargin;
            var containerMinWidth = itemGroupMinWidth + containerPaddingLeft + containerPaddingRight + borderWidth * 2;

            panel.$element.css({minWidth: containerMinWidth});
            panel.$element.find('ul').css({minWidth: itemGroupMinWidth});
        }

        // 컴포넌트 보이기
        panel.$element.addClass(ACTIVATED_STATUS);
    }

    // 컨디션 패널 항목 아이템이 지정한 대로 출력될 수 있도록 후처리를 실시합니다.
    function retouchItems(panel, $ul) {
        var $items = $ul.children('li');
        var $items2 = $ul.children('li:not(.transparency)');
        var emptyLITemplate = '<li class="dews-condition-panel-item-transparency"></li>';
        var colsRegex = /col-(\d+)\s?/;
        var options = panel._options;

        $items.each(function(idx, item) {
            var $item = $(item), $empty, $label;
            var matches, cols, itemSpace;
            matches = colsRegex.exec(item.className);

            // 병합이 되는 셀이 있는 지 확인하고 처리합니다.
            if ($.isArray(matches) && matches[1]) {
                cols = parseInt(matches[1], 10);
                for (var i = 0; i < cols - 1; i++) {
                    $empty = $(emptyLITemplate);
                    $empty.addClass('transparency'); // TODO: 하위 호환성을 위해 추가하였으나 제거할 것
                    $item.after($empty);
                }
            }

            // itemWidth 또는 labelWidth 로 너비가 지정된 경우
            // itemWidth 처리
            if (options.itemWidth) {
                itemSpace = parseInt($item.css('margin-right').replace('px', ''));
                $item.css({ width: options.itemWidth * (cols || 1) + itemSpace * ((cols || 1) - 1) + 'px'});
            }

            $label = $item.find('> label');
            // labelWidth 처리
            if (options.labelWidth) {
                $label.css({ width: options.labelWidth + 'px' });
            }
            // 라벨 문자열 다국어 적용
            if ($label.data('dews-localize-key')) {
                $label.text(dews.localize.get($label.text(), $label.data('dews-localize-key')));
            }

            // ellipsis(말줄임표)가 적용되었는지를 판단하여 title 을 이용하여 툴팁이 뜰 수 있게함
            if ($label.get(0)) {
                setLabelTitleWhenEllipsis($label.get(0), $label.text());
            }

            // 컨디션패널 항목을 items 에 추가
            panel.items.push(new PanelItem($item));
        });

        var sum = 0;

        $items2.each(function (idx, item) {
            var $item = $(item), $empty;
            var panelCols = panel.options.columns;
            // 병합이 되는 셀이 있는 지 확인하고 처리합니다.
            var matches = colsRegex.exec(item.className);

            if ($.isArray(matches) && matches[1]) {
                var cols = parseInt(matches[1], 10);
            } else {
                cols = 1;
            }

            var beforeSum = sum;
            sum = sum + cols;

            if (sum === panelCols) {
                sum = 0;
            } else if (sum > panelCols) {
                for (var j = 0; j < panelCols - beforeSum; j++) {
                    $empty = $(emptyLITemplate);
                    $empty.addClass('transparency');
                    $item.before($empty);
                }

                sum = cols;
            }
        });
    }

    // 지정한 label 요소에 지정한 텍스트의 title 속성을 지정합니다.
    function setLabelTitleWhenEllipsis(label, text) {
        if (label && label.scrollWidth) {
            if (label.scrollWidth > label.offsetWidth) {
                $(label).attr('title', text);
            } else {
                $(label).removeAttr('title');
            }
        }
    }

    // 옵션 영역 보기 버튼 추가 여부를 판단하고 처리합니다.
    function createOptionsExpandButton(panel) {
        var $optional, $button,
            collapsedCssName = 'collapsed',
            expandedCssName = 'expanded';

        $optional = panel.$element.find('.optional-area');
        if ($optional.length > 0 && $optional.find('> li').length > 0) {
            $button = panel.$element.find('.' + EXPAND_BUTTON_CLASS_NAME);
            panel.$element.addClass('expandable');

            if ($button.length === 0) {
                $button = $('<button type="button"></button>');
                $button.addClass(EXPAND_BUTTON_CLASS_NAME);
                $button.on('click', function(e) {
                    e.preventDefault();
                    // 옵션 영역을 토글 시킵니다.
                    expandOptionalArea(panel, panel._options.collapsed);
                });
                panel.$element.append($button);
            }

            // 옵션 영역이 열려있는지 닫혀있는지로 버튼 및 옵션 영역 숨기기 처리
            if (panel._options.collapsed) {
                $button.addClass(collapsedCssName);
                $optional.hide();
            } else {
                $button.addClass(expandedCssName);
                $optional.show();
            }
        }
    }

    // 옵션 영역을 열거나 닫습니다.
    function expandOptionalArea(panel, expand) {
        var $button = panel.$element.find('.' + EXPAND_BUTTON_CLASS_NAME),
            $optional = panel.$element.find('.optional-area'),
            collapsedCssName = 'collapsed',
            expandedCssName = 'expanded';

        if (expand && panel._options.collapsed) {
            $button.removeClass(collapsedCssName).addClass(expandedCssName);
            $optional.slideDown();
            panel._options.collapsed = false;
        } else if (!expand && !panel._options.collapsed) {
            $button.removeClass(expandedCssName).addClass(collapsedCssName);
            $optional.slideUp();
            panel._options.collapsed = true;
        }
    }

    /**
     * 컨디션패널을 생성하기 위한 클래스
     * @param {HTMLElement} element 컨디션패널 요소
     * @param {object} options 컨디션패널 옵션
     * @constructor
     */
    var ConditionPanel = function (element, options) {
        var self = this;

        // 대상 요소 저장
        self._element = element;
        self.$element = $(element);

        // 생성 옵션 결정
        var inlineOptions = getInlineOptions(self.$element);
        self.options = $.extend({}, defaultOptions, inlineOptions, options);
        self._options = $.extend(true, {}, self.options);

        // 개별 요소에 대한 접근
        self.items = [];
        self.listItems = self.items; // 하위호환성을 위해서 listItems 로도 items 노출
        self.items.getById = function (id) {    // 아이디를 이용하여 개별 항목 가져오기
            var result;

            $.each(self.items, function(idx, item) {
                if (item._$element.attr('id') === id) {
                    result = item;
                    return false;
                }
            });

            return result;
        };

        self.tracked = false;

        dews.ready(function() {
            if (!self.tracked) {
                self._applyFocusManager();
                self.tracked = true;
            }
        });

        return self;
    };

    /**
     * 옵션 영역이 열려있는지 여부를 가져오거나 옵션 영역을 열거나 닫습니다.
     * @param expand {boolean} 옵션 영역을 열지 여부 (true: 열림, false: 닫힘)
     * @returns {boolean|undefined} 매개변수의 제공에 따라 현재 옵션 영역이 열렸는지 여부를 반환하거나 undefined 를 반환합니다.
     */
    ConditionPanel.prototype.expandOptional = function(expand) {
        var self = this;

        if (typeof expand === 'undefined') {
            // 현재 옵션 영역이 열려있는지를 반환
            return !self._options.collapsed;
        } else {
            // 값이 들어온 경우에는 옵션 영역을 열거나 닫음
            expandOptionalArea(self, expand);
        }
    };

    /**
     * 내부 컴포넌트에서 엔터키를 입력했을때 컴포넌트가 포커스 전환이 이워질 수 있도록 합니다.
     * @private
     */
    ConditionPanel.prototype._applyFocusManager = function () {
        var self = this;
        var $el = $(self._element);
        var controls = [];

        // 다음 포커스 대상 컨트롤을 가져옵니다.
        var getNextControl = function(current) {
            var idx;
            var next;

            for (var i = 0; i < controls.length; i++) {
                if (controls[i].dewsObj === current) {
                    idx = i;
                    break;
                }
            }

            if (idx >= 0 && idx < controls.length) {
                while(!next) {
                    idx++;

                    if (controls[idx] && controls[idx].dewsObj && $.isFunction(controls[idx].dewsObj.canFocusable)
                        && controls[idx].dewsObj.canFocusable() && controls[idx].$ul.is(':visible')) {
                        next = controls[idx].dewsObj;
                    }

                    if (idx >= controls.length) {
                        break;
                    }
                }
            }

            return next;
        };

        // 이전 포커스 대상 컨트롤을 가져옵니다.
        var getBeforeControl = function(current) {
            var idx;
            var before;

            for (var i = 0; i < controls.length; i++) {
                if (controls[i].dewsObj === current) {
                    idx = i;
                    break;
                }
            }

            if (idx >= 0 && idx < controls.length) {
                while(!before) {
                    idx--;

                    if (controls[idx] && controls[idx].dewsObj && $.isFunction(controls[idx].dewsObj.canFocusable)
                        && controls[idx].dewsObj.canFocusable() && controls[idx].$ul.is(':visible')) {
                        before = controls[idx].dewsObj;
                    }

                    if (idx <= -1) {
                        break;
                    }
                }
            }

            return before;
        };

        $el.find('*[class^=dews-ui-].dews-form-control').each(function (idx, target) {
            var $item = $(target);
            var $ul = $item.closest('ul');

            var dewsObj = $item.data('dews-control');

            if (dewsObj && $.isFunction(dewsObj.applyPanelFocus)) {
                // 각 컨트롤에 엔터키 처리를 하도록 설정합니다.
                dewsObj.applyPanelFocus();

                dewsObj.on('nextFocus', function (e) {
                    var next = getNextControl(e.control);

                    if (next) {
                        next.focus();
                    } else {
                        // 마지막 컨트롤에서 엔터키가 입력되면 포커스 처리가 끝났다는 이벤트를 발생시킴
                        $el.trigger('lastFocus');
                    }
                });

                dewsObj.on('beforeFocus', function (e) {
                    var before = getBeforeControl(e.control);

                    if (before) {
                        before.focus();
                    }
                });

                controls.push({dewsObj: dewsObj, $ul: $ul});
            }
        });
    };

    ConditionPanel.prototype.on = function () {
        var self = this;
        var $panel = $(self._element);

        switch (arguments[0]) {
            case "change":
                Array.prototype.splice.apply(arguments, [0, 1, '_change']);
                $panel.on.apply($panel, arguments);
                break;
            default:
                $panel.on.apply($panel, arguments);
                break;
        }
    };

    /**
     * 컨디션패널을 작성합니다.
     * @private
     */
    ConditionPanel.prototype._render = function() {
        var self = this;

        // 컨디션패널의 래퍼인 컨테이너를 생성합니다.
        // self._createContainer();
        createPanel(self);

        // 컨디션패널 열기/닫기 버튼을 생성합니다.
        // self._createButton();
        createOptionsExpandButton(self);
    };

    /**
     * 컨디션패널의 validation 체크를 합니다.
     * @param options
     */
    ConditionPanel.prototype.validate = function (options) {
        var self = this;
        var $el = $(self._element);
        var result = true;
        var defOptions = { tooltip: true };
        var $dfr = $.Deferred();

        options = $.extend({}, defOptions, options);

        $dfr.done(function () {
            $el.find('*[class^=dews-ui-].dews-form-control.required').each(function (idx, target) {
                var $item = $(target);
                var dewsObj = $item.data('dews-control');
                var $ul = $item.closest('ul');
                var $li = $item.closest('li');

                if ($ul.is(':visible') && $li.is(':visible')) {
                    if ($.isFunction(dewsObj.validate)) {
                        if (!dewsObj.validate()) {
                            if (options.tooltip) {
                                if (options.message) {
                                    dews.ui.tooltip.show($item, {
                                        type: 'required',
                                        text:options.message
                                    });
                                } else {
                                    dews.ui.tooltip.show($item, {type: 'required'});
                                }
                            }
                            result = false;
                            // return false; // break 처리
                        }
                    }
                }
            });
        });

        if (self.tracked) {
            $dfr.resolve();
        } else {
            var interval = setInterval(function () {
                if (self.tracked) {
                    clearInterval(interval);
                    $dfr.resolve();
                }
            }, 100);
        }

        return result;
    };

    /**
     * 컨디션패널의 serialize 합니다.
     */
    ConditionPanel.prototype.serialize = function () {
        var self = this;
        var $el = $(self._element);
        var value;
        var $dfr = $.Deferred();

        $dfr.done(function () {
            $el.find('*[class^=dews-ui-][id].dews-form-control').each(function (idx, target) {
                var $item = $(target);

                var dewsObj = $item.data('dews-control');

                if (dewsObj && $.isFunction(dewsObj.serializeForPanel)) {
                    var obj = dewsObj.serializeForPanel();

                    if (obj) {
                        value = value || {};

                        $.extend(true, value, obj);
                    }
                }
            });
        });

        if (self.tracked) {
            $dfr.resolve();
        } else {
            var interval = setInterval(function () {
                if (self.tracked) {
                    clearInterval(interval);
                    $dfr.resolve();
                }
            }, 100);
        }

        return value;
    };
    /**
     * 컨디션패널의 focus 합니다.
     */
    ConditionPanel.prototype.focus = function () {
        var self = this;
        var $el = $(self._element);
        var $dfr = $.Deferred();

        $dfr.done(function () {
            $el.find('*[class^=dews-ui-].dews-form-control').each(function (idx, target) {
                var $item = $(target);
                var $li = $item.closest('li');

                if ($li.is(':visible')) {
                    var dewsObj = $item.data('dews-control');

                    if (dewsObj && $.isFunction(dewsObj.canFocusable)) {
                        dewsObj.focus();
                        return false;
                    }
                }
            });
        });

        if (self.tracked) {
            $dfr.resolve();
        } else {
            var interval = setInterval(function () {
                if (self.tracked) {
                    clearInterval(interval);
                    $dfr.resolve();
                }
            }, 100);
        }
    };

    /**
     * 컨디션패널에 설정된 옵션을 가져옵니다.
     * @returns {object} 옵션 설정값
     */
    ConditionPanel.prototype.getOptions = function () {
        return this.options;
    };

    /**
     * 컨디션패널에서 자동화 인쇄 관련 데이터를 가져옵니다.
     * @return {Array} 컨디션패널 내 값이 존재하는 데이터 반환
     * @private
     */
    ConditionPanel.prototype._getParamsForPrint = function () {
        var self = this,
            $el = self.$element,
            printData = [];

        $el.find('*[class^=dews-ui-].dews-form-control').each(function(idx, target) {
            var $item = $(target),
                dewsObj = $item.data('dews-control'),
                data = {};

            if (dewsObj) {
                data = dewsObj._getPrintData();

                if (data) {
                    data.optional = $item.closest('ul').hasClass('required-area') ? false : true;
                    data.label = $item.closest('li').find('> label').text();
                    printData.push(data);
                }
            }
        });

        return printData;
    };

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 컨디션패널로 만들거나 가져옵니다.
             * @param {string|jQuery} selector 컨디션패널로 만들 셀렉터 또는 jQuery 객체
             * @param {object} options 컨디션패널 옵션
             * @returns {object|Array} 컨디션패널 인스턴스
             */
            conditionpanel: function (selector, options) {
                var $el, obj;

                obj = [];

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var conditionpanel,
                        element = this;

                    if ($(element).data('dews-control')) {
                        conditionpanel = $(element).data('dews-control');
                    } else {
                        conditionpanel = new ConditionPanel(element, options);
                        conditionpanel._render();

                        $(element).data("dews-control", conditionpanel);
                    }
                    obj.push(conditionpanel);

                    if (dews.ui.page._useOnegrid) {
                        conditionpanel.onegrid = dews.ui.Onegrid(element, conditionpanel);

                    }
                });

                return (obj.length == 1) ? obj[0] : obj;
            }
        }
    });

    dews.ui.addControlInitializer('conditionpanel', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }
        dews.ui.conditionpanel($(".dews-ui-condition-panel, .dews-condition-panel", $container));
    });
})(jQuery, window.dews);


/*
 * 폼 패널
 */
(function ($, dews) {

    var COMPONENT_NAME = 'dews-ui-form-panel';
    var COMPONENT_TYPE = 'dews-container-control';
    var ACTIVATED_STATUS = 'dews-control-activate';
    var DEFAULT_COLUMN_SIZE = 2;
    var MAX_COLUMN_SIZE = 4;
    var MIN_COLUMN_SIZE = 1;

    /**
     * 폼패널에 포함된 항목의 요소를 나타내는 클래스입니다.
     * @param $li 폼패널 항목이 되는 LI 요소의 JQuery 객체입니다.
     * @constructor
     */
    function PanelItem($li) {
        var self = this;
        self._$element = $li;
        self.label = self._$element.find('> label').get(0);
        self.container = self._$element.find('> span').get(0);
    }

    /**
     * 폼패널 항목의 라벨에 설정된 텍스트를 가져오거나 설정합니다.
     * @param text {string} 설정할 라벨의 텍스트 (생략하면 설정된 텍스트를 가져옵니다.)
     * @returns {string | undefined}
     */
    PanelItem.prototype.text = function (text) {
        var self = this;

        if (typeof text === 'undefined') {
            return $(self.label).text();
        } else {
            $(self.label).text(text);
            setLabelTitleWhenEllipsis(self.label, text);
        }
    };

    // 기본 옵션 값
    var defaultOptions = {
        columns: DEFAULT_COLUMN_SIZE,
        labelAlign: 'right'
    };

    // HTML 요소에 지정된 옵션을 JSON 형태로 가져옵니다.
    function getInlineOptions($el) {
        var options = {};
        /*
         * data-dews-columns: 컬럼 개수 (MIN_COLUMN_SIZE ~ MAX_COLUMN_SIZE) - 기본값: 3
         * data-dews-label-width: 라벨 영역의 너비 - 기본값: 스타일시트에 정의된 값
         * data-dews-item-width: 폼패널 개별 항목의 영역 너비 (라벨 너비 + 컴포넌트 영역 너비) - 기본값: 스타일시트에 정의된 값
         * data-dews-label-align: 라벨의 텍스트 정렬 방식 (left, center, right) - 기본값: right
         */

        if ($el.data('dews-columns')) {
            options.columns = parseInt($el.data('dews-columns'), 10);
        }
        if ($el.data('dews-label-width')) {
            options.labelWidth = parseInt($el.data('dews-label-width'), 10);
        }
        if ($el.data('dews-item-width')) {
            options.itemWidth = parseInt($el.data('dews-item-width'), 10);
        }
        if ($el.data('dews-label-align')) {
            options.labelAlign = $el.data('dews-label-align');
        }

        return options;
    }

    // 폼 패널을 생성합니다.
    function createPanel(panel) {
        var $form;
        var formName = 'dews-form-panel-form';

        // 이미 생성되어 있다면 생성 로직을 생략
        if (panel.$element.hasClass(COMPONENT_TYPE)) {
            return;
        }

        // 기본 컴포넌트 클래스가 지정되지 않았다면 추가
        if (!panel.$element.hasClass(COMPONENT_NAME)) {
            panel.$element.addClass(COMPONENT_NAME);
        }

        if (panel._options.columns &&
            panel._options.columns >= MIN_COLUMN_SIZE && panel._options.columns <= MAX_COLUMN_SIZE) {
            panel.$element.addClass('col-' + panel._options.columns.toString());
        } else {
            throw '폼패널의 컬럼 갯수가 잘못 지정되었습니다.';
        }

        // 폼 요소가 누락되어 있다면 추가함
        $form = panel.$element.find('> .' + formName);

        if ($form.length === 0) {
            // 기존 코드에는 .dews-form-panel-form 을 기본적으로 요구하였으므로 하위호환성 확보
            $form = $('<form class="' + formName + '"></form>');
            $form.append(panel.$element.find('> ul').detach());
            panel.$element.append($form);
        }

        $form.on('submit', function (e) { e.preventDefault(); }); // Enter 키에 의한 폼 submit 방지

        panel.$element.addClass(COMPONENT_TYPE);

        panel.$element.find('ul').each(function (idx, item) {
            var $ul = $(item);
            retouchItems(panel, $ul);
        });

        // 라벨의 정렬 처리
        switch (panel._options.labelAlign) {
            case 'center':
                panel.$element.find('> .dews-form-panel-form > ul > li > label')
                    .css('text-align', 'center');
                break;
            case 'left':
                panel.$element.find('> .dews-form-panel-form > ul > li > label')
                    .css('text-align', 'left');
                break;
            case 'right':
                panel.$element.find('> .dews-form-panel-form > ul > li > label')
                    .css('text-align', 'right');
                break;
            default:
                break;
        }

        // 항목의 너비가 지정되어 있다면 컨테이너의 상태에 따라 재계산하여 설정
        if (panel._options.itemWidth) {
            var $firstItem = panel.$element.find('li').eq(0);
            var itemLeftMargin = parseInt($firstItem.css('margin-right'), 10);
            var itemRightMargin = parseInt($firstItem.css('margin-left'), 10);
            var containerPaddingLeft = parseInt($firstItem.css('padding-left'), 10);
            var containerPaddingRight = parseInt($firstItem.css('padding-right'), 10);
            var borderLeftWidth = parseInt(panel.$element.css('border-left-width'), 10);
            var borderRightWidth = parseInt(panel.$element.css('border-right-width'), 10);
            var itemGroupMinWidth = panel._options.itemWidth * panel._options.columns
                + (panel._options.columns - 1) * (itemLeftMargin + itemRightMargin);
            var containerMinWidth =
                itemGroupMinWidth + containerPaddingLeft + containerPaddingRight + borderLeftWidth + borderRightWidth;

            panel.$element.css({minWidth: containerMinWidth});
            panel.$element.find('ul').css({minWidth: itemGroupMinWidth});
        }

        // 컴포넌트 보이기
        panel.$element.addClass(ACTIVATED_STATUS);
    }

    // 폼패널 항목 아이템이 지정한 대로 출력될 수 있도록 후처리를 실시합니다.
    function retouchItems(panel, $ul) {
        var $items = $ul.children('li');
        var emptyLITemplate = '<li class="dews-form-panel-item-transparency"></li>';
        var colsRegex = /col-(\d+)\s?/;
        var options = panel._options;

        $items.each(function (idx, item) {
            var $item = $(item);
            var $empty, $label;
            var matches, cols, itemSpaceLeft, itemSpaceRight;

            // 병합된 셀이 있는지 확인하고 처리함
            matches = colsRegex.exec(item.className);
            if ($.isArray(matches) && matches[1]) {
                cols = parseInt(matches[1], 10);
                for (var i = 0; i < cols - 1; i++) {
                    $empty = $(emptyLITemplate);
                    $empty.addClass('transparency'); // TODO: 하위호환성을 위해 추가하였으나 범용 클래스명이므로 제거할 것
                    $item.after($empty);
                }
            }

            // itemWidth 또는 labelWidth 로 너비가 지정된 경우
            // itemWidth 처리
            if (options.labelWidth) {
                itemSpaceLeft = parseInt($item.css('margin-left'));
                itemSpaceRight = parseInt($item.css('margin-right'));
                $item.css({
                    width: options.itemWidth * (cols || 1) + (itemSpaceLeft + itemSpaceRight) * ((cols || 1) - 1) + 'px'
                });
            }

            $label = $item.find('> label');
            // labelWidth 처리
            if (options.labelWidth) {
                $label.css({ width: options.labelWidth + 'px' });
            }
            // 라벨 문자열 다국어 적용
            if ($label.data('dews-localize-key')) {
                $label.text(dews.localize.get($label.text(), $label.data('dews-localize-key')));
            }

            // ellipsis(말줄임표)가 적용되었는지를 판단하여 title 속성을 이용해 툴팁 제공
            if ($label.get(0)) {
                setLabelTitleWhenEllipsis($label.get(0), $label.text());
            }

            // 폼패널 항목을 items 속성에 추가
            panel.items.push(new PanelItem($item));
        });
    }

    // 라벨에 설정하는 텍스트의 길이가 라벨의 길이보다 길 경우 title 속성으로 툴팁이 나올 수 있도록 합니다.
    function setLabelTitleWhenEllipsis(label, text) {
        if (label && label.scrollWidth) {
            if (label.scrollWidth > label.offsetWidth) {
                $(label).attr('title', text);
            } else {
                $(label).removeAttr('title');
            }
        }
    }

    /**
     * 폼패널을 생성하기 위한 클래스
     * @param $element {JQuery} 폼패널 생성 대상 요소
     * @param options 폼패널 옵션
     * @constructor
     */
    function FormPanel($element, options) {
        var self = this;

        // 대상 요소 지정
        self.$element = $element;

        // 생성 옵션 결정
        var inlineOptions = getInlineOptions(self.$element);
        self.options = $.extend({}, defaultOptions, inlineOptions, options);
        self._options = $.extend(true, {}, self.options);

        // 개별요소에 대한 접근
        self.items = [];
        self.listItems = self.items; // 하위호환성을 위해서 listItems 로도 items 를 노출
        self.items.getById = function (id) { // 아이디를 이용하여 개별항목 가져오기
            var result;

            $.each(self.items, function (idx, item) {
                if (item._$element.attr('id') === id) {
                    result = item;
                    return false;
                }
            });

            return result;
        };

        self.tracked = false;

        dews.ready(function() {
            if (!self.tracked) {
                self._trackChanges();
                self._applyFocusManager();
                self.tracked = true;
            }
        });

        // 폼패널 생성
        createPanel(self);

        return self;
    }

    /**
     * 내부 컴포넌트들 내부에서 change 이벤트가 발생하면 폼패널에서도 change 이벤트가 발생하도록 처리합니다.
     * @private
     */
    FormPanel.prototype._trackChanges = function () {
        var self = this;
        var $el = self.$element;
        var evt;

        $el.find('*[class^=dews-ui-].dews-form-control').each(function (idx, target) {
            var $item = $(target);

            var dewsObj = $item.data('dews-control');

            if (dewsObj && $.isFunction(dewsObj.on)) {
                // 컨트롤의 change 이벤트를 중계하도록 합니다.
                dewsObj.on('change', function () {
                    if (!self.binding) {
                        evt = new $.Event('_change');
                        evt.source = dewsObj;
                        evt.$source = $item;
                        // 데이터에 대한 바인딩이 일어나는 중이 아니라 컨트롤에서 변경이 일어날 경우에만 이벤트를 발생시킨다.
                        $el.trigger(evt);
                    }
                });
            }
        });
    };

    /**
     * 내부 컴포넌트에서 엔터키를 입력했을때 컴포넌트가 포커스 전환이 이워질 수 있도록 합니다.
     * @private
     */
    FormPanel.prototype._applyFocusManager = function () {
        var self = this;
        var $el = self.$element;
        var controls = [];

        // 다음 포커스 대상 컨트롤을 가져옵니다.
        var getNextControl = function(current) {
            var idx = controls.indexOf(current);
            var next;

            if (idx >= 0 && idx < controls.length) {
                while(!next) {
                    idx++;

                    if (controls[idx] && $.isFunction(controls[idx].canFocusable) && controls[idx].canFocusable()) {
                        next = controls[idx];
                    }

                    if (idx >= controls.length) {
                        break;
                    }
                }
            }

            return next;
        };

        // 이전 포커스 대상 컨트롤을 가져옵니다.
        var getBeforeControl = function(current) {
            var idx = controls.indexOf(current);
            var before;

            if (idx >= 0 && idx < controls.length) {
                while(!before) {
                    idx--;

                    if (controls[idx] && $.isFunction(controls[idx].canFocusable) && controls[idx].canFocusable()) {
                        before = controls[idx];
                    }

                    if (idx <= -1) {
                        break;
                    }
                }
            }

            return before;
        };

        $el.find('*[class^=dews-ui-].dews-form-control').each(function (idx, target) {
            var $item = $(target);

            var dewsObj = $item.data('dews-control');

            if (dewsObj && $.isFunction(dewsObj.applyPanelFocus)) {
                // 각 컨트롤에 엔터키 처리를 하도록 설정합니다.
                dewsObj.applyPanelFocus();

                dewsObj.on('nextFocus', function (e) {
                    var next = getNextControl(e.control);

                    if (next) {
                        next.focus();
                    } else {
                        // 마지막 컨트롤에서 엔터키가 입력되면 포커스 처리가 끝났다는 이벤트를 발생시킴
                        $el.trigger('lastFocus');
                    }
                });

                dewsObj.on('beforeFocus', function (e) {
                    var before = getBeforeControl(e.control);

                    if (before) {
                        before.focus();
                    }
                });

                controls.push(dewsObj);
            }
        });
    };

    FormPanel.prototype.on = function () {
        var self = this;
        var $panel = self.$element;

        switch (arguments[0]) {
            case "change":
                Array.prototype.splice.apply(arguments, [0, 1, '_change']);
                $panel.on.apply($panel, arguments);
                break;
            default:
                $panel.on.apply($panel, arguments);
                break;
        }
    };

    /**
     * 폼패널의 validation 체크를 합니다.
     * @param options
     */
    FormPanel.prototype.validate = function (options) {
        var self = this;
        var $el = self.$element;
        var result = true;
        var defOptions = { tooltip: true };

        options = $.extend({}, defOptions, options);

        $el.find('*[class^=dews-ui-].dews-form-control.required').each(function (idx, target) {
            var $item = $(target);
            var $li = $item.closest('li');

            if ($li.is(':visible')) {
                var dewsObj = $item.data('dews-control');
                if ($.isFunction(dewsObj.validate)) {
                    if (!dewsObj.validate()) {
                        if (options.tooltip) {
                            if (options.message) {
                                dews.ui.tooltip.show($item, {
                                    type: 'required',
                                    text:options.message
                                });
                            } else {
                                dews.ui.tooltip.show($item, {type: 'required'});
                            }
                        }
                        result = false;
                    }
                }
            }
        });

        return result;
    };

    /**
     * 폼패널의 컨트롤 들의 데이터를 serialize 합니다.
     */
    FormPanel.prototype.serialize = function () {
        var self = this;
        var $el = self.$element;
        var value;

        $el.find('*[class^=dews-ui-][id].dews-form-control').each(function (idx, target) {
            var $item = $(target);
            var dewsObj = $item.data('dews-control');

            if (dewsObj && $.isFunction(dewsObj.serializeForPanel)) {
                var obj = dewsObj.serializeForPanel();

                if (obj) {
                    value = value || {};

                    $.extend(true, value, obj);
                }
            }
        });

        return value;
    };

    /**
     * 폼 패널에 포커스를 설정합니다.
     */
    FormPanel.prototype.focus = function () {
        var self = this;
        var $el = self.$element;

        $el.find('*[class^=dews-ui-].dews-form-control').each(function (idx, target) {
            var $item = $(target);
            var $li = $item.closest('li');

            if ($li.is(':visible')) {
                var dewsObj = $item.data('dews-control');

                if (dewsObj && $.isFunction(dewsObj.canFocusable)) {
                    dewsObj.focus();
                    return false;
                }
            }
        });
    };

    /**
     * JSON 데이터로 폼 패널 내의 컴포넌트 들에 데이터를 바인딩 합니다.
     * @param data
     */
    FormPanel.prototype.bindData = function (data) {
        var self = this;
        var $el = self.$element;

        self.binding = true; // 바인딩 중

        if (data) {
            $el.find('*[class^=dews-ui-][id].dews-form-control').each(function (idx, target) {
                var $item = $(target);

                var dewsObj = $item.data('dews-control');

                if (dewsObj && $.isFunction(dewsObj.bindFromPanel)) {
                    dewsObj.bindFromPanel(data);
                }
            });
        }

        self.binding = false; // 바인딩 끝
    };

    /**
     * 그리드 등의 데이터 출력 컴포넌트에 데이터를 현재 데이터를 반영합니다.
     * @param target 그리드 등의 데이터 출력 컴포넌트
     */
    FormPanel.prototype.bindTo = function (target) {
        var self = this;
        var instance, data;

        if (target instanceof jQuery) {
            instance = target.data('dews-control');
        } else {
            instance = target;
        }

        if (instance && $.isFunction(instance.updateRowFromPanel)) {
            data = self.serialize();

            if (data) {
                instance.updateRowFromPanel.call(instance, data);
            }
        } else {
            console.log('# FormPanel 의 데이터를 원본 데이터소스로 바인딩하는데 실패하였습니다. #', target, instance);
        }
    };

    // 이전 API 호환을 위해 남겨둠
    FormPanel.prototype.bindGrid = function (grid) {
        this.bindTo(grid);
    };

    // 이전 API 호환을 위해 남겨둠
    FormPanel.prototype.bindCardList = function (cardlist) {
        this.bindTo(cardlist);
    };

    dews = $.extend(true, dews, {
        ui: {
            formpanel: function (selector) {
                var $panel, panel;

                if (selector instanceof jQuery) {
                    $panel = selector;
                } else if ($.type(selector) === "string") {
                    $panel = $(selector);
                } else {
                    throw "대상이 지정되지 않았습니다.";
                }

                $panel.each(function () {
                    var $ctrl = $(this);

                    panel = $ctrl.data('dews-control');

                    if (!panel) {
                        panel = new FormPanel($ctrl);

                        if (!$ctrl.hasClass('dews-ui-form-panel')) {
                            $ctrl.addClass('dews-ui-form-panel');
                        }
                        if (!$ctrl.hasClass('dews-form-panel')) {
                            $ctrl.addClass('dews-form-panel');
                        }

                        $ctrl.data('dews-control', panel);
                    }
                });

                return panel;
            }
        }
    });

    dews.ui.addControlInitializer('formpanel', function(target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

      // TODO: dews-form-panel 로만 초기화하도록 되어 있어 추가하였으나 dews-ui-form-panel 로만 초기화 시켜도록 변경되어야 함
        dews.ui.formpanel($("div.dews-form-panel, div.dews-ui-form-panel", $container));
    });
})(jQuery, window.dews || {});


/*
 * 자동완성
 */
(function ($, dews, kendo) {

    function getInlineOptions($this, srcOptions) {
        var $el = $this, dataSource, dataSourceID, dataSourceUrl, dataOptions, options = {};

        if (srcOptions) {
            if (srcOptions.params) {
                options.params = srcOptions.params;
            }
        }

        if ($el.data('dews-params')) {
            options.params = $.deparam($el.data('dews-params'));
        }

        if ($el.data('dews-data-url')) {
            if ($el.attr('id')) {
                dataSourceID = $el.attr('id') + '_DataSource';
            } else {
                dataSourceID = (new Date()).toString() + '_DataSource';
            }
            if (options.params) {
                dataSourceUrl = dews.url.appendParameters(dews.url.getAbsoluteUrl($el.data('dews-data-url')), options.params);
                dataOptions = {
                    transport: {
                        read: {
                            url: dataSourceUrl,
                            dataType: 'json'
                        }
                    },
                    serverFiltering: true
                };
            } else {
                dataSourceUrl = dews.url.getAbsoluteUrl($el.data('dews-data-url'));
                dataOptions = {
                    transport: {
                        read: {
                            url: dataSourceUrl,
                            dataType: 'json'
                        }
                    }
                };
            }
            dataSource = dews.ui.dataSource(dataSourceID, dataOptions);
            options.dataSource = dataSource;
        }
        if ($el.data('dews-text-field')) {
            options.dataTextField = $el.data('dews-text-field');
        }
        if ($el.data('dews-code-field')) {
            options.template = $el.data('dews-code-field');
        }
        if ($el.data('dews-list-width')) {
            options.listWidth = $el.data('dews-list-width');
        }
        if ($el.data('dews-list-maxheight')) {
            options.height = $el.data('dews-list-maxheight');
        }
        if ($el.data('dews-filter')) {
            options.filter = $el.data('dews-filter');
        }
        if ($el.data('dews-min-length')) {
            options.minLength = $el.data('dews-min-length');
        }
        if ($.type($el.data('dews-visible-code')) === 'boolean') {
            options.visibleCode = $el.data('dews-visible-code');
        }
        return options;
    }

    function getOptions($this, srcOptions) {
        var $el = $this, options, inlineOptions;

        inlineOptions = getInlineOptions($el, srcOptions);

        options = $.extend(true, {}, inlineOptions, srcOptions);

        if (options.template) {
            if (options.template.match(/<[^>]+>/g) === null) {
                if (options.visibleCode === false) {
                    options.template = "<span class='dews-autocomplete-text'>#:" + options.dataTextField + " #</span>";
                } else {
                    options.template = "<span class='dews-autocomplete-text'>#:" + options.dataTextField + " #</span> <span class='dews-autocomplete-code'>#:" + options.template + "#</span>";
                }
            }
        } else {
            options.template = "<span class='dews-autocomplete-text'>#=" + options.dataTextField + " #</span>";
        }

        return options;
    }

    function initControl(auto, $el) {
        var wrapper = $el.parent('.k-autocomplete');

        if (wrapper.find('.k-icon.k-loading')) {
            wrapper.find('.k-icon.k-loading').remove();
        }

        if ($el.hasClass('k-input')) {
            $el.removeClass('k-input');
            $el.addClass('k-textbox');
            $el.addClass('dews-ui-autocomplete');
        }

        if (!wrapper.hasClass('dews-autocomplete-wrapper')) {
            wrapper.removeClass('dews-ui-autocomplete');
            wrapper.addClass('dews-autocomplete-wrapper');
        }

        if (wrapper.hasClass('required')) {
            wrapper.addClass('dews-state-required');
            wrapper.removeClass('required');
            $el.addClass('dews-state-required');
        }

        if (wrapper.hasClass('disabled') || $el.prop('disabled') === true) {
            wrapper.addClass('dews-state-disabled');
            wrapper.removeClass('disabled');
            $el.addClass('dews-state-disabled');
            $el.prop('disabled', true);
        }

        if (wrapper.hasClass('readonly') || $el.prop('readonly') === true) {
            wrapper.addClass('dews-state-readonly');
            wrapper.removeClass('readonly');
            $el.addClass('dews-state-readonly');
            $el.prop('readonly', true);
        }

        if (wrapper.hasClass('etc1')) {
            wrapper.addClass('dews-state-etc1');
            wrapper.removeClass('etc1');
            $el.addClass('dews-state-etc1');
        }


        if (wrapper.hasClass('etc2')) {
            wrapper.addClass('dews-state-etc2');
            wrapper.removeClass('etc2');
            $el.addClass('dews-state-etc2');
        }

        if (wrapper.hasClass('etc3')) {
            wrapper.addClass('dews-state-etc3');
            wrapper.removeClass('etc3');
            $el.addClass('dews-state-etc3');
        }

        if (!$el.hasClass('dews-control-activate')) {
            $el.addClass('dews-control-activate');
        }

        if (auto.options.listWidth) {
            if (auto.options.listWidth < $el.parent('.dews-autocomplete-wrapper').width()) {
                auto.list.width($el.parent('.dews-autocomplete-wrapper').width());
            } else {
                auto.list.width(auto.options.listWidth);
            }
        }

        if ($el.attr('placeholder') && $el.data('dews-placeholder-localize-key')) {
            $el.attr('placeholder', dews.localize.get($el.attr('placeholder'), $el.data('dews-placeholder-localize-key'), $el.data('dews-placeholder-localize-lang') || null));
        }

        setUserGuideAPI($el);
    }

    function bindEvent(auto, $this) {
        if (auto.dataSource.transport.options) {
            auto.options.baseUrl = auto.dataSource.transport.options.read.url;
        }

        $this.on('focus', function () {
            if (auto && auto._prev !== "") {
                auto.search(auto._prev);
            }
        });

        $this.on('keydown', function (e) {
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (auto._prev.length <= auto.options.minLength) {
                    auto.close();
                }
            }
        });

        auto.bind('filtering', function (e) {
            var filter = e.filter, value = filter.value;

            if (value === "") {
                auto.close();
                e.preventDefault();
            }

            if ($this.attr('readonly')) {
                e.preventDefault();
            }

            if (auto.dataSource.transport.options) {
                var filters = {
                    'keyword': value,
                    'field': filter.field,
                    'operator': filter.operator,
                    'ignoreCase': filter.ignoreCase
                };

                auto.dataSource.transport.options.read.url = dews.url.appendParameters(auto.options.baseUrl, filters);
            }
        });

        auto.bind('close', function () {
            if (auto !== undefined && auto._old !== "") {
                if (auto.dataItem(0)) {
                    auto._prev = $(auto.dataItem(auto.listView.focus())).innerText;
                }
            }
        });

        auto.bind('dataBound', function (e) {
            var listItems = e.sender.ul.children();
            var list, innerText, innerHTML;
            var reg = new RegExp("(" + auto._prev + ")", 'gi');
            if (listItems.length > 0) {
                $(listItems).each(function (i) {
                    list = listItems[i];
                    innerText = $(list).children('.dews-autocomplete-text')[0].innerText;
                    innerHTML = innerText.replace(reg, "<strong>$1</strong>");
                    $(list).children('.dews-autocomplete-text')[0].innerHTML = innerHTML;
                });
            }
        });
    }

    function setAPI(auto, $el, opt) {
        var code, text, url;

        auto.code = function () {
            if (auto && auto._old !== "") {
                code = $(auto.dataItem(auto.listView.focus()))[0];
                if (code[opt.dataTextField] === auto._old) {
                    return code[$el.data('dews-code-field')];
                }
            }
            return "";
        };

        auto.text = function () {
            if (auto && auto._old !== "") {
                text = $(auto.dataItem(auto.listView.focus()))[0];
                if (text[opt.dataTextField] === auto._old) {
                    return text[opt.dataTextField];
                }
            }
            return "";
        };

        auto.setParams = function (params) {
            auto.options.params = params;
            auto.dataSource.options.serverFiltering = true;
            url = auto.dataSource.transport.options.read.url;
            auto.options.baseUrl = dews.url.appendParameters(url, auto.options.params);
        };
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    /**
     * 이벤트 핸들러를 on, off 를 사용하여 등록하고 해제할 수 있도록 설정합니다.
     * @param instance kendo 컴포넌트 인스턴스
     */
    function attachEventProxy(instance) {

    }

    $.extend(true, dews, {
        ui: {
            autocomplete: function (selector, options) {
                var $el, autocomplete;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type(selector) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this), auto, opt;

                    auto = $this.data('dews-control');

                    if (!auto) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        $this.kendoAutoComplete(opt);
                        auto = $this.data('kendoAutoComplete');

                        $this.data('dews-control', auto);

                        initControl(auto, $this);
                        bindEvent(auto, $this);
                        setAPI(auto, $this, opt);
                    }
                    autocomplete = auto;
                });

                return autocomplete;
            }
        }
    });
    kendo.ui.AutoComplete.fn.readonly = (function (readonly) {
        return function (value) {
            var self = this;

            if (typeof value === 'undefined') {
                return self.element.prop('readonly');
            } else {
                if (value) {
                    if (!self.wrapper.hasClass('dews-state-readonly')) {
                        self.wrapper.addClass('dews-state-readonly');
                    }
                } else {
                    if (self.wrapper.hasClass('dews-state-readonly')) {
                        self.wrapper.removeClass('dews-state-readonly');
                    }
                }
            }

            readonly.call(self, value);
        };
    })(kendo.ui.AutoComplete.fn.readonly);

    kendo.ui.AutoComplete.fn.enable = (function (enable) {
        return function (value) {
            var self = this;

            if (typeof value === 'undefined') {
                return !self.element.prop('disabled');
            } else {

                if (value) {
                    if (self.wrapper.hasClass('disabled')) {
                        self.wrapper.removeClass('disabled');
                    }
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                } else {
                    if (!self.wrapper.hasClass('disabled')) {
                        self.wrapper.addClass('disabled');
                    }
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                }
            }

            enable.call(self, value);
        };
    })(kendo.ui.AutoComplete.fn.enable);

    kendo.ui.AutoComplete.fn.on = function () {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    };

    kendo.ui.AutoComplete.fn.off = function () {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    };

    kendo.ui.AutoComplete.fn.validate = function () {
        var self = this;

        return !!self.text();
    };

    kendo.ui.AutoComplete.fn.bindFromPanel = function (data) {
        var self = this, $element = self.element;
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.text(data[column]);
            }
        }
    };

    kendo.ui.AutoComplete.fn.serializeForPanel = function () {
        var self = this, $element = self.element;
        var column;
        var data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = self.text();
        }

        return data;
    };

    kendo.ui.AutoComplete.fn.applyPanelFocus = function () {
        var self = this, $element = self.element;

        $element.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    kendo.ui.AutoComplete.fn.canFocusable = function () {
        var self = this, $element = self.element;

        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    };
    /**
     * 자동완성 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    kendo.ui.AutoComplete.fn._getPrintData = function () {
        var self = this,
            $el = self.element,
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    };

    dews.ui.addControlInitializer('autocomplete', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.autocomplete($("input[type='text'].dews-ui-autocomplete", $container));
    });
})(jQuery, window.dews || {}, window.kendo);


/*
 * 바코드
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        type: "code39",
        text: {
            visible: false
        }
    };

    /**
     * 바코드 생성을 위한 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} srcOptions 소스코드에서 전달된 옵션
     * @returns {object} 옵션
     */
    function getOptions($el, srcOptions) {
        var inlineOptions, options = {};

        inlineOptions = getInlineOptions($el);

        $.extend(true, options, defaultOptions, inlineOptions, srcOptions);

        return options;
    }

    /**
     * HTML 코드 상에 설정된 옵션 정보를 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 옵션
     */
    function getInlineOptions($el) {
        var options = {},
            width,
            height,
            color,
            value,
            type,
            text;

        width = $el.data('dews-width');
        height = $el.data('dews-height');
        color = $el.data('dews-color');
        value = $el.data('dews-value');
        type = $el.data('dews-type');
        text = $el.data('dews-text');

        if (width) {
            options.width = parseInt(width, 10);
        }
        if (height) {
            options.height = parseInt(height, 10);
        }
        if (color) {
            options.color = color;
        }
        if (value) {
            options.value = value;
        }
        if (type) {
            options.type = type;
        }
        if (text) {
            options.text = {
                visible: /true/i.test(text)
            };
        }

        return options;
    }

    $.extend(true, dews, {
        ui: {
            barcode: function (selector, options) {
                var $ctl, barcode;

                if (selector instanceof jQuery) {
                    $ctl = selector;
                } else if ($.type(selector) === 'string') {
                    $ctl = $(selector);
                } else {
                    throw '바코드를 생성할 대상이 제공되지 않았습니다.';
                }

                $ctl.each(function () {
                    var $this = $(this),
                        opt;

                    barcode = $this.data('dews-control');

                    if (!barcode) {
                        opt = getOptions($this, options);

                        $this.kendoBarcode(opt);

                        if (!$this.hasClass('dews-ui-barcode')) {
                            $this.addClass('dews-ui-barcode');
                        }
                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        barcode = $this.data('kendoBarcode');
                        $this.data('dews-control', barcode);
                    }
                });

                return barcode;
            }
        }
    });

    dews.ui.addControlInitializer('barcode', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.barcode($('span.dews-ui-barcode', $container));
    });
})(jQuery, window.dews, window.kendo);


(function ($, dews, kendo) {
    // 기본 옵션
    var defaultOption = {};

    $.extend(true, dews, {
        ui: {
            /**
             * Button을 생성하거나 가져옵니다.
             * @param {string} selector 요소를 지정하는 셀렉터입니다.
             * @param {object} [options] 버튼 설정 값
             */
            button: function (selector, options) {
                var $el,
                    button;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            control,
                            opt;

                        button = $this.data('dews-control');

                        if (!control) {
                            opt = $.extend(true, {}, defaultOption, options);

                            if (!$this.hasClass('dews-control')) {
                                $this.addClass('dews-control');
                            }

                            if (!$this.hasClass('dews-ui-button')) {
                                $this.addClass('dews-ui-button');
                            }

                            if (!$this.attr('type')) {
                                $this.attr('type','button');
                            }

                            if ($this.data('dews-localize-key')) {
                                $this.text(dews.localize.get($this.text(), $this.data('dews-localize-key'), $this.data('dews-localize-lang') || null));
                            }

                            $this.kendoButton(opt);

                            button = $this.data('kendoButton');
                            $this.data('dews-control', button);

                            if (!$this.hasClass('dews-control-activate')) {
                                $this.addClass('dews-control-activate');
                            }
                        }
                    });

                    return button;
                }
            }
        }
    });

    dews.ui.addControlInitializer('button', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.button($('.dews-ui-button', $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 캘린더
 */
(function ($, dews, kendo) {

    var defaultDateOptions = {
        format: dews._environments.formats.dateFormat,
        valueFormat: dews._environments.formats.dateValueFormat
    };

    var defaultMonthOptions = {
        start: "year",
        depth: "year",
        format: dews._environments.formats.monthFormat,
        valueFormat: dews._environments.formats.monthValueFormat
    };

    /**
     * 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var defaultOptions,
            inlineOptions,
            options = {};

        if ($el.hasClass('month')) {
            defaultOptions = defaultMonthOptions;
        } else {
            defaultOptions = defaultDateOptions;
        }

        defaultOptions.culture = dews.localize.getLanguage();

        inlineOptions = getInlineOptions($el, defaultOptions);

        $.extend(true, options, defaultOptions, inlineOptions, codeOptions);

        return options;
    }

    /**
     * HTML 태그에 지정된 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 옵션
     */
    function getInlineOptions($el, defaultOptions) {
        var options = {};

        if ($el.data('dews-value')) {
            options.value = kendo.parseDate(($el.data('dews-value') + ''), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-max')) {
            options.max = kendo.parseDate(($el.data('dews-max') + ''), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-min')) {
            options.min = kendo.parseDate(($el.data('dews-min') + ''), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-format')) {
            options.format = $el.data('dews-format');
        }

        return options;
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 달력을 생성합니다.
             * @param {String|jQuery} selector 셀렉터 또는 jQuery 객체
             * @param {Object} [options] 설정 값, 생략하면 일별 default로 달력이 생성됩니다.
             */
            calendar: function (selector, options) {
                var $el,
                    calendar;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        opt;

                    calendar = $this.data('dews-control');

                    if (!calendar) {

                        opt = getOptions($this, options);

                        $this.kendoCalendar(opt);

                        calendar = $this.data('kendoCalendar');
                        calendar.options.valueFormat = opt.valueFormat;

                        $this.data('dews-control', calendar);

                    }
                });

                return calendar;
            }
        }
    });

    // current 함수 재정의
    kendo.ui.Calendar.fn.current = (function (current) {
        return function (useDate) {
            var self = this,
                date;

            date = current.call(self);

            if (useDate) {
                return date;
            } else {
                return kendo.toString(date, self.options.valueFormat, kendo.getCulture());
            }
        };
    })(kendo.ui.Calendar.fn.current);

    // max 함수 재정의
    kendo.ui.Calendar.fn.max = (function (max) {
        return function (value) {
            var self = this,
                date;

            if (typeof value === 'undefined') {
                date = max.call(self);

                return kendo.toString(date, self.options.valueFormat, kendo.getCulture());
            } else {
                if ($.type(value) === 'date') {
                    date = value;
                } else {
                    date = kendo.parseDate(value, self.options.valueFormat, kendo.getCulture());
                }

                return max.call(self, date);
            }
        };
    })(kendo.ui.Calendar.fn.max);

    // min 함수 재정의
    kendo.ui.Calendar.fn.min = (function (min) {
        return function (value) {
            var self = this,
                date;

            if (typeof value === 'undefined') {
                date = min.call(self);

                return kendo.toString(date, self.options.valueFormat, kendo.getCulture());
            } else {
                if ($.type(value) === 'date') {
                    date = value;
                } else {
                    date = kendo.parseDate(value, self.options.valueFormat, kendo.getCulture());
                }
                return min.call(self, date);
            }
        };
    })(kendo.ui.Calendar.fn.min);

    // navigate 함수 재정의
    kendo.ui.Calendar.fn.navigate = (function (navigate) {
        return function (value, view) {
            var self = this,
                date;

            if ($.type(value) !== 'date') {
                date = kendo.parseDate(value, self.options.valueFormat, kendo.getCulture());
            } else {
                date = value;
            }

            navigate.call(self, date, view);
        };
    })(kendo.ui.Calendar.fn.navigate);

    // value 함수 재정의
    kendo.ui.Calendar.fn.value = (function (value) {
        return function (val) {
            var self = this,
                date;

            if (typeof val === 'undefined') {
                // get
                return kendo.toString(value.call(self), self.options.valueFormat, kendo.getCulture());
            } else {
                // set
                if (typeof val === 'string') {
                    val = kendo.parseDate(val, self.options.valueFormat, kendo.getCulture());
                }
            }

            value.call(self, val);
        };
    })(kendo.ui.Calendar.fn.value);

    kendo.ui.Calendar.fn.text = function () {
        var self = this;

        return kendo.toString(self._value, self.options.format, kendo.getCulture());
    };

    dews.ui.addControlInitializer('calendar', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.calendar($(".dews-ui-calendar", $container));
    });
})(jQuery, window.dews || {}, window.kendo);


/**
 * 카드리스트
 * */

(function ($, dews, kendo) {
    var defaultOptions = {
        // scrollable: {
        //     virtual: true
        // },
        editable: false,
        navigatable: true,
        selectable: true,
        headerCheck: false,
        selectedIndex: 0,
        autoBind: true,
        template: '',
        sort:[],
        headerTemplate: '<th></th>',
        previous: '',
        keepRow: false
    };

    function getOptions($el ,option) {
        var opt = {}, template;

        if ($el.data('dews-cardlist-width')) {
            $el.css('width', $el.data('dews-cardlist-width') + 'px');
        }

        if ($el.data('dews-cardlist-height')) {
            $el.css('height', $el.data('dews-cardlist-height') + 'px');
        }

        opt = $.extend(true, opt, defaultOptions, option);

        opt.headerTemplate = '<th></th>';

        // 헤더 체크 박스설정 [ HEADERCHECK ]
        if (opt.headerCheck) { // true
                opt.headerTemplate = $(opt.headerTemplate).append($('<span class="dews-checkbox-wrapper"><input type="checkbox"  class="dews-ui-checkbox dews-control k-checkbox dews-control-activate"><label class="dews-checkbox-label k-checkbox-label" onclick="kendo.ui.Grid.fn._checkboxClick(this)"></label></span>'));
                opt.headerTemplate = opt.headerTemplate[0].outerHTML;
        }

        // 템플릿에 체크박스가 있을 경우 생성 [ TEMPLATE ]
        if (opt.template.match(/#\s?checkbox\s?#/gi)) {
            opt.template = opt.template.replace(/dews-cardlist-icon/gi, 'dews-cardlist-icon checkbox');
            opt.template = opt.template.replace(/#\s?checkbox\s?#/gi, '<span class="dews-checkbox-wrapper"><input type="checkbox" class="dews-ui-checkbox dews-control k-checkbox dews-control-activate"><label class="dews-checkbox-label k-checkbox-label" onclick="kendo.ui.Grid.fn._checkboxClick(this)"></label></span>');
        }
        template = $('<tr class="k-alt" data-uid="#: uid #">' +
            '<td>' + opt.template + '</td>' +
            '</tr>');

        // 카드리스트 정렬 설정 [ SORT ]
        if (opt.sort && opt.sort.length !== 0) {
            var dropdownlist = $('<select class="dews-ui-dropdownlist"></select>');
            opt.sort.forEach(function (idx, value) {
                var options = $('<option value="' + idx.field + '">' + idx.title + '</option>');
                dropdownlist.append(options);
            });

            opt.headerTemplate = $(opt.headerTemplate).append(dropdownlist)[0].outerHTML;
        }

        // 카드리스트 css 설정 [ CSS ]
        if (opt.css) {
            var styles = $('<style></style>');
            opt.css.match(/([^{]+){[^}]+}/gi).forEach(function (style) {
                var target = '';
                if (opt.$content && opt.$content.attr('id')) {
                    target += '#'+ opt.$content.attr('id');
                }
                if ($el.attr('id')) {
                    target +=  ' #'+$el.attr('id');
                }

                styles[0].innerText += target + ' ' + style.trim();
            });
            opt.styles = styles;
        }

        // 데이터소스 aggregate 있는데 footerTemplate이 없는 경우 aggregate 삭제
        if (opt.dataSource && opt.dataSource._aggregate && !opt.footerTemplate) {
            delete opt.dataSource._aggregate;
        }

        // 카드리스트 footerTemplate 설정
        if (opt.footerTemplate) {
            opt.columns = [];
            opt.footerTemplate.match(/#:\s?[A-z]+\s?\([^)]+\s?\)\s?#/gi).forEach(function (idx, value) {
                var field = idx.replace(/#:\s?[A-z]+\s?\(/gi,'').replace(/\)\s?#/gi, ''),
                    cal = idx.replace(/\([A-z]+\s?\)\s?/gi, '');
                opt.columns.push({field: field, footerTemplate: cal.toLowerCase()});
            });
        }

        // autoBind 설정 [ AUTOBIND ]
        if ($.type(opt.autoBind) === 'boolean') {
            defaultOptions.autoBind = opt.autoBind
        }


        opt.rowTemplate = template[0].outerHTML;

        return opt;
    }
    // 카드리스트 객체 생성
    function CardList ($el, options) {
        var self = this, opt, card;

        if (options.hasOwnProperty("change")) {
            self.change = options.change;
            delete options.change;
        }

        if (options.hasOwnProperty("dataBound")) {
            self.dataBound = options.dataBound;
            delete options.dataBound;
        }

        opt = getOptions($el, options);

        $el.kendoGrid(opt);
        card = $el.data('kendoGrid');

        self.$element = $el;
        self.options = opt;
        self._card = card;

        self.options.change = function (e) {
            var uid = this.element.find('tr.k-state-selected').data('uid');
            if (uid !== opt.previous) {
                var selected =  this.element.find('tr[data-uid="'+uid+'"]');
                var previous = this.element.find('tr[data-uid="'+opt.previous+'"]');
                var changeParams =  {
                    cardlist: self,
                    row: {
                        index: selected.index(),
                        data: this.dataItem(selected),
                        previous: {
                            index: previous.index(),
                            data: this.dataItem(previous),
                        }
                    }
                },
                event = $.Event('change', changeParams);
                self.options.selectedIndex = selected.index();
                opt.previous = uid;
                self._card.element.trigger(event);
            }
        };

        self.options.dataBound = function (e) {
            if (this.tbody.find('tr[data-uid="'+this.options.uid+'"]').length === 0 && this.dataSource._destroyed.length === 0) {
                var boundParams =  {
                        cardlist: self,
                        row: {
                            data: this.items()
                        }
                    },
                    event = $.Event('dataBound', boundParams);
                self._card.element.trigger(event);
                if (this.options.keepRow) {
                    this.select(this.tbody.find('tr:eq('+ this.options.selectedIndex + ')'));
                } else {
                    this.select(this.tbody.find('tr:first-child'));
                }
            }
        };
        self._card.setOptions(self.options);
        // 스타일 붙이기
        if ($.type(self.options.styles) !== 'undefined') {
            self.$element.append(self.options.styles);
        }

        self._bindEvent();

        return self;
    }

    CardList.prototype._initControl = function () {
        var self = this,
            opt = self.options;

        // 그리드 내 컬럼을 비워줌
        self._card.element.find('.k-grid-header-wrap table tr').empty();
        self._card.element.find('.k-grid-header-wrap table colgroup').empty();
        self._card.element.find('.k-grid-content table colgroup').empty();
        self._card.element.find('.k-grid-header-wrap table tr').append($(opt.headerTemplate));
        if (self._card.element.find('.k-grid-header-wrap table tr th .dews-ui-dropdownlist')) {
            dews.ui.dropdownlist(self._card.element.find('.k-grid-header-wrap table tr th .dews-ui-dropdownlist'));
        }

        self._card.bind('dataBound', function () {
            setRightStyle(self._card);
        });

        /*if (opt.footerTemplate) {
            opt.columns.forEach(function (idx, value) {
                opt.footerTemplate = opt.footerTemplate.replace(/#:\s?[A-z]+\s?\([^)]+\s?\)\s?#/i, '');
            });
        }*/
        // 컬럼 헤더 부분 드롭다운리스트 변경시 이벤트
        self._card.thead.find('.dews-dropdownlist-wrapper').on('change', function (e) {
            var column,
                select = $(e.target);
            // 드롭다운리스트 정렬 갯수만큼 돌아서 문구가 같은 option 태그에 selected attribute 추가
            $.each(select.find('> option'), function (index, option) {
                var $option = $(option);
                // 기존에 있던 selected attribute 삭제
                $option.removeAttr('selected');
                // 카드리스트 정렬 부분에 설정된 이름과 option의 text가 일치하면 해당 option attribute에 selected 추가
                if ($option.text() === self._card.thead.find('.dews-dropdownlist-wrapper .k-input').text()) {
                    $option.attr('selected', 'selected');
                }
            });

            column = select.find('option[selected="selected"]')[0].value;
            self._card.options.sortable = true;
            self._card.dataSource.sort({field: column, dir: 'asc'});
            self._card.options.sortable = false;
        });
    };

    CardList.prototype._bindEvent = function () {
        var self = this;

        $(self._card.element).on('change', function (e) {
           if (self.change && $.type(self.change) === 'function' && e.cardlist) {
               self.change.call(self, e);
           }

           if ($.type(e.cardlist) === 'undefined') {
               e.stopImmediatePropagation();
           }
        });

        $(self._card.element).on('dataBound', function (e) {
            if (self.dataBound && $.type(self.dataBound) === 'function' && e.cardlist) {
                self.dataBound.call(self, e);
            }

            if ($.type(e.cardlist) === 'undefined') {
                e.stopImmediatePropagation();
            }
        });

        $(self._card.element).on('rowAdd', function (e) {
            if (self.options.rowAdd && $.type(self.options.rowAdd) === 'function') {
                self.options.rowAdd.call(self, e);
            }
        });

        $(self._card.element).on('rowRemove', function (e) {
            if (self.options.rowRemove && $.type(self.options.rowRemove) === 'function') {
                self.options.rowRemove.call(self, e);
            }
        });
    };

    dews = $.extend(true, dews, {
        ui: {
            cardlist: function (selector, options) {
                var $el, cardlist, $content;

                if (dews.ui.dialogPage) {
                    $content = dews.ui.dialogPage.$content;
                } else if (dews.ui.page) {
                    $content = dews.ui.page.$content;
                } else {
                    $content = $(document);
                }

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector, $content);
                }

                if ($.type(selector) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this), card;

                    card = $this.data('dews-control');

                    if (!card) {
                        if ($.type(options) === 'undefined') {
                            options = {};
                        }
                        options.$content = $content;

                        card = new CardList($this, options);
                        $this.data('dews-control', card);
                        card._initControl();

                        if (!$this.hasClass('dews-ui-cardlist')) {
                            $this.addClass('dews-ui-cardlist');
                        }

                        if (!$this.hasClass("dews-control-activate")) {
                            $this.addClass("dews-control-activate");
                        }

                        if (!$this.hasClass('dews-data-control')) {
                            $this.addClass('dews-data-control');
                        }

                    }
                    cardlist = card;
                });

                return cardlist;
            }
        }
    });
    /**
     * 카드리스트 행 추가
     */
    CardList.prototype.addRow = function () {
        var self = this;

        self._card.addRow(self);
    };
    // 카드리스트 행 추가 관련 kendo addRow 수정
    kendo.ui.Grid.fn.addRow = function(cardlist) {
        var that = this,
            index,
            dataSource = that.dataSource,
            mode = that._editMode(),
            createAt = that.options.editable.createAt || "bottom",
            pageSize = dataSource.pageSize(),
            view = dataSource.view() || [];

        if ((that.editable && that.editable.end()) || !that.editable) {
            if (mode === "incell") {
                that.cancelRow();
            }

            that.options.addRow = true;

            index = dataSource.indexOf(view[0]);

            if (createAt.toLowerCase() === "bottom") {
                index += view.length;

                if (pageSize && !dataSource.options.serverPaging && pageSize <= view.length) {
                    index -= 1;
                }
            }

            if (index < 0) {
                if (dataSource.page() > dataSource.totalPages()) {
                    index = (dataSource.page() - 1) * pageSize;
                } else {
                    index = 0;
                }
            }

            var model = dataSource.insert(index, {}),
                id = model.uid,
                table = that.lockedContent ? that.lockedTable : that.table,
                row = table.find("tr[" + kendo.attr("uid") + "=" + id + "]"),
                cell = row.children("td:not(.k-group-cell,.k-hierarchy-cell)").eq(that._firstEditableColumnIndex(row));

            if (mode === "inline" && row.length) {
                that.editRow(row);
            } else if (mode === "popup") {
                that.editRow(model);
            }

            if (createAt.toLowerCase() === "bottom" && that.lockedContent) {
                //scroll the containers to the bottom
                that.lockedContent[0].scrollTop = that.content[0].scrollTop = that.content[0].offsetHeight;
            }

            if (createAt.toLowerCase() === "bottom") {
                var position = $('tr:last', this.element.context).offset().top;
                $('div.k-grid-content',this.element.context).scrollTop($('div.k-grid-content',this.element.context).scrollTop() + position);
            } else {
                $('div.k-grid-content', this.element.context).scrollTop(0);
            }

            var addParams =  {
                cardlist: cardlist,
                row: {
                    index: that.tbody.find('tr[data-uid="'+row.data('uid')+'"]').index(),
                    data: that.dataItem(row)
                }
            }, rowAddEvent = $.Event('rowAdd', addParams);
            that.element.trigger(rowAddEvent);

            that.element.find('td.k-state-focused').removeClass('k-state-focused');
            that.select(that.tbody.find('tr[data-uid="'+row.data('uid')+'"]'));
        }
    };
    /**
     * 카드리스트 행 삭제
     * @param row (number || array) 삭제할 행의 index
     */
    CardList.prototype.removeRow = function (row) {
        var self = this, selected = self.select();

        var removeParams =  {
            cardlist: self,
            row: {
                index: row,
                data: self.dataItems(row)
            }
        }, rowRemoveEvent = $.Event('rowRemove', removeParams);
        self._card.element.trigger(rowRemoveEvent);

        if (self._card.dataSource) {
            if ($.type(row) === 'array') {
                for (var i = row.length-1; i >= 0; i-=1) {
                    if ($.type(row[i]) === 'number' && row[i] > -1) {
                        self._card.dataSource.remove(self.dataItem(row[i]));
                    }
                }
            } else if ($.type(row) === 'number' && row > -1) {
                self._card.dataSource.remove(self.dataItem(row));
            }
        }
        setRightStyle(self._card);
        // 카드리스트 현재 선택된 행이 삭제 됬을 경우 행 자동 선택
        if (selected === row && self._card.dataSource.data().length !== 0) {
            if (self._card.dataSource.data().length === row) {
                self.select(row-1);
            } else {
                self.select(row);
            }
            self._card.element.find('td.k-state-focused').removeClass('k-state-focused');
        }
    };
    /**
     * 카드리스트 엑셀 다운로드
     * @param options
     */
    CardList.prototype.saveAsExcel = function (options) {
        var self = this,
            jsUrl, excelOptions;

        excelOptions = {
            allPages: true,
            fileName: 'Download.xlsx'
        };

        // 엑셀관련 설정을 한다.
        self._card.options.excel = $.extend(true, self._card.options.excel || {}, excelOptions, options);

        if ($.type(window.JSZip) === 'function') {
            self._card.saveAsExcel.call(self._card);
        } else {
            jsUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', '/kendo/jszip.min.js');
            dews.ajax.script(jsUrl).done(function () {
                self._card.saveAsExcel.call(self._card);
            });
        }
    };
    /**
     * 카드리스트 이벤트 추가
     */
    CardList.prototype.on = function () {
        var self = this;

        $(self._card.element).on.apply($(self._card.element), arguments);
    };
    /**
     * 카드리스트 이벤트 제거
     */
    CardList.prototype.off = function () {
        var self = this;

        $(self._card.element).off.apply($(self._card.element), arguments);
    };
    /**
     * 카드리스트 지정한 행 데이터 호출
     * @param row (number) 호출할 데이터의 행 index
     * @returns {object} 호출한 행의 데이터
     */
    CardList.prototype.dataItem = function (row) {
        var self = this;

        if (self._card.dataSource && row > -1) {
            return self._card.dataItem(self._card.element.find('tbody tr:eq('+row+')'));
        }
    };
    /**
     * 카드리스트 지정한 행 데이터 혹은 전체 데이터 호출
     * @param row (number || array) 호출할 데이터의 행 index
     * @returns {Array} 호출한 행의 데이터 혹은 카드리스트 전체 데이터
     */
    CardList.prototype.dataItems = function (row) {
        var self = this, data = [];

        if (self._card.dataSource) {
            if ($.type(row) === 'array') {
                for (var i = 0; i < row.length; i+=1) {
                    if ($.type(row[i]) === 'number' && row[i] > -1) {
                        data.push(self._card.element.find('tbody tr:eq('+row[i]+')'));
                    }                }
            } else if ($.type(row) === 'number' && row > -1) {
                data = self._card.dataItem(self._card.element.find('tbody tr:eq('+row+')'));
            } else if ($.type(row) === 'undefined') {
                data = self._card.dataSource.data();
            }
        }
        return data;
    };
    /**
     * 카드리스트 행 지정
     * @param row (number) 카드리스트의 포커스 할 행 index 설정
     * @returns {number} 카드리스트의 현재 선택 된 행의 index
     */
    CardList.prototype.select = function (row) {
        var self = this;

        if (self._card.dataSource) {
            if ($.type(row) === 'number' && row > -1) {
                self._card.current(self._card.element.find('.k-grid-content tr:eq('+row+') > td'));
                self._card.select(self._card.element.find('.k-grid-content tr:eq('+row+')'));
                self._card.element.find('.k-grid-content tr:eq('+row+') > td').trigger('mousedown');
            } else if ($.type(row) === 'undefined' && self._card.element.find('.k-grid-content tr.k-state-selected').length !== 0) {
                return self._card.select().index();
            }
        }
    };
    /**
     * 카드리스트의 데이터소스 설정
     * @param dataSource (dataSource) 카드리스트 데이터소스 설정
     */
    CardList.prototype.setDataSource = function (dataSource) {
        this.options.dataSource = dataSource;
        this._card.setDataSource(dataSource);
    };
    /**
     * 카드리스트 옵션 설정
     * @param option (object)
     */
    CardList.prototype.setOptions = function (option) {
        var self = this, options;

        if (option.sort) {
            self.options.sort = [];
        }
        options = $.extend(true, {}, self.options, option);
        self.options = getOptions(self._element, options);
        self._card.setOptions(self.options);
        self._initControl();
    };
    /**
     * 카드리스트 바인딩
     * @param panel (object) 바인딩할 폼패널 객체
     */
    CardList.prototype.bindPanel = function (panel) {
        var self = this,
            data = self.dataItem(self.select()),
            formpanel = panel;

        if ($.type(panel) === 'object' && panel.length) {
            formpanel = dews.ui.formpanel(panel);
        }

        if (data) {
            formpanel.bindData(data.toJSON());
        }
    };
    /**
     * 카드리스트 패널간 바인딩
     * @param data (object) 카드리스트에 설정할 데이터
     */
    CardList.prototype.updateRowFromPanel = function (data) {
        var self = this,
            dataItem;
        if (self.select() > -1) {
            dataItem = self.dataItem(self.select());
            for (var i = 0; i < Object.keys(data).length; i++) {
                if ($.type(dataItem.get(Object.keys(data)[i])) !== 'undefined' && dataItem.get(Object.keys(data)[i]) !== data[Object.keys(data)[i]]) {
                    dataItem.set(Object.keys(data)[i], data[Object.keys(data)[i]]);
                }
            }
        }
    };
    /**
     * 카드리스트에서 체크된 항목의 데이터 가져오기
     * @returns {Array} 체크된 항목의 데이터
     */
    CardList.prototype.getCheckedRow = function () {
        var self = this, data = [];

        self._card.tbody.find('.k-checkbox:checked').each(function (idx, value) {
            data.push(self.dataItem($(value).closest('tr').index()));
        });

        return data;
    };
    /**
     * 카드리스트에서 체크된 항목의 행 index 가져오기
     * @returns {Array} 체크된 항목의 index
     */
    CardList.prototype.getCheckedIndex = function () {
        var self = this, index = [];

        self._card.tbody.find('.k-checkbox:checked').each(function (idx, value) {
            index.push($(value.closest('tr')).index());
        });

        return index;
    };
    // 카드리스트 체크박스 체크 이벤트
    kendo.ui.Grid.fn._checkboxClick = function (target) {
        var $label = $(target),
            $checkbox = $label.parent(".dews-checkbox-wrapper").find('input[type="checkbox"]'),
            cardlist = $checkbox.closest('.dews-ui-cardlist'),
            header = cardlist.find('.k-grid-header'),
            content = cardlist.find('.k-grid-content');

        if($checkbox.length > 0) {
            $checkbox.click();
            // 헤더 체크박스가 존재하는지 확인
            if ($checkbox.closest('.k-grid-header').length !== 0) {
                if ($checkbox.filter(':checked').length !== 0) {
                    content.find('.k-checkbox').prop('checked', true)
                } else {
                    content.find('.k-checkbox').prop('checked', false);
                }
            }
            // 카드리스트 헤더 체크박스 자동 설정
            if (header.find('.k-checkbox').length !== 0 && content.find('.k-checkbox').length !== 0) {
                if (content.find('.k-checkbox').filter(':checked').length === content.find('.k-checkbox').length) {
                    header.find('.k-checkbox').prop('checked', true);
                } else {
                    header.find('.k-checkbox').prop('checked', false);
                }
            }
        }
    };
    /**
     * 카드리스트의 특정 컬럼 값 설정
     * @param index (number) 행 index
     * @param field (string) 설정할 field
     * @param value (string) 설정할 값
     */
    CardList.prototype.setValue = function (index, field, value) {
        var self = this, dataItem;
        if (self._card.dataSource) {
            dataItem = self.dataItem(index);

            dataItem.set(field, value);
        }
    };
    /**
     * 카드리스트의 특정 컬럼 값 호출
     * @param index (number) 행 index
     * @param field (string) 값을 가져올 field
     */
    CardList.prototype.getValue = function (index, field) {
        var self = this, dataItem;
        if (self._card.dataSource) {
            dataItem = self.dataItem(index);

            return dataItem.get(field);
        }
    };
    /**
     * 카드리스트의 현재 상태 반환
     * @param index (number) 행 index
     * @returns {*} (string) 현재 상태값
     */
    CardList.prototype.getRowState = function (index) {
        var self = this, dataItem;
        if (self._card.dataSource && index > -1) {
            dataItem = self.dataItem(index);
            if (dataItem.isNew && dataItem.isNew()) {
                return 'added';
            } else if (dataItem.dirty) {
                return 'updated';
            } else {
                return 'none';
            }
        }
    };
    /**
     * 카드리스트 마스터 디테일 구조 설정
     * @param target (object) 디테일 객
     */
    CardList.prototype.setDetail = function (target) {
        var self = this,
            master = self,
            detail = target,
            masterDataSource = master.options.dataSource,
            detailDataSource = detail.options.dataSource;

        detailDataSource.options.detail = true;
        detailDataSource.options.lineDataSources = {};
        detailDataSource.options.masterDataSource = masterDataSource;
        masterDataSource.options.master = {};
        masterDataSource.options.detailDataSource = detailDataSource;

        self.on('change', function (e) {
            var currentHDataItem = master.dataItem(master.select()), uid = currentHDataItem._uid;
            if (masterDataSource.options._dataChange) {
                detailDataSource._detailDataChange();
            }
            if($.type(detailDataSource.options.lineDataSources[uid]) === "undefined") {
                detailDataSource.options.lineDataSources[uid] = dews.ui.dataSource("__ds_" + uid, detailDataSource.options);
                detailDataSource.options.lineDataSources[uid].options.master = {};
                detailDataSource.options.id = detailDataSource.id;
                detail.setDataSource(detailDataSource.options.lineDataSources[uid]);
                detailDataSource.options.lineDataSources[uid].read();

                detailDataSource.options.lineDataSources[uid].options.parentDataSource = detailDataSource;
                if (masterDataSource.options._dataChange) {
                    detailDataSource.options.lineDataSources[uid]._detailDataChange();
                }
            } else{
                detail.setDataSource(detailDataSource.options.lineDataSources[uid]);
            }
            masterDataSource.options.master[detailDataSource.options.id] = detailDataSource;
            detailDataSource.options.lineDataSources[uid].options.parent = master.options.dataSource;
        });

        self.on('rowAdd', function (e) {
            var data = master.dataItem(e.row.index);
            data.set('_uid', guid());
        });

        function guid() {
            return 'xxxxxxxx-xxxx-4xxx-9xxx-xxxxxxxxxxxx'.replace(/[xy]/g,
                function(c) {
                    var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);
                    return v.toString(16);
                });
        }
    };
    // 그리드 키보드로 이동 가능하게 수정하는 코드
    kendo.ui.Grid.fn._navigatable = (function (navigator) {
        return function (){
            var self = this;

            navigator.call(self);

            self.element.find('.k-grid-content table').on('keydown', self.element, function (e) {
                if (e.keyCode >= 37 && e.keyCode <= 40) {
                    var $target = $(e.target),
                        selectedTr = $target.find('> tbody > tr.k-state-selected'),
                        focusedTd = $target.find('> tbody> tr > td.k-state-focused');

                    if (focusedTd.length === 0) {
                        focusedTd = $target.find('> tbody > tr:first-child');
                        self.element.find('.k-state-focused').removeClass('k-state-focused');
                    }

                    selectedTr.removeClass('k-state-selected');
                    self.current(focusedTd);
                    self.select(focusedTd.closest('tr'));
                    e.stopPropagation();
                }
            });
        };
    })(kendo.ui.Grid.fn._navigatable);

    kendo.ui.Grid.fn.refresh = function (e) {
        var that = this,
            length,
            idx,
            html = "",
            data = that.dataSource.view(),
            navigatable = that.options.navigatable,
            currentIndex,
            selected = that.tbody.find('tr.k-state-selected'),
            uid,
            current = $(that.current()),
            isCurrentInHeader = false,
            groups = (that.dataSource.group() || []).length,
            offsetLeft = that.content && that.content.scrollLeft(),
            colspan = that.columns.length;

        if (selected.length !== 0) {
            uid = selected.data('uid');
            that.options.uid = uid;
        }

        if (e && e.action === "itemchange" && that.editable) { // skip rebinding if editing is in progress
            return;
        }

        e = e || {};

        if (that.trigger("dataBinding", { action: e.action || "rebind", index: e.index, items: e.items })) {
            return;
        }

        that._angularItems("cleanup");

        if (navigatable && (that._isActiveInTable() || (that._editContainer && that._editContainer.data("kendoWindow")))) {
            isCurrentInHeader = current.is("th");
            currentIndex = 0;
            if (isCurrentInHeader) {
                currentIndex = that.thead.find("th:not(.k-group-cell)").index(current);
            }
        }

        that._destroyEditable();

        that._progress(false);

        that._hideResizeHandle();

        that._data = [];

        if (!that.columns.length) {
            that._autoColumns(that._firstDataItem(data[0], groups));
            colspan = groups + that.columns.length;
        }

        that._group = groups > 0 || that._group;

        if(that._group) {
            that._templates();
            that._updateCols();
            that._updateLockedCols();
            that._updateHeader(groups);
            that._group = groups > 0;
        }

        if (this.options.keepRow) {
            that.options.selectedIndex = selected.index();
            that._destroyed = [];
        }

        that._renderContent(data, colspan, groups);

        that._renderLockedContent(data, colspan, groups);

        that._footer();

        that._setContentHeight();

        that._setContentWidth(offsetLeft);

        if (that.lockedTable) {
            //requires manual trigger of scroll to sync both tables
            if (that.options.scrollable.virtual) {
                that.content.find(">.k-virtual-scrollable-wrap").trigger("scroll");
            } else if (that.touchScroller) {
                that.touchScroller.movable.trigger("change");
            } else {
                that.content.trigger("scroll");
            }
        }

        if (currentIndex >= 0) {
            that._removeCurrent();
            if (!isCurrentInHeader) {
                that.current(that.tbody.find('tr[data-uid="'+uid+'"] > td'));
            } else {
                that.current(that.thead.find("th:not(.k-group-cell)").eq(currentIndex));
            }
        }

        if (that.touchScroller) {
            that.touchScroller.contentResized();
        }

        if (that.selectable) {
            that.selectable.resetTouchEvents();
        }

        that._angularItems("compile");

        if (that.options.addRow !== true && that.tbody.find('tr[data-uid="'+uid+'"]').length === 0 && that.dataSource._destroyed.length === 0) {
            that.tbody.find('tr').removeClass('k-state-selected');
            that.trigger('dataBound');
        } else if (uid) {
            setRightStyle(that);
            that.select(that.tbody.find('tr[data-uid="'+uid+'"]'));
        }

        that.options.keepRow = false;
        that.options.addRow = false;
    };
    /**
     * 카드리스트 이전 행 선택
     */
    CardList.prototype.keepRow = function () {
        var self = this;

        self._card.options.keepRow = true;
    };

    /**
     * 카드리스트 포커스 설정
     */
    CardList.prototype.setFocus = function () {
        var self = this,
            selectedIndex = self._card.select().index();

        self.select(selectedIndex);
    };
    // 카드리스트 스타일 설정
    function setRightStyle(card) {

        var cardlist = card;
        // 1줄 사용 코드
        if ($('.dews-cardlist-template', cardlist.element).hasClass('single')) {
            if ($('.dews-cardlist-main-text', cardlist.element).length !== 0) {
                $('.dews-cardlist-main-text', cardlist.element).css('top', 'calc(50% - ' + ($('.dews-cardlist-main-text', cardlist.element).height() / 2) + 'px)');
            }
        }

        // icon 영역이 존재하는 경우 설정
        if ($('.dews-cardlist-icon.checkbox', cardlist.element).length !== 0) {
            $('.dews-cardlist-icon.checkbox', cardlist.element).css('top', 'calc(50% - ' + ($('.dews-cardlist-icon.checkbox', cardlist.element).height() / 2) + 'px)');
        }

        // 오른쪽 텍스트 가운데 설정
        if ($('.dews-cardlist-right-text', cardlist.element).length !== 0 && !$('.dews-cardlist-right-text', cardlist.element).hasClass('bottom')) {
            $('.dews-cardlist-right-text', cardlist.element).css('top', 'calc(50% - ' + ($('.dews-cardlist-right-text', cardlist.element).height() / 2) + 'px)');
        }

        if (cardlist.items().length === 0) {
            cardlist.element.find('.k-grid-content-expander').css('width', cardlist.element.find('.k-grid-content > table').width());
        }
    }

    /**
     * 카드리스트에서 부모 데이터 컨트롤의 데이터 반환
     * @return {*} 부모 데이터 컨트롤의 데이터
     */
    CardList.prototype.getParentData = function () {
        var self = this;

        if (self.options.dataSource && self.options.dataSource.options.parent) {
            return self.options.dataSource.options.parent.data();
        }
    };

    /**
     * 카드리스트에서 자식 데이터 컨트롤의 데이터 반환
     * @param index 가져올 행의 자식 데이터의 인덱스
     * @return {*} 가져올 자식 데이터
     */
    CardList.prototype.getChildData = function (index, gridId) {
        var self = this,
            data = self.dataItem(index),
            uid,
            detail,
            dataSourceId,
            masterDataSource = self.options.dataSource,
            detailDatSource;

        if ($.type(data) === 'undefined') {
            return;
        }

        if ($.type(masterDataSource) !== 'undefined') {
            detailDatSource = masterDataSource.options.detailDataSource;
        }

        if ($.type(gridId) !== 'undefined') {
            detail = $('#' + gridId, self.$content).data('dews-control');
            if (detail.options.dataSource && detail.options.dataSource.options.parentDataSource) {
                dataSourceId = detail.options.dataSource.options.parentDataSource.id;
            }

            if ($.type(dataSourceId) !== 'undefined') {
                detailDatSource = masterDataSource.options.master[dataSourceId];
            }
        }

        uid = data._uid;
        if ($.type(uid) !== 'undefined') {
            if (masterDataSource && detailDatSource && detailDatSource.options.lineDataSources[uid]) {
                return detailDatSource.options.lineDataSources[uid].data();
            }
        }
    };

})(jQuery, window.dews, window.kendo);


/*
 * 챠트
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        type: '',
        title: {
            position: "top",
            align: "left",
            color: "#4a4a4a",
            font: "16px 'Graphic",
            padding: {
                bottom: 10
            }
        },
        seriesColors: ['#1c90fb', '#7ace4c', '#febc2c', '#fc6f7f', '#9a83ff', '#0071d0', '#12cbf6', '#50e3c2', '#f4588b', '#ff9177', '#61baff'],
        seriesDefaults: {
            stack: false,
            labels: {
                visible: false,
                background: "transparent"
            },
            overlay: {
                gradient: "none"
            },
            border: {
                width: 0
            }
        },
        chartArea: {
            background: "transparent"
        },
        autoBind: true,
        tooltip: {
            visible: true,
            color: "#000",
            border: {
                width: 2,
                opacity: 1
            },
            opacity: 0.85
        },
        legend: {
            visible: true,
            position: "top",
            align: "start",
            color: "#4a4a4a"
        },
        categoryAxis: {
            color: "#8c8c8c",
            line: {
                visible: false
            },
            majorGridLines: {
                visible: false
            }
        },
        valueAxis: {
            color: "#8c8c8c",
            line: {
                visible: false,
                color: "#e8e8e8",
                width: 1
            },
            minorGridLines: {
                visible: false
            }
        },
        xAxis: {
            color: "#8c8c8c",
            title: {
                font: "13px Graphic",
                color: "#000"
            }
        },
        yAxis: {
            color: "#8c8c8c",
            title: {
                font: "13px Graphic",
                color: "#000"
            }
        }
    };

    /**
     * 챠트 생성을 위한 옵션을 생성합니다.
     * @param {object} srcOptions 소스코드에서 전달된 옵션
     * @returns {object} 옵션
     */
    function getOptions(srcOptions) {
        var options = $.extend(true, {}, defaultOptions);

        if (srcOptions) {
            // 차트 타입에 따른 옵션 설정
            if ($.type(srcOptions.type) === 'string') {
                switch (srcOptions.type) {
                    case 'pie':
                    case 'donut':
                        options.legend.position = 'bottom';
                        options.legend.align = "center";
                        break;
                    case 'area':
                        $.extend(true, options.seriesDefaults, {
                            markers: {
                                visible: true,
                                type: "circle",
                                size: 6,
                                background: "#fff",
                                border: {
                                    width: 1
                                }
                            },
                            area: {
                                opacity: 0.1,
                                line: {
                                    width: 2
                                }
                            }
                        });
                        break;
                    case 'line':
                        $.extend(true, options.seriesDefaults, {
                            markers: {
                                visible: true,
                                type: "circle",
                                size: 6,
                                background: "#fff",
                                border: {
                                    width: 1
                                }
                            }
                        });
                        break;
                    case 'scatter':
                        $.extend(true, options.seriesDefaults, {
                            markers: {
                                visible: true,
                                type: "circle",
                                size: 6,
                                background: function (e) {
                                    return e.series.color;
                                },
                                border: {
                                    width: 1
                                }
                            }
                        });
                        break;

                }
            }
            // 제목 설정
            if ($.type(srcOptions.title) === 'string') {
                srcOptions.title = {
                    text: srcOptions.title
                };
            }
            // 도넛 내 텍스트 설정
            if ($.type(srcOptions.inner) === 'object' && srcOptions.type.toLowerCase() === 'donut' && $.type(srcOptions.series) === 'array') {
                srcOptions.series[0].visual = function (e) {
                    center = e.center;
                    radius = e.radius;

                    return e.createVisual();
                };

                var fontsize = $.type(srcOptions.inner.fontSize) === 'number' ? srcOptions.inner.fontSize : 18;

                options.render = function (e) {
                    var draw = kendo.drawing;
                    var geom = kendo.geometry;
                    var chart = e.sender;
                    var circleGeometry = new geom.Circle(center, radius);
                    var bbox = circleGeometry.bbox();
                    var text = new draw.Text(srcOptions.inner.text, [0, 0], {
                        font: fontsize + "px Graphic"
                    });
                    draw.align([text], bbox, "center");
                    draw.vAlign([text], bbox, "center");

                    e.sender.surface.draw(text);
                }
            }
        }

        options = customizingOptions($.extend(true, options, srcOptions));

        return options;
    }

    /**
     * 차트의 옵션 설정
     * @param opt 설정할 옵션
     * @return {*} 변경된 옵션
     */
    function customizingOptions(opt) {
        var options = opt;

        // 차트 타입 설정
        if ($.type(options.type) === 'string') {
            options.seriesDefaults.type = options.type;
        }

        // 차트 너비 설정
        if ($.type(options.width) === 'number') {
            options.chartArea.width = options.width;
        }

        // 차트 높이 설정
        if ($.type(options.height) === 'number') {
            options.chartArea.height = options.height;
        }

        // 차트 색상 설정
        if ($.type(options.colors) === 'array') {
            options.seriesDefault = options.colors;
        }

        // 차트 스택 설정
        if ($.type(options.stack) === 'boolean') {
            options.seriesDefaults.stack = options.stack;
        }

        return options;
    }

    function Chart($el, opt) {
        var self = this,
            options;

        options = getOptions(opt);
        self._$element = $el;
        self._chart = $el.kendoChart(options).data('kendoChart');
        self.options = options;

        self._bindEvent();

        if (self.options.autoBind && $.type(self.options.dataSource) === 'object') {
            self.options.dataSource.read();
        }

        return self;
    }

    /**
     *  차트의 기본 이벤트를 설정합니다.
     */
    Chart.prototype._bindEvent = function () {
        var self = this;

        if (self.options.type.toLowerCase() === 'polarline') {
            self._chart.bind('dataBound', function (e) {
                if ($.type(self.options.dataSource) !== 'undefined') {
                    var data = self.options.dataSource.data();
                    var seriesIndex = 0;
                    var xField = self.options.series[0].xField;
                    var yField = self.options.series[0].yField;
                    var preData = '';
                    self.options.series = [];
                    $.each(data, function (idx, value) {
                        if (idx === 0) {
                            preData = value[self.options.seriesDefaults.categoryField];
                        }

                        if (preData !== value[self.options.seriesDefaults.categoryField]) {
                            seriesIndex++;
                            preData = value[self.options.seriesDefaults.categoryField];
                        }

                        if (value.hasOwnProperty(self.options.seriesDefaults.categoryField)) {
                            if ($.type(self.options.series[seriesIndex]) === 'undefined') {
                                self.options.series[seriesIndex] = {
                                    data: []
                                };
                            }
                            self.options.series[seriesIndex].data.push([value[xField], value[yField]]);
                        }
                    });

                    self._chart.setOptions(self.options);
                    self._chart.refresh();
                }
            });
        }
    };

    /**
     * 차트의 데이터소스를 설정합니다.
     * @param dataSource 데이터소스 객체
     */
    Chart.prototype.setDataSource = function (dataSource) {
        var self = this;

        self._chart.setDataSource(dataSource);
        self.options.dataSource = dataSource;
    };

    /**
     * 차트의 이벤트를 설정합니다.
     */
    Chart.prototype.on = function () {
        var self = this;

        self._chart.bind.apply(self._chart, arguments);
    };

    /**
     * 차트의 이벤트를 제거합니다.
     */
    Chart.prototype.off = function () {
        var self = this;

        self._chart.unbind.appy(self._chart, arguments);
    };

    $.extend(true, dews, {
        ui: {
            /**
             * 챠트를 생성하거나 가져옵니다.
             * @param {jQuery|string} selector 챠트가 될 대상의 jQuery 객체 또는 셀렉터
             * @param {object} [options] 생성 옵션
             */
            chart: function (selector, options) {
                var $ctl, chart;

                if (selector instanceof jQuery) {
                    $ctl = selector;
                } else if ($.type(selector) === 'string') {
                    $ctl = $(selector);
                } else {
                    throw '챠트를 생성할 대상이 제공되지 않았습니다.';
                }

                $ctl.each(function () {
                    var $this = $(this),
                        opt, charts;

                    chart = $this.data('dews-control');

                    if (!chart) {

                        charts = new Chart($this, options);

                        if (!$this.hasClass('dews-ui-chart')) {
                            $this.addClass('dews-ui-chart');
                        }
                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', charts);

                        chart = charts;
                    }
                });

                return chart;
            }
        }
    });
})(jQuery, window.dews, window.kendo);


/**
 * 체크 박스
 */
(function ($, dews, kendo) {

    function Checkbox(selector){
        var self = this;
        self.target = selector;

        self._createLabel();

        self._setClass();
    }

    Checkbox.prototype._setClass = function(){
        var self = this,
            $this = self.target;

        if (!$this.hasClass('dews-control')) {
            $this.addClass('dews-control');
        }

        if (!$this.hasClass('dews-ui-checkbox')) {
            $this.addClass('dews-ui-checkbox');
        }

        if (!$this.hasClass('k-checkbox')) {
            $this.addClass('k-checkbox');
        }

        if (!$this.hasClass('dews-control-activate')) {
            $this.addClass('dews-control-activate');
        }

    };

    Checkbox.prototype._createLabel = function(){
        var self = this,
            $label = $('<label class="dews-checkbox-label k-checkbox-label"></label>');
        var $textLabel;

        self.target.wrap('<span class="dews-checkbox-wrapper"/>');
        self.target.after($label);

        $textLabel = self.target.parent().siblings('label[for='+self.target.attr('id') + ']');
        if($textLabel[0] && $textLabel.data('dews-localize-key')) {
            $textLabel.text(dews.localize.get($textLabel.text(), $textLabel.data('dews-localize-key'), $textLabel.data('dews-localize-lang') || null));
        }

        $label.on('click', function () {
            self.target.click();
        });
    };

    Checkbox.prototype.focus = function(){
        var self = this;

        self.target.focus();
    };

    Checkbox.prototype.on = function() {
        var self = this;

        self.target.on.apply(self.target, arguments);
    };

    Checkbox.prototype.off = function() {
        var self = this;

        self.target.off.apply(self.target, arguments);
    };

    Checkbox.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self.target);
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                $element.prop('checked', data[column]);
            }
        }
    };

    Checkbox.prototype.serializeForPanel = function () {
        var self = this, $element = $(self.target);
        var column;
        var data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = $element.prop('checked');
        }

        return data;
    };

    Checkbox.prototype.applyPanelFocus = function () {
        var self = this, $element = $(self.target);

        $element.on ('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    Checkbox.prototype.canFocusable = function () {
        var self = this, $element = $(self.target);

        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    };
    /**
     * 체크박스 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    Checkbox.prototype._getPrintData = function () {
        var self = this,
            $el = $(self.target),
            data;

        if ($el.is(':checked')) {
            data = {
                id: $el.attr('id'),
                text: true
            }
        }

        return data;
    };

    $.extend(true, dews, {
        ui: {
            /**
             * Checkbox를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 요소를 지정하는 셀렉터 또는 jQuery객체입니다.
             */
            checkbox: function (selector) {
                var $el,box;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                $el.each(function () {
                    var $this = $(this),
                        chkBox;

                    chkBox = $this.data('dews-control');

                    if(!chkBox){
                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        chkBox = new Checkbox($this);
                        $this.data('dews-control',chkBox);
                    }

                    box = chkBox;
                });

                return box;
            }
        }
    });

    dews.ui.addControlInitializer('checkbox', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.checkbox($('input[type=checkbox].dews-ui-checkbox', $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 코드도움 AJAX 및 다이얼로그 처리
 */
(function ($, dews, kendo) {

    /**
     * 코드도움 AJAX 요청 객체
     * @param {string} code 코드도움 코드
     * @param {object} params 코드도움 AJAX 요청에 필요한 추가적인 파라미터 객체
     * @constructor
     */
    var CodeHelpAjax = function (code, params, custom, apiUrl) {
        var self = this;

        self.code = code;
        self.params = params;

        if(custom) {
            self.url = apiUrl;
        } else {
            self.url = dews.string.format(dews._environments.codeDataUrlFormat, self.code);
        }
    };

    /**
     * AJAX 요청을 보냅니다.
     * @returns {Promise} AJAX 요청에 대한 Promise 객체
     */
    CodeHelpAjax.prototype.getCodeData = function () {
        var self = this,
            options = {};

        options.data = self.params;

        return dews.ajax.get(self.url, options);
    };

    /**
     * 코드 도움을 위한 다이얼로그 입니다.
     * @param {string} code 코드도움창 코드
     * @param {object} params 추가적인 파라미터
     * @param {string} title 코드도움창 타이틀
     * @param {string} mode 코드도움창 작동 방식(single|multi)
     * @param {number} width 코드도움창 너비
     * @param {number} height 코드도움창 높이
     * @param {object} initData 코드도움창 초기 데이터
     * @constructor
     */
    var CodeHelpDialog = function (code, params, title, mode, width, height, initData, custom, viewUrl, $target) {
        var self = this;

        self.code = code;
        self.params = params;
        self.title = title;
        self.mode = mode;
        self.width = width;
        self.height = height;
        self.initData = initData;
        self.custom = custom;
        self.viewUrl = viewUrl;

        self.$target = $target;
    };

    /**
     * 코드도움 다이얼로그를 엽니다.
     * @param {function} callback 다이얼로그에서 데이터를 설정할 때 실행할 콜백 함수
     */
    CodeHelpDialog.prototype.open = function (callback) {
        var self = this,
            dialog,
            options,
            initData = {}, buttonArea;

        // 다이얼로그 옵션을 생성합니다.
        options = {
            url: dews.url.getCodeViewUrl(self.code),
            iframe: false,
            buttons: 'applyAndClose',
            ok: callback,
            cancel: null
        };

        if(self.custom) {
            options.url = self.viewUrl;
        }

        if (self.code) {
            $.extend(true, initData, { code: self.code});
        }

        if (self.params) {
            options.url = dews.url.appendParameters(options.url, self.params);
            $.extend(true, initData, { params: self.params });
        }

        if ($.type(self.title) !== 'undefined' && $.trim(self.title)) {
            options.title = self.title;
            options.url = dews.url.appendParameters(options.url, { tl: self.title });
            $.extend(true, initData, { title: self.title });
        }

        if ($.type(self.width) !== 'undefined' && self.width) {
            options.width = self.width;
        }

        if ($.type(self.height) !== 'undefined' && self.height) {
            options.height = self.height;
        }

        if (self.mode) {
            $.extend(true, initData, { mode: self.mode });

            if (self.mode === 'multi') {
                options.url = dews.url.appendParameters(options.url, { mt : 1 });
            }
        }

        // 다이얼로그 작성
        dialog = dews.ui.dialog(self.code, options);

        if (initData) {
            $.extend(true, initData, { data: self.initData });
            dialog.setInitData(initData);
        }

        dews.log(
            '## dews-ui-codehelp : 다이얼로그 열기 ##\n' +
            '초기화 데이터: ' + JSON.stringify(initData)
        );
        // 다이얼로그 열기
        dialog.open();

        if (dialog._kendoWindow) {
            dialog._kendoWindow.bind('deactivate', function () { // deactivate 로 바꾼 이유는 애니메이션이 끝나고 실행하기 위함
                setTimeout(function () {
                    self.$target.trigger('codedialogclosed');
                }, $('.k-window.dialog').length > 1 ? 200 : 0); // 다이얼로그가 2개 이상의 다이얼로그가 떠있을 때만, 0.2초를 지연시킴. 아닐때는 똑같이 처리.
            });
        }
    };

    $(document).ready(function () {
        // 코드피커에서 생성된 이벤트들의 처리를 담당한다.

        // 코드도움 데이터 요청에 대한 설정은 이벤트 객체에 함께 들어오므로 그 정보로 AJAX 요청을 수행한다..
        $(document).on('codesearch', '.dews-ui-codepicker, .dews-ui-grid, .dews-ui-treegrid', function (e) {
            var code = e.code || '',        // 코드도움 코드
                params = e.params || {},    // 코드도움 요청을 위한 파라미터
                custom = e.custom,
                url = e.apiUrl,             // 코드도움 사용자 정의 데이터 URL
                callback = e.callback,      // 데이터를 설정하는 콜백 함수
                $target = $(e.target),      // 이벤트를 발생시킨 엘리먼트(코드피커 컨트롤 외)
                ajax, data;

            // AJAX로 데이터를 요청
            if (code) {
                ajax = new CodeHelpAjax(code, params, custom, url);

                // AJAX 로 데이터 요청을 시작했다는 이벤트를 발생시킨다.
                // 컨트롤에서 이벤트로 로딩처리 등을 수행합니다.
                $target.trigger('ajaxstart');

                ajax.getCodeData().done(function (data) {
                    // 서버에서 가져온 데이터를 요청 컨트롤에 전달
                    if (data && data.data) {
                        dews.log('## dews-ui-codehelp: 코드 데이터 ##\n' +  JSON.stringify(data.data));

                        if (typeof callback === 'function') {
                            callback.call(e.target, data.data);
                        }
                    } else if (data.state === 'error') {
                        if (typeof callback === 'function') {
                            callback.call(e.target);
                        }
                    }
                }).fail(function () {
                    // 서버 오류가 발생했거나 요청이 실패했을 경우
                    $target.trigger('ajaxerror');
                }).always(function () {
                    // AJAX 데이터 요청이 끝났음을 해당 컨트롤에 알려줍니다.
                    $target.trigger('ajaxcomplete');
                });
            }
        });


        // 코드 도움 다이얼로그 오픈 이벤트 처리
        $(document).on('codedialog', '.dews-ui-codepicker, .dews-ui-multicodepicker, .dews-ui-grid, .dews-ui-treegrid', function (e) {
            var code = e.code || '',
                size = e.size || 'medium',
                params = e.params || {},
                title = e.title || "",
                mode = e.mode || 'single',
                width = e.width,
                height = e.height,
                initData = e.initData,
                callback = e.callback,
                custom = e.custom,
                viewUrl = e.viewUrl,
                dialog,
                $target = $(e.target);

            if (code) {
                switch (size.toUpperCase()) {
                    case 'SMALL':
                        width = width || 360;
                        height = height || 397;
                        size = 'small';
                        break;
                    case 'LARGE':
                    case 'BIG':
                        width = width || 746;
                        height = height || 537;
                        size = 'large';
                        break;
                    case 'EXTRA':
                    case 'LARGEBIG':
                        width = width || 818;
                        height = height || 630;
                        size = 'large';
                        break;
                    default :
                        width = width || 560;
                        height = height || 537;
                        size = 'medium';
                        break;
                }
            }

            if (e.isDefaultPrevented()) {
                return;
            }

            dialog = new CodeHelpDialog(code, params, title, mode, width, height, initData, custom, viewUrl, $target);

            $.extend(true, dews, {
                ui: {
                    codehelp: {
                        setKeyboardNavigation : function (textbox, grid, dialog) {
                            textbox.on('keydown', function (e) {
                                e.stopPropagation();
                                if(e.keyCode === 13) {
                                    grid.dataSource.read();
                                    grid.setFocus();
                                } else if (e.keyCode === 27) {
                                    dialog.close();
                                }
                            });

                            grid._grid.onKeyDown = function (_grid, key) {
                                e.stopPropagation();
                                if (key === 13) {
                                    if(dialog.getInitData().mode === 'multi') {
                                        dialog.ok(grid.getCheckedRows());
                                    } else {
                                        dialog.ok(grid.dataItem(grid.select()));
                                    }
                                } else if (key === 27) {
                                    dialog.close();
                                }
                            };

                            dialog.$content.on('keydown', function (e) {
                                e.stopPropagation();
                                if(e.keyCode === 13) {
                                    if(dialog.getInitData().mode === 'multi') {
                                        dialog.ok(grid.getCheckedRows());
                                    } else {
                                        dialog.ok(grid.dataItem(grid.select()));
                                    }
                                }
                            });
                        }
                    }
                }
            });

            dialog.open(callback);

        });
    });
})(jQuery, window.dews, window.kendo);


/**
 * 코드 도움 에디터
 */
(function ($, dews) {

    // 기본 옵션 값
    var defaultOptions = {
        useButton: true,    // 찾기 버튼의 사용 여부
        useKeyword: true,   // 검색어 입력을 받는지 여부
        codeField: 'code',  // 검색 결과에서의 코드 필드명
        textField: 'text',  // 검색 결과에서의 텍스트 필드명
        useAjax: true,      // 도움창 오픈 전 AJAX를 통해서 먼저 확인할 지 여부
        helpCode: null,     // 도움창의 아이디 및 코드 도움 요청 코드
        helpSize: 'medium',  // 도움창의 코드 타입
        helpParams: null,   // 코드 도움 및 도움창 요청에 추가적으로 필요한 파라미터
        helpTitle: '',      // 도움창의 타이틀
        helpCustom: false,  // 사용자 정의 도움창 사용 여부
        helpViewUrl: '',    // 도움창 View URL (생략시 도움창 View URL을 자동 생성)
        helpApiUrl: '',     // 도움창 Data URL (생략시 도움창 Data URL을 자동 생성)
        helpWidth: null,    // 도움창 기본 너비
        helpHeight: null    // 도움창 기본 높이
    };

    /**
     * 코드피커 요소에 지정되어 있는 코드 도움 추가 파라미터를 객체로 가져옵니다.
     * @param $element 코드피커 요소의 jQuery 객체
     * @returns {object} QueryString형태로 지정된 코드 도움 파라미터를 객체로 변경한 것
     */
    function getHelpParams($element) {
        var str = $element.data('dews-help-params'),
            data = defaultOptions.helpParams;

        if (str) {
            data = $.deparam(str);
        }

        return data;
    }

    /**
     * 코드피커를 생성하기 위한 클래스
     * @param {HTMLElement} element 코드피커 요소
     * @param {object} options 코드피커 옵션
     * @constructor
     */
    var CodePicker = function (element, options) {
        var self = this,
            $element = $(element);
        var inlineOptions;

        inlineOptions = getInlineOptions($element, defaultOptions);

        self.options = $.extend(true, {}, defaultOptions, inlineOptions, options);

        self._element = element;
    };

    function getInlineOptions($element, defaultOptions) {
        var options = {};
        var inlineData = {
            useButton: $element.data('dews-use-button') || defaultOptions.useButton,
            useKeyword: $element.data('dews-use-keyword') || defaultOptions.useKeyword,
            codeField: $element.data('dews-code-field') || defaultOptions.codeField,
            textField: $element.data('dews-text-field') || defaultOptions.textField,
            useAjax: $element.data('dews-ajax'),
            helpCode: $element.data('dews-help-code') || defaultOptions.helpCode,
            helpSize: $element.data('dews-help-size') || defaultOptions.helpSize,
            helpParams: getHelpParams($element),
            helpTitle: dews.localize.get($element.data('dews-help-title'), $element.data('dews-localize-key'), $element.data('dews-localize-lang') || null) || defaultOptions.helpTitle,
            helpCustom: $element.data('dews-help-custom') || defaultOptions.helpCustom,
            helpViewUrl: $element.data('dews-help-view-url') || defaultOptions.helpViewUrl,
            helpApiUrl: $element.data('dews-help-api-url') || defaultOptions.helpApiUrl,
            helpWidth: $element.data('dews-help-width') || defaultOptions.helpWidth,
            helpHeight: $element.data('dews-help-height') || defaultOptions.helpHeight
        };

        options = $.extend(true, options, defaultOptions, inlineData);

        return options
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.siblings('.dews-ui-codepicker').attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.siblings('.dews-ui-codepicker').attr('id'));
                }
            }
        });
    }

    /**
     * 코드피커의 외부 컨테이너를 생성합니다.
     * @private
     */
    CodePicker.prototype._createContainer = function () {
        var self = this,
            $el = $(self._element),
            $wrapper,
            cssProperties;

        $wrapper = $("<span />").addClass('dews-codepicker-wrapper dews-control k-textbox');

        if ($el.attr('style')) {
            var matches;

            matches = $el.attr('style').match(/width:([^;]+);?/i);
            if (matches && matches.length > 0) {
                $wrapper.width($.trim(matches[1]));
            }
        }

        // 상태 클래스 추가
        if ($el.prop('readonly') && !$el.hasClass('readonly')) {
            $el.addClass('readonly');
        } else if ($el.hasClass('readonly') && !$el.prop('readonly')) {
            $el.prop('readonly', true);
        }
        if ($el.prop('disabled') && !$el.hasClass('disabled')) {
            $el.addClass('disabled');
        } else if ($el.hasClass('disabled') && !$el.prop('disabled')) {
            $el.prop('disabled', true);
        }

        if ($el.hasClass('readonly')) {
            $wrapper.addClass('dews-state-readonly');
        }
        if ($el.hasClass('disabled')) {
            $wrapper.addClass('dews-state-disabled');
        }
        if ($el.hasClass('required')) {
            $wrapper.addClass('dews-state-required');
        }
        if ($el.hasClass('etc1')) {
            $wrapper.addClass('dews-state-etc1');
        }
        if ($el.hasClass('etc2')) {
            $wrapper.addClass('dews-state-etc2');
        }
        if ($el.hasClass('etc3')) {
            $wrapper.addClass('dews-state-etc3');
        }

        if ($el.attr('id')) {
            $wrapper.attr('id', $el.attr('id') + '-wrapper');
        }

        $el.wrap($wrapper);

        if (!$el.hasClass('dews-ui-codepicker')) {
            $el.addClass('dews-ui-codepicker');
        }

        if (!$el.attr("name") && $el.attr("id")) {
            // 코드피커 요소에 id는 지정되어 있는데 name이 지정되어 있지 않으면 name을 id와 동일하게 설정한다.
            $el.attr('name', $el.attr('id'));
        }
    };

    /**
     * 코드피커의 찾기 버튼을 생성합니다.
     * @private
     */
    CodePicker.prototype._createButton = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $button;

        if (self.options.useButton === true && $el.prop('readonly') === false && $el.prop('disabled') === false) {
            // 찾기 버튼은 옵션에서 useButton이 설정되어 있고, 대상 컨트롤이 readonly가 아니어야 합니다.
            if (!$wrapper.hasClass('k-space-right')) {
                $wrapper.addClass('k-space-right');
            }

            if ($wrapper.find("button.dews-codepicker-button").length === 0) {
                $button = $('<button type="button"><span class="dews-icon icon-search"></span></button>').addClass('dews-codepicker-button');

                // 대상 요소의 뒤에 버튼을 추가
                $el.after($button);

                $button.on('click', function (e) {
                    // 찾기 버튼 클릭에 대한 이벤트 발생
                    var keyword, $text;

                    $text = $('.dews-codepicker-text', $wrapper);
                    keyword = $text.val();

                    self._triggerCodeDialog(keyword, null);
                });
            }
        }
    };

    /**
     * 코드피커의 찾기 버튼을 제거합니다.
     * @private
     */
    CodePicker.prototype._removeButton = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $button = $wrapper.find('button.dews-codepicker-button');

        if (self.options.useButton && $button.length > 0) {
             $wrapper.removeClass('k-space-right'); // 래퍼에서 우측 버튼 클래스를 제거한다.
            $button.remove(); // 버튼을 제거한다.
        }
    };

    /**
     * 코드 정보를 보관할 메인 텍스트박스 엘리먼트에 추가적인 부분을 꾸밉니다.
     * @private
     */
    CodePicker.prototype._decorateCodeElement = function () {
        var self = this,
            $el = $(self._element);

        $el.addClass('dews-codepicker-code');
        $el.css('display', 'none');
    };

    /**
     * 텍스트 출력 및 검색 값 입력을 위한 엘리먼트를 생성해서 추가합니다.
     * @private
     */
    CodePicker.prototype._createTextElement = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text,
            text_id;

        text_id = $el.attr('id') + '_text';
        $text = $('<input type="text" />').attr('id', text_id).prop('readonly', $el.prop('readonly')).prop('disabled', $el.prop('disabled')).addClass('dews-codepicker-text');

        if (!self.options.useKeyword) {
            $text.prop('readonly', true);
        }

        // 포커스를 받았을 때 외부 컨테이너에 포커스 효과를 주기 위한 처리
        $text.on('focus', function () {
            $wrapper.addClass('dews-codepicker-wrapper-focused');
        }).on('blur', function () {
            $wrapper.removeClass('dews-codepicker-wrapper-focused');
        });

        // 텍스트용 input을 추가한다.
        $el.after($text);
    };

    /**
     * 컨트롤에 설정된 기본 코드 및 텍스트를 적용합니다.
     * @private
     */
    CodePicker.prototype._setDefaultData = function () {
        var self = this,
            $el = $(self._element),
            code, text, data;

        code = $el.data('code') || '';
        text = $el.data('text') || '';

        data = {};
        data[self.options.codeField] = code;
        data[self.options.textField] = text;

        self.setData(data);
    };

    /**
     * 코드피커의 코드나 텍스트가 변경되어 정보가 유효하지 않다는 표시를 추가합니다.
     * @private
     */
    CodePicker.prototype._setDirtyFlag = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper');

        $wrapper.addClass('dews-dirty-data');
    };

    /**
     * 코드피커의 코드나 텍스트 정보가 유효하지 않다는 표시를 제거합니다.
     * @private
     */
    CodePicker.prototype._removeDirtyFlag = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        $wrapper.removeClass('dews-dirty-data');
    };

    CodePicker.prototype._setTooltip = function($text){
        var self = this;
        var $item = $(self._element).parent();

        self._tooltip = dews.ui.tooltip.show($item, {
            type: 'normal',
            text: $text.attr('data-original-title'),
            fadeOutTime: 0
        });
    };

    /**
     * 코드피커에 이벤트들을 등록합니다.
     * @private
     */
    CodePicker.prototype._bindEvents = function () {
        var self = this, $btn,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper),
            helpEvent, keyword;

        // 입력 텍스트박스(temp)에 대한 이벤트 바인딩
        $text.on('keyup', function (e) {
            var $this = $(this),
                isDirty = false;

            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 키보드 키 입력 처리
                var key = e.keyCode || e.which;
                if (key !== 13 && key !== 115) { // 엔터키 제외
                    // 텍스트가 변경되면 컨트롤의 Dirty 플래그를 변경한다.
                    isDirty = ($this.val() !== $el.data('text'));

                    if (isDirty) {
                        if ($this.val() === '') {
                            // 텍스트박스(temp)의 내용을 전부 지우면 코드피커의 데이터를 초기화합니다.
                            self.clearData();
                        } else {
                            self._setDirtyFlag();
                        }
                    } else {
                        self._removeDirtyFlag();
                    }
                }
            }
        }).on('keydown', function (e) {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                var key = e.keyCode || e.which;

                if (key === 9 && e.shiftKey) {
                    e.preventDefault();
                    previousFocus(self, $el);
                } else if (key === 13 && (e.shiftKey || e.ctrlKey || e.altKey)) {
                    e.preventDefault();
                } else if (key === 13 || key === 9) {
                    // 현재 셋팅되어 있는 키워드가 이전에 선택한 항목의 텍스트와 다를 때만 이벤트를 발생한다.
                    keyword = $this.val();
                    if (keyword && keyword !== $el.data('text')) {
                        if (self.options.useAjax === true) {
                            // 코드도움창을 띄우기 전에 먼저 AJAX를 통해서 조회를 실시하는 경우
                            self._triggerCodeSearch(keyword);
                        } else {
                            // 코드도움창을 띄우는 경우
                            self._triggerCodeDialog(keyword, null);
                        }
                    } else if (self.hasOwnProperty('usePanelFocus') && self.usePanelFocus) {
                        if (key === 9) {
                            e.preventDefault();
                        }
                        nextFocus(self, $el);
                    }
                }
                if (key === 115) {
                    $btn = $('.dews-codepicker-button', $wrapper);

                    // F4 - 도움창 띄우기 단축키
                    e.preventDefault();
                    if ($btn.is(':visible:enabled')) { // 버튼이 활성화 되어 있을 경우가 도움창 띄우기가 가능한 경우
                        e.stopPropagation();
                        $btn.click(); // 버튼 클릭 이벤트와 동일한 작업이 필요하므로 버튼 클릭 이벤트를 발생
                    }
                }

            }
        }).on('dblclick', function (e) {
            var $this = $(this);

            // 기본 이벤트 실행 및 이벤트 전파를 무효화 시킵니다.
            e.preventDefault();
            e.stopPropagation();

            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 마우스 더블클릭으로 텍스트 전체가 선택되는 현상을 막습니다.
                if (this.setSelectionRange) {
                    this.setSelectionRange($this.val().length, $this.val().length);
                }

                keyword = $this.val();

                // 마우스 더블클릭 => 도움창 띄우기
                self._triggerCodeDialog(keyword, null);
            }
        }).on('click', function () {
            // 포커스 이벤트를 이용할 경우 전체 선택 후 다시 선택이 해제되므로 클릭 이벤트에서 처리합니다.
            if ($(this).prop('readonly') === false && $(this).prop('disabled') === false) {
                // 읽기 전용이 아닐 경우에는 포커스가 오면 텍스트 전체를 선택합니다.
                $(this).select();
            }
        }).on('focus', function () {
            if (!$wrapper.hasClass('dews-state-focused')) {
                $wrapper.addClass('dews-state-focused');
            }
        }).on('blur', function () {
            if ($wrapper.hasClass('dews-state-focused')) {
                $wrapper.removeClass('dews-state-focused');
            }
        }).on('mouseover', function () {
            if($text.attr('data-original-title') ) {
                self._setTooltip($text);
            }
        }).on('mouseleave', function () {
            if(self._tooltip) {
                self._tooltip._delete();
            }
        });

        $el.on('codedialogclosed', function (e) {
            // 공통도움창에서 ESC키 혹은 close 시켰을 경우에만 발생하게 설정
            if (self.isDirty()) {
                if (self.code() === '' && self.text() === '') {
                    self.clearData();
                } else {
                    var data = {};
                    data[$el.data('dews-code-field')] = self.code();
                    data[$el.data('dews-text-field')] = self.text();
                    self.setData(data);
                }
            }

            self.focus();
        });

        $el.on('setData', function() {
            self.focus();
        });
    };

    /**
     * 코드피커 컨트롤을 활성화 시킵니다.
     * @private
     */
    CodePicker.prototype._activate = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            eChange;

        if (!$wrapper.hasClass('dews-control-activate')) {
            $wrapper.addClass('dews-control-activate');
        }
    };

    /**
     * 코드피커 AJAX 코드 찾기 이벤트를 발생시킵니다.
     * @param {string} [keyword] 검색어
     * @private
     */
    CodePicker.prototype._triggerCodeSearch = function (keyword) {
        var self = this,
            $el = $(self._element),
            helpEvent,
            params;

        if ($.isFunction(self.options.helpParams)) {
            params = self.options.helpParams.call(self);
        } else {
            params = self.options.helpParams;
        }

        helpEvent = new $.Event('codesearch', {
            code: self.options.helpCode,
            params: $.extend(true, {}, params, {'keyword': keyword}),
            custom: self.options.helpCustom,
            apiUrl: self.options.helpApiUrl,
            callback: function (data) {
                // 데이터를 설정하는 콜백
                if (typeof(data) !== 'undefined') {
                    dews.log(
                        '## dews-ui-codepicker: codesearch 이벤트 콜백함수 실행 ##\n' +
                        'data: ' + JSON.stringify(data)
                    );
                    self.setData(data);

                    if (self.options._grid === true && $.type(self.options._gridCallback) === 'function') {

                        if ($.isArray(data) && data.length === 1) {
                            self.options._gridCallback(data[0]);
                        } else if ($.type(data) === 'object') {
                            self.options._gridCallback(data);
                        }
                    }
                }
            }
        });

        dews.log(
            '## dews-ui-codepicker: codesearch 이벤트 발생 ##\n' +
            'e.code: ' + helpEvent.code + '\n' +
            'e.params: ' + JSON.stringify(helpEvent.params)
        );

        $el.trigger(helpEvent);
    };

    /**
     * 코드 도움 다이얼로그 이벤트를 발생시킵니다.
     * @param {string} [keyword] 검색어
     * @param {object|array} [initData] 초기화 데이터
     * @private
     */
    CodePicker.prototype._triggerCodeDialog = function (keyword, initData) {
        var self = this,
            $el = $(self._element),
            helpEvent,
            params;

        initData = initData || null;

        if ($.isFunction(self.options.helpParams)) {
            params = self.options.helpParams.call(self);
        } else {
            params = self.options.helpParams;
        }

        helpEvent = new $.Event('codedialog', {
            code: self.options.helpCode,
            size: self.options.helpSize,
            params: $.extend(true, {}, params, {'keyword': keyword}),
            title: self.options.helpTitle,
            mode: 'single',
            width: self.options.helpWidth,
            height: self.options.helpHeight,
            custom: self.options.helpCustom,
            viewUrl: self.options.helpViewUrl,
            initData: initData,
            callback: function (data) {
                // 데이터를 설정하는 콜백
                if (typeof(data) !== 'undefined') {
                    dews.log(
                        '## dews-ui-codepicker: codesearch 이벤트 콜백함수 실행 ##\n' +
                        'data: ' + JSON.stringify(data)
                    );
                    if ($.isArray(data)) {
                        // 코드피커는 하나만 수용 가능하므로 코드도움 다이얼로그에서 최종 선택한 항목은 배열이 되면 안됨
                        throw '두 개 이상의 항목을 코드피커에 설정할 수 없습니다.';
                    } else {
                        if (self.options._grid === true && $.type(self.options._gridCallback) === 'function') {
                            // 그리드에서의 호출일 경우
                            // 그리드에서는 다이얼로그가 생성되면 코드피커는 사라지므로 데이터의 전달을 직접 그리드
                            // 쪽으로 해주어야 함
                            self.options._gridCallback(data);
                        } else {
                            self.setData(data);
                        }
                    }
                }
            }
        });

        dews.log(
            '## dews-ui-codepicker: codedialog 이벤트 발생 ##\n' +
            'e.code: ' + helpEvent.code + '\n' +
            'e.size: ' + helpEvent.size + '\n' +
            'e.params: ' + JSON.stringify(helpEvent.params) + '\n' +
            'e.title: ' + helpEvent.title + '\n' +
            'e.mode: ' + helpEvent.mode + '\n' +
            //'e.url: ' + helpEvent.url + '\n' +
            'e.width: ' + helpEvent.width + '\n' +
            'e.height: ' + helpEvent.height + '\n' +
            'e.initData: ' + JSON.stringify(helpEvent.initData)
        );

        $el.trigger(helpEvent);
    };

    /**
     * 코드피커를 작성합니다.
     * @private
     */
    CodePicker.prototype._render = function() {
        var self = this, $el = $(self._element);

        // 코드피커의 래퍼인 컨테이너를 생성합니다.
        self._createContainer();

        // 메인 엘리먼트를 꾸밉니다.
        self._decorateCodeElement();

        // 찾기 버튼을 생성합니다.
        self._createButton();

        // 입력 필드를 생성합니다.
        self._createTextElement();

        // 기본 데이터를 설정합니다.
        self._setDefaultData();

        // 이벤트를 셋팅합니다.
        self._bindEvents();

        setUserGuideAPI($('.dews-codepicker-text', $el.parent('.dews-codepicker-wrapper')));
    };

    /**
     * 컨트롤을 읽기 전용 상태로 만듭니다.
     * @private
     */
    CodePicker.prototype._setReadonly = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);


        if (!$wrapper.hasClass('dews-state-readonly')) {
            $wrapper.addClass('dews-state-readonly');
        }

        $el.prop('readonly', true); // code 컨트롤에 readonly를 설정

        if (!$el.hasClass('reaodnly')) {
            $el.addClass('readonly');
        }

        $text.prop('readonly', true); // text 컨트롤에 readonly를 설정
    };

    /**
     * 컨트롤의 읽기 전용 상태를 해제합니다.
     * @private
     */
    CodePicker.prototype._removeReadonly = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        if ($wrapper.hasClass('dews-state-readonly')) {
            $wrapper.removeClass('dews-state-readonly');
        }

        $el.prop('readonly', false); // code 컨트롤에서 reaodonly를 설정

        if ($el.hasClass('readonly')) {
            $el.removeClass('readonly');
        }

        $text.prop('readonly', false); // 텍스트 컨트롤에 readonly를 설정
    };

    /**
     * 컨트롤을 비활성화 상태로 만듭니다.
     * @private
     */
    CodePicker.prototype._setDisabled = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        if (!$wrapper.hasClass('dews-state-disabled')) {
            $wrapper.addClass('dews-state-disabled');
        }

        $el.prop('disabled', true);

        if (!$el.hasClass('disabled')) {
            $el.addClass('disabled');
        }

        $text.prop('disabled', true);
    };

    /**
     * 컨트롤을 활성화 상태로 돌립니다.
     * @private
     */
    CodePicker.prototype._removeDisabled = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        if ($wrapper.hasClass('dews-state-disabled')) {
            $wrapper.removeClass('dews-state-disabled');
        }

        $el.prop('disabled', false);

        if ($el.hasClass('disabled')) {
            $el.removeClass('disabled');
        }

        $text.prop('disabled', false);
    };

    /**
     * 코드 피커를 읽기 전용 여부를 설정하거나 가져옵니다.
     * @param {boolean} [value] 읽기 전용으로 설정할 것인지 여부 (생략하면 현재 읽기전용 여부를 가져옵니다.)
     * @returns {boolean} 읽기전용 여부
     */
    CodePicker.prototype.readonly = function (value) {
        var self = this,
            $el = $(self._element),
            readonly;

        readonly = $el.prop('readonly');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === true) {
                self._removeButton();
                self._setReadonly();
                readonly = value;
            } else if (value === false) {
                self._removeReadonly();
                self._createButton();
                readonly = value;
            }
        }

        return readonly;
    };

    /**
     * 코드 피커의 활성화 여부를 설정하거나 가져옵니다.
     * @param {boolean} [value] 설정할 활성화 여부(생략하면 현재 활성화 여부를 반환합니다.)
     * @retruns {boolean} 활성화 여부
     */
    CodePicker.prototype.enable = function (value) {
        var self = this,
            $el = $(self._element),
            enabled;

        enabled = !$el.prop('disabled');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === false) {
                self._removeButton();
                self._setDisabled();
                enabled = !value;
            } else if (value === true) {
                self._removeDisabled();
                self._createButton();
                enabled = !value;
            }
        }

        return enabled;
    };

    /**
     * 코드 피커의 코드 도움 파라미터를 설정합니다.
     * @param {object|function} params 설정할 파라미터 객체 또는 함수
     */
    CodePicker.prototype.setHelpParams = function (params) {
        var self = this;

        self.options.helpParams = params;
    };

    /**
     * 코드피커에 코드와 텍스트를 설정합니다.
     * @param {object} data 코드와 텍스트
     */
    CodePicker.prototype.setData = function (data) {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper),
            isArray = false,
            isTrigger = true,
            selected,
            code = '',
            text = '',
            setDataEvent,
            dialogEvent,
            changeEvent;

        if ($.type(data) === 'object' && !$.isEmptyObject(data)) {
            selected = data;
        } else if ($.isArray(data)) {
            isArray = true;
            if (data.length === 1) {
                selected = data[0];
            }
        }

        if (selected) {
            // 설정할 데이터가 단독일 경우에는 바로 설정한다.
            if (selected.hasOwnProperty(self.options.codeField)) {
                code = selected[self.options.codeField];
            }
            if (selected.hasOwnProperty(self.options.textField)) {
                text = selected[self.options.textField];
            }

            if ($.type(arguments[1]) === 'boolean') {
                if (!arguments[1]) {
                    isTrigger = false;
                }
            }
            // setData 이벤트 발생
            setDataEvent = new $.Event('setData');
            // 값이 false 일 경우 실행하지 않음
            if (isTrigger) {
                setDataEvent.code = code;
                setDataEvent.text = text;

                $el.trigger(setDataEvent, [selected]);
            }

            if (setDataEvent.isDefaultPrevented()) {
                // 이벤트 핸들러에서 preventDefault를 호출했을 때는
                // 값의 변경등을 더 이상 진행하지 않습니다.
                return;
            }

            $el.data('code', code).data('text', text).val(code);
            $text.val(text).attr('data-original-title', code); // 툴팁처리 - 툴팁 정보를 갱신합니다.

            // Dirty 표시를 제거합니다.
            self._removeDirtyFlag();

            if (isTrigger) {
                // change 이벤트 발생
                changeEvent = new $.Event('_change');
                changeEvent.code = code;
                changeEvent.text = text;

                $el.trigger(changeEvent);
            }

        } else if (isArray) {
            // 설정할 데이터가 다수일 경우에는 코드다이얼로그를 열도록 codedialog 이벤트를 발생시킨다.
            self._triggerCodeDialog($text.val(), data);
        }
    };

    /**
     * 코드피커의 코드와 텍스트를 모두 빈 값으로 초기화합니다.
     */
    CodePicker.prototype.clearData = function () {
        var self = this,
            data = {};

        data[self.options.codeField] = data[self.options.textField] = '';

        self.setData(data);
    };

    /**
     * 코드피커의 코드나 텍스트가 변경되어 정보가 유효하지 않은지 여부를 가져옵니다.
     * @returns {boolean} 유효하지 않은지 여부
     */
    CodePicker.prototype.isDirty = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper');

        return $wrapper.hasClass('dews-dirty-data');
    };

    /**
     * 코드피커에 포커스를 줍니다.
     * @returns {CodePicker} 코드피커
     */
    CodePicker.prototype.focus = function () {
        var self = this,
            $el = $(self._element),
            $wrapper = $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        if ($text.prop('disabled') === false) {
            $text.focus();
        }

        return self;
    };

    /**
     * 코드피커의 텍스트를 모두 선택합니다.
     * @returns {CodePicker} 코드피커
     */
    CodePicker.prototype.select = function () {
        var self = this,
            $el = $(self._element),
            $wrapper= $el.parent('.dews-codepicker-wrapper'),
            $text = $('.dews-codepicker-text', $wrapper);

        if ($text.prop('readonly') === false && $text.prop('disabled') === false) {
            $text.select();
        }

        return self;
    };

    /**
     * 코드 피커에 설정된 코드를 가져옵니다.
     * @returns {string} 코드
     */
    CodePicker.prototype.code = function () {
        var self = this,
            $el = $(self._element);

        return $el.data('code');
    };

    /**
     * 코드 피커에 설정된 텍스트를 가져옵니다.
     * @returns {string} 텍스트
     */
    CodePicker.prototype.text = function () {
        var self = this,
            $el = $(self._element);

        return $el.data('text');
    };

    /**
     * 코드 피커에 새로운 옵션을 적용합니다.
     * @param options
     */
    CodePicker.prototype.setOptions = function (options) {
        options = $.extend(true, {}, this.options, options);

        this.options = options;
    };

    /**
     * 코드 피커에 설정된 옵션을 가져옵니다.
     * @returns {object} 옵션 설정값
     */
    CodePicker.prototype.getOptions = function () {
        return this.options;
    };

    /**
     * DEWS 객체에 직접 이벤트 핸들러를 등록합니다.
     */
    CodePicker.prototype.on = function () {
        var self = this;
        var $el = $(self._element);
        var args;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $el.on.apply($el, arguments);
    };

    /**
     * DEWS 객체에 직접 등록한 이벤트 핸들러를 해제합나다.
     */
    CodePicker.prototype.off = function () {
        var self = this;
        var $el = $(self._element);

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $el.off.apply($el, arguments);
    };

    CodePicker.prototype.validate = function () {
        var self = this;
        return !!self.code();
    };

    CodePicker.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self._element),
            codeColumn, textColumn, value;

        if (data) {

            codeColumn = $element.data('dews-bind-code') || $element.data('dews-code-field') || $element.attr('id');
            textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

            if (codeColumn && data.hasOwnProperty(codeColumn)) {
                value = {};

                value[$element.data('dews-code-field')] = data[codeColumn];

                if (textColumn && data.hasOwnProperty(textColumn)) {
                    value[$element.data('dews-text-field')] = data[textColumn];
                }

                self.setData(value, false);
            }
        }
    };

    CodePicker.prototype.serializeForPanel = function () {
        var self = this, $element = $(self._element),
            codeColumn, textColumn, data;

        codeColumn = $element.data('dews-bind-code') || $element.data('dews-code-field') || $element.attr('id');
        textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

        if (codeColumn) {
            data = {};
            data[codeColumn] = self.code();

            if (textColumn) {
                data[textColumn] = self.text();
            }
        }

        return data;
    };

    CodePicker.prototype.applyPanelFocus = function () {
        var self = this;

        self.usePanelFocus = true;
    };

    CodePicker.prototype.canFocusable = function () {
        var self = this, $element = $(self._element);
        var $wrapper = $element.parent('.dews-codepicker-wrapper');
        var $text = $('.dews-codepicker-text', $wrapper);

        return !$element.hasClass('readonly') && $text.is(':enabled') && $text.is(':visible');
    };

    /**
     * 코드피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    CodePicker.prototype._getPrintData = function () {
        var self = this,
            $el = $(self._element),
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    };

    function nextFocus(instance, $element) {
        var evt = new $.Event('nextFocus');
        evt.control = instance;

        $element.trigger(evt);
    }

    function previousFocus(instance, $element) {
        var evt = new $.Event('beforeFocus');
        evt.control = instance;

        $element.trigger(evt);
    }

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 코드피커로 만들거나 가져옵니다.
             * @param {string|jQuery} selector 코드피커로 만들 셀렉터 또는 jQuery 객체
             * @param {object} options 코드피커 옵션
             * @returns {object|Array} 코드피커 인스턴스
             */
            codepicker: function (selector, options) {
                var $el, obj;

                obj = [];

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker,
                        element = this;

                    if ($(element).data('dews-control')) {
                        picker = $(element).data('dews-control');
                    } else {
                        if (!$(element).hasClass('dews-ui-codepicker')) {
                            $(element).addClass('dews-ui-codepicker');
                        }
                        if (!$(element).hasClass('dews-form-control')) {
                            $(element).addClass('dews-form-control');
                        }

                        picker = new CodePicker(element, options);
                        picker._render();
                        picker._activate();
                        $(element).data("dews-control", picker);
                    }

                    obj.push(picker);
                });

                return (obj.length == 1) ? obj[0] : obj;
            }
        }
    });

    dews.ui.addControlInitializer('codepicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.codepicker($(".dews-ui-codepicker", $container));
    });
})(jQuery, window.dews);


/*
 * 콤보박스
 */
(function ($, dews, kendo) {
    var defaultOptions = {
    };

    /**
     * 설정 값을  가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var inlineOptions;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};

        return $.extend(true, {}, defaultOptions, inlineOptions, codeOptions);
    }

    /**
     * HTML 코드 상에 선언되어 있는 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     */
    function getInlineOptions($el) {
        var options = {},
            dataSource, dataSourceID, dataSourceUrl, dataSourceParams, dataSourceOptions;

        if ($el) {

            // AJAX를 이용한 데이터 바인딩을 사용할지 여부의 판단
            // - 코드도움 코드나 DATA 요청 URL 이 지정되어 있으면 AJAX 를 이용한 데이터 바인딩
            if ($el.data('dews-help-code') || $el.data('dews-data-url')) {

                if ($el.attr('id')) {
                    dataSourceID = $el.attr('id') + '_DataSource';
                } else {
                    dataSourceID = (new Date()).toString() + '_DataSource';
                }

                if ($el.data('dews-data-url')) {
                    dataSourceUrl = dews.url.getAbsoluteUrl($el.data('dews-data-url'));

                    dataSourceOptions = {
                        transport: {
                            read: {
                                url: dataSourceUrl,
                                dataType: 'json'
                            }
                        }
                    };

                    dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
                } else {
                    dataSourceUrl = dews.url.getCodeDataUrl($el.data('dews-help-code'));

                    dataSourceOptions = {
                        transport: {
                            read: {
                                url: dataSourceUrl,
                                dataType: 'json'
                            }
                        }
                    };

                    if ($el.data('dews-help-params')) {
                        dataSourceParams = $.deparam($el.data('dews-help-params'));
                        dataSourceOptions.transport.read.data = dataSourceParams;
                    }

                    dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
                }

                options.dataSource = dataSource;
            }

            if ($el.data('dews-value-field')) {
                options.dataValueField = $el.data('dews-value-field');
            }

            if ($el.data('dews-text-field')) {
                options.dataTextField = $el.data('dews-text-field');
            }

            if ($el.hasClass('readonly')) {
                $el.attr('readonly', true);
            }
        }

        return options;
    }

    /**
     * 컨트롤을 초기화합니다.
     * @param {jQuery} $el 대상 DOM 요소의 jQuery 객체
     * @param {object} [options] 설정 값
     */
    function initControl($el, options) {
        var $wrapper, $state;

        $wrapper = $el.closest('.k-combobox');
        $state = $wrapper.find('.k-dropdown-wrap');

        if ($wrapper.hasClass('dews-ui-combobox')) {
            $wrapper.removeClass('dews-ui-combobox');
        }
        if ($wrapper.hasClass('dews-control-activate')) {
            $wrapper.removeClass('dews-control-activate');
        }
        if (!$wrapper.hasClass('dews-combobox-wrapper')) {
            $wrapper.addClass('dews-combobox-wrapper');
        }
        if ($wrapper.find('.k-input').hasClass('dews-ui-combobox')) {
            $wrapper.find('.k-input').removeClass('dews-ui-combobox');
        }

        //
        // 상태정보 추가
        //
        if ($wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            $wrapper.removeClass('disabled');
        }
        if ($wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            $wrapper.removeClass('readonly');
        }
        if ($wrapper.hasClass('required')) {
            $state.addClass('dews-state-required');
            $wrapper.removeClass('required');
        }

        setUserGuideAPI($wrapper.find('.dews-form-control'));
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.closest('select.dews-ui-combobox').attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.closest('select.dews-ui-combobox').attr('id'));
                }
            }
        });
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 콤보박스를 만들거나 가져옵니다.
             * @param {string|jQuery} selector 대상 요소에 대한 셀렉터 또는 jQuery 객체
             * @param {object} [options] 드롭다운리스트 옵션
             */
            combobox: function (selector, options) {
                var $el,
                    combo;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control,
                        $wrapper,
                        opt;

                    control = $this.data('dews-control');

                    if (!control) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass('dews-ui-combobox')) {
                            $this.addClass('dews-ui-combobox');
                        }
                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        dews.ui.util.ConvertClassAndProperty($this);

                        $this.find('>option[data-dews-localize-key]').each(function (idx, value) {
                            var $list = $(value);
                            $list.text(dews.localize.get($list.text(), $list.data('dews-localize-key'), $list.data('dews-localize-lang') || null));
                        });

                        $this.kendoComboBox(opt);
                        control = $this.data('kendoComboBox');

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        initControl($this, opt);

                        $this.data('dews-control', control);
                    }

                    combo = control;
                });

                return combo;
            }
        }
    });

    kendo.ui.ComboBox.fn.enable = (function (enable) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return !self.element.prop('disabled');
            } else {
                state = self.wrapper.find('.k-dropdown-wrap');

                if (value) {
                    if (self.wrapper.hasClass('disabled')) {
                        self.wrapper.removeClass('disabled');
                    }
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                    if (state.hasClass('dews-state-disabled')) {
                        state.removeClass('dews-state-disabled');
                    }
                } else {
                    if (!self.wrapper.hasClass('disabled')) {
                        self.wrapper.addClass('disabled');
                    }
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                    if (!state.hasClass('dews-state-disabled')) {
                        state.addClass('dews-state-disabled');
                    }
                }
            }

            enable.call(self, value);
        };
    })(kendo.ui.ComboBox.fn.enable);

    kendo.ui.ComboBox.fn.setDataSource = (function (data) {
        return function (dataSource) {
            var that = this;
            var parent;
            that.options.dataSource = dataSource;
            that._dataSource();
            if (that.listView.bound()) {
                that._initialIndex = null;
                that.listView._current = null;
            }
            that.listView.setDataSource(that.dataSource);
            if (that.options.autoBind) {
                that.dataSource.fetch().done(function () {
                    that.select(0);
                });
            }
            parent = that._parentWidget();
            if (parent) {
                that._cascadeSelect(parent);
            }
        };
    })(kendo.ui.ComboBox.fn.setDataSource);

    kendo.ui.ComboBox.fn.readonly = (function (readonly) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return !self.element.prop('readonly');
            } else {
                state = self.wrapper.find('.k-dropdown-wrap');

                if (!value) {
                    if (self.wrapper.hasClass('readonly')) {
                        self.wrapper.removeClass('readonly');
                    }
                    if (self.element.hasClass('readonly')) {
                        self.element.removeClass('readonly');
                    }
                    if (state.hasClass('dews-state-readonly')) {
                        state.removeClass('dews-state-readonly');
                    }
                } else {
                    if (!self.wrapper.hasClass('readonly')) {
                        self.wrapper.addClass('readonly');
                    }
                    if (!self.element.hasClass('readonly')) {
                        self.element.addClass('readonly');
                    }
                    if (!state.hasClass('dews-state-readonly')) {
                        state.addClass('dews-state-readonly');
                    }
                }
            }

            readonly.call(self, value);
        };
    })(kendo.ui.ComboBox.fn.readonly);

    kendo.ui.ComboBox.fn.on = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    };

    kendo.ui.ComboBox.fn.off = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus'|| arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    };

    kendo.ui.ComboBox.fn.validate = function () {
        var self = this;
        return !!self.text();
    };

    kendo.ui.ComboBox.fn.bindFromPanel = function(data) {
        var self = this, $element = self.element;
        var valueColumn, textColumn, value;

        if (data) {
            valueColumn = $element.data('dews-bind-value') || $element.data('dews-value-field') || $element.attr('id');
            textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

            if (valueColumn && data.hasOwnProperty(valueColumn)) {
                value = {};

                self.value(data[valueColumn]);

                if (textColumn && data.hasOwnProperty(textColumn)) {
                    self.text(data[textColumn]);
                }
            }
        }
    };

    kendo.ui.ComboBox.fn.serializeForPanel = function () {
        var self = this, $element = self.element;
        var valueColumn, textColumn;
        var data;

        valueColumn = $element.data('dews-bind-value') || $element.data('dews-value-field') || $element.attr('id');
        textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

        if (valueColumn) {
            data = {};
            data[valueColumn] = self.value();

            if (textColumn) {
                data[textColumn] = self.text();
            }
        }

        return data;
    };

    kendo.ui.ComboBox.fn.applyPanelFocus = function () {
        var self = this, $element = self.element;
        var $wrapper = $element.parent('.dews-combobox-wrapper');
        var $el = $wrapper.find('.dews-form-control');

        $el.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $el.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $el.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $el.trigger(evt);
            }
        });
    };

    kendo.ui.ComboBox.fn.canFocusable = function () {
        var self = this, $element = self.element;
        var $wrapper = $element.parent('.dews-combobox-wrapper');
        var $el = $wrapper.find('.dews-form-control');
        return !$el.hasClass('readonly') && $el.is(':visible') && $el.is(':enabled');
    };

    /**
     * 콤보박스 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    kendo.ui.ComboBox.fn._getPrintData = function () {
        var self = this,
            $el = $(self.element),
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    };

    dews.ui.addControlInitializer('combobox', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.combobox($("select.dews-ui-combobox, input[type='text'].dews-ui-combobox", $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 컨테이너 패널
 */

(function ($, dews) {
    // 기본 옵션 설정
    var defaultOptions = {
        isVisible: true
    };
    // 컨테이너 아이템 생성
    function ContainerItem(element, parent) {
        var self = this;

        self.element = $(element);
        self.parent = parent;

        return self;
    }

    /**
     * 컨테이너 아이템 출력 유무 설정
     * @param display (string)
     */
    ContainerItem.prototype.display = function (display) {
        var self = this;

        if (display === 'none') {
            self.element.css('display', 'none');
        } else {
            self.element.css('display', 'block');
        }

        setStyle(self.parent, self.parent.options);
        // 컨테이너 아이템 내부에 그리드가 있을 경우 사이즈 재조정, 그리드 생성 이전에는 로직 타지 않음
        if (self.element.find('> .dews-ui-grid canvas')[0]) {
            var grid = dews.ui.grid(self.element.find('> .dews-ui-grid'));
            grid._grid.resetSize();
        }
    };
    // 컨테이너 패널 fit-bottom 설정
    function setFitBottom(containerpanel) {
        var self = containerpanel,
            containerItem = self.container.find('> .dews-container-item'),
            normalItem = self.container.find('>.dews-container-item.normal'),
            marginRight = parseInt(normalItem.css('marginRight')),
            marginLeft = parseInt(normalItem.css('marginLeft')),
            totalWidth,
            target = self.container;
        // 하단 끝선 관련 문제
        var overflow = target.data('dews-fit-bottom');
        if ($.type(overflow) === 'boolean' && overflow) {
            target.addClass('fit-bottom');
            // 탭 패널이 있을 경우 열려지지 않은 탭에 대해서는 display: none이기 때문에 설정이 되지 않기 때문에 다 열어주고 설정
            if (target.closest('.dews-ui-tab-panel').length !== 0 && target.closest('.dews-tab-item')) {
                target.closest('.dews-ui-tab-panel').find('> .dews-tab-items >.dews-tab-item > .dews-tab-content').css('display', 'none');
                target.closest('.dews-ui-tab-panel').find('> .dews-tab-items >.dews-tab-item').css('display', 'none');
                target.closest('.dews-tab-item').css('display', 'block');
                target.closest('.dews-tab-content').css('display', 'block');
            }
            // 컨테이너 패널의 fit-bottom이 해당 자식 노드에서 마지막인지 확인
            if (target.parent().find('>.dews-container-panel').length !==0 && target.parent().find('>.dews-container-panel:last').hasClass('fit-bottom') === target.hasClass('fit-bottom')) {
                // 컨테이너 패널의 fit-bottom이 최 상위 영역인지 확인
                if (target.parent().closest('.dews-container-panel').length === 0) {
                    target.css('min-height', 760 - target.offset().top - 25 + 'px');
                    target.css('height', $(window).height() - target.offset().top - 25 +'px');
                } else {
                    target.css('min-height', target.parent().outerHeight() - target.offset().top +target.parent().offset().top + 'px');
                    target.css('height', target.parent().outerHeight() - target.offset().top +target.parent().offset().top +'px');
                }
            } else {
                // 컨테이너 패널의 fit-bottom이 최 상위 영역인지 확인
                var containerPanel = target.parent().find('> .dews-container-panel'),
                    flag = false,
                    totalHeight = 0;
                $.each(containerPanel, function (idx, target) {
                    var $container = $(target);
                    if (flag) {
                        totalHeight = $container.height() + 5 + totalHeight;
                    }

                    if ($container.hasClass('fit-bottom')) {
                        flag = true;
                    }
                });
                if (target.parent().closest('.dews-container-panel').length === 0) {
                    target.css('min-height', 760 - target.offset().top - 25 - totalHeight + 'px');
                    target.css('height', $(window).height()- target.offset().top - 25 - totalHeight +'px');
                } else {
                    target.css('min-height', target.parent().outerHeight() - target.offset().top +target.parent().offset().top
                        - totalHeight+ 'px');
                    target.css('height', target.parent().outerHeight() - target.offset().top +target.parent().offset().top
                        - totalHeight +'px');
                }
            }
            // 컨테이너 패널의 fit-bottom이 해당 자식 노드에서 마지막인지 확인
            for (var child = 0; child < containerItem.length; child+=1) {
                if ($(containerItem[child].lastElementChild).offset() && $(containerItem[child].lastElementChild).offset().top - target.offset().top < target.height() && containerItem[child].childElementCount !== 1) {
                    $(containerItem[child].lastElementChild).css('height', target.height() - $(containerItem[child].lastElementChild).offset().top + target.offset().top + 5 +'px');
                }
            }

            totalWidth = marginRight + marginLeft + normalItem.width();
            // 윈도우 사이즈보다 너비가 작을 경우 설정하는 코드
            if ($(window).width() >= 1280) {
                if ($(window).width() - target.offset().left  - 15 < totalWidth) {
                    normalItem.css('width', normalItem.width());
                    normalItem.css('right', '');
                } else {
                    normalItem.css('width', '');
                    normalItem.css('right', '0px');
                }
            } else {
                normalItem.css('right', '');
                normalItem.css('width', target.width() - (marginRight + marginLeft) + 'px');
            }
            // 탭 컨텐츠의 높이를 설정
            if (target.find('.dews-ui-tab-panel').length !== 0) {
                target.find('.dews-tab-item > .dews-tab-content').css('height', target.find('.dews-tab-items').height() + 'px');
            }
            // 폼패널의 최소 사이즈 설정
            if (normalItem.find('> .dews-form-panel').length !== 0) {
                normalItem.css('minWidth', normalItem.find('> .dews-form-panel').css('minWidth'));
            }
            // 탭 패널이 있을 경우 다시 보여줬던 탭 아이템을 숨긴다.
            if (target.closest('.dews-ui-tab-panel').length !== 0 && target.closest('.dews-tab-content')) {
                target.closest('.dews-ui-tab-panel').find('> .dews-tab-items > .dews-tab-item > .dews-tab-content').css('display', '');
                target.closest('.dews-ui-tab-panel').find('> .dews-tab-items >.dews-tab-item').css('display', '');
                target.closest('.dews-tab-item').css('display', '');
                target.closest('.dews-tab-content').css('display', '');
            }
        }
    }
    // 컨테이너 패널 포지션 위치 정의 (left, normal, right)
    function setStyle(containerpanel, opt) {
        var self = containerpanel,
            options = opt,
            containerItem = self.container.find('>.dews-container-item'),
            marginLeft = 0,
            marginRight = 0,
            totalWidth = 0;

        if (self.container.data('dews-container-height')) {
            self.container[0].style.minHeight = self.container.data('dews-container-height') + 'px';
        }

        if (containerItem) {
            if (options === undefined) {
                for (var j = 0; j < containerItem.length; j+=1) {
                    if (containerItem[j].getAttribute('data-dews-position')) {
                        containerItem[j].classList.add(containerItem[j].getAttribute('data-dews-position'));

                        if (!containerItem[j].classList.contains('normal') && containerItem[j].getAttribute('data-dews-width') && containerItem[j].style.display !== 'none') {
                            containerItem[j].style.width = containerItem[j].getAttribute('data-dews-width') + 'px';
                        }
                    } else {
                        if (j === containerItem.length-1) {
                            containerItem[j].classList.add('normal');
                        } else {
                            containerItem[j].classList.add('left');
                        }
                    }
                }
            } else if ($.type(options.items) !== 'undefined') {
                for (var k = 0; k < options.items.length; k+=1) {
                    if (options.items[k].style.display !== 'none') {
                        if (options.items[k].position === 'normal') {
                            containerItem[k].classList.add('normal');
                        } else if (options.items[k].position === 'left') {
                            containerItem[k].classList.add('left');
                            containerItem[k].style.width = options.items[k].width + 'px';
                        } else if (options.items[k].position === 'right') {
                            containerItem[k].classList.add('right');
                            containerItem[k].style.width = options.items[k].width + 'px';
                            marginRight += options.items[k].width + 8;
                        }
                    }
                }
            }

            for (var i = 0; i < containerItem.length; i+=1) {
                if (containerItem[i].style.display !== 'none') {
                    if (containerItem[i].classList.contains('normal')) {
                        containerItem[i].style.marginLeft = marginLeft + 'px';
                    } else if (containerItem[i].classList.contains('left')) {
                        containerItem[i].style.left = marginLeft + 'px';
                        marginLeft += $(containerItem[i]).width() + 8;
                    }
                }
            }

            for (var r = containerItem.length-1; r >= 0; r-=1) {
                if (containerItem[r].style.display !== 'none') {
                    if (containerItem[r].classList.contains('normal')) {
                        containerItem[r].style.marginRight = marginRight + 'px';
                    } else if (containerItem[r].classList.contains('right')) {
                        containerItem[r].style.right = marginRight + 'px';
                        marginRight += $(containerItem[r]).width() + 10;
                    }
                }
            }

            if (self.container.data('dews-fit-bottom')) {
                dews.ready(function () {
                    setFitBottom(self);
                });
            } else {
                self.container.find('>.dews-container-item.normal').css('height', '');
            }
        }
    }
    // 컨테이너 패널 생성
    function ContainerPanel (element, options) {
        var self = this,
            target = element;

        self.container = target;
        self.items = [];
        setStyle(self, options);
        self.options = $.extend(true, {}, defaultOptions, options);
        self._bindEvent();

        for (var j = 0; j < self.container.find('>.dews-container-item').length; j+=1) {
            self.items.push(new ContainerItem(self.container.find('>.dews-container-item')[j], self));
        }

        self.items.getById = function (id) {
            var self = this;

            for (var i = 0; i < self.length; i+=1) {
                if (self[i].element.attr('ID') === id) {
                    return self[i];
                }
            }

            return null;
        };

        return self;
    }
    // 컨테이너 패널 이벤트 설정
    ContainerPanel.prototype._bindEvent = function () {
        var self = this;

        $(window).on('resize', function (e) {
            if (isVisible(self)) {
                setFitBottom(self);
                self.options.isVisible = true;
            } else {
                self.options.isVisible = false;
            }
        });

        setInterval(function () {
            if (isVisible(self) && !self.options.isVisible) {
                setFitBottom(self);
                self.options.isVisible = true;
            }
        }, 100);
    };
    // 컨테이너 패널 visible 유무 함수
    function isVisible(container) {
        var self = container;

        return self.container.is(':visible');
    }

    dews = $.extend(true, dews, {
        ui: {
            containerpanel: function (selector, options) {
                var $panel, panel;

                if (selector instanceof jQuery) {
                    $panel = selector;
                } else if ($.type(selector) === "string") {
                    $panel = $(selector);
                } else {
                    throw "대상이 지정되지 않았습니다.";
                }

                $panel.each(function () {
                    var $ctrl = $(this), opt = options;

                    panel = $ctrl.data('dews-control');

                    if (!$ctrl.hasClass('dews-ui-container-panel')) {
                        $ctrl.addClass('dews-ui-container-panel');
                    }

                    if (!$ctrl.hasClass('dews-container-panel')) {
                        $ctrl.addClass('dews-container-panel');
                    }

                    if (!panel) {
                        panel = new ContainerPanel($ctrl, opt);
                        $ctrl.data('dews-control', panel);
                    }
                });

                return panel;
            }
        }
    });

    dews.ui.addControlInitializer('containerpanel', function(target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        // TODO: dews-container-panel 로만 초기화하도록 되어 있어 추가하였으나 dews-ui-container-panel 로만 초기화 시켜도록 변경되어야 함
        dews.ui.containerpanel($("div.dews-container-panel, div.dews-ui-container-panel", $container));
    });
})(jQuery, window.dews || {});


(function ($, dews) {

    /**
     * 컨텍스트메뉴를 생성하기 위한 클래스
     * @param {HTMLElement} selector 컨텍스트메뉴 타겟 요소
     * @param {object} options  컨텍스트 메뉴 옵션
     * @constructor
     */
    var ContextMenu = function (selector, options) {
        var self = this;

        self.target = selector;

        self.options = options;
        self.eventArg = null;

        var $position = 0;

        $(window).scroll(function () {
            $position = $(this).scrollTop();
        });

        self.target.on('contextmenu', function (e) {
            var positionX = e.pageX - $(this).offset().left;
            var positionY = e.pageY - $(this).offset().top;

            e.preventDefault();     // 기본 이벤트 핸들러의 실행을 취소
            e.stopPropagation();    // 부모로 이벤트가 전달되는 것을 막음

            self.eventArg = $.Event('contextmenuclick', {
                target: e.target,
                currentTarget: e.currentTarget
            });

            $('.dews-ui-contextmenu').remove();

            self._createMenu(positionX, positionY, $position);
        });

        // 커스텀 컨텍스트 메뉴의 클릭 이벤트 핸들러를 호출해주고 이벤트 처리 완료 시킴
        self.target.on('contextmenuclick', function (e) {
            var handler;

            $.each(self.options.items, function (idx, item) {
                if (item.id === e.action) {
                    if (item.hasOwnProperty("handler")) {
                        item.handler(e);
                    }

                    self.container.remove();
                    return false;
                }

            });
        });
    };

    /**
     * 컨텍스트메뉴의 외부 컨테이너를 생성하고 위치 설정 합니다.
     * @private
     */
    ContextMenu.prototype._createMenu = function (x, y, position) {
        var self = this, $container, $list, $position = position;

        $container = $('<div/>').addClass('dews-ui-contextmenu');
        $list = $('<ul/>').addClass('dews-contextmenu-list');

        $container.css({"position": "absolute", "top": y + 'px', "left": x + "px"});

        self.container = $container;

        $(document.body).append($container);
        $container.append($list);

        self._createList();

        if ($container.outerWidth() + $container.offset().left + self.target.offset().left > $(window).width()) {
            $container.css("left", $(window).width() - $container.outerWidth() + "px");
        } else {
            $container.css("left", x + self.target.offset().left + "px");
        }

        if ($container.offset().top + $container.outerHeight() - $position + self.target.offset().top > $(window).height()) {
            $container.css("top", $(window).height() + $position - $container.outerHeight() + "px");
        } else {
            $container.css("top", y + self.target.offset().top + "px");
        }

        if ($('.dews-contextmenu-list li', self.container).length === 0) {
            $container.remove();
        }
    };

    /**
     * 컨텍스트메뉴 리스트를 생성합니다.
     * @private
     */
    ContextMenu.prototype._createList = function () {
        var self = this;

        self._contextMenuItemTrigger();

        $.each(self.options.items, function (idx, item) {
            if(item.display(self.eventArg) === true) {
                self.container.children('ul').append('<li data-action="' + item.id + '"><button type="button">' + item.text + '</button></li>');
            }
        });

        self.container.find('.dews-contextmenu-list li').bind('click contextmenu', { instance: self }, self._contextMenuItemClick);

        self.container.bind('click contextmenu', function (e) {
            self.container.remove();
            e.preventDefault();
        });

        self.container.on("mousewheel", function (e) {
            e.preventDefault();
        });

        $(window).scroll(function() {
            self.container.remove();
        });

        $(window).bind('mousedown blur',function (e) {
            var l_position = self.container.offset();
            l_position.right = parseInt(l_position.left) + (self.container.width());
            l_position.bottom = parseInt(l_position.top) + parseInt(self.container.height());

            if ((l_position.left <= e.pageX && e.pageX <= l_position.right) && (l_position.top <= e.pageY && e.pageY <= l_position.bottom)) {

            }  else {
                self.container.remove();
            }

        });
    };

    /**
     * 컨텍스트메뉴 리스트 클릭시 옵션값 확장 및 이벤트 바인딩합니다.
     * @private
     */
    ContextMenu.prototype._contextMenuItemClick = function (e) {
        var self = e.data.instance;

        self.eventArg.action = $(e.target).parent().data('action');

        if (e.which === 3) {
            e.preventDefault();
        }

        self._contextMenuItemTrigger();
    };

    ContextMenu.prototype._contextMenuItemTrigger = function () {
        var self = this;

        if (self.options && $.isFunction(self.options.extendEventArgs)) {
            $.extend(true,
                self.eventArg,
                self.options.extendEventArgs.call(self, self.eventArg));
        }

        self.target.trigger(self.eventArg);
    };

    $.extend(true, dews, {
        ui: {
            contextmenu: function (selector, options) {
                var $el, context;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                } else {
                    $el = document;
                }

                if ($.isArray(options)) {
                    options = {
                        items : options
                    };
                }

                $el.each(function () {
                    var contextmenu, $this = $(this);

                    contextmenu = $this.data('dews-control');

                    if (!contextmenu) {

                        if($.type(selector) === 'array') {
                            contextmenu = new ContextMenu($el, selector);
                        } else{
                            contextmenu = new ContextMenu($el, options);
                        }

                        $this.data('dews-control', contextmenu);
                    }

                    context = contextmenu;
                });

                return context;
            }
        }
    });
})(jQuery, window.dews);


/*
 * 데이터소스
 */
(function ($, dews, kendo) {
    var defaultOptions = {};

    /**
     * 옵션은 kendo.DataSource 형식에 맞는 옵션으로 재구성
     */
    function getOptions(source) {
        var result = {};

        if (source) {
            if (!source.hasOwnProperty('data')) {
                $.extend(true, result, {
                    batch: true,
                    transport: {
                        read: {
                            cache: false
                        }
                    },
                    schema: {
                        data: function (data) {
                            var result = [];

                            dews.log('## dews.ui.dataSource + ajax - result ##');
                            dews.log(data);

                            if (data) {
                                if (data.hasOwnProperty('state')) {
                                    if (data.state === 'success') {
                                        result = data.data;
                                    } else if (data.state === 'error' && typeof source.error !== 'undefined') {
                                        source.error.call(this, data, data.message);
                                    }
                                }
                            }

                            if (result === null) {
                                result = [];
                            }
                            return result;
                        }
                    }
                });
            }

            // Edit 모드에서 멀티 컬럼 키가 지원
            if (source.hasOwnProperty('schema') && source.schema.hasOwnProperty('model') && !source.schema.model.hasOwnProperty('id')) {
                source.schema.model.id = '_uid_';
            }

            // dews.ajax 에러 이벤트 발생
            var errorHandler = function(e) {
                if (typeof e !== 'undefined' && e.xhr && e.xhr.statusCode) {
                    var evt = new $.Event(e.xhr.statusText.toLowerCase());
                    evt.code = e.xhr.status;
                    $(dews.ajax).trigger(evt);
                }
            };

            if (source.hasOwnProperty('error')) {
                var srcHandler = source.error;

                source.error = function(e) {
                    errorHandler(e);
                    srcHandler(e);
                };
            } else {
                source.error = errorHandler;
            }
        }

        $.extend(true, result, defaultOptions, source);

        return result;
    }

    function setDataSourceOptions(options) {
        var defaultOptions = {
            _destroy: [],
            params: '',
            restoreMode: 'auto',
            async: true
        }, opt;

        opt = $.extend(true, defaultOptions, options);

        if (opt.schema && opt.schema.model.fields) {
            var field = [];
            for (var i =0; i < opt.schema.model.fields.length; i+=1) {
                opt.schema.model.fields[i].fieldName = opt.schema.model.fields[i].field;
                if (opt.schema.model.fields[i].type) {
                    opt.schema.model.fields[i].dataType = opt.schema.model.fields[i].type;
                } else if (!opt.schema.model.fields[i].dataType) {
                    opt.schema.model.fields[i].dataType = 'text';
                }

                if ((opt.schema.model.fields[i].dataType).toLowerCase() === 'string') {
                    opt.schema.model.fields[i].dataType = 'text';
                }
                field.push(opt.schema.model.fields[i]);
            }
            opt.field = field;
        }

        return opt;
    }

    dews = $.extend(true, dews, {
        ui: {
            /**
             * 데이터 소스
             *
             * @param {String} id 데이터소스 아이디
             * @param {Object} [options] 데이터소스 옵션
             * @param {String|jQuery} [container] 데이터소스를 저장할 컨테이너
             */
            dataSource: function (id, options, container) {
                var dataSource, $container = $(document);
                if (options && options.hasOwnProperty('grid') && options.grid) {
                    options.id = id;
                    dataSource = new DataProvider(options);
                    $container.data("dews-datasource-"+id, dataSource);
                } else {
                    if (options) {
                        options.id = id;
                        options = getOptions(options);

                        dataSource = new kendo.data.DataSource(options);
                        dataSource.id = id;
                        $container.data("dews-datasource-" + id, dataSource);
                        dews.log('## dews.ui.dataSource: ' + id + ' 생성 ##');
                        dews.log(dataSource.data());
                    } else {
                        dataSource = $container.data("dews-datasource-" + id);
                    }

                    return dataSource;
                }

                return dataSource;
            }
        }
    });
    /**
     * 데이터소스 read 재 정의
     *
     * @param data
     * @returns {JQueryPromise<T>}
     */
    kendo.data.DataSource.fn.read = function (data) {
        var that = this, params = that._params(data);
        var deferred = $.Deferred();
        that._destroyed = [];

        if (that.options.master) {
            for (var i = 0; i < Object.keys(that.options.master).length; i+=1) {
                that.options.master[Object.keys(that.options.master)[i]].options.lineDataSources = {};
                that.options.master[Object.keys(that.options.master)[i]].read();
            }
        }

        that._queueRequest(params, function() {
            var isPrevented = that.trigger('requestStart', { type: "read" });
            if (!isPrevented) {
                that.trigger('progress');

                that._ranges = [];
                that.trigger("reset");
                if (that.online()) {
                    that.transport.read({
                        data: params,
                        success: function(data) {
                            that.success(data);

                            deferred.resolve();
                        },
                        error: function() {
                            var args = Array.prototype.slice.call(arguments);

                            that.error.apply(that, args);

                            deferred.reject.apply(deferred, args);
                        }
                    });
                } else if (that.options.offlineStorage != null){
                    that.success(that.offlineData());

                    deferred.resolve();
                }
            } else {
                that._dequeueRequest();

                deferred.resolve(isPrevented);
            }
        });

        return deferred.promise();
    };

    /**
     * 수정된 항목들에 대한 저장 요청을 서버로 보냅니다.
     *
     * @param {String} url 요청 URL
     * @param {Object} [options] 전송 옵션
     */
    kendo.data.DataSource.prototype.batchSave = function (url, options) {
        var self = this,
            opt,
            data,
            batchData;

        data = self.getDirtyData();

        batchData = {};
        batchData[self.options.id] = data;

        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        return dews.api.post(url, opt).done(function (result) {
            if (self.options.lineDataSources) {
                $.each(self.options.lineDataSources, function (idx, item) {
                    item.read();
                });
            } else {
                self.read();
            }

            if (options && options.hasOwnProperty("callback") && $.type(options.callback) === "function") {
                options.callback.call(this, result);
            }
        }).fail(function (jqXHR, status, msg, data) {
            if (options && options.hasOwnProperty("error") && $.type(options.error) === 'function') {
                options.error.call(this, msg, data, status, jqXHR);
            }
        });
    };

    /**
     * 데이터소스의 전체 항목에 대한 저장 요청을 서버로 보냅니다.
     *
     * @param {string} url 요청 URL
     * @param {object} [options] 전송 옵션
     */
    kendo.data.DataSource.prototype.saveAll = function (url, options) {
        var self = this,
            opt,
            data,
            batchData;

        data = self.data();

        batchData = {};
        batchData[self.options.id] = data;

        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        return dews.api.post(url, opt).done(function (result) {
            if (self.options.lineDataSources) {
                $.each(self.options.lineDataSources, function (idx, item) {
                    item.read();
                });
            } else {
                self.read();
            }

            if (options && options.hasOwnProperty("callback") && $.type(options.callback) === "function") {
                options.callback.call(this, result);
            }
        }).fail(function (jqXHR, status, msg, data) {
            if (options && options.hasOwnProperty("error") && $.type(options.error) === 'function') {
                options.error.call(this, msg, data, status, jqXHR);
            }
        });
    };

    /**
     * 수정된 항목들을 가져옵니다.
     */
    kendo.data.DataSource.prototype.getDirtyData = function () {
        var self = this,
            currentData = self._data,
            newRecords = [],
            updateRecords = [],
            deleteRecords = [],
            data, i, l;

        if (self.options.detail && self.options.lineDataSources) {
            for (l = 0; l < Object.keys(self.options.lineDataSources).length; l+=1) {
                var lineDataSource = self.options.lineDataSources[Object.keys(self.options.lineDataSources)[l]];

                for (i = 0; i < lineDataSource._data.length; i++) {
                    if (lineDataSource._data[i].isNew && lineDataSource._data[i].isNew()) {
                        newRecords.push(lineDataSource._data[i].toJSON());
                    } else if (lineDataSource._data[i].dirty) {
                        updateRecords.push(lineDataSource._data[i].toJSON());
                    }
                }

                for (i = 0; i < lineDataSource._destroyed.length; i++) {
                    deleteRecords.push(lineDataSource._destroyed[i].toJSON());
                }
            }
        } else {
            for (i = 0; i < currentData.length; i++) {
                if (currentData[i].isNew && currentData[i].isNew()) {
                    newRecords.push(currentData[i].toJSON());
                } else if (currentData[i].dirty) {
                    updateRecords.push(currentData[i].toJSON());
                }
            }

            for (i = 0; i < self._destroyed.length; i++) {
                deleteRecords.push(self._destroyed[i].toJSON());
            }
        }

        data = {};

        $.extend(data, { Updated: updateRecords }, { Deleted: deleteRecords }, { Added: newRecords });

        return data;
    };

    /**
     * 변경된 항목의 수를 가져옵니다.
     */
    kendo.data.DataSource.prototype.getDirtyDataCount = function () {
        var self = this,
            datas = self.data(),
            count = 0, i = 0, l = 0;

        if (self.options.detail && self.options.lineDataSources) {
            for (l = 0; l < Object.keys(self.options.lineDataSources).length; l+=1) {
                var lineDataSource = self.options.lineDataSources[Object.keys(self.options.lineDataSources)[l]];

                for (i = 0; i < lineDataSource._data.length; i++) {
                    if (lineDataSource._data[i].isNew && lineDataSource._data[i].isNew()) {
                        count++;
                    } else if (lineDataSource._data[i].dirty) {
                        count++;
                    }
                }

                count += lineDataSource._destroyed.length;
            }
        } else {
            for (i = 0; i < datas.length; i++) {
                if (datas[i].isNew && datas[i].isNew()) {
                    count++;
                } else if (datas[i].dirty) {
                    count++;
                }
            }

            count += self._destroyed.length;
        }

        return count;
    };

    /**
     * 카드리스트 데이터 변경에 따른 메인버튼 조정
     * @param page 페이지 정보
     * @private
     */
    kendo.data.DataSource.prototype._dataChange = function (page) {
        var self = this,
            parameter = {
                dataSource: self,
                isChange: false
            },
            event = new $.Event('dataChange', parameter);

        self.options._dataChange = true;

        self.bind('change', function () {
           if (self.hasDirty()) {
               event.isChange = true;
           } else {
               event.isChange = false;
           }

           if ($.type(arguments[0]) === 'boolean') {
               event.isChange = arguments[0];
           }

           page.$content.trigger(event);
        });
    };

    /**
     * 마스터 디테일 구조일 경우 디테일 데이터소스에서 변경이 일어난 경우 메인버튼의 활성화/비활성화 설정
     * @private
     */
    kendo.data.DataSource.prototype._detailDataChange = function () {
        var self = this;

        self.options._dataChange = true;

        self.bind('change', function (e) {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.trigger('change');
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        if (e.action === 'itemchange') {
                            self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource, true);
                        } else if (e.action === 'add') {
                            self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource, true);
                        } else if (e.action === 'remove') {
                            self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource, true);
                        } else {
                            if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                                self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource, true);
                            } else {
                                self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource, true);
                            }
                        }
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        if (e.action === 'itemchange') {
                            self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource);
                        } else if (e.action === 'add') {
                            self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource);
                        } else if (e.action === 'remove') {
                            self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource);
                        } else {
                            if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                                self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource);
                            } else {
                                self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource);
                            }
                        }
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        });
    };

    /**
     * 마스터 디테일 관계 형성 시 전체 데이터 변경 유무 확인
     * @param target 자식 전체 검사 유무 (기본값: true)
     * @return {boolean} 전체 데이터 변경 유무
     */
    kendo.data.DataSource.prototype.hasDirty = function (target) {
        var self = this,
            range = true,
            result = false;

        if ($.type(target) === 'boolean') {
            range = target;
        }

        if (range) {
            if ($.type(self.options.detailDataSource) !== 'undefined') {
                result = self.options.detailDataSource.hasDirty(range);

                if (result) {
                    return result;
                } else if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            } else {
                if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            }
        } else {
            if (self.getDirtyDataCount() > 0) {
                result = true;
            }
        }

        return result;
    };

    function DataProvider(options) {
        var self = this, opt;

        var dataProvider = new RealGridJS.LocalDataProvider();

        opt = setDataSourceOptions(options);
        opt.rollback = dataProvider.savePoint();
        dataProvider.setFields(opt.field);
        dataProvider.setOptions(opt);

        self.dataProvider = dataProvider;
        self.options = opt;
        self.id = opt.id;

        self._bindEvent();

        return self;
    }

    /**
     * 데이터소스의 모든 데이터 저장
     * @param url 저장할 url 경로
     * @param options 전송 옵션
     * @return {*} 저장 한 이후에 실행될 프로미스 객체
     */
    DataProvider.prototype.saveAll = function (url, options) {
        var self = this, opt, data, batchData, dfr = $.Deferred();

        data = self.dataProvider.getJsonRows(0, -1);

        batchData = {};
        batchData[self.options.id] = data;

        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        dews.api.post(url, opt).done(function (result) {
            if (self.options.lineDataSources) {
                $.each(self.options.lineDataSources, function (idx, item) {
                    item.options._destroy = [];
                    item.dataProvider.clearRowStates();
                });
            } else {
                self.options._destroy = [];
                self.dataProvider.clearRowStates();
            }
            dfr.resolve(result);
        }).fail(function (jqXHR, status, msg, data) {
            dfr.reject(msg);
        });

        return dfr;
    };

    /**
     * 데이터소스 읽기
     */
    DataProvider.prototype.read = function () {
        var self = this,
            data = '',
            url;

        self.options._destroy = [];

        if (self.options.master) {
            for (var i = 0; i < Object.keys(self.options.master).length; i+=1) {
                self.options.master[Object.keys(self.options.master)[i]].options.lineDataSources = {};
                self.options.master[Object.keys(self.options.master)[i]].read();
            }
        }
        if (self.options.transport && self.options.transport.read.url) {
            if (self.options.transport.read.data) {
                data = $.type(self.options.transport.read.data) === 'function' ? self.options.transport.read.data() : self.options.transport.read.data;
            }

            if ($.type(self.options.transport.read.url) === 'function') {
                url = self.options.transport.read.url.call(self);
            } else {
                url = self.options.transport.read.url;
            }
            // 데이터소스 post, get 설정
            if ($.type(self.options.transport.read.type) === 'undefined' || self.options.transport.read.type.toLowerCase() === 'get') {
                dews.api.get(url, {
                    data: data,
                    async: self.options.async
                }).done(function (result) {
                    if ($.type(result) === 'object' && result.hasOwnProperty('data')) {
                        self.options.data = result.data;
                    } else {
                        self.options.data = result;
                    }
                    self.dataProvider.setRows(self.options.data);
                    self.dataProvider.clearRowStates();
                    self.options.rollback = self.dataProvider.savePoint();
                }).fail(function (e, xhr) {
                    if (self.options.error && $.type(self.options.error) === 'function') {
                        self.options.error.call(self, e.responseJSON);
                    }
                });
            } else {
                dews.api.post(url, {
                    data: data,
                    async: self.options.async
                }).done(function (result) {
                    if ($.type(result) === 'object' && result.hasOwnProperty('data')) {
                        self.options.data = result.data;
                    } else {
                        self.options.data = result;
                    }
                    self.dataProvider.setRows(self.options.data);
                    self.dataProvider.clearRowStates();
                    self.options.rollback = self.dataProvider.savePoint();
                }).fail(function (e, xhr) {
                    if (self.options.error && $.type(self.options.error) === 'function') {
                        self.options.error.call(self, e.responseJSON);
                    }
                });
            }
        } else if (self.options.data) {
            self.dataProvider.setRows(self.options.data);
            self.dataProvider.clearRowStates();
            self.options.rollback = self.dataProvider.savePoint();
        }
    };

    /**
     * 데이터소스의 변경된 데이터 반환
     * @return {{Added: Array, Updated: Array, Deleted: Array}} 변경된 데이터 반환
     */
    DataProvider.prototype.getDirtyData = function () {
        var self = this,
            currentData = {
                'Added': [],
                'Updated': [],
                'Deleted': []
            }, i , j, k, l;

        if (self.options.detail && self.options.lineDataSources) {
            for (l = 0; l < Object.keys(self.options.lineDataSources).length; l+=1) {
                var lineDataSource = self.options.lineDataSources[Object.keys(self.options.lineDataSources)[l]];
                if (lineDataSource.dataProvider.getStateRows('created')) {
                    for (i = 0; i < lineDataSource.dataProvider.getStateRows('created').length; i+=1) {
                        var create = lineDataSource.dataProvider.getJsonRow(lineDataSource.dataProvider.getStateRows('created')[i]);
                        create._huid = Object.keys(self.options.lineDataSources)[l];
                        currentData.Added.push(create);
                    }
                }

                if (lineDataSource.dataProvider.getStateRows('updated')) {
                    for (j = 0; j < lineDataSource.dataProvider.getStateRows('updated').length; j+=1) {
                        var update = lineDataSource.dataProvider.getJsonRow(lineDataSource.dataProvider.getStateRows('updated')[j]);
                        update._huid = Object.keys(self.options.lineDataSources)[l];
                        currentData.Updated.push(update);
                    }
                }

                for (k = 0; k < lineDataSource.options._destroy.length; k+=1) {
                    var del = lineDataSource.options._destroy[k];
                    del._huid = Object.keys(self.options.lineDataSources)[l];
                    currentData.Deleted.push(del);
                }
            }
        } else {
            if (self.dataProvider.getStateRows('created')) {
                for (i = 0; i < self.dataProvider.getStateRows('created').length; i+=1) {
                    currentData.Added.push(self.dataProvider.getJsonRow(self.dataProvider.getStateRows('created')[i]));
                }
            }

            if (self.dataProvider.getStateRows('updated')) {
                for (j = 0; j < self.dataProvider.getStateRows('updated').length; j+=1) {
                    currentData.Updated.push(self.dataProvider.getJsonRow(self.dataProvider.getStateRows('updated')[j]));
                }
            }

            for (k = 0; k < self.options._destroy.length; k+=1) {
                currentData.Deleted.push(self.options._destroy[k]);
            }
        }

        return currentData;
    };

    /**
     * 데이터소스 변경된 데이터 갯수 반환
     * @return {number} 변경된 데이터 갯수
     */
    DataProvider.prototype.getDirtyDataCount = function () {
        var self = this, count = 0, i, j, k, l;

        if (self.options.detail && self.options.lineDataSources) {
            for (l = 0; l < Object.keys(self.options.lineDataSources).length; l+=1) {
                var lineDataSource = self.options.lineDataSources[Object.keys(self.options.lineDataSources)[l]];
                if (lineDataSource.dataProvider.getStateRows('created')) {
                    for (i = 0; i < lineDataSource.dataProvider.getStateRows('created').length; i+=1) {
                        count+=1;
                    }
                }

                if (lineDataSource.dataProvider.getStateRows('updated')) {
                    for (j = 0; j < lineDataSource.dataProvider.getStateRows('updated').length; j+=1) {
                        count+=1;
                    }
                }

                for (k = 0; k < lineDataSource.options._destroy.length; k+=1) {
                    count+=1;
                }
            }
        } else {
            if (self.dataProvider.getStateRows('created')) {
                for (i = 0; i < self.dataProvider.getStateRows('created').length; i+=1) {
                    count+=1;
                }
            }

            if (self.dataProvider.getStateRows('updated')) {
                for (j = 0; j < self.dataProvider.getStateRows('updated').length; j+=1) {
                    count+=1;
                }
            }

            for (k = 0; k < self.options._destroy.length; k+=1) {
                count+=1;
            }
        }

        return count;
    };

    /**
     * 데이터소스에서 변경된 데이터만 서버에 저장합니다.
     * @param url 저장할 url 경로
     * @param options 전송 옵션
     * @return {*} 저장 한 이후에 설정할 프로미스 객체
     */
    DataProvider.prototype.batchSave = function (url, options) {
        var self = this, data, opt, batchData, dfr = $.Deferred();
        data = self.getDirtyData();

        batchData = {};
        batchData[self.options.id] = data;
        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        dews.api.post(url, opt).done(function (result) {
            if (self.options.lineDataSources) {
                $.each(self.options.lineDataSources, function (idx, item) {
                    item.options._destroy = [];
                    item.dataProvider.clearRowStates();
                });
            } else {
                self.options._destroy = [];
                self.dataProvider.clearRowStates();
            }
            dfr.resolve(result);
        }).fail(function (jqXHR, status, msg, data) {
            dfr.reject(msg);
        });

        return dfr;
    };

    /**
     * 데이터소스에서 전체 데이터를 호출하거나 데이터 설정
     * @param data 설정할 데이터
     * @return {*} 전체 데이터
     */
    DataProvider.prototype.data = function (data) {
        var self = this;
        if (data) {
            self.options.data = data;
            self.dataProvider.setRows(self.options.data);
            self.options.rollback = self.dataProvider.savePoint();
            self.options._destroy = [];
        } else {
            return self.dataProvider.getJsonRows(0, -1);
        }
    };

    /**
     * 데이터소스에서 맨 마직막 행에 데이터 추가
     * @param value 추가할 데이터
     */
    DataProvider.prototype.add = function (value) {
        this.dataProvider.addRow(value);
    };

    /**
     * 데이터소스에서 지정한 행 다음에 데이터 추가
     * @param row 지정한 행의 인덱스
     * @param value 추가할 데이터
     */
    DataProvider.prototype.insert = function (row, value) {
        this.dataProvider.insertRow(row, value);
    };

    /**
     * 데이터소스에서 지정한 행의 데이터 삭제
     * @param row 지정한 행의 인덱스
     */
    DataProvider.prototype.remove = function (row) {
        this.dataProvider.removeRow(row);
    };

    /**
     * 데이터소스 지정한 인덱스로 데이터 반환
     * @param row 지정한 행의 인덱스
     * @return {*} 지정한 행의 데이터
     */
    DataProvider.prototype.at = function (row) {
        return this.dataProvider.getJsonRow(row);
    };

    /**
     * 데이터소스 필드 설정
     * @param fields 설정할 필드
     */
    DataProvider.prototype.setFields = function (fields) {
        this.options.schema.model.fields = fields;
        this.options = setDataSourceOptions(this.options);
        this.dataProvider.setFields(this.options.field);
    };

    /**
     * 데이터소스 옵션 설정
     * @param options 설정할 옵션 정보
     */
    DataProvider.prototype.setOptions = function (options) {
        var self = this, opt;

        opt = $.extend(true, this.options, options);
        self.options = opt;
        self.dataProvider.setOptions(opt);
    };

    /**
     * 데이터소스 스키마에 설정한 id 값으로 일치하는 데이터 반환
     * @param value 스키마에 설정한 id 필드에서 가져올 데이터
     * @return {Array} 반환된 데이터
     */
    DataProvider.prototype.get = function (value) {
        var self = this, data = self.data(), dataItem = [], id = "";

        if (self.options.schema && self.options.schema.model && self.options.schema.model.id) {
            id = self.options.schema.model.id;
        }

        if (id) {
            for (var i = 0; i < data.length; i+=1) {
                if((data[i])[id] === value) {
                    dataItem = data[i];
                    break;
                }
            }
        }
        return dataItem;
    };

    /**
     * 데이터소스 변경에 따른 메인버튼 활성화/비활성화 설정
     * @param page 해당 페이지 정보
     * @private
     */
    DataProvider.prototype._dataChange = function (page) {
        var self = this,
            parameter = {
                dataSource: self,
                isChange: false
            },
            event = new $.Event('dataChange', parameter);

        self.options._dataChange = true;

        self.dataProvider.onRowDeleted = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowInserted = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowUpdated = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowStatesCleared = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };
    };

    /**
     * 마스터 디테일 구조 사용시 디테일 데이터소스 변경에 따른 메인버튼 활성화/비활성화 설정
     * @private
     */
    DataProvider.prototype._detailDataChange = function () {
        var self = this;

        self.options._dataChange = true;

        self.dataProvider.onRowDeleted = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowDeleted.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowUpdated = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowUpdated.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowInserted = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowInserted.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowStatesCleared = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowStatesCleared.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                            self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource, true);
                        } else {
                            self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource, true);
                        }
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                            self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource);
                        } else {
                            self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource);
                        }
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };
    };

    /**
     * 마스터 디테일 관계 형성 시 전체 데이터 변경 유무 확인
     * @param target 자식 전체 검사 유무 (기본값: true)
     * @return {boolean} 전체 데이터 변경 유무
     */
    DataProvider.prototype.hasDirty = function (target) {
        var self = this,
            range = true,
            result = false;

        if ($.type(target) === 'boolean') {
            range = target;
        }

        if (range) {
            if ($.type(self.options.detailDataSource) !== 'undefined') {
                result = self.options.detailDataSource.hasDirty(range);

                if (result) {
                    return result;
                } else if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            } else {
                if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            }
        } else {
            if (self.getDirtyDataCount() > 0) {
                result = true;
            }
        }

        return result;
    };

    DataProvider.prototype._bindEvent = function () {
        var self = this;
    };
})(jQuery, window.dews || {}, window.kendo);


/*
 * 날짜피커, 시간피커, 월피커
 */
(function ($, dews, kendo) {

    function getDefaultDateOptions() {
        return {
            format: dews._environments.formats.dateFormat,
            valueFormat: dews._environments.formats.dateValueFormat,
            footer: false
        };
    }

    function getDefaultMonthOptions() {
        return {
            start: "year",
            depth: "year",
            format: dews._environments.formats.monthFormat,
            valueFormat: dews._environments.formats.monthValueFormat
        };
    }

    function getDefaultTimeOptions() {
        return {
            format: dews._environments.formats.timeFormat,
            valueFormat: dews._environments.formats.timeValueFormat,
            interval: 30
        };
    }

    function getDefaultDateTimeOptions() {
        return {
            format: dews._environments.formats.dateTimeFormat,
            valueFormat: dews._environments.formats.dateTimeValueFormat
        };
    }

    /**
     * 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체
     * @param {object} defaultOptions 기본 옵션
     * @param {object} srcOptions 스크립트 코드에서 전송된 옵션
     * @returns {object} 옵션 설정 값
     */
    function getOptions($el, defaultOptions, srcOptions) {
        var inlineOptions = {},
            preDefinedFormat,
            options;

        inlineOptions = getInlineOptions($el, defaultOptions);
        preDefinedFormat = dews.getPreDefinedFormat($el);

        if (preDefinedFormat) {
            var vf = preDefinedFormat.replace(/[^(a-z)]/gi,"");
            preDefinedFormat = {
                format: preDefinedFormat,
                valueFormat: vf
            };
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions, preDefinedFormat);
        } else if (preDefinedFormat !== false && inlineOptions) {
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions);
        } else {
            options = $.extend(true, {}, defaultOptions, srcOptions);
        }

        if ($el.val()) {
            options.value = kendo.parseDate($el.val(), options.valueFormat, kendo.getCulture());
        }

        return options;
    }

    /**
     * HTML 태그에 지정된 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} defaultOptions 기본 옵션
     * @returns {object} 옵션
     */
    function getInlineOptions($el, defaultOptions) {
        var options = {};

        if ($el.data('dews-max')) {
            options.max = kendo.parseDate($el.data('dews-max').toString(), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-min')) {
            options.min = kendo.parseDate($el.data('dews-min').toString(), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-format')) {
            options.format = $el.data('dews-format');
        }

        return options;
    }

    /**
     * 코드피커를 초기화 합니다.
     * @param {jQuery} $el 적용할 대상 요소의 jQuery객체입니다.
     * @param {string} type 피커 타입입니다.
     */
    function initControl($el, type) {
        var $wrapper = $el.closest('.k-widget'),
            $state = $wrapper.find('.k-picker-wrap');

        if ($wrapper.hasClass('dews-ui-' + type)) {
            $wrapper.removeClass('dews-ui-' + type);
        }
        if ($wrapper.hasClass('dews-control-activate')) {
            $wrapper.removeClass('dews-control-activate');
        }
        if (!$wrapper.hasClass('dews-' + type + '-wrapper')) {
            $wrapper.addClass('dews-' + type + '-wrapper');
        }

        //
        // 상태정보 추가
        //
        if ($wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            $wrapper.removeClass('disabled');
        }
        if ($wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            $wrapper.removeClass('readonly');
        }
        if ($wrapper.hasClass('required')) {
            $state.addClass('dews-state-required');
            $wrapper.removeClass('required');
        }
        if ($wrapper.hasClass('etc1')) {
            $state.addClass('dews-state-etc1');
            $wrapper.removeClass('etc1');
        }
        if ($wrapper.hasClass('etc2')) {
            $state.addClass('dews-state-etc2');
            $wrapper.removeClass('etc2');
        }
        if ($wrapper.hasClass('etc3')) {
            $state.addClass('dews-state-etc3');
            $wrapper.removeClass('etc3');
        }

        setUserGuideAPI($el);
    }

    /**
     * 텍스트박스에 마스크를 적용합니다.
     * @param {jQuery} $el 적용할 대상 요소의 jQuery 객체
     * @param {string} format 적용 포맷
     */
    function setMask($el, format) {
        var maskJsUrl;

        // jquery.maskedinput.js 를 이용하여 마스크를 적용함
        // script 파일을 로드된 적이 없으면 동적으로 로드합니다.
        maskJsUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', 'jquery.maskedinput.js');

        if ($.mask) {
            $el.mask(format.replace(/[ymdhms]/ig, '9'));
        } else {
            $.getScript(maskJsUrl, function () {
                $el.mask(format.replace(/[ymdhms]/ig, '9'));
            });
        }
    }

    /**
     * 공통 이벤트를 설정합니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체 입니다.
     * @param {object} [options] 피커의 옵션입니다.
     */
    function setEvent($el, options) {
        $el.on('click', function () {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 읽기 전용/비활성화 상태가 아니면 포커스가 오면 텍스트 전체를 선택하도록 한다.
                $this.select();
            }
        }).on('blur', function (e) {
            var $this = $(this), ctrl;
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                if (!dews.date.validate($this.val(), options.format)) {
                    ctrl = $this.data('dews-control');
                    ctrl.value('');
                    // TODO: 입력된 값이 유효하지 않을 경우 오류 표시 및 포커스 처리 고도화
                }
            }
        }).on('keydown', function (e) {
            var $this = $(this), ctrl;
            // f4로 달력 팝업 활성화
            if (e.keyCode === 115) {
                ctrl = $this.data('dews-control');
                ctrl.open();
                e.stopPropagation();
                e.preventDefault();
            }
        });
    }

    /**
     * 값을 설정하거나 가져옵니다.
     * @param {function} value Kendo UI 의 value 함수
     */
    function getSetValue(value) {
        return function (val) {
            var self = this, formats;

            if (self.options.name.toUpperCase() === 'DATEPICKER') {
                if (self.options.depth === 'decade') {
                    formats = dews._environments.formats.yearValueFormat;
                } else if (self.options.depth === 'year') {
                    formats = dews._environments.formats.monthValueFormat; 
                } else if (self.options.depth === 'month') {
                    formats = dews._environments.formats.dateValueFormat;
                }
            } else if (self.options.name.toUpperCase() === 'DATETIMEPICKER') {
               formats = dews._environments.formats.dateTimeValueFormat;
            } else if (self.options.name.toUpperCase() === 'TIMEPICKER') {
                formats = dews._environments.formats.timeValueFormat;
            }

            if (typeof val === 'undefined') {
               return kendo.toString(self._value, formats, kendo.getCulture());
            }
            if ($.type(val) === "string") {
                val = kendo.parseDate(val, formats, kendo.getCulture());
            }

            value.call(self, val);
        };
    }

    /**
     * readonly 함수를 확장합니다.
     * @param {function} readonly Kendo UI의 readonly 함수
     */
    function setReadonly(readonly) {
        return function (val) {
            var self = this,
                $state = self.wrapper.find('.k-picker-wrap');

            if (typeof val === 'undefined') {
                return self.element.prop('readonly');
            } else {
                if (val === true) {
                    if (!self.wrapper.hasClass('readonly')) {
                        self.wrapper.addClass('readonly');
                    }
                    if (!self.element.hasClass('readonly')) {
                        self.element.addClass('readonly');
                    }
                    if (!$state.hasClass('dews-state-readonly')) {
                        $state.addClass('dews-state-readonly');
                    }
                } else if (val === false) {
                    if (self.wrapper.hasClass('readonly')) {
                        self.wrapper.removeClass('readonly');
                    }
                    if (self.element.hasClass('readonly')) {
                        self.element.removeClass('readonly');
                    }
                    if ($state.hasClass('dews-state-readonly')) {
                        $state.removeClass('dews-state-readonly');
                    }
                }
            }

            readonly.call(self, val);
        };
    }

    /**
     * enable 함수를 확장합니다.
     * @param {function} readonly Kendo UI의 원본 readonly 함수
     */
    function setEnable(readonly) {
        return function (val) {
            var self = this,
                $state = self.wrapper.find('.k-picker-wrap');

            if (typeof val === 'undefined') {
                return !self.element.prop('disabled');
            } else {
                if (val === false) {
                    if (!self.wrapper.hasClass('disabled')) {
                        self.wrapper.addClass('disabled');
                    }
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                    if (!$state.hasClass('dews-state-disabled')) {
                        $state.addClass('dews-state-disabled');
                    }
                } else {
                    if (self.wrapper.hasClass('disabled')) {
                        self.wrapper.removeClass('disabled');
                    }
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                    if ($state.hasClass('dews-state-disabled')) {
                        $state.removeClass('dews-state-disabled');
                    }
                }
            }

            readonly.call(self, val);
        };
    }

    /**
     * 설정된 텍스트를 가져옵니다.
     */
    function getText() {
        return this.element.val();
    }

    function on() {
        var self = this, $element = self.element;
        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    }

    /**
     * 최소값을 설정하거나 가져옵니다.
     */
    function getSetMin(min) {
        return function (val) {
            var self = this,
                date;

            if (typeof val === 'undefined') {
                if (self.wrapper.hasClass('dews-timepicker-wrapper')) {
                    return kendo.toString(self.options.min, dews._environments.formats.timeValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-monthpicker-wrapper')) {
                    return kendo.toString(self.options.min, dews._environments.formats.monthValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-datetimepicker-wrapper')) {
                    return kendo.toString(self.options.min, dews._environments.formats.dateTimeValueFormat, kendo.getCulture());
                } else {
                    return kendo.toString(self.options.min, getDefaultDateOptions().valueFormat, kendo.getCulture());
                }
            } else {
                if (self.wrapper.hasClass('dews-timepicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.timeValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-monthpicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.monthValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-datetimepicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.dateTimeValueFormat, kendo.getCulture());
                } else {
                    date = kendo.parseDate(val.toString(), getDefaultDateOptions().valueFormat, kendo.getCulture());
                }
            }

            min.call(self, date);
        };
    }

    /**
     *  최대값을 설정하거나 가져옵니다.
     */
    function getSetMax(max) {
        return function (val) {
            var self = this,
                date;

            if (typeof val === 'undefined') {
                if (self.wrapper.hasClass('dews-timepicker-wrapper')) {
                    return kendo.toString(self.options.max, dews._environments.formats.timeValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-monthpicker-wrapper')) {
                    return kendo.toString(self.options.max, dews._environments.formats.monthValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-datetimepicker-wrapper')) {
                    return kendo.toString(self.options.max, dews._environments.formats.dateTimeValueFormat, kendo.getCulture());
                } else {
                    return kendo.toString(self.options.max, getDefaultDateOptions().valueFormat, kendo.getCulture());
                }
            } else {
                if (self.wrapper.hasClass('dews-timepicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.timeValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-monthpicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.monthValueFormat, kendo.getCulture());
                } else if (self.wrapper.hasClass('dews-datetimepicker-wrapper')) {
                    date = kendo.parseDate(val.toString(), dews._environments.formats.dateTimeValueFormat, kendo.getCulture());
                } else {
                    date = kendo.parseDate(val.toString(), getDefaultDateOptions().valueFormat, kendo.getCulture());
                }
            }

            max.call(self, date);
        };
    }

    /**
     * 날짜 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    function getPrintData () {
        var self = this,
            $el = $(self.element),
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    }

    /**
     * 추가적인 작업을 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setAdditionalAPI($element, instance) {

        instance.on = function () {
            if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
                $element.on.apply($element, arguments);
            } else {
                instance.bind.apply(instance, arguments);
            }
        };
    }

    function off() {
        var self = this, $element = self.element;
        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    }

    function validate() {
        var self = this;
        return !!self.value();
    }

    function bindFromPanel(data) {
        var self = this, $element = self.element;
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.value(data[column]);
            }
        }
    }

    function serializeForPanel() {
        var self = this, $element = self.element;
        var column, data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = self.value();
        }

        return data;
    }

    function applyPanelFocus() {
        var self = this, $element = self.element;

        $element.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    }

    function focus() {
        var self = this, $element = self.element;
        $element.focus();
    }

    function canFocusable() {
        var self = this, $element = self.element;
        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 년월일을 받아오는 날짜 피커를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 피커로 변경될 요소를 지정하는 셀럭터 또는 jQuery 객체입니다.
             * @param {object} [options] 피커 설정 값입니다.
             */
            datepicker: function (selector, options) {
                var $el,
                    datepicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker,
                        $this = $(this),
                        opt;

                    picker = $this.data('dews-control');

                    if (!picker) {
                        opt = getOptions($this, getDefaultDateOptions(), options);

                        dews.ui.util.ConvertClassAndProperty($this);
                        $this.kendoDatePicker(opt);

                        picker = $this.data('kendoDatePicker');
                        picker.options.valueFormat = opt.valueFormat;

                        if (!$this.hasClass('dews-ui-datepicker')) {
                            $this.addClass('dews-ui-datepicker');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        initControl($this, 'datepicker');
                        setMask($this, opt.format);
                        setEvent($this, opt);

                        $this.data('dews-control', picker);
                    }

                    datepicker = picker;
                });

                return datepicker;
            },
            /**
             * 시간을 받아오는 시간 피커를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 피커로 변경될 요소를 지정하는 셀렉터 또는 jQuery 객체입니다.
             * @param {object} [options] 피커 설정 값입니다.
             */
            timepicker: function (selector, options) {
                var $el,
                    timepicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker,
                        $this = $(this),
                        opt;

                    picker = $this.data('dews-control');

                    if (!picker) {
                        opt = getOptions($this, getDefaultTimeOptions(), options);

                        dews.ui.util.ConvertClassAndProperty($this);
                        $this.kendoTimePicker(opt);

                        picker = $this.data('kendoTimePicker');
                        picker.options.valueFormat = opt.valueFormat;

                        if (!$this.hasClass('dews-ui-timepicker')) {
                            $this.addClass('dews-ui-timepicker');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass("dews-control-activate");
                        }

                        initControl($this, 'timepicker');
                        setMask($this, opt.format);
                        setEvent($this, opt);

                        $this.data('dews-control', picker);
                    }

                    timepicker = picker;
                });

                return timepicker;
            },
            /**
             * 년월을 받아오는 월 피커를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 피커로 변경될 요소를 지정하는 셀렉터 또는 jQuery 객체입니다.
             * @param {object} [options] 피커 설정 값입니다.
             */
            monthpicker: function (selector, options) {
                var $el,
                    datepicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker,
                        $this = $(this),
                        opt;

                    picker = $this.data('dews-control');

                    if (!picker) {
                        opt = getOptions($this, getDefaultMonthOptions(), options);

                        dews.ui.util.ConvertClassAndProperty($this);
                        $this.kendoDatePicker(opt);

                        picker = $this.data('kendoDatePicker');
                        picker.options.valueFormat = opt.valueFormat;

                        if (!$this.hasClass('dews-ui-monthpicker')) {
                            $this.addClass('dews-ui-monthpicker');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        initControl($this, 'monthpicker');
                        setMask($this, opt.format);
                        setEvent($this, opt);

                        $this.data('dews-control', picker);
                    }

                    datepicker = picker;
                });

                return datepicker;
            },
            /**
             * 년월일시분을 받아오는 일시 피커를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 피커로 변경될 요소를 지정하는 셀렉터 또는 jQuery객체입니다.
             * @param {object} [options] 피커 설정 값입니다.
             */
            datetimepicker: function (selector, options) {
                var $el,
                    datetimepicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker,
                        $this = $(this),
                        opt;

                    picker = $this.data('dews-control');

                    if (!picker) {
                        opt = getOptions($this, getDefaultDateTimeOptions(), options);

                        dews.ui.util.ConvertClassAndProperty($this);
                        $this.kendoDateTimePicker(opt);

                        picker = $this.data('kendoDateTimePicker');
                        picker.options.valueFormat = opt.valueFormat;

                        if (!$this.hasClass('dews-ui-datetimepicker')) {
                            $this.addClass('dews-ui-datetimepicker');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        initControl($this, 'datetimepicker');
                        setMask($this, opt.format);
                        setEvent($this, opt);

                        $this.data('dews-control', picker);
                    }

                    datetimepicker = picker;
                });

                return datetimepicker;
            }
        }
    });

    dews.ui.addControlInitializer('datepicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.datepicker($('input[type="text"].dews-ui-datepicker', $container));
        dews.ui.timepicker($('input[type="text"].dews-ui-timepicker', $container));
        dews.ui.monthpicker($('input[type="text"].dews-ui-monthpicker', $container));
        dews.ui.datetimepicker($('input[type="text"].dews-ui-datetimepicker', $container));
    });

    /**
     * 값을 설정하거나 가져옵니다.
     */
    kendo.ui.DatePicker.fn.value = getSetValue(kendo.ui.DatePicker.fn.value);

    /**
     * 값을 설정하거나 가져옵니다.
     */
    kendo.ui.TimePicker.fn.value = getSetValue(kendo.ui.TimePicker.fn.value);

    /**
     * 값을 설정하거나 가져옵니다.
     */
    kendo.ui.DateTimePicker.fn.value = getSetValue(kendo.ui.DateTimePicker.fn.value);

    // readonly 함수 확장
    kendo.ui.DatePicker.fn.readonly = setReadonly(kendo.ui.DatePicker.fn.readonly);
    kendo.ui.TimePicker.fn.readonly = setReadonly(kendo.ui.TimePicker.fn.readonly);
    kendo.ui.DateTimePicker.fn.readonly = setReadonly(kendo.ui.DateTimePicker.fn.readonly);


    // enable 함수 확장
    kendo.ui.DatePicker.fn.enable = setEnable(kendo.ui.DatePicker.fn.enable);
    kendo.ui.TimePicker.fn.enable = setEnable(kendo.ui.TimePicker.fn.enable);
    kendo.ui.DateTimePicker.fn.enable = setEnable(kendo.ui.DateTimePicker.fn.enable);

    // text 함수 추가
    kendo.ui.DatePicker.fn.text = kendo.ui.TimePicker.fn.text = kendo.ui.DateTimePicker.fn.text = getText;

    kendo.ui.DatePicker.fn.on = kendo.ui.TimePicker.fn.on = kendo.ui.DateTimePicker.fn.on = on;
    kendo.ui.DatePicker.fn.off = kendo.ui.TimePicker.fn.off = kendo.ui.DateTimePicker.fn.off = off;
    kendo.ui.DatePicker.fn.validate = kendo.ui.TimePicker.fn.validate = kendo.ui.DateTimePicker.fn.validate = validate;
    kendo.ui.DatePicker.fn.bindFromPanel = kendo.ui.TimePicker.fn.bindFromPanel = kendo.ui.DateTimePicker.fn.bindFromPanel = bindFromPanel;
    kendo.ui.DatePicker.fn.serializeForPanel = kendo.ui.TimePicker.fn.serializeForPanel = kendo.ui.DateTimePicker.fn.serializeForPanel = serializeForPanel;
    kendo.ui.DatePicker.fn.applyPanelFocus = kendo.ui.TimePicker.fn.applyPanelFocus = kendo.ui.DateTimePicker.fn.applyPanelFocus = applyPanelFocus;
    kendo.ui.DatePicker.fn.focus = kendo.ui.TimePicker.fn.focus = kendo.ui.DateTimePicker.fn.focus = focus;
    kendo.ui.DatePicker.fn.canFocusable = kendo.ui.TimePicker.fn.canFocusable = kendo.ui.DateTimePicker.fn.canFocusable = canFocusable;

    //min, max 함수 확장
    kendo.ui.DatePicker.fn.min = getSetMin(kendo.ui.DatePicker.fn.min);
    kendo.ui.DatePicker.fn.max = getSetMax(kendo.ui.DatePicker.fn.max);
    kendo.ui.TimePicker.fn.min = getSetMin(kendo.ui.TimePicker.fn.min);
    kendo.ui.TimePicker.fn.max = getSetMax(kendo.ui.TimePicker.fn.max);
    kendo.ui.DateTimePicker.fn.min = getSetMin(kendo.ui.DateTimePicker.fn.min);
    kendo.ui.DateTimePicker.fn.max = getSetMax(kendo.ui.DateTimePicker.fn.max);

    // 자동화 인쇄 관련 함수 확장
    kendo.ui.DatePicker.fn._getPrintData = kendo.ui.TimePicker.fn._getPrintData = kendo.ui.DateTimePicker.fn._getPrintData = getPrintData;

})(jQuery, window.dews, window.kendo);


/*
 * 다이얼로그 창
 */
(function ($, dews, kendo) {

    /*
     * iframe 형식(메인 프레임 내부의 iframe에 비지니스 페이지가 임베딩되는 형식)으로 구성된 레이아웃에서는
     * 모달 다이얼로그 창은 iframe 내부가 아닌 메인 프레임에서 떠야 합니다.
     */

    var defaultTargetFrame = '_main',
        defaultOptions = {
            modal: true,            // 모달 여부
            width: 640,             // 다이얼로그 너비(px)
            height: 240,            // 다이얼로그 높이(px)
            size: 'medium',         // 다이얼로그의 사이즈 설정 (small, medium, large, extra)
            draggable: true,        // 다이얼로그 이동 가능 여부
            resizable: false,       // 다이얼로그 사이즈 조절 가능 여부
            url: '',                // 다이얼로그 컨텐츠 URL
            iframe: false,           // 아이프레임 사용여부,
            buttons: 'none',        // 다이얼로그 버튼 영역을 설정
            border: '',
            animation: {
                open: { duration: 100 },
                close: { duration : 100 }
            }
        };

    // 에러 페이지 정의
    var transparentImg = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA',
        error401Page = '<div class="dews-dialog-error">'
            + '<img src="' + transparentImg + '" class="dews-dialog-error-img">'
            + '<div class="dews-dialog-error-title">401 Unauthorized</div>'
            + '</div>',
        error404Page = '<div class="dews-dialog-error">'
            + '<img src="' + transparentImg + '" class="dews-dialog-error-img">'
            + '<div class="dews-dialog-error-title">404 page not found</div>'
            + '</div>',
        error500Page = '<div class="dews-dialog-error">'
            + '<img src="' + transparentImg + '" class="dews-dialog-error-img">'
            + '<div class="dews-dialog-error-title">500 Internal server error</div>'
            + '</div>';

    /**
     * 다이얼로그 창
     * @param {string} id 다이얼로그 아이디
     * @param {object} [options] 다이얼로그 설정 값
     * @param {boolean} [useMain] 다이얼로그가 메인 프레임에 생성되는지 여부
     * @constructor
     */
    function DialogWindow (id, options, useMain) {
        var self = this;
        var modal = options.modal;

        self.id = id;
        self.options = $.extend({}, defaultOptions, options);
        self.initData = null;
        self.buttons = {
            ok: $('<button class="dews-ui-button confirm"></button>'),
            cancel:$('<button class="dews-ui-button confirm"></button>')
        };

        // 옵션 사이즈 별로 너비 높이 설정
        switch ((self.options.size).toLowerCase()) {
            case 'small':
                self.options.width = 360;
                self.options.height = 240;
                break;
            case 'large':
                self.options.width = 746;
                self.options.height = 630;
                break;
            case 'extra':
                self.options.width = 1095;
                self.options.height = 630;
                break;
            default:
                self.options.width = 560;
                self.options.height = 600;
                break;
        }
        // 옵션 너비 설정
        if ($.type(options.width) !== 'undefined') {
            self.options.width = options.width;
        }
        // 옵션 높이 설정
        if ($.type(options.height) !== 'undefined') {
            self.options.height = options.height;
        }

        if(options.width === 'large') {
            if(!options.height) {
                self.options.height = 630;
            }
        } else if(options.width === 'medium') {
            if(!options.height) {
                self.options.height = 600;
            }
        }

        if (useMain) {
            self.target = getMainFrameWindowObject(window);
        } else {
            self.target = window;
        }

        if (options) {
            if (options.hasOwnProperty('initData')) {
                // 초기화 데이터 설정
                self.initData = options.initData;
                delete options.initData;
            }
        }
    }

    /**
     * 다이얼로그 창을 엽니다.
     * @param {boolean} center 화면 중앙에 다이얼로그를 표시할지 여부
     */
    DialogWindow.prototype.open = function (center) {
        var self = this,
            kendoOptions,
            contentUrl,
            $kWin, kWin;

        if ($.type(center) !== 'boolean') {
            if(self.options.hasOwnProperty('position')){
                center = false;
            } else {
                center = true;
            }
        }

        // kendo Dialog 옵션
        kendoOptions = $.extend(true, {}, self.options);

        if (kendoOptions.url) {
            // 다이얼로그 내부 URL 을 설정
            contentUrl = dews.url.getAbsoluteUrl(kendoOptions.url);

            if (kendoOptions.iframe) {
                // iframe 방식 로드
                if (!kendoOptions.content) {
                    kendoOptions.content = contentUrl;
                }
            }

            delete kendoOptions.url;
        }


        kendoOptions.activate = function () {
            self._initControl();
            // 컨테이너 내부에서 신규로 로드된 컨트롤의 초기화하기 위해서 이벤트를 발생시킨다.
            $(document).trigger('inituicontrols', [ '#' + self.id, self ]);
        };

        kendoOptions.close = function () {
            /*
             다이얼로그 창이 닫히면 다이얼로그 엘리먼트 자체를 삭제해야 합니다.
             그렇지 않으면 다시 동일한 아이디의 다이얼로그를 띄울 때
             이전 내용이 보이다 새로운 내용으로 교체되는 현상이 발생합니다.
             */
            self._kendoWindow.bind('deactivate', function () {
                self._kendoWindow.destroy();
            });

            if ($.type(self.options.close) === 'function') {
                // 옵션에 설정되어 있는 close 함수를 호출한다.
                self.options.close.call(self);
            }

            delete dews.ui.dialogPage;
        };

        $kWin = self.target.$('#' + self.id + '.dews-ui-dialog');

        if ($kWin.length > 0) {
            kWin = $kWin.eq(0).data('kendoWindow');
        } else {
            $kWin = self.target.$(dews.string.format('<div id="{0}" />', self.id));
            $kWin.addClass('dews-ui-dialog');

            if(kendoOptions.size === 'small') {
                $kWin.addClass('dews-ui-dialog small');
            } else if(kendoOptions.size === 'medium') {
                $kWin.addClass('dews-ui-dialog medium');
            } else if(kendoOptions.size === 'large') {
                $kWin.addClass('dews-ui-dialog large');
            } else if(kendoOptions.size === 'extra') {
                $kWin.addClass('dews-ui-dialog extra');
            }

            var $content;
            if (typeof kendoOptions.content === 'string') {
                if(typeof contentUrl === 'undefined') {
                    $content = $(kendoOptions.content);

                    delete kendoOptions.content;
                }
            } else if (kendoOptions.content instanceof jQuery) {
                $content = kendoOptions.content;

                delete kendoOptions.content;
            }

            $kWin.kendoWindow(kendoOptions);

            kWin = $kWin.data('kendoWindow');

            $kWin.data('dews-control', self);
            self._kendoWindow = kWin;
            self.$innerContent = $content;
            self.options.center = center;
        }

        if(!$kWin.hasClass('dews-ui-msgbox-dialog')) {
            $kWin.parent().addClass('dialog');
        }

        if (self.options.modal === false) {
            $kWin.parent().addClass('modaless');
        }

        if (center) {
            kWin.center();
        }
        // 다이얼로그 객체를 전역으로 등록
        dews.ui.dialogPage = {
            id: self.id,
            dialog: kWin,
            $content: $kWin
        };
        // 컨텍스트를 구성
        self.dialog = kWin;
        self.$content = $kWin;

        if (!kendoOptions.iframe && contentUrl) {
            // 다이얼로그 화면을 로드하기 위한 Promise
            var loadPromise = function() {
                var $loadDfd = $.Deferred();

                $.get(contentUrl).done(function (html) {
                    $kWin.html(html);
                    $loadDfd.resolve();
                }).fail(function(xhr) {
                    switch (xhr.status) {
                        case 401:
                            $kWin.html(error401Page);
                            break;
                        case 500:
                            $kWin.html(error500Page);
                            break;
                        case 404:
                            $kWin.html(error404Page);
                            break;
                    }
                    console.log('## 다이얼로그 로드 에러:', contentUrl);
                    $loadDfd.reject();
                })

                return $loadDfd.promise();
            }
            // 다국어 리소스를 로드하기 위한 Promise
            var localizePromise = function() {
                var $localizeDfd = $.Deferred();

                if (dews._environments.useLocalization && dews.localize.mode() === 'multiple') {
                    dews.localize.load(dews.localize.language(), self.id)
                        .always(function () {
                            $localizeDfd.resolve();
                        });
                } else {
                    $localizeDfd.resolve();
                }

                return $localizeDfd.promise();
            }

            loadPromise().then(localizePromise).always(function() {
                kWin.open();
            });

        } else {
            kWin.open();
        }
        // if(defaultOptions.iframe === false) {
        //     dews.ajax.load('#'+self.id, kendoOptions.content);
        // }
        // kWin.open();
    };

    /**
     * 다이얼로그 구조 설정
     * @private
     */
    DialogWindow.prototype._initControl = function () {
        var self = this,
            $kWin = self._kendoWindow.element,
            $content = self.$innerContent,
            kendoOptions = self._kendoWindow.options,
            wrapper= $('<div class="dews-dialog-contents"></div>');

        if ($content && $content.length > 0) {
            $kWin.append($content);
        }

        wrapper.append($kWin.find('> *'));
        $kWin.append(wrapper);

        var $buttons = $('<div class="dews-button-group dews-dialog-button-group bottom"></div>');

        if(kendoOptions.buttons === 'applyAndClose') {
            $buttons.append(self.buttons.ok);
            dews.ui.button(self.buttons.ok);
            self.buttons.ok.text(dews.localize.get('적용','dews_적용'));
            self.buttons.cancel.text(dews.localize.get('취소','dews_취소'));
            $kWin.append($buttons);
        } else if(kendoOptions.buttons === 'saveAndCancel') {
            $buttons.append(self.buttons.ok);
            dews.ui.button(self.buttons.ok);
            self.buttons.ok.text(dews.localize.get('저장','dews_저장'));
            self.buttons.cancel.text(dews.localize.get('취소','dews_취소'));
            $kWin.append($buttons);
        } else if(kendoOptions.buttons === 'close') {
            self.buttons.cancel.text(dews.localize.get('닫기','dews_닫기'));
            $kWin.append($buttons);
        }

        $buttons.append(self.buttons.cancel);
        dews.ui.button(self.buttons.cancel);

        self.buttons.cancel.on('click', function (e) {
            e.preventDefault();

            dews.ui.dialog(self.id).close();
        });

        if (self.options.center) {
            self._kendoWindow.center();
        }
    };

    /**
     * 다이얼로그를 닫습니다.
     */
    DialogWindow.prototype.close = function () {
        var self = this;

        if (self._kendoWindow) {
            self._kendoWindow.close();

            // 다이얼로그 객체를 정리
            dews.ui.dialogPage = null;
        }
    };

    /**
     * 다이얼로그 윈도우의 처리가 정상적으로 끝나 다이얼로그를 닫습니다.
     * @param {object} [data] 처리 결과 데이터
     */
    DialogWindow.prototype.ok = function (data) {
        var self = this;

        if (self._kendoWindow) {
            self._kendoWindow.close();

            if (self.options.hasOwnProperty('ok') && $.type(self.options.ok) === 'function') {
                self.options.ok.call(self, data);
            }
        }
    };

    /**
     * 다이얼로그 윈도우의 처리를 취소하고 다이얼로그를 닫습니다.
     */
    DialogWindow.prototype.cancel = function () {
        var self = this;

        if (self._kendoWindow) {
            self._kendoWindow.close();

            if (self.options.hasOwnProperty('cancel') && $.type(self.options.cancel) === 'function') {
                self.options.cancel.call(self);
            }
        }
    };

    /**
     * 다이얼로그 윈도우의 초기화 데이터를 가져옵니다.
     */
    DialogWindow.prototype.getInitData = function () {
        var self = this;

        return self.initData;
    };

    /**
     * 다이얼로그 윈도우의 초기화 데이터를 설정합니다.
     * @param {*} data 초기화 데이터
     */
    DialogWindow.prototype.setInitData = function (data) {
        var self = this;

        if ($.type(data) === 'undefined') {
            data = null;
        }

        self.initData = data;
    };

    /**
     * 다이얼로그 윈도우의 사이즈를 조정합니다.
     * @param {number} width 너비
     * @param {number} height 높이
     * @param {boolean} [center] 가운데 여부(기본값: 가운데)
     */
    DialogWindow.prototype.resize = function (width, height, center) {
        var self = this,
            $wrapper;

        if ($.type(center) === 'undefined') {
            center = true;
        }

        $wrapper = self._kendoWindow.wrapper;

        if ($wrapper) {
            $wrapper.kendoStop(true, true);
            $wrapper.width(width).height(height);
            if (center) {
                self._kendoWindow.center();
            }
        }
    };

    /**
     * 다이얼로그의 제목을 설정하거나 가져옵니다.
     * @param {string} [title] 다이얼로그 제목
     * @returns {string} 다이얼로그 제목
     */
    DialogWindow.prototype.title = function (title) {
        var self = this;

        if (typeof title === 'undefined') {
            title = self._kendoWindow.title();
        } else {
            self._kendoWindow.title(title);
        }

        return title;
    };

    /**
     * 다이얼로그가 출력된 메인 프레임 윈도우 객체를 찾아서 반환합니다.
     * @param {object} win 대상 윈도우 객체
     */
    function getMainFrameWindowObject(win) {
        if (win.dews && win.dews.isMainFrame()) {
            return win;
        } else if (win !== window.top) {
            return getMainFrameWindowObject(win.parent); // 메인 프레임이 아니고 부모 프레임이 존재하면 부모 프레임 검사
        } else {
            return win; // 어떤 프레임도 메인 프레임이 아닐 경우에는 현재 프레임 객체를 메인 프레임으로 반환
        }
    }

    /**
     * 이미 생성되어 있는 다이얼로그 객체를 찾아서 반환합니다.
     * @param {string} dialogId 다이얼로그의 아이디
     * @param {object} [win] 다이얼로그를 찾을 프레임의 윈도우 객체
     * @returns {DialogWindow} 다이얼로그 객체
     */
    function findDialog(dialogId, win) {
        var dialog, $dialog, rootWin;

        if (!win) {
            win = window;
        }

        $dialog = win.$('#' + dialogId + '.dews-ui-dialog');

        if ($dialog.length > 0) {
            dialog = $dialog.eq(0).data('dews-control');
        }
        else {
            rootWin = getMainFrameWindowObject(win);

            if (rootWin !== win) {
                dialog = findDialog(dialogId, rootWin);
            }
        }

        return dialog;
    }

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 다이얼로그를 생성합니다.
             * @param {string} id 다이얼로그 아이디
             * @param {object} [options] 다이얼로그 생성 옵션 값
             * @param {boolean} [useMain] 다이얼로그를 메인 프레임에 생성할지 여부
             */
            dialog: function (id, options, useMain) {
                var dialog,                             // 다이얼로그 객체
                    dialogId,                           // 다이얼로그의 아이디
                    dialogOptions = {},                 // 다이얼로그의 옵션 값
                    find = false;                       // 기존에 만들어진 다이얼로그를 찾아야 하는지 여부

                if (arguments[0] && $.type(arguments[0]) === 'string') {
                    dialogId = arguments[0];
                } else {
                    throw '다이얼로그의 아이디가 지정되지 않았습니다.';
                }

                if (arguments.length === 1) {
                    find = true;
                }

                if (!find) {
                    // 다이얼로그를 신규로 생성합니다.
                    if ($.isPlainObject(arguments[1])) {
                        dialogOptions = options;
                    }

                    if ($.type(useMain) !== 'boolean') {
                        useMain = true;
                    }

                    dialog = new DialogWindow(dialogId, dialogOptions, useMain);
                }

                if (!dialog) {
                    // 기존에 생성된 다이얼로그의 인스턴스를 찾아서 반환합니다.
                    dialog = findDialog(dialogId);

                    if (!dialog) {
                        throw '지정한 아이디의 다이얼로그를 찾을 수 없습니다.';
                    }
                }

                return dialog;
            }
        }
    });

})(jQuery, window.dews, window.kendo);



/*
 * 드롭다운버튼
 */

(function ($, dews) {
    function ChildButton (element) {
        var self = this;

        self.element = $(element);
        self.id = element.id;

        return self;
    }

    ChildButton.prototype.text = function (text) {
        var self = this;

        if (typeof text !== 'undefined') {
            self.element[0].innerText = text;
        } else {
            return self.element[0].innerText;
        }
    };

    ChildButton.prototype.enable = function (value) {
        var self = this,
            state;

        state = !self.element.attr('disabled');

        if (typeof value !== 'undefined') {
            if (value === true) {
                self.element.removeClass('dews-state-disabled');
                self.element.attr('disabled', false);
            } else if(value === false) {
                self.element.addClass('dews-state-disabled');
                self.element.attr('disabled', 'disabled');
            }
            state = value;
        }

        return state;
    };

    ChildButton.prototype.on = function () {
        var self = this;

        self.element.on.apply(self.element, arguments);
    };

    ChildButton.prototype.off = function () {
        var self = this;

        self.element.off.apply(self.element, arguments);
    };

    function setElement($this, options) {
        var element = $this,
            opt = options;

        if (opt) {
            if (opt.text) {
                var label = $('<label/>').text(opt.text);
                $(element).append(label);
            }

            if (opt.button && opt.button.length !== 0) {
                for (var i = 0; i < opt.button.length; i++) {
                    var button = $('<button type="button" id="' + opt.button[i].id +'">').text(opt.button[i].text);

                    if (typeof opt.button[i].enable === 'function') {
                        button.attr('disabled', !opt.button[i].enable());
                    }

                    $(element).append(button);
                }
            }
        }

        return $(element);
    }

    var DropDownButton = function (element, options) {
        var self = this;

        self.element = setElement(element, options);
        self.div = $('<div class="dews-dropdownbutton-list"/>');
        self.label = self.element.find('label');
        self.position = 0;
        self.buttons = [];

        self._bindButton();
        self._bindEvent();
        self._initControl();

        self.buttons.getById = function (id) {
            var self = this;

            for (var i =0; i < self.length; i+=1) {
                if (self[i].id === id) {
                    return self[i];
                }
            }
            return null;
        };
    };

    DropDownButton.prototype._initControl = function () {
        var self = this;

        if (self.element.attr('disabled') === 'disabled' || self.element.attr('disabled') === true) {
            self.element.addClass('dews-state-disabled');
        }

        self.div.find('button[disabled]').addClass('dews-state-disabled');
        self.label.addClass('dews-dropdown-label');
    };
    // 드롭다운 버튼의 버튼의 구조를 바꿔줌
    DropDownButton.prototype._bindButton = function () {
        var self = this;

        self.element.find('button').each(function () {
            self.div.append(this);
            self.buttons.push(new ChildButton(this));
        });

        $('body').append(self.div);
    };

    DropDownButton.prototype._getFontSize = function () {
        var self = this;

        //글자 크기 상태값 받아오기
        if (self.element.hasClass('confirm')) {
            self.div.addClass('confirm');
        } else if (self.element.hasClass('small')) {
            self.div.addClass('small');
        }
    };

    /**
     * 드롭다운버튼 리스트 위치 설정.
     * @private
     */
    DropDownButton.prototype._setListPosition = function () {
        var self = this;
        //드롭다운버튼의 위치
        var buttonX = self.element.offset().left;
        var buttonY = self.element.offset().top;
        var buttonHeight = self.element.height();
        var buttonWidth = self.element.width();
        var margin = self.div.width() - buttonWidth;
        var zIndex = dews.ui.getDialogMaxZIndex();

        if (zIndex > parseInt(self.div.css('zIndex'), 10)) {
            self.div.css('zIndex', zIndex+2);
        }

        //오른쪽 아래로 열릴 떄
        function openDefault () {
            self.div.css({
                'min-width' : buttonWidth,
                'top': buttonY + buttonHeight,
                'left': buttonX
            });
        }

        //왼쪽 아래로 열릴 때
        function openLeftDown () {
            self.div.css({
                'min-width' : buttonWidth,
                'top': buttonY + buttonHeight,
                'left': buttonX - margin + 'px'
            });
        }

        //왼쪽 위로 열릴 때
        function openLeftUp () {
            self.div.css({
                'top': buttonY,
                'left': buttonX - margin + 'px',
                'min-width' : buttonWidth
            });
        }

        //오른쪽 위로 열릴 떄
        function openRightUp () {
            self.div.css({
                'min-width' : buttonWidth,
                'top': buttonY,
                'left': buttonX + 'px'
            });
        }

        //리스트 잘림 현상 수정
        if (self.element.offset().top - self.position + self.div.height() >= $(window).height()) { //위로 열릴 때
            if (self.element.offset().left + self.div.width() >= $(window).width()) { //오른쪽을 기준으로 열릴 때
                openLeftUp();
            } else { //왼쪽을 기준으로 열릴 때
                openRightUp();
            }

            self.listPosition = 'up';

        } else { //아래로 열릴 때
            if (self.element.offset().left + self.div.width() >= $(window).width()) { //오른쪽을 기준으로 열릴 때
                openLeftDown();
            } else { //왼쪽을 기준으로 열릴 때
                openDefault();
            }

            self.listPosition = 'down';
        }
    };

    /**
     * 드롭다운버튼 리스트 열기.
     * @private
     */
    DropDownButton.prototype._listUp = function () {
        var self = this;

        self.div.removeClass('selected');
        self.label.removeClass('selected');

        $(window).off('click');
    };

    /**
     * 드롭다운버튼 리스트 닫기.
     * @private
     */
    DropDownButton.prototype._listDown = function () {
        var self = this;
        var dynamicListHeight = self.div.height();

        //기존에 열려 있던 드롭다운버튼 닫기
        $('.dews-dropdown-label').removeClass('selected');
        $('.dews-dropdownbutton-list').removeClass('selected');

        self.div.addClass('selected');
        self.label.addClass('selected');

        if (self.listPosition === 'up') {
            self.div.css({
                'marginTop': -dynamicListHeight
            });
        }

        if (self.listPosition === 'down') {
            self.div.css({
                'marginTop': 0
            });
        }
    };

    DropDownButton.prototype._bindEvent = function () {
        var self = this;

        // text 클릭시 이벤트
        self.label.on('click', function(e) {
            e.stopPropagation();

            self._getFontSize();
            self._setListPosition();

            if (!self.element.hasClass('dews-state-disabled')) {
                if (self.label.hasClass('selected')) {
                    self._listUp();
                } else {
                    self._listDown();
                    documentClick();
                }
            }
        });

        // 다른 부분을 클릭및 스크롤시 버튼 리스트 닫기
        function documentClick () {
            $(window).on('click mousewheel DOMMouseScroll', function () {
                self._listUp();
            });
        }

        $(window).bind('resize mousewheel DOMMouseScroll',function () {
            self.position = $(this).scrollTop();
            self._initControl();
        });
    };

    DropDownButton.prototype.enable = function (value) {
        var self = this,
            state;

        state = !self.element.attr('disabled');

        if (typeof value !== 'undefined') {
            if (value === true) {
                self.element.removeClass('dews-state-disabled');
                self.element.attr('disabled', false);
            } else if(value === false) {
                self.element.addClass('dews-state-disabled');
                self.element.attr('disabled', true);
            }

            state = value;
        }

        return state;
    };

    $.extend(true, dews, {
        ui: {
            dropdownbutton: function (selector, options) {
                var $el, dropdownbutton;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var button,
                        $this = $(this);

                    button = $this.data('dews-control');

                    if (!button) {

                        if (!$this.hasClass("dews-ui-dropdownbutton")) {
                            $this.addClass("dews-ui-dropdownbutton");
                        }

                        if ($this.data('dews-localize-key')) {
                            $this.find('>label[data-dews-localize-key]').text(dews.localize.get( $this.find('>label').text(), $this.data('dews-localize-key'), $this.data('dews-localize-lang') || null));

                            $this.find('>button[data-dews-localize-key]').each(function (idx, value) {
                                var $list = $(value);
                                $list.text(dews.localize.get($list.text(), $list.data('dews-localize-key'), $list.data('dews-localize-lang') || null));
                            });
                        }

                        button = new DropDownButton(this, options);

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', button);
                    }

                    dropdownbutton = button;
                });

                return dropdownbutton;
            }
        }
    });

    dews.ui.addControlInitializer('dropdownbutton', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.dropdownbutton($("div.dews-ui-dropdownbutton", $container));
    });
})(jQuery, window.dews || {});


/*
 * 드롭다운리스트
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        useNumkey: true,
        autoOpen: false
    };

    /**
     * 설정 값을  가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var inlineOptions;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};

        return $.extend(true, {}, defaultOptions, inlineOptions, codeOptions);
    }

    /**
     * HTML 코드 상에 선언되어 있는 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     */
    function getInlineOptions($el) {
        var options = {},
            dataSource, dataSourceID, dataSourceUrl, dataSourceParams, dataSourceOptions;

        if ($el) {

            // AJAX를 이용한 데이터 바인딩을 사용할지 여부의 판단
            // - 코드도움 코드나 DATA 요청 URL 이 지정되어 있으면 AJAX 를 이용한 데이터 바인딩
            if ($el.data('dews-help-code') || $el.data('dews-data-url')) {

                if ($el.attr('id')) {
                    dataSourceID = $el.attr('id') + '_DataSource';
                } else {
                    dataSourceID = (new Date()).toString() + '_DataSource';
                }

                if ($el.data('dews-data-url')) {
                    dataSourceUrl = dews.url.getAbsoluteUrl($el.data('dews-data-url'));

                    dataSourceOptions = {
                        transport: {
                            read: {
                                url: dataSourceUrl,
                                dataType: 'json'
                            }
                        }
                    };

                    dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
                } else {
                    dataSourceUrl = dews.url.getCodeDataUrl($el.data('dews-help-code'));

                    dataSourceOptions = {
                        transport: {
                            read: {
                                url: dataSourceUrl,
                                dataType: 'json'
                            }
                        }
                    };

                    if ($el.data('dews-help-params')) {
                        dataSourceParams = $.deparam($el.data('dews-help-params'));
                        dataSourceOptions.transport.read.data = dataSourceParams;
                    }

                    dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
                }

                options.dataSource = dataSource;
            }

            if ($el.data('dews-value-field')) {
                options.dataValueField = $el.data('dews-value-field');
            }

            if ($el.data('dews-text-field')) {
                options.dataTextField = $el.data('dews-text-field');
            }

            // 숫자를 이용해서 항목을 선택하는 기능 추가
            if ($el.data('dews-use-numkey') === false) {
                options.useNumkey = $el.data('dews-use-numkey');
            }

            // 포커스가 들어갔을 때, 자동으로 항목을 여는 기능 추가
            if ($el.data('dews-auto-open')) {
                options.autoOpen = $el.data('dews-auto-open');
            }

            if ($el.data('dews-show-tooltip')) {
                options.showTooltip = $el.data('dews-show-tooltip');
            }

            if ($el.hasClass('readonly')) {
                $el.attr('readonly', true);
            }
        }

        return options;
    }

    /**
     * 컨트롤을 초기화합니다.
     * @param {jQuery} $el 대상 DOM 요소의 jQuery 객체
     * @param {object} [options] 설정 값
     */
    function initControl($el, options) {
        var $wrapper, $state;

        $wrapper = $el.closest('.k-dropdown');
        $state = $wrapper.find('.k-dropdown-wrap');

        if ($wrapper.hasClass('dews-ui-dropdownlist')) {
            $wrapper.removeClass('dews-ui-dropdownlist');
        }
        if ($wrapper.hasClass('dews-control-activate')) {
            $wrapper.removeClass('dews-control-activate');
        }
        if (!$wrapper.hasClass('dews-dropdownlist-wrapper')) {
            $wrapper.addClass('dews-dropdownlist-wrapper');
        }

        //
        // 상태정보 추가
        //
        if ($wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            $wrapper.removeClass('disabled');
        }
        if ($wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            $wrapper.removeClass('readonly');
        }
        if ($wrapper.hasClass('required')) {
            $state.addClass('dews-state-required');
            $wrapper.removeClass('required');
        }

        if (options.useNumkey === true) {
            useNumKey($el);
        }

        $el.data('dews-control')._bindEvents();

        setUserGuideAPI($wrapper);
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.children('select.dews-ui-dropdownlist').attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.children('select.dews-ui-dropdownlist').attr('id'));
                }
            }
        });
    }

    function useNumKey($element) {
        var $wrapper = $element.closest('.k-dropdown');

        $wrapper.on('keydown', function (e) {
            var key = e.key, regex = /[1-9]/;

            if ($wrapper.hasClass('k-state-border-down') || $element.attr('aria-expanded') === 'true') {
                if (regex.test(key) && $element.data('dews-control').items().length >= key) {
                    $element.data('dews-control').select(parseInt(key) - 1);
                    $element.data('dews-control').close();
                }
            }
        });
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 드롭다운리스트를 만들거나 가져옵니다.
             * @param {string|jQuery} selector 대상 요소에 대한 셀렉터 또는 jQuery 객체
             * @param {object} [options] 드롭다운리스트 옵션
             */
            dropdownlist: function (selector, options) {
                var $el,
                    ddl;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var dropdown,
                        $this = $(this),
                        opt;

                    dropdown = $this.data('dews-control');

                    if (!dropdown) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass('dews-ui-dropdownlist')) {
                            $this.addClass('dews-ui-dropdownlist');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        dews.ui.util.ConvertClassAndProperty($this);

                        $this.find('>option[data-dews-localize-key]').each(function (idx, value) {
                            var $list = $(value);
                            $list.text(dews.localize.get($list.text(), $list.data('dews-localize-key'), $list.data('dews-localize-lang') || null));
                        });

                        $this.kendoDropDownList(opt);

                        dropdown = $this.data('kendoDropDownList');

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', dropdown);

                        initControl($this, opt);
                    }

                    ddl = dropdown;
                });

                return ddl;
            }
        }
    });

    kendo.ui.DropDownList.fn._bindEvents = function () {
        var self = this, $element = self.element;
        var $wrapper = $element.parent('.dews-dropdownlist-wrapper');
        var list = self.items();

        $wrapper.on('keydown', function (e) {
            if($element.prop('readonly') === false && $element.prop('disabled') === false) {
                if(e.keyCode === 115) {
                    self.open();
                    e.stopPropagation();
                    e.preventDefault();
                }
            }
        }).on('focus', function (e) {
           if (self.options.autoOpen === true) {
               if($element.prop('readonly') === false && $element.prop('disabled') === false) {
                   self.open();
                   e.stopPropagation();
                   e.preventDefault();
               }
           }
        }).on('mousedown', function (e) {
            e.preventDefault();
        });

        if (self.options.showTooltip && list) {
            for (var i = 0; i < list.length; i++) {
                $(list[i]).on('mouseover', function () {
                    var self = this;

                    if (self && self.scrollWidth) {
                        self.scrollWidth > self.offsetWidth ? $(self).attr('title', self.innerText) :  $(self).removeAttr('title');
                    }
                });
            }
        }
    };

    kendo.ui.DropDownList.fn.enable = (function (enable) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return !self.element.prop('disabled');
            } else {
                state = self.wrapper.find('.k-dropdown-wrap');

                if (value) {
                    if (self.wrapper.hasClass('disabled')) {
                        self.wrapper.removeClass('disabled');
                    }
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                    if (state.hasClass('dews-state-disabled')) {
                        state.removeClass('dews-state-disabled');
                    }
                } else {
                    if (!self.wrapper.hasClass('disabled')) {
                        self.wrapper.addClass('disabled');
                    }
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                    if (!state.hasClass('dews-state-disabled')) {
                        state.addClass('dews-state-disabled');
                    }
                }
            }

            enable.call(self, value);
        };
    })(kendo.ui.DropDownList.fn.enable);

    kendo.ui.DropDownList.fn.setDataSource = (function (data) {
        return function (dataSource) {
            var that = this;
            var parent;
            that.options.dataSource = dataSource;
            that._dataSource();
            if (that.listView.bound()) {
                that._initialIndex = null;
                that.listView._current = null;
            }
            that.listView.setDataSource(that.dataSource);
            if (that.options.autoBind) {
                that.dataSource.fetch().done(function () {
                    that.select(0);
                });
            }
            parent = that._parentWidget();
            if (parent) {
                that._cascadeSelect(parent);
            }
        };
    })(kendo.ui.DropDownList.fn.setDataSource);

    kendo.ui.DropDownList.fn.readonly = (function (readonly) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return !self.element.prop('readonly');
            } else {
                state = self.wrapper.find('.k-dropdown-wrap');

                if (!value) {
                    if (self.wrapper.hasClass('readonly')) {
                        self.wrapper.removeClass('readonly');
                    }
                    if (self.element.hasClass('readonly')) {
                        self.element.removeClass('readonly');
                    }
                    if (state.hasClass('dews-state-readonly')) {
                        state.removeClass('dews-state-readonly');
                    }
                } else {
                    if (!self.wrapper.hasClass('readonly')) {
                        self.wrapper.addClass('readonly');
                    }
                    if (!self.element.hasClass('readonly')) {
                        self.element.addClass('readonly');
                    }
                    if (!state.hasClass('dews-state-readonly')) {
                        state.addClass('dews-state-readonly');
                    }
                }
            }

            readonly.call(self, value);
        };
    })(kendo.ui.DropDownList.fn.readonly);

    kendo.ui.DropDownList.fn.on = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus'|| arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    };

    kendo.ui.DropDownList.fn.off = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus'|| arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    };

    kendo.ui.DropDownList.fn.validate = function () {
        var self = this;
        return !!self.value();
    };

    kendo.ui.DropDownList.fn.bindFromPanel = function(data) {
        var self = this, $element = self.element;
        var valueColumn, textColumn, value;

        if (data) {

            valueColumn = $element.data('dews-bind-value') || $element.data('dews-value-field') || $element.attr('id');
            textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

            if (valueColumn && data.hasOwnProperty(valueColumn)) {
                value = {};

                self.value(data[valueColumn]);

                if (textColumn && data.hasOwnProperty(textColumn)) {
                    self.text(data[textColumn]);
                }
            }
        }
    };

    kendo.ui.DropDownList.fn.serializeForPanel = function () {
        var self = this, $element = self.element;
        var valueColumn, textColumn;
        var data;

        valueColumn = $element.data('dews-bind-value') || $element.data('dews-value-field') || $element.attr('id');
        textColumn = $element.data('dews-bind-text') || $element.data('dews-text-field');

        if (valueColumn) {
            data = {};
            data[valueColumn] = self.value();

            if (textColumn) {
                data[textColumn] = self.text();
            }
        }

        return data;
    };

    kendo.ui.DropDownList.fn.applyPanelFocus = function () {
        var self = this, $element = self.element;
        var $wrapper = $element.parent('.dews-dropdownlist-wrapper');

        $wrapper.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    kendo.ui.DropDownList.fn.canFocusable = function () {
        var self = this, $element = self.element;
        return !$element.hasClass('readonly') && $element.is(':enabled') && $element.closest('.k-dropdown').is(':visible');
    };

    /**
     * 드롭다운 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    kendo.ui.DropDownList.fn._getPrintData = function () {
        var self = this,
            $el = $(self.element),
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    };

    dews.ui.addControlInitializer('dropdownlist', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.dropdownlist($("select.dews-ui-dropdownlist", $container));
    });
})(jQuery, window.dews || {}, window.kendo);



(function ($, dews, kendo) {
    var editorDefaultOption = {
        tools: [
            {
                name: "fontName",
                items: [
                    { text: "맑은고딕", value: "'Malgun Gothic'" },
                    { text: "돋움", value: "Dotum" },
                    { text: "돋움체", value: "DotumChe" },
                    { text: "굴림", value: "Gulim" },
                    { text: "굴림체", value: "GulimChe" },
                    { text: "바탕", value: "Batang" },
                    { text: "바탕체", value: "BatangChe" },
                    { text: "궁서", value: "Gungsuh" },
                    { text: "Arial", value: "Arial" },
                    { text: "Courier New", value: "'Courier New'" },
                    { text: "Verdana", value: "Verdana" },
                    { text: "Tahoma", value: "Tahoma" }
                ]
            },
            {
                name: "fontSize",
                items: [
                    { text: "8pt", value: "8pt" },
                    { text: "9pt", value: "9pt" },
                    { text: "10pt", value: "10pt" },
                    { text: "12pt", value: "12pt" },
                    { text: "14pt", value: "14pt" },
                    { text: "18pt", value: "18pt" },
                    { text: "24pt", value: "24pt" },
                    { text: "36pt", value: "36pt" }
                ]
            },
            "foreColor",
            "backColor",
            "bold",
            "italic",
            "underline",
            "strikethrough",
            "justifyLeft",
            "justifyCenter",
            "justifyRight",
            "justifyFull",
            "indent",
            "outdent"
        ],
        messages: {
            bold: "굵게",
            italic: "기울임",
            underline: "밑줄",
            strikethrough: "취소선",
            superscript: "Superscript",
            subscript: "Subscript",
            justifyCenter: "가운데 맞춤",
            justifyLeft: "왼쪽 맞춤",
            justifyRight: "오른쪽 맞춤",
            justifyFull: "양쪽 맞춤",
            insertUnorderedList: "글머리 기호",
            insertOrderedList: "번호 매기기",
            indent: "들여쓰기",
            outdent: "내어쓰기",
            createLink: "하이퍼링크 추가",
            unlink: "하이퍼링크 제거",
            insertImage: "이미지 추가",
            insertFile: "파일 추가",
            insertHtml: "HTML 추가",
            fontName: "글꼴",
            fontNameInherit: "글꼴",
            fontSize: "크기",
            fontSizeInherit: "크기",
            formatBlock: "포맷",
            formatting: "포맷",
            style: "스타일",
            viewHtml: "HTML 보기",
            emptyFolder: "빈 폴더",
            uploadFile: "업로드",
            orderBy: "Arrange by:",
            orderBySize: "사이즈",
            orderByName: "이름",
            invalidFileType: "The selected file \"{0}\" is not valid. Supported file types are {1}.",
            deleteFile: "Are you sure you want to delete \"{0}\"?",
            overwriteFile: "A file with name \"{0}\" already exists in the current directory. Do you want to overwrite it?",
            directoryNotFound: "A directory with this name was not found.",
            imageWebAddress: "Web address",
            imageAltText: "Alternate text",
            fileWebAddress: "Web address",
            fileTitle: "Title",
            linkWebAddress: "Web address",
            linkText: "Text",
            linkToolTip: "ToolTip",
            linkOpenInNewWindow: "Open link in new window",
            dialogInsert: "Insert",
            dialogUpdate: "Update",
            dialogButtonSeparator: "or",
            dialogCancel: "Cancel",
            createTable: "테이블 생성",
            addColumnLeft: "왼쪽에 열 추가",
            addColumnRight: "오른쪽에 열 추가",
            addRowAbove: "위쪽에 행 추가",
            addRowBelow: "아래쪽에 행 추가",
            deleteRow: "행 삭제",
            deleteColumn: "열 삭제"
        },
        stylesheets: [
        ]
    },
        defaultTools = kendo.ui.Editor.defaultTools;

    function getOptions($el, codeOptions) {
        var inlineOptions;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};

        return $.extend(true, {}, editorDefaultOption, inlineOptions, codeOptions);
    }

    function getInlineOptions($el) {
        var options = {},
            inlineStylesheets,
            stylesheets = [],
            styleUrl;

        if ($el.data('dews-stylesheets')) {
            inlineStylesheets = $el.data('dews-stylesheets');
            stylesheets = inlineStylesheets.split(',');

            if (stylesheets.length > 0) {
                for (var i = 0; i < stylesheets.length; i++) {
                    if (stylesheets[i]) {
                        styleUrl = dews.url.getAbsoluteUrl($.trim(stylesheets[i]));

                        if (!options.hasOwnProperty('stylesheets')) {
                            options.stylesheets = [];
                        }

                        options.stylesheets.push(styleUrl);
                    }
                }
            }
        }

        return options;
    }

    if (defaultTools) {
        defaultTools.insertLineBreak.options.shift = false;
        defaultTools.insertParagraph.options.shift = true;
    }

    $.extend(true, dews, {
        ui: {
            editor: function (selector, options) {
                var $el,
                    editor;

                options = $.extend({}, editorDefaultOption, options);

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            ctrl,
                            opt;

                        ctrl = $this.data("dews-control");

                        if (!ctrl) {
                            opt = getOptions($this, options);

                            if (!$this.hasClass("dews-ui-editor")) {
                                $this.addClass("dews-ui-editor");
                            }

                            $this.addClass("dews-control-activate");

                            $this.css({ height: $this.height() + 'px' });
                            $this.kendoEditor(opt);

                            ctrl = $this.data('kendoEditor');

                            var watchContentFrame = function () {
                                $('iframe', ctrl.wrapper).off('load').on('load', function () {
                                    if (!$(this.contentDocument.body).attr('contenteditable')) {
                                        ctrl.refresh();
                                    }
                                });
                            }

                            watchContentFrame();
                            setInterval(function () {
                                watchContentFrame();
                            }, 1000);

                            if (!$this.closest(".k-editor").hasClass("dews-editor-wrapper")) {
                                $this.closest(".k-editor").addClass("dews-editor-wrapper");
                            }

                            // 글꼴 드롭다운 너비조정
                            $(".k-fontName", $this.closest(".k-editor")).parents("span.k-dropdown, span.k-combobox").width(120);
                            // 사이즈 드롭 너비조정
                            $(".k-fontSize", $this.closest(".k-editor")).parents("span.k-dropdown, span.k-combobox").width(90);

                            $(window).trigger("resize");

                            $this.data('dews-control', ctrl);
                        }

                        editor = ctrl;
                    });
                }

                return editor;
            }
        }
    });

    dews.ui.addControlInitializer('editor', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.editor($("textarea.dews-ui-editor", $container));
    });
})(jQuery, window.dews || {}, window.kendo);


/**
 * 파일 컴포넌트
 */
(function ($, dews) {

    /**
     * @typedef {Object} FileData 업로드된 파일 정보
     * @property {boolean} [isNew = true] 임시 업로드 파일 여부
     * @property {string} fileKey 파일의 유니크 키
     * @property {string} [filename] 파일명
     * @property {string} [extension] 확장자
     * @property {number} [size] 파일 크기
     */

    /**
     * @typedef {Object} UploadOptions 업로드 설정
     * @property {boolean} use 업로드 기능의 사용 여부
     * @property {string} url 업로드 API URL
     */

    /**
     * @typedef {Object} DownloadOptions 다운로드 설정
     * @property {boolean} use 다운로드 기능의 사용 여부
     * @property {string} url 다운로드 API URL
     * @property {string} tempUrl 임시파일 다운로드 API URL
     * @property {string} param 다운로드에서 파일 키의 파라미터 명
     */

    /**
     * @typedef {Object} TokenOptions 임시 인증토큰 설정
     * @property {boolean} use 임시 인증토큰 사용 여부
     * @property {string} url 임시 인증토큰 발급 API URL
     * @property {string} param 다운로드 시 인증토큰을 전달할 파라미터 명
     */

    /**
     * @typedef {Object} BindingOptions 바인딩 설정
     * @property {string} fileKey 파일키
     * @property {string} filename 파일명
     * @property {string} extension 확장자
     * @property {number} size 파일사이즈
     * @property {boolean} [isNew] 신규로 등록된 임시파일 여부
     */

    /**
     * @typedef {Object} FileOptions 파일 컴포넌트 옵션
     * @property {UploadOptions} [upload] 업로드 설정
     * @property {DownloadOptions} [download] 다운로드 설정
     * @property {TokenOptions} [token] 임시 인증토큰 설정
     * @property {FileData} [file] 업로드된 파일 정보
     * @property {BindingOptions} [binding] 바인딩 정보
     * @property {[string]} [filters] 확장자 기반의 파일 필터
     * @property {boolean} [readonly = false] 읽기 전용 여부
     * @property {boolean} [disabled = false] 비활성화 여부
     * @property {boolean} [required = false] 필수 입력 여부
     */

    /**
     * 기본 옵션
     * @type {FileOptions}
     */
    var defaultOptions = {
        upload: {
            use: true,
            url: '/upload/file'
        },
        download: {
            use: true,
            url: '/download/file',
            tempUrl: '/download/tempfile',
            param: 'key'
        },
        token: {
            use: true,
            url: '/auth/temporary/token',
            param: 'token'
        },
        readonly: false,
        disabled: false,
        required: false
    };

    /**
     * DOM 요소에 설정된 파일 컴포넌트 옵션을 수집하여 가져옵니다.
     * @param {Element} el 옵션이 포함된 DOM 요소
     * @returns {FileOptions}
     */
    function getInlineOptions(el) {
        var $el = $(el);

        /**
         * @type {FileOptions}
         */
        var options = {};

        // 업로드 기능 사용 여부
        if ($.type($el.data('dews-upload-use')) === 'boolean') {
            options.upload = options.upload || {};
            options.upload.use = $el.data('dews-upload-use');
        }

        // 업로드 API URL
        var uploadUrl = $el.data('dews-upload-url');
        if ($.trim(uploadUrl)) {
            options.upload = options.upload || {};
            options.upload.url = uploadUrl;
        }

        // 다운로드 기능 사용 여부
        if ($.type($el.data('dews-download-use')) === 'boolean') {
            options.download = options.download || {};
            options.download.use = $el.data('dews-download-use');
        }

        // 다운로드 API URL
        var downloadUrl = $el.data('dews-download-url');
        if ($.trim(downloadUrl)) {
            options.download = options.download || {};
            options.download.url = downloadUrl;
        }

        // 임시파일 다운로드 API URL
        var downloadTempUrl = $el.data('dews-download-temp-url');
        if ($.trim(downloadTempUrl)) {
            options.download = options.download || {};
            options.download.tempUrl = downloadTempUrl;
        }

        // 다운로드 API URL 에 파일 키를 전달할 파라미터 이름
        var downloadParam = $el.data('dews-download-param');
        if ($.trim(downloadParam)) {
            options.download = options.download || {};
            options.download.param = downloadParam;
        }

        // 토큰 사용 여부
        if ($.type($el.data('dews-token-use')) === 'boolean') {
            options.token = options.token || {};
            options.token.use = $el.data('dews-token-use');
        }

        // 임시 토큰 발급 API URL
        var tokenUrl = $el.data('dews-token-url');
        if ($.trim(tokenUrl)) {
            options.token = options.token || {};
            options.token.url = $.trim(tokenUrl);
        }

        // 토큰을 전달하는 파라미터 이름
        var tokenParam = $el.data('dews-token-param');
        if ($.trim(tokenParam)) {
            options.token = options.token || {};
            options.token.param = tokenParam;
        }

        // 확장자 기반의 파일 필터
        var strFilters = $el.data('dews-filters');
        if ($.trim(strFilters)) {
            options.filters = $.map(strFilters.split(','), function (item) {
                return $.trim(item);
            });
        }

        // 첨부파일 정보
        if ($el.data('dews-file-key') || $el.data('dews-filename') ||
            $el.data('dews-extension') || $el.data('dews-size')) {
            options.file = {isNew: false};
            if ($el.data('dews-file-key')) {
                options.file.fileKey = $el.data('dews-file-key');
            }
            if ($el.data('dews-filename')) {
                options.file.filename = $el.data('dews-filename');
            }
            if ($el.data('dews-extension')) {
                options.file.extension = $el.data('dews-extension');
            }
            if ($el.data('dews-size')) {
                options.file.size = parseInt($el.data('dews-size'), 10);
            }
        }

        // 읽기 전용
        if ($el.prop('readonly') || $el.hasClass('readonly')) {
            options.readonly = true;
        }

        // 비활성화
        if ($el.prop('disabled') || $el.hasClass('disabled')) {
            options.disabled = true;
        }

        // 필수입력
        if ($el.hasClass('required')) {
            options.required = true;
        }

        // 바인딩 정보
        if ($el.data('dews-bind-file-key') || $el.data('dews-bind-filename') || $el.data('dews-bind-extension') ||
            $el.data('dews-bind-size') || $el.data('dews-bind-is-new')) {
            options.binding = options.binding || {};
            var bindFileKey = $el.data('dews-bind-file-key');
            if ($.trim(bindFileKey)) {
                options.binding.fileKey = $.trim(bindFileKey);
            }
            var bindFilename = $el.data('dews-bind-filename');
            if ($.trim(bindFilename)) {
                options.binding.filename = $.trim(bindFilename);
            }
            var bindExtension = $el.data('dews-bind-extension');
            if ($.trim(bindExtension)) {
                options.binding.extension = $.trim(bindExtension);
            }
            var bindSize = $el.data('dews-bind-size');
            if ($.trim(bindSize)) {
                options.binding.size = $.trim(bindSize);
            }
            var bindIsNew = $el.data('dews-bind-is-new');
            if ($.trim(bindIsNew)) {
                options.binding.isNew = $.trim(bindIsNew);
            }
        }

        return options;
    }

    /**
     * 파일 컴포넌트의 UI를 초기화합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function initialize(file) {
        /** 컨테이너를 생성합니다. */
        var createContainer = function () {
            var $wrapper = $('<div class="dews-file-wrapper"><div class="dews-file-wrap"></div></div>');

            file.$element.wrap($wrapper);
            file._$wrapper = file.$element.parents('.dews-file-wrapper');
            file._$fileBox = file._$wrapper.find('> .dews-file-wrap');

            updateUploadable(file, file._options.upload.use);
            updateDownloadable(file, file._options.download.use);
            updateFileExists(file, !!file._options.file);
        };
        /** 파일명 영역을 생성합니다. */
        var createFileText = function () {
            var $text = $('<input type="text" class="dews-file-text" readonly>');
            file.$text = $text;
            file.$element.after($text);

            file.$text.on('focus', function () {
                setFocus(file);
            }).on('blur', function () {
                removeFocus(file);
            }).on('keydown', function (e) {
                if (file._usePanelFocus && (e.keyCode === 13 || e.keyCode === 9) &&
                    !file._$wrapper.hasClass('readonly') && !file._$wrapper.hasClass('disabled')) {
                    // 패널 내에서의 포커스 처리
                    e.preventDefault();
                    if (e.keyCode === 9 && e.shiftKey) {
                        triggerPreviousFocus(file);
                    } else {
                        if (!(e.shiftKey || e.ctrlKey || e.altKey)) {
                            triggerNextFocus(file);
                        }
                    }
                } else if (e.keyCode === 115) {
                    // F4 키 처리
                    e.preventDefault();
                    if (file._options.upload.use) {
                        file.$buttons.$upload.click();
                    }
                }
            });

            if (file._options.file) {
                setFileData(file, file._options.file);
            }
        };
        /** 버튼들을 생성합니다. */
        var createButtons = function () {
            var $buttonContainer = $('<div class="dews-file-button-box"></div>');
            file.$buttons = {
                $delete: $('<button type="button" class="dews-file-button icon-delete"></button>'),
                $upload: $('<button type="button" class="dews-file-button icon-upload"></button>'),
                $download: $('<button type="button" class="dews-file-button icon-download"></button>')
            };

            // 버튼을 추가
            $buttonContainer.append(file.$buttons.$delete);
            $buttonContainer.append(file.$buttons.$upload);
            $buttonContainer.append(file.$buttons.$download);

            file._$fileBox.append($buttonContainer);
        };
        /** 기본 이벤트를 바인딩 합니다. */
        var bindEvents = function () {
            /** 업로드 중 취소 이벤트를 발생시킴 */
            var triggerUploadCancel = function () {
                var $evt = new $.Event('_uploadCancel');
                file.$element.trigger($evt);
            };

            /** 설정된 파일을 삭제하는 이벤트를 발생시킴 */
            var triggerDelete = function () {
                var $evt = new $.Event('_fileDelete');
                file.$element.trigger($evt);
            };

            // 업로드 대상 파일의 선택이 완료되었을 경우
            file.$element.on('change', function (e) {
                if (file._options.upload.use && e.target.files.length) { // 업로드 기능을 사용할 경우만 동작해야 함
                    var blob = e.target.files[0];

                    file.$text.val(e.target.files[0].name);
                    updateUploading(file, true);
                    file.uploading = true; // 파일이 업로드 중 임을 설정

                    // 파일 업로드 시작
                    startUploading(file, blob); // 파일 컴포넌트 업로드 시작
                }
            });

            // 드래그 파일 요소 지정
            file.$text.on('dragover', function (e) {
                e.preventDefault();
            });

            // 업로드 파일 드랍하였을 경우
            file.$text.on('drop', function (e) {
                e.preventDefault();
                var data = e.originalEvent.dataTransfer.files,
                    filters = file._options.filters,
                    blob;
                if (file._options.upload.use && data.length && !file._$wrapper.hasClass('readonly') && !file._$wrapper.hasClass('disabled')) {
                    if (data.length > 1) {
                        return; //파일 두개 이상일 경우 설정
                    }
                    if (filters) {
                        for (var i = 0; i < filters.length; i++) {
                            if (compareExtension(data, filters[i]) || filters[i] === getExtension(data[0].name)) {
                                blob = data[0];
                            }
                        }
                    } else {
                        blob = data[0];
                    }
                } else {
                    return; //업로드 제한 될 경우 설정
                }

                if (blob) {
                    file.$text.val(blob.name);
                } else {
                    return;
                }

                updateUploading(file, true);
                file.uploading = true; // 파일이 업로드 중 임을 설정

                startUploading(file, blob); // 파일 컴포넌트 업로드 시작
            });

            // 파일명을 출력하는 텍스트박스를 더블클릭 한 경우
            file.$text.on('dblclick', function (e) {
                e.preventDefault();
                if (file._options.upload.use && !file._$wrapper.hasClass('readonly') && !file._$wrapper.hasClass('disabled')) {
                    file.$element.click(); // 파일 선택 다이얼로그를 출력
                }
            });

            // 업로드 버튼을 클릭하였을 경우
            file.$buttons.$upload.on('click', function (e) {
                e.preventDefault();
                if (file._options.upload.use) {
                    file.$element.click(); // 파일 선택 다이얼로그를 출력
                }
            });

            // 삭제 버튼을 클릭하였을 경우
            file.$buttons.$delete.on('click', function (e) {
                e.preventDefault();
                if (file.uploading) {
                    triggerUploadCancel(); // 진행중인 파일의 업로드를 중단하는 아벤트 발생
                } else {
                    triggerDelete(); // 설정된 파일을 삭제하는 이벤트 발생
                    updateFileExists(file, false);
                }
            });

            // 다운로드 버튼을 클릭하였을 경우
            file.$buttons.$download.on('click', function (e) {
                e.preventDefault();

                if (file._options.download.use && $.isPlainObject(file._options.file) && file._options.file.fileKey) {
                    downloadFile(file);
                }
            });

            // 컴포넌트의 레이아웃이 변경되었을 경우
            file._$wrapper.on('_layoutChange', function (e) {
                e.preventDefault();
                var type = e.changeType;
                // 파일명 출력 텍스트박스의 너비를 재설정한다.
                var buttonAreaSize = file._$wrapper.find('.dews-file-button-box').outerWidth(true);
                var containerSize = file._$wrapper.innerWidth();

                file.$text.outerWidth(containerSize - buttonAreaSize);

            });

            // 컴포넌트에 등록된 파일을 삭제
            file._$wrapper.on('_fileDelete', function (e) {
                e.preventDefault();

                deleteFile(file);
            });

            file._$wrapper.on('mouseenter', function (e) {
                triggerLayoutChange(file, 'filename');
                // 툴팁 적용
                if (file.uploading) {
                    showProgressTooltip(file);
                } else if (file._options.file) {
                    showFileInfoTooltip(file);
                }
                var $text = $('<p class="placeholder">' + dews.localize.get('여기에 드래그 하세요.', 'dews_여기에 드래그 하세요.') + '</p>');
                if (file._options.upload.use && !file.$text.val() && !file._$wrapper.hasClass('readonly') && !file._$wrapper.hasClass('disabled')) {
                    file.$text.after($text);
                }
            }).on('mouseleave', function (e) {
                triggerLayoutChange(file, 'filename');
                hideTooltip(file);
                if (file._$fileBox.find('.placeholder')) {
                    file._$fileBox.find('.placeholder').remove();
                }
            });
        };

        if (!file.initialized) {
            // 컨테이너를 생성합니다.
            createContainer();
            // 파일명 영역을 생성합니다.
            createFileText();
            // 버튼들을 생성합니다.
            createButtons();
            // 파일 확장자 필더를 설정합니다.
            attachExtensionFilters(file);
            // 기본 이벤트를 바인딩합니다.
            bindEvents();

            // 필수 입력 처리
            file._options.required && setRequired(file);
            // 읽기전용 처리
            file._options.readonly && setReadonly(file);
            // 비활성화 처리
            file._options.disabled && setDisable(file);

            file.initialized = true;
        }
    }


    /**
     * 파일 컴포넌트의 UI를 종료합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function terminate(file) {
        /** 이벤트를 제거합니다. */
        var unbindEvents = function () {

        };
        /** 파일 확장자 필터를 제거합니다. */
        var detachFileExtensionFilter = function () {

        };
        /** 버튼을 제거합니다. */
        var removeButtons = function () {

        };
        /** 파일명 영역을 제거합니다. */
        var createFileText = function () {

        };
        /** 컨테이너를 제거합니다. */
        var removeContainer = function () {

        };

        if (file.initialized) {
            unbindEvents();
            detachFileExtensionFilter();
            removeButtons();
            createFileText();
            removeContainer();
            file.initialized = false;
        }
    }

    /**
     * 파일타입에서 타입 비교
     * @param {Filelist} dragfile 업로드 파일
     * @param {Array} filter 필터 옵션의 제한 된 확장자
     * @returns {boolean} 타입 비교 여부
     */
    function compareExtension(dragfile, filter) {
        var typeParam = typeof filter === "string" ? filter.replace(/\s/g, "") : "image/*",
            file, regex;

        typeParam = typeParam
            .replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g, "\\$&")
            .replace(/,/g, "|")
            .replace(/\/\*/g, "/.*");

        if (dragfile) {
            regex = new RegExp(".?(" + typeParam + ")$", "i");
            file = dragfile[0];

            if (!file.type.match(regex)) {
                return false;
            }
        }
        return true;
    }

    /**
     * 파일명에서 확장자명 추출
     * @param {string} filename 파일명
     * @returns {string} 확장자명
     */
    function getExtension(filename) {
        var fileLen = filename.length;
        var lastDot = filename.lastIndexOf('.');
        var fileExt = filename.substring(lastDot, fileLen).toLowerCase();
        return fileExt;
    }

    /**
     * 파일 확장자 필터를 설정합니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     */
    function attachExtensionFilters(file) {
        var filter = '';
        if ($.isArray(file._options.filters) && file._options.filters.length > 0) {
            filter = file._options.filters.join(',');
        }
        if (filter) {
            file.$element.attr('accept', filter);
        }
    }

    /**
     * 파일 확장자 필터를 비웁니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     */
    function clearExtensionFilters(file) {
        file.$element.removeAttr('accept');
    }

    /**
     * 파일 컴포넌트의 업로드 가능 여부 UI 처리를 수행합니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     * @param {boolean} use 업로드 가능 여부
     */
    function updateUploadable(file, use) {
        var $wrapper = file._$wrapper;
        var className = 'uploadable';

        if (use) {
            if (!$wrapper.hasClass(className)) {
                $wrapper.addClass(className);
            }
        } else {
            $wrapper.removeClass(className);
        }
        triggerLayoutChange(file, 'filename');
    }

    /**
     * 파일 컴포넌트의 다운로드 가능 여부 UI 처리를 수행합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {boolean} use 다운로드 사용 여부
     */
    function updateDownloadable(file, use) {
        var $wrapper = file._$wrapper;
        var className = 'downloadable';

        if (use) {
            if (!$wrapper.hasClass(className)) {
                $wrapper.addClass(className);
            }
        } else {
            $wrapper.removeClass(className);
        }
        triggerLayoutChange(file, 'filename');
    }

    /**
     * 파일 컴포넌트의 선택 파일이 존재하는 경우에 대한 UI 처리를 수행합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {boolean} exists 파일 존재 여부
     */
    function updateFileExists(file, exists) {
        var $wrapper = file._$wrapper;
        var className = 'exists';

        if (exists) {
            if (!$wrapper.hasClass(className)) {
                $wrapper.addClass(className);
            }
        } else {
            $wrapper.removeClass(className);
        }
        triggerLayoutChange(file, 'filename');
    }

    /**
     * 파일 컴포넌트의 업로드가 진행 중인지 여부에 대한 UI 처리를 수행합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {boolean} uploading 업로드 진행중인지 여부
     */
    function updateUploading(file, uploading) {
        var $wrapper = file._$wrapper;
        var className = 'uploading';

        if (uploading) {
            if (!$wrapper.hasClass(className)) {
                $wrapper.addClass(className);
            }
        } else {
            $wrapper.removeClass(className);
        }
        triggerLayoutChange(file, 'filename');
    }

    /**
     * 파일 컴포넌트의 업로드를 시작합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {Blob} blob 첨부파일
     */
    function startUploading(file, blob) {
        // 파일 업로드 시작
        uploadFile(blob, file)
            .done(function (fileData) {
                updateUploading(file, false);
                updateFileExists(file, true);
                file._options.file = fileData;

                setFileData(file, fileData);
            })
            .fail(function (type) {
                // 업로드 실패
                updateUploading(file, false);
                switch (type) {
                    case 'cancel':
                        setFileData(file, file._options.file);
                        updateFileExists(file, false);
                        break;
                    case 'error':
                        updateError(file, true);
                        break;
                }
            })
            .always(function () {
                updateUploading(file, false);
                file.$element.val('');
                file.uploading = false; // 업로드 중이 아님을 설정
            });
    }

    /**
     * 파일 컴포넌트의 에러 상태에 대한 UI 처리를 수행합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {boolean} error 에러 발생 여부
     */
    function updateError(file, error) {
        var $wrapper = file._$wrapper;
        var className = 'error';

        if (error) {
            if (!$wrapper.hasClass(className)) {
                $wrapper.addClass(className);
            }
        } else {
            $wrapper.removeClass(className);
        }
        triggerLayoutChange(file, 'filename');
    }

    /**
     * 파일 정보를 설정합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {FileData} data 설정할 파일 데이터
     * @param {boolean} [ev = true] 이벤트 발생 여부
     */
    function setFileData(file, data, ev) {
        ev = ($.type(ev) === 'undefined') ? true : ev;
        file.$text.val((data && data.filename) ? data.filename : '');

        if ($.isPlainObject(data) && data.filename && ev) {
            triggerFileChange(file, data);
        }
    }

    /**
     * 설정된 파일 정보를 삭제합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {boolean} [ev = true] 이벤트 발생 여부
     */
    function deleteFile(file, ev) {
        ev = ($.type(ev) === 'undefined') ? true : ev;
        file._options.file = undefined;
        file.$text.val('');
        hideTooltip(file);

        if (ev) {
            triggerFileChange(file);
        }
    }

    /**
     * 파일 컴포넌트에 포커스 UI 처리를 설정합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function setFocus(file) {
        var $wrapper = file._$wrapper;
        if (!$wrapper.hasClass('focused')) {
            $wrapper.addClass('focused');
            setFocusUserGuidItem(file);
        }
    }

    /**
     * 파일 컴포넌트에 포커스가 진입하면 사용자 가이드의 매핑 항목을 표시할 수 있도록 처리합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function setFocusUserGuidItem(file) {
        file.$text.on('focus', function () {
            var page = dews.ui.page;
            if (page && page.hasUserGuide) {
                if ($.isFunction(page.focusGuideItem) && file.$element.attr('id')) {
                    page.focusGuideItem('#' + file.$element.attr('id'));
                }
            }
        });
    }

    /**
     * 파일 컴포넌트의 포커스 UI 처리를 제거합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function removeFocus(file) {
        var $wrapper = file._$wrapper;
        $wrapper.removeClass('focused');
    }

    /**
     * 파일 정보 툴팁을 표시합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function showFileInfoTooltip(file) {
        dews.ui.tooltip.show(file._$wrapper, {
            fadeOutTime: 0,
            text: file._options.file.filename +
            (file._options.file.size ? ' <small>(' + humanReadableFileSize(file._options.file.size) + ')</small>' : '')
        });
    }

    /**
     * 파일 업로드 진행사항 툴팁을 표시합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function showProgressTooltip(file) {
        // dews.ui.tooltip.show(file._$wrapper, {
        //     fadeOutTime: 0
        // });
        // 툴팁 텍스트 변경 시 위치 문제로 인해 업데이트가 될 때 마다 툴팁 출력으로 변경
    }

    /**
     * 파일 업로드 진행사항 툴팁을 갱신합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {number} uploaded 업로드된 용량
     * @param {number} total 전체 용량
     * @param {number} percent 진행률
     */
    function updateProgressTooltip(file, uploaded, total, percent) {
        dews.ui.tooltip.hide(file._$wrapper);
        dews.ui.tooltip.show(file._$wrapper, {
            fadeOutTime: 0,
            text: percent + '% <small>(' + humanReadableFileSize(uploaded) + '/' + humanReadableFileSize(total) + ')</small>'
        });
    }

    /**
     * 출력 중인 툴팁을 제거합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function hideTooltip(file) {
        dews.ui.tooltip.hide(file._$wrapper);
    }

    /**
     * 파일 컴포넌트를 읽기 전용으로 설정합니다.
     * @param file
     */
    function setReadonly(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;

        if (!$wrapper.hasClass('readonly')) {
            $wrapper.addClass('readonly');
        }
        if (!$element.prop('readonly')) {
            $element.prop('readonly', true);
        }
        updateUploadable(file, false);
        updateDownloadable(file, false);
    }

    /**
     * 파일 컴포넌트를 읽기 전용 상태에서 해제합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function removeReadonly(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;

        if ($wrapper.hasClass('readonly')) {
            $wrapper.removeClass('readonly');
        }
        if ($element.prop('readonly')) {
            $element.prop('readonly', false);
        }
        updateUploadable(file, file._options.upload.use);
        updateDownloadable(file, file._options.download.use);
    }

    /**
     * 파일 컴포넌트를 비활성화 상태로 설정합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     */
    function setDisable(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;
        var $text = file.$text;

        if (!$wrapper.hasClass('disabled')) {
            $wrapper.addClass('disabled');
        }
        if (!$element.prop('disabled')) {
            $element.prop('disabled', true);
        }
        if (!$text.prop('disabled')) {
            $text.prop('disabled', true);
        }
        updateUploadable(file, false);
        updateDownloadable(file, false);
    }

    /**
     * 파일 컴포넌트를 활성화 상태로 설정합니다.
     * @param file
     */
    function removeDisable(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;
        var $text = file.$text;

        if ($wrapper.hasClass('disabled')) {
            $wrapper.removeClass('disabled');
        }
        if ($element.prop('disabled')) {
            $element.prop('disabled', false);
        }
        if ($text.prop('disabled')) {
            $text.prop('disabled', false);
        }
        updateUploadable(file, file._options.upload.use);
        updateDownloadable(file, file._options.download.use);
    }

    /**
     * 파일 컴포넌트를 필수 입력 상태로 설정합니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     */
    function setRequired(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;

        if (!$wrapper.hasClass('required')) {
            $wrapper.addClass('required');
        }
        if (!$element.hasClass('required')) {
            $element.addClass('required');
        }
    }

    /**
     * 파일 컴포넌트를 필수 입력 상태에서 해제합니다.
     */
    function removeRequired(file) {
        var $wrapper = file._$wrapper;
        var $element = file.$element;

        if ($wrapper.hasClass('required')) {
            $wrapper.removeClass('required');
        }
        if ($element.hasClass('required')) {
            $element.removeClass('required');
        }
    }

    /**
     * 레이아웃 변경이 일어났다는 이벤트를 발생시킴
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {string} mode 변경된 레이아웃의 형식
     */
    function triggerLayoutChange(file, mode) {
        var $evt = new $.Event('_layoutChange');
        $evt.changeType = mode;
        file._$wrapper.trigger($evt);
    }

    /**
     * 파일이 변경되었다는 이벤트를 발생시킴
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @param {FileData} [data] 설정된 파일의 인스턴스
     */
    function triggerFileChange(file, data) {
        var $evt = new $.Event('_change');

        $evt.file = data;
        $evt.isDeleted = false;
        if ($.type(data) === 'undefined') {
            $evt.isDeleted = true;
        }
        file.$element.trigger($evt);
    }

    /**
     * 패널 내에서 다음 컴포넌트로 포커스를 이동시키는 이벤트를 발생시킵니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     */
    function triggerNextFocus(file) {
        var evt = new $.Event('nextFocus');
        evt.control = file;

        file.$element.trigger(evt);
    }

    /**
     * 패널 내에서 다음 컴포넌트로 포커스를 이동시키는 이벤트를 발생시킵니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스
     */
    function triggerPreviousFocus(file) {
        var evt = new $.Event('beforeFocus');
        evt.control = file;

        file.$element.trigger(evt);
    }

    /**
     * 서버로 파일을 업로드합니다.
     *
     * @param {Blob} blob 업로드 할 파일입니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스입니다.
     */
    function uploadFile(blob, file) {
        var $dfd = $.Deferred();
        var $wrapper = file._$wrapper;

        // 업로드 프로그래스 요소 생성
        var createProgress = function () {
            file._$wrapper.prepend('<span class="progress-bar" style="width: 0px;"></span>');
            file._$wrapper.addClass('uploading');
        };
        // 업로드 프로그래스 요소 제거
        var removeProgress = function () {
            file._$wrapper.find('.progress-bar').remove();
            file._$wrapper.removeClass('uploading');
        };
        // 업로드 프로그래스 값 변경
        var updateProgress = function (percent) {
            var $progress = file._$wrapper.find('.progress-bar');
            $progress.css('width', percent + '%');
        };

        // 업로드 진행률 변경에 대한 핸들러
        var progressHandler = function (e) {
            var percentCompleted = Math.round((e.loaded / e.total) * 100);
            console.log('## 첨부파일 업로드 ##', e.loaded, e.total, percentCompleted);
            updateProgress(percentCompleted);
            updateProgressTooltip(file, e.loaded, e.total, percentCompleted);
        };

        // 업로드 완료에 대한 핸들러
        var completeHandler = function (e) {
            /**
             * @type {FileData}
             */
            var fileData = {};
            removeProgress();
            clearCancelEvent();
            if (this.status === 200) {
                var data = JSON.parse(this.responseText);

                if (data.success === 'true') {
                    data = data.data;
                    fileData.fileKey = data.newFilename;
                    fileData.filename = data.originalFilename;
                    fileData.extension = data.originalExtension;
                    fileData.size = parseInt(data.fileSize, 10);
                    fileData.isNew = true;
                }
            }
            hideTooltip(file);
            $dfd.resolve(fileData);
        };
        // 업로드 중 에러에 대한 핸들러
        var errorHandler = function (e) {
            removeProgress();
            clearCancelEvent();
            $dfd.reject('error');
        };
        // 업로드 중 취소에 대한 핸들러
        var cancelHandler = function (e) {
            removeProgress();
            clearCancelEvent();
            $dfd.reject('cancel');
        };

        // 업로드 취소에 이벤트에 등록된 핸들러를 제거
        var clearCancelEvent = function () {
            $wrapper.off('_uploadCancel');
        };

        if (!blob) return;

        var token = (dews.ui.page) ? JSON.parse(dews.ui.page.token).access_token : '';

        var formData = new FormData();
        formData.append('file', blob);
        formData.append('isText', 'false');
        formData.append(file._options.token.param, token);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', file._options.upload.url, true);

        xhr.upload.addEventListener('progress', progressHandler);
        xhr.addEventListener('load', completeHandler);
        xhr.addEventListener('error', errorHandler);
        xhr.addEventListener('abort', cancelHandler);

        createProgress();

        $wrapper.on('_uploadCancel', function () {
            if (xhr && xhr.readyState === 1 && file.uploading) {
                xhr.abort();
                xhr = null;
            }
        });

        xhr.send(formData);

        return $dfd.promise();
    }

    /**
     * 서버에서 파일을 다운로드합니다.
     * @param {FileComponent} file 파일 컴포넌트 인스턴스입니다.
     */
    function downloadFile(file) {
        // 다운로드 프레임 확보
        var $frame = file._$wrapper.find('.download-frame');
        if ($frame.length === 0) {
            $frame = $('<iframe style="display: none; width: 0; height: 0;"></iframe>');
            file._$wrapper.append($frame);
        }

        // 첨부파일 다운로드
        /**
         * 첨부파일 다운로드를 시작합니다.
         * @param {string} [url] 다운로드 경로
         */
        var startDownload = function (url) {
            $frame.prop('src', url);
        }

        getDownloadUrl(file).then(startDownload);
    }

    /**
     * 첨부파일 다운로드를 위한 임시 인증 토큰을 획득합니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @returns {$.Deferred} Promise 객체
     */
    function getTemporaryToken(file) {
        var $dfd = $.Deferred();
        var token = '';

        if (file._options.token && file._options.token.use) {
            dews.api.get(file._options.token.url, {})
                .done(function (tokenData) {
                    token = tokenData;
                })
                .always(function () {
                    $dfd.resolve(token);
                });
        } else {
            $dfd.resolve(token);
        }

        return $dfd;
    }

    /**
     * 파일 컴포넌트에 설정된 파일의 다운로드가 가능한 URL을 가져옵니다.
     * @param {FileComponent} file 파일 컴포넌트의 인스턴스
     * @return {$.Deferred} Promise 객체
     */
    function getDownloadUrl(file) {
        var $dfd = $.Deferred();

        var makeUrl = function (token) {
            var url;

            if (file._options.file.isNew) {
                // 임시파일
                url = file._options.download.tempUrl
                    + '?' + file._options.download.param + '=' + encodeURIComponent(file._options.file.fileKey)
                    + '&filename=' + encodeURIComponent(file._options.file.filename);
                if (token) {
                    url += '&' + file._options.token.param + '=' + encodeURIComponent(token);
                }
            } else {
                // 기존파일
                url = file._options.download.url + '?' + file._options.download.param
                    + '=' + encodeURIComponent(file._options.file.fileKey);
                if (token) {
                    url += '&' + file._options.token.param + '=' + encodeURIComponent(token);
                }
            }

            return url;
        }

        if (file._options.file) {
            getTemporaryToken(file)
                .done(function (token) {
                    $dfd.resolve(makeUrl(token));
                });
        } else {
            $dfd.resolve('');
        }

        return $dfd;
    }

    /**
     * 파일 크기를 사용자가 인식할 수 있는 포맷으로 변경합니다.
     * @param {number} size 파일크기
     * @returns {string} 포맷이 적용된 파일 크기
     */
    function humanReadableFileSize(size) {
        var i = Math.floor(Math.log(size) / Math.log(1024));
        return (size / Math.pow(1024, i)).toFixed(2) * 1 + ' ' + ['B', 'kB', 'MB', 'GB', 'TB'][i];
    }

    /**
     * 단일 파일 컴포넌트의 생성자입니다.
     *
     * @class FileComponent
     * @classdesc 단일 파일 컴포넌트입니다.
     *
     * @property {FileOptions} options 컴포넌트 초기화 시에 설정된 옵션 정보 입니다.
     * @property {Element} element 컴포넌트 생성 대상 요소입니다.
     * @property {jQuery} $element 컴포넌트 생성 대상 요소의 jQuery 객체입니다.
     * @property {boolean|undefined} initialized 컴포넌트가 초기화 되어 있는 상태인지 여부입니다.
     * @property {{$upload: jQuery, $download: jQuery, $delete: jQuery}} $buttons 파일 컴포넌트 버튼
     * @property {jQuery} $text 파일명을 표시하는 요소의 jQuery 객체입니다.
     * @property {boolean} uploading 현재 업로드 중인지 여부를 가져옵니다.
     *
     * @property {FileOptions} _options 컴포넌트 내부에서 실제 사용되는 옵션입니다.
     * @property {jQuery} _$wrapper 컨테이너 요소의 jQuery 객체입니다.
     * @property {jQuery} _$fileBox 파일 컴포넌트의 박스 영역의 jQuery 객체입니다.
     * @property {boolean} _usePanelFocus 패널 내부에서의 포커스 처리를 수행하는지 여부입니다.
     *
     * @param {Element} el 변환 대상 요소
     * @param {FileOptions} [opt] 옵션
     */
    function FileComponent(el, opt) {
        var self = this;
        var options = $.extend(true, {}, defaultOptions, getInlineOptions(el), opt);

        self.element = el;
        self.$element = $(el);
        self._options = options; // 실제 사용되는 옵션
        self.options = options; // 초기화 시 할당된 옵션 정보

        initialize(self);
    }

    /**
     * 파일 컴포넌트에 파일 정보를 설정합니다.
     * @param {FileData} file
     */
    FileComponent.prototype.setFile = function (file) {
        var self = this;
        if (file && $.isPlainObject(file)) {
            self._options.file = $.extend(true, {}, {isNew: false}, file);
            updateFileExists(self, true);
            setFileData(self, self._options.file, false);
        }
    };

    /**
     * 파일 컴포넌트에 설정된 파일 정보를 삭제합니다.
     */
    FileComponent.prototype.deleteFile = function () {
        var self = this;
        deleteFile(self, false);
        updateFileExists(self, false);
    };

    /**
     * 파일 컴포넌트에 설정된 파일 정보를 가져옵니다.
     */
    FileComponent.prototype.getFile = function () {
        var self = this;
        return self._options.file;
    };
    /**
     * 파일 컴포넌트의 읽기전용 상태 설정 여부를 가져오거나 설정합니다.
     * @param {boolean|undefined} val 값이 있으면 읽기전용 상태를 설정합니다.
     * @returns {*} 파리미터가 없을 때는 설정된 읽기전용 여부를 가져옵니다.
     */
    FileComponent.prototype.readonly = function (val) {
        var self = this;
        if ($.type(val) === 'undefined') {
            return self.$element.prop('readonly');
        } else {
            val ? setReadonly(self) : removeReadonly(self);
        }
    };
    /**
     * 파일 컴포넌트의 읽기전용 상태 설정 여부를 가져오거나 설정합니다.
     * @param {boolean|undefined} val 값이 있으면 읽기전용 상태를 설정합니다.
     * @returns {*} 파리미터가 없을 때는 설정된 읽기전용 여부를 가져옵니다.
     */
    FileComponent.prototype.enable = function (val) {
        var self = this;
        if ($.type(val) === 'undefined') {
            return self.$element.prop('disabled');
        } else {
            !val ? setDisable(self) : removeDisable(self);
        }
    };

    /**
     * 파일 컴포넌트의 필수입력 상태 설정 여부를 가져오거나 설정합니다.
     * @param {boolean|undefined} val 값이 있으면 필수입력 상태를 설정합니다.
     * @returns {*|boolean} 파라미터가 없을 때는 설정된 필수입력 여부를 가져옵니다.
     */
    FileComponent.prototype.required = function (val) {
        var self = this;
        if ($.type(val) === 'undefined') {
            return self.$element.hasClass('required');
        } else {
            val ? setRequired(self) : removeRequired(self);
        }
    };

    /**
     * 이벤트 핸들러를 등록합니다.
     */
    FileComponent.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self.$element.on.apply(self.$element, arguments);
    };

    /**
     * 이벤트 핸들러를 제거합니다.
     */
    FileComponent.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self.$element.off.apply(arguments);
    };

    /**
     * 업로드 파일 선택 다이얼로그에 파일 필터를 추가합니다.
     * @param {...string} extensions 필터로 설정할 확장자 입니다.
     */
    FileComponent.prototype.addFileFilters = function (extensions) {
        var self = this;
        var newFilters = Array.prototype.slice.call(arguments);
        if (!$.isArray(self._options.filters)) {
            self._options.filters = [];
        }

        if (newFilters.length > 0) {
            self._options.filters = self._options.filters.concat(newFilters);

            attachExtensionFilters(self);
        }
    };

    /**
     * 업로드 파일 선택 다이얼로그의 파일 필터에서 지정한 항목들을 제거합니다.
     * @param {...string} extensions 필터에서 제거할 확장자 입니다.
     */
    FileComponent.prototype.removeFileFilters = function (extensions) {
        var self = this;

        if (!$.isArray(self._options.filters)) {
            self._options.filters = [];
        }

        var removes = Array.prototype.slice.call(arguments);
        self._options.filters = self._options.filters.filter(function (item) {
            return removes.indexOf(item) < 0;
        });

        attachExtensionFilters(self);
    };

    /**
     * 업로드 파일 선택 다이얼로그의 파일 필터를 초기화합니다.
     */
    FileComponent.prototype.clearFileFilters = function () {
        var self = this;
        self._options.filters = [];
        clearExtensionFilters(self);
    };

    /**
     * 설정된 파일 선택 다이얼로그의 파일 필터를 가져옵니다.
     * @returns {string[]} 파일 필더 배열 객체
     */
    FileComponent.prototype.getFileFilters = function () {
        var self = this;
        return (self._options.filters || []).splice();
    };

    /**
     * 파일 컴포넌트가 포커스를 받을 수 있는 지 여부를 판별합니다.
     */
    FileComponent.prototype.canFocusable = function () {
        var self = this;
        var $wrapper = self._$wrapper;

        return !$wrapper.hasClass('readonly') && !$wrapper.hasClass('disabled') && $wrapper.is(':visible');
    };

    FileComponent.prototype.applyPanelFocus = function () {
        var self = this;
        self._usePanelFocus = true;

        self.on('change', function (e) {
            if (!e.isDeleted) {
                triggerNextFocus(self);
            }
        });
    };

    /**
     * 파일 컴포넌트에 포커스를 설정합니다.
     */
    FileComponent.prototype.focus = function () {
        var self = this;
        self.$text.focus();
    };

    /**
     * 파일 컴포넌트의 필수입력에 대한 유효성을 검사합니다.
     * @returns {boolean} 유효성
     */
    FileComponent.prototype.validate = function () {
        var self = this;
        return !!self._options.file;
    };

    /**
     * 패널 컨테이너에서 전달된 JSON 데이터를 파일 컴포넌트에 바인딩합니다.
     * @param {{}} data 전달된 바인딩 대상 데이터
     */
    FileComponent.prototype.bindFromPanel = function (data) {
        var self = this;
        var convertData = function (source) {
            /** @type {FileData} */
            var converted;
            var fields, fileKey, filename, extension, size, isNew;

            if (self._options.binding) {
                converted = {};
                fields = self._options.binding;
                fileKey = fields.fileKey ? source[fields.fileKey] : undefined;
                filename = fields.filename ? source[fields.filename] : undefined;
                extension = fields.extension ? source[fields.extension] : undefined;
                size = fields.size ? source[fields.size] : undefined;
                isNew = fields.isNew ? [fields.isNew] : undefined;

                if (fileKey) {
                    converted.fileKey = fileKey;
                }
                if (filename) {
                    converted.filename = filename;
                }
                if ($.type(extension) === 'number') {
                    converted.size = size;
                } else if ($.type(extension) === 'string') {
                    converted.size = parseInt(size, 10);
                }
                if ($.type(isNew) === 'boolean') {
                    converted.isNew = isNew;
                } else if ($.type(isNew) === 'string') {
                    converted.isNew = (isNew === 'true');
                }
            }

            return converted;
        }

        if (data && $.isPlainObject(data)) {
            var bindData = convertData(data);
            self.setFile(bindData);
        }
    };

    /**
     * 패널 컴포넌트들에서 사용하기 위해서 컴포넌트의 데이터를 JSON 객체로 직렬화 합니다.
     * @returns {{}}
     */
    FileComponent.prototype.serializeForPanel = function () {
        var self = this;
        var data;
        /** @param {FileData} fileData */
        var convertData = function (fileData) {
            /** @type {BindingOptions} */
            var bindings = self._options.binding;
            var converted;

            if (bindings && $.isPlainObject(bindings)) {
                converted = {};

                bindings.fileKey && (converted[bindings.fileKey] = fileData.fileKey);
                bindings.filename && (converted[bindings.filename] = fileData.filename);
                bindings.extension && (converted[bindings.extension] = fileData.extension);
                bindings.size && (converted[bindings.size] = fileData.size);
                bindings.isNew && (converted[bindings.isNew] = fileData.isNew);
            }

            return converted;
        };

        if (self._options.file && $.isPlainObject(self._options.file)) {
            data = convertData(self._options.file);
        }

        return data;
    };

    /**
     * 파일 컴포넌트에 설정된 파일의 다운로드가 가능한 주소를 가져옵니다.
     * @return {$.Deferred}
     */
    FileComponent.prototype.getDownloadUrl = function () {
        var self = this;
        return getDownloadUrl(self);
    };

    /**
     * 파일 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    FileComponent.prototype._getPrintData = function () {
        return undefined;
    };

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 파일 컴포넌트로 생성하거나 이미 생성된 컴포넌트의 인스턴스를 가져옵니다.
             * @param selector {string|jQuery} 파일 컴포넌트로 생성할 대상을 찾을 셀렉터 문자열이거나 jQuery 객체입니다.
             * @param options {object} 파일 컴포넌트 옵션입니다.
             * @returns {FileComponent} 생성된 파일 컴포넌트의 인스턴스입니다.
             */
            file: function (selector, options) {
                var $el, obj;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var file,
                        element = this;

                    if ($(element).data('dews-control')) {
                        file = $(element).data('dews-control');
                    } else {
                        if (!$(element).hasClass('dews-ui-file')) {
                            $(element).addClass('dews-ui-file');
                        }
                        if (!$(element).hasClass('dews-form-control')) {
                            $(element).addClass('dews-form-control');
                        }

                        file = new FileComponent(element, options);
                        $(element).data("dews-control", file);

                        // setAdditionalAPI($(element), file);
                        // setUserGuideAPI($(element));
                    }

                    obj = file;
                });

                return obj;
            }
        }
    });

    dews.ui.addControlInitializer('file', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.file($("input[type=file].dews-ui-file", $container));
    });
})(jQuery, window.dews);


(function ($, dews, kendo) {
    // 기본 옵션
    var defaultOption = {};

    var FileButton = function (element, option) {
        var self = this,
            $element = $(element);

        self.$element = $element;
        self.options = option;

        self._initControl();

        return self;
    };

    FileButton.prototype._initControl = function () {
        var self = this;

        self._createContainer();

        self._createInput();

        self._bindEvent();
    };
    // 버튼을 감쌀 wrapper를 만듭니다.
    FileButton.prototype._createContainer = function () {
        var self = this,
            container;

        container = $('<sapn class="dews-filebutton-wrapper">');

        if (self.$element.hasClass('disabled')) {
            container.addClass('dews-state-disabled');
            self.$element.prop('disabled', 'disabled');
        }

        self.$element.wrap(container);
    };
    // input[type="file"]의 텍스트박스를 만듭니다.
    FileButton.prototype._createInput = function () {
        var self = this,
            input;

        input = $('<input type="file" class="dews-filebutton-input" style="display: none">');

        self.$element.closest('.dews-filebutton-wrapper').append(input);

        self.$input = input;
    };
    // fileButton 이벤트
    FileButton.prototype._bindEvent = function () {
        var self = this;

        self.$element.on('click', function (e) {
            if (!self.$element.hasClass('disabled')) {
                self.$input.click();
            }
            e.stopPropagation();
        });

        self.$input.on('change', function (e) {
            var event;

            if (e.target.files.length && e.target.files.length !== 0) {
                e.file = e.target.files;
                e.type = 'fileSelect';
            } else {
                return false;
            }

            event = new $.Event('fileSelect', e);

            self.$element.trigger(event);
        });
    };
    // fileButton에 이벤트를 등록합니다.
    FileButton.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'fileSelect') {
            Array.prototype.splice.call(arguments, 0, 1, 'change');
            self.$input.on.apply(self.$input, arguments);
        } else {
            self.$element.on.apply(self.$element, arguments);
        }
    };
    // fileButton에 이벤트를 해제합니다.
    FileButton.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'fileSelect') {
            Array.prototype.splice.call(arguments, 0, 1, 'change');
            self.$input.off.apply(self.$input, arguments);
        } else {
            self.$element.off.apply(self.$element, arguments);
        }
    };
    /**
     * 파일 버튼의 활성화 유무를 설정하거나 값을 가져옵니다.
     * @param value {boolean} 활성화 유무를 설정할 값
     */
    FileButton.prototype.enable = function (value) {
        var self = this;

        if ($.type(value) === 'undefined') {
            return !self.$element.hasClass('disabled');
        } else if ($.type(value) === 'boolean') {
            if (value) {
                self.$element.removeClass('disabled');
                self.$element.prop('disabled', '');
                self.$element.closest('.dews-filebutton-wrapper').removeClass('dews-state-wrapper');
            } else {
                self.$element.addClass('disabled');
                self.$element.prop('disabled', 'disabled');
                self.$element.closest('.dews-filebutton-wrapper').addClass('dews-state-wrapper');
            }
        }
    };

    $.extend(true, dews, {
        ui: {
            /**
             * fileButton 생성하거나 가져옵니다.
             * @param {string} selector 요소를 지정하는 셀렉터입니다.
             * @param {object} [options] 버튼 설정 값
             */
            filebutton: function (selector, options) {
                var $el,
                    filebutton;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        file,
                        opt;

                    file = $this.data('dews-control');

                    if (!file) {
                        opt = $.extend(true, {}, defaultOption, options);

                        if (!$this.hasClass('dews-control')) {
                            $this.addClass('dews-control');
                        }

                        if (!$this.hasClass('dews-ui-filebutton')) {
                            $this.addClass('dews-ui-filebutton');
                        }

                        if ($this.data('dews-localize-key')) {
                            $this.text(dews.localize.get($this.text(), $this.data('dews-localize-key'), $this.data('dews-localize-lang') || null));
                        }

                        file = new FileButton($this, opt);
                        $this.data('dews-control', file);

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }
                    }

                    filebutton = file;
                });

                return filebutton;
            }
        }
    });

    dews.ui.addControlInitializer('filebutton', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.filebutton($('button.dews-ui-filebutton', $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 그리드
 */
(function ($, dews) {
    var loadGridStyle;

    function getOptions(self, options) {
        var grid = self._grid, opt, defaultOptions = {
            "panel": {
                "visible": false
            },
            "checkBar": {
                "visible": true
            },
            "stateBar": {
                "visible": false
            },
            "header": {
                "minHeight": options.gridStyle.header.height
            },
            "footer": {
                "visible": false,
                "height": options.gridStyle.footer.height,
                "minHeight": options.gridStyle.footer.height
            },
            "indicator": {
                "visible": true,
                "headText": "No",
                "footText": " "
            },
            "edit": {
                "insertable": false,
                "appendable": false,
                "editable": false,
                "crossWhenExitLast": true,
                "showInvalidFormatMessage": false,
                "enterToTab": true,
                "checkDiff": true,
                "skipReadOnly": false
            },
            "display": {
                'fitStyle': 'fill',
                'showEmptyMessage': false,
                'emptyMessage': dews.localize.get('데이터가 없습니다.', 'dews_데이터가 없습니다.'),
                'rowHeight': options.gridStyle.body.height,
                'minHeight': options.gridStyle.body.height,
                'focusColor': options.gridStyle.selection.focusBorderColor,
                'focusBorderWidth': '2px',
                'innerFocusColor': options.gridStyle.selection.focusBorderColor,
                'showInnerFocus': true,
                'columnMovable': options.movable ? options.movable : false,
                'columnResizable': true,
                'editingMergedRow': false
            },
            "copy": {
                'singleMode': true
            },
            "paste": {
                'singleMode': true,
                'checkReadOnly': true
            },
            "select": {
                "style": "none"
            },
            "sorting": {
                "enabled": true,
                "keepFocusedRow": true
            },
            "fixed": {
                "colBarWidth": 1
            },
            "dataBounding": false,
            "rowDynamic": [],
            "autoBind": true,
            "depth": 1,
            "maxDepth": 1,
            "grouping": false,
            "groupCol": 1,
            "maxGroupCol": 1,
            "context": true,
            "editSkip": false,
            "copyMode": 'cell',
            "sortMode": 'explicit',
            "isVisible": true,
            "fillWidth": true,
            "images": [],
            "displayColumns": []
        };

        opt = $.extend(true, defaultOptions, options);
        // 숫자 출력 유무 설정
        if ($.type(opt.rowNo) !== 'undefined') {
            if ($.type(opt.rowNo) === 'object') {
                opt.indicator.visible = true;
                opt.indicator.headText = $.type(opt.rowNo.text) === 'undefined' ? opt.indicator.headText : opt.rowNo.text;
                opt.indicator.width = $.type(opt.rowNo.width) === 'undefined' ? 40 : opt.rowNo.width;
            } else if ($.type(opt.rowNo) === 'boolean') {
                opt.indicator.visible = opt.rowNo;
            }
        }
        // 선택 유무 설정
        if ($.type(opt.selectable) !== 'undefined') {
            if (opt.selectable) {
                opt.select.style = 'singleRow';
            }
        }
        // 정렬 유무 설정
        if ($.type(opt.sortable) !== 'undefined') {
            opt.sorting.enabled = opt.sortable;
        }
        // 수정 가능 유무 설정
        if ($.type(opt.editable) !== 'undefined') {
            opt.edit.editable = opt.editable;
        }
        // 체크 바 출력 유무 설정
        if ($.type(opt.checkable) !== 'undefined') {
            opt.checkBar.visible = opt.checkable;
        }
        // 상태 바 출력 유무 설정
        if ($.type(opt.stateColumn) === 'boolean') {
            opt.stateBar.visible = opt.stateColumn;
        }
        // 읽기전용 유무 설정
        if ($.type(opt.readOnly) !== 'undefined') {
            opt.edit.readOnly = opt.readOnly;
        }
        // 셀 스킵 기능 설정
        if ($.type(opt.editSkip) === 'boolean' && opt.editSkip) {
            opt.editSkip = true;
            opt.edit.skipReadOnly = true;
        }
        // 데이터가 없을 시 메시지 출력 설정
        if ($.type(opt.noData) !== 'undefined') {
            opt.display.showEmptyMessage = opt.noData;

            if (opt.display.showEmptyMessage && $.type(opt.noDataMessage) !== 'undefined') {
                opt.display.emptyMessage = opt.noDataMessage;
            }
        }
        // 복사 붙여넣기 시 행 복사, 셀 복사 설정
        if (opt.copyMode.toLowerCase() === 'row') {
            opt.copy.singleMode = false;
            opt.paste.singleMode = false;
        }
        // 그리드 너비 지정 관련 설정
        if (!opt.fillWidth) {
            opt.display.fitStyle = 'none';
        }
        // 그리드 resizable 옵션 설정
        if ($.type(opt.resizable) === 'boolean') {
            opt.display.columnResizable = opt.resizable;
        }

        //그리드 병합된 행 값 변경 시 행분리되지않도록 옵션 설정
        if ($.type(opt.editingMergedRow) !== 'undefined') {
            opt.display.editItemMerging = opt.editingMergedRow;
        }

        // 그리드 스타일 지정
        opt = setStyles(grid, opt);
        // 컬럼 커스터 마이징 설정
        opt = customizingColumn(opt.columns, opt, self);
        delete opt.fieldIndex;
        grid.setColumns(opt.columns);
        grid.setHeader({height: opt.maxDepth * opt.header.minHeight});
        grid.setFooter({minHeight: opt.footer.minHeight, height: opt.footer.height});
        if (opt.grouping) {
            opt.display.rowHeight = opt.display.minHeight * opt.maxGroupCol;
        }
        // 그리드 데이터소스 설정
        if (opt.dataSource && opt.dataSource.dataProvider) {
            opt.dataSource.dataProvider.setFields(opt.dataSource.options.field);
            grid.setDataProvider(opt.dataSource.dataProvider);
        }
        // 그리드 그룹지정
        if (opt.dataSource && opt.dataSource.options.group) {
            setGroup(grid, opt);
        }

        return opt;
    }

    // 그리드 그룹지정
    function setGroup(grid, opt) {
        var group = [],
            groupOption = {};
        for (var g = 0; g < opt.dataSource.options.group.length; g += 1) {
            group.push(opt.dataSource.options.group[g].field);
        }
        grid.groupBy(group);
        // 그리드 그룹 헤더 템플릿 사용시 설
        if ($.type(opt.groupHeaderTemplate) !== 'undefined') {
            var state = opt.groupHeaderTemplate,
                index = 0;
            for (g = 0; g < grid.getDisplayColumns().length; g += 1) {
                for (var r = 0; r < group.length; r += 1) {
                    if (group[r] === grid.getDisplayColumns()[g]) {
                        index = g;
                        break;
                    }
                }
            }
            if (/\${title}/.test(state)) {
                state = state.replace(/\${title}/gi, opt.columns[index].header.text);
            }
            if (/\${field}/.test(state)) {
                state = state.replace(/\${field}/gi, '${groupField}');
            }
            if (/\${value}/.test(state)) {
                state = state.replace(/\${value}/gi, '${groupValue}');
            }
            if (/\${count}/.test(state)) {
                state = state.replace(/\${count}/gi, '${rowCount}');
            }
            groupOption.headerStatement = state;
        }
        // 그리드 헤더 옵션 설정
        if ($.type(opt.dataSource.options.userGroup) !== 'undefined' && opt.dataSource.options.userGroup) {
            groupOption.mergeMode = true;
            groupOption.collapsedAdornments = "footer";
            groupOption.expandedAdornments = "footer";
            opt.panel.visible = true;
        }
        grid.setRowGroup(groupOption);
        grid.setSortingOptions({handleVisibility: "hidden"});
    }

    // 그리드 컬럼 커스터마이징
    function customizingColumn(columns, opt, grid) {
        if (columns && opt.dataSource && opt.dataSource.options.field) {
            var dataSource = opt.dataSource.options;
            for (var i = 0; i < columns.length; i += 1) {
                if ($.type(columns[i]) !== 'undefined') {
                    columns[i].fieldName = columns[i].field;
                    if ($.type(columns[i].field) !== 'undefined') {
                        columns[i].name = columns[i].field;
                    }
                    for (var f = 0; f < dataSource.field.length; f += 1) {
                        if (columns[i].fieldName === dataSource.field[f].fieldName) {
                            opt.fieldIndex = f;
                            break;
                        }
                    }
                    if ($.type(columns[i].styles) === 'undefined') {
                        columns[i].styles = {};
                    }
                    // 그리드 포맷 및 스타일 설정
                    if ($.type(opt.fieldIndex) !== 'undefined' && $.type(dataSource.field[opt.fieldIndex].styles) === 'undefined') {
                        dataSource.field[opt.fieldIndex].styles = {};
                    }
                    // 그리드 에디터 기본값 설정
                    if ($.type(columns[i].editor) === 'undefined') {
                        columns[i].editor = {
                            type: 'text'
                        };
                    }
                    // 그리드 너비 지정 유무 설정
                    if ($.type(columns[i].width) === 'undefined' && opt.display.fitStyle === 'fill') {
                        columns[i].fillWidth = 1;
                    }
                    // 그리드 컬럼 문구 설정
                    if (columns[i].title) {
                        columns[i].header = $.extend(true, columns[i].header, {
                            text: columns[i].title,
                            fixedHeight: opt.display.rowIndex
                        });
                    } else {
                        columns[i].header = {
                            text: ' '
                        };
                    }
                    // 그리드 문자 정렬 기본값 설정
                    if ($.type(opt.styles) !== 'undefined' && $.type(opt.styles.textAlign) !== 'undefined') {
                        columns[i].align = opt.styles.textAlign;
                    } else if ($.type(columns[i].align) === 'undefined') {
                        columns[i].align = 'center';
                    }
                    // 그리드 문자 정렬 설정
                    if (columns[i].align) {
                        var align;
                        if (columns[i].align === 'right') {
                            align = 'far';
                        } else if (columns[i].align === 'left') {
                            align = 'near';
                        } else {
                            align = 'center';
                        }
                        columns[i].styles.textAlignment = align;
                    }
                    // 그리드 포맷 설정
                    if (columns[i].formats) {
                        if ($.type(columns[i].formats.type) === 'undefined') {
                            columns[i].formats.type = 'text';
                        }
                        switch ((columns[i].formats.type).toUpperCase()) {
                            case 'DATE':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = dews._environments.formats.dateFormat;
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.field[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.field[opt.fieldIndex].dataType = 'datetime';
                                    dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'datetime';
                                }
                                columns[i].styles.datetimeFormat = $.type(columns[i].formats.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].formats.format;
                                break;
                            case 'LINK':
                                columns[i].renderer = $.extend(true, columns[i].renderer, {
                                    'type': 'link',
                                    'url': dews.url.getAbsoluteUrl('${' + columns[i].field + '}'),
                                    'showUrl': false,
                                    'useMenu': $.type(columns[i].formats.useMenu) === 'boolean' ? columns[i].formats.useMenu : false
                                });
                                break;
                            case 'MASK':
                                var mask = columns[i].formats.format, replace = '', exp = '(', regchar = '',
                                    regcount = 1, expcount = 0;
                                for (var m = 0; m < mask.length; m += 1) {
                                    if (mask[m] !== regchar && regchar === '*') {
                                        exp += '{' + expcount + '})(';
                                        expcount = 0;
                                        regcount++;
                                    }
                                    switch (mask[m]) {
                                        case '0':
                                        case '9':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\d';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '#':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\d';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'L':
                                        case '?':
                                            if (expcount === 0) {
                                                exp += '[a-zA-Z]';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}[a-zA-Z]';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '&':
                                            if (expcount === 0) {
                                                exp += '\\S';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\S';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'C':
                                            if (expcount === 0) {
                                                exp += '.';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}.';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'A':
                                        case 'a':
                                            if (expcount === 0) {
                                                exp += '[a-zA-Z0-9]';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}[a-zA-Z0-9]';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '*':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '})(\\d';
                                                replace += '$' + regcount;
                                                expcount = 0;
                                                regcount++;
                                            }
                                            replace += '*';
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        default:
                                            if (mask[m] !== '*') {
                                                replace += '$' + regcount + mask[m];
                                            }
                                            exp += '{' + expcount + '})(';
                                            expcount = 0;
                                            regcount++;
                                            break;
                                    }
                                    if (m === mask.length - 1) {
                                        exp += '{' + expcount + '})';
                                        if (regchar !== '*') {
                                            replace += '$' + regcount;
                                        }
                                    }
                                }
                                columns[i].displayRegExp = exp;
                                columns[i].displayReplace = replace;
                                break;
                            case 'NUMBER':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = '#,##0.##';
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].dataType = 'number';
                                    dataSource.field[opt.fieldIndex].min = columns[i].formats.min;
                                    dataSource.field[opt.fieldIndex].max = columns[i].formats.max;
                                    dataSource.field[opt.fieldIndex].styles.numberFormat = $.type(columns[i].formats.format) === 'undefined' ? '#,##0.##' : columns[i].formats.format;
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                                    dataSource.schema.model.fields[opt.fieldIndex].numberFormat = $.type(columns[i].formats.format) === 'undefined' ? '#,##0.##' : columns[i].formats.format;
                                }
                                columns[i].styles.numberFormat = columns[i].formats.format;
                                break;
                            case 'CHECK':
                                columns[i].renderer = {
                                    'type': 'check',
                                    'shape': 'box',
                                    'editable': false,
                                    'startEditOnClick': true,
                                    'trueValues': $.type(columns[i].formats.trueValue) === 'undefined' ? 'true' : columns[i].formats.trueValue,
                                    'falseValues': $.type(columns[i].formats.falseValue) === 'undefined' ? 'false' : columns[i].formats.falseValue,
                                    'trueImage': opt.gridStyle.body.checkedImg,
                                    'falseImage': opt.gridStyle.body.unCheckImg,
                                    'labelPosition': 'none',
                                    'showInnerFocus': false
                                };
                                /*if (columns[i].formats.header) {
                                    columns[i].header.checkLocation = 'center';
                                    grid.setColumnHeaderOptions({
                                        checkColor: '#ff4995ff',
                                        hoveredCheckColor: '#ff4995ff'
                                    });
                                    opt.headerClick = true;
                                }*/
                                columns[i].editable = false;
                                columns[i].styles.figureBackground = '#ff4995ff';
                                break;
                            case 'DATASOURCE':
                                var value = columns[i].formats.dataValueField,
                                    label = columns[i].formats.dataTextField;
                                columns[i].values = [];
                                columns[i].labels = [];
                                columns[i].lookupDisplay = true;
                                if (columns[i].formats.dataSource.transport.data.length > 0) {
                                    for (var k = 0; k < columns[i].formats.dataSource.transport.data.length; k += 1) {
                                        columns[i].values.push(columns[i].formats.dataSource.transport.data[k][value]);
                                        columns[i].labels.push(columns[i].formats.dataSource.transport.data[k][label]);
                                    }
                                }
                                break;
                            case 'IMAGE':
                                columns[i].editable = false;
                                columns[i].renderer = {
                                    type: 'image',
                                    smoothing: true
                                };
                                columns[i].styles.contentFit = 'auto';
                                break;
                            case 'TIME':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = "HH:mm:ss";
                                    }
                                }

                                var time = columns[i].formats.format, timeReg = '';
                                if (/HH/gi.test(time)) {
                                    timeReg = time.replace(/HH/gi, '$1');
                                }
                                if (/mm/gi.test(time)) {
                                    timeReg = timeReg.replace(/mm/gi, '$2');
                                }
                                if (/ss/gi.test(time)) {
                                    timeReg = timeReg.replace(/ss/gi, '$3');
                                }

                                columns[i].displayRegExp = /([0-1]\d|2[0-3])([0-5]\d)([0-5]\d)?/gi;
                                columns[i].displayReplace = timeReg;
                                break;

                            case 'PASSWORD':
                                var format = columns[i].formats.format;

                                columns[i].displayRegExp = /^.*$/gi;
                                columns[i].displayReplace = format;
                        }
                    }
                    // 그리드 에디터 설정
                    if (columns[i].editor) {
                        var editorAlign = 'center';
                        if (columns[i].styles.textAlignment) {
                            editorAlign = columns[i].styles.textAlignment;
                        }
                        if ($.type(columns[i].editor.type) === 'undefined') {
                            columns[i].editor.type = 'string';
                        }
                        columns[i].editor.textAlignment = editorAlign;

                        switch ((columns[i].editor.type).toUpperCase()) {
                            case 'DROPDOWN':
                            case 'COMBO':
                                var values = columns[i].editor.dataValueField,
                                    labels = columns[i].editor.dataTextField,
                                    datasource = columns[i].editor.dataSource;
                                columns[i].values = [];
                                columns[i].labels = [];
                                columns[i].editButtonVisibility = 'visible';
                                if ((columns[i].editor.type).toUpperCase() === 'DROPDOWN') {
                                    columns[i].editor.textReadOnly = true;

                                    if (columns[i].editor.autoOpen) {
                                        columns[i].editor.autoOpen = true;
                                    }
                                } else {
                                    columns[i].editor.textReadOnly = false;
                                }
                                columns[i].editor.type = 'dropDown';
                                columns[i].lookupDisplay = true;
                                columns[i].editor.dropdowncount = 3;
                                columns[i].labelField = labels;
                                if ($.type(columns[i].editor.dataSource) === 'function') {
                                    datasource = columns[i].editor.dataSource.call(grid, {
                                        grid: grid,
                                        row: {
                                            index: 0,
                                            data: {
                                                labels: '',
                                                values: ''
                                            }
                                        }
                                    });
                                }

                                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                                    for (var j = 0; j < datasource.transport.data.length; j += 1) {
                                        columns[i].values.push(datasource.transport.data[j][values]);
                                        columns[i].labels.push(datasource.transport.data[j][labels]);
                                    }
                                }
                                break;
                            case 'NUMBER':
                                if (columns[i].editor.predefined === true) {
                                    if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                        columns[i].editor.preFormat = columns[i].editor.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                    if (preDefinedFormat) {
                                        columns[i].editor.format = preDefinedFormat;
                                    } else {
                                        columns[i].editor.format = '#,##0.##';
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].dataType = 'number';
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                                    dataSource.field[opt.fieldIndex].min = columns[i].editor.min;
                                    dataSource.field[opt.fieldIndex].max = columns[i].editor.max;
                                }
                                columns[i].editor.editFormat = $.type(columns[i].editor.format) === 'undefined' ? '#,##0.##' : columns[i].editor.format;
                                columns[i].styles.numberFormat = $.type(columns[i].editor.format) === 'undefined' ? '#,##0.##' : columns[i].editor.format;
                                columns[i].editor.increaseValue = $.type(columns[i].editor.increaseValue) === 'undefined' ? 1000 : parseFloat(columns[i].editor.increaseValue);
                                columns[i].editor.increaseType = $.type(columns[i].editor.increaseType) === 'undefined' ? 'multiple' : columns[i].editor.increaseType;


                                break;
                            case 'STRING':
                                columns[i].editor.type = 'text';
                                break;
                            case 'DATE':
                                if (columns[i].editor.predefined === true) {
                                    if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                        columns[i].editor.preFormat = columns[i].editor.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                    if (preDefinedFormat) {
                                        columns[i].editor.format = preDefinedFormat;
                                    } else {
                                        columns[i].editor.format = dews._environments.formats.dateFormat;
                                    }
                                }

                                columns[i].editor.yearDisplayFormat = '{Y}' + dews.localize.get('년', 'dews_년Y');
                                columns[i].editor.months = dews.localize.getMonth();
                                columns[i].editor.weekDays = dews.localize.getDays();
                                columns[i].editor.minDate = new Date(1900, 0, 1);
                                columns[i].editor.maxDate = new Date(2100, 12, 0);
                                columns[i].editor.datetimeFormat = $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].editor.format;
                                columns[i].styles.datetimeFormat = $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].editor.format;
                                columns[i].editor.mask = {
                                    editMask: $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : (columns[i].editor.format).replace(/[A-z\\s]/gi, '9'),
                                    includedFormat: true
                                };
                                columns[i].editButtonVisibility = 'visible';
                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.field[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.field[opt.fieldIndex].dataType = 'datetime';
                                    dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = 'iso'; // 서버에서 date형식으로 넘어올 경우 사용해야함
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'datetime';
                                }
                                break;
                            case 'READONLY':
                                columns[i].readOnly = true;
                                columns[i].editable = false;
                                break;
                            case 'MASK':
                            case 'TIME':
                                var editMask = columns[i].editor.format;
                                if (editMask) {
                                    for (var em = 0; em < editMask.length; em += 1) {
                                        switch (editMask[em]) {
                                            case 'L':
                                            case '?':
                                            case '#':
                                            case '&':
                                                editMask = editMask.replace(editMask[em], 'a');
                                                break;
                                            case 'A':
                                            case 'a':
                                                editMask = editMask.replace(editMask[em], '*');
                                                break;
                                            case 'H':
                                            case 'm':
                                            case 's':
                                                editMask = editMask.replace(editMask[em], '0');
                                                break;
                                        }
                                    }
                                }
                                if (columns[i].editor.type.toUpperCase() === 'TIME') {
                                    columns[i].editor.type = 'time';
                                    if (columns[i].editor.predefined === true) {
                                        if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                            columns[i].editor.preFormat = columns[i].editor.format;
                                        }
                                        var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                        if (preDefinedFormat) {
                                            editMask = preDefinedFormat;
                                        } else {
                                            editMask = "HH:mm:ss";
                                        }
                                    }
                                } else {
                                    columns[i].editor.type = 'text';
                                }

                                columns[i].editor.mask = {
                                    editMask: editMask,
                                    allowEmpty: true
                                };

                                break;
                            case 'CODEPICKER':
                                columns[i].editor.firstClick = true;
                                columns[i].button = 'image';
                                columns[i].buttonVisibility = 'visible';
                                columns[i].imageButtons = {
                                    'width': 24,
                                    'height': 22,
                                    'images': [{
                                        'name': 'codepickerbutton',
                                        'up': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'hover': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'down': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png'
                                    }]
                                };
                                opt._grid = true;
                                columns[i].codeOption = {
                                    field: columns[i].field,
                                    code: columns[i].editor.helpCode,
                                    codeField: columns[i].editor.codeField,
                                    textField: columns[i].editor.textField,
                                    params: columns[i].editor.helpParams,
                                    size: columns[i].editor.helpSize,
                                    title: columns[i].editor.helpTitle,
                                    mode: 'single',
                                    width: columns[i].editor.helpWidth,
                                    height: columns[i].editor.helpHeight,
                                    initData: columns[i].editor.initData,
                                    callback: columns[i].editor.callback,
                                    custom: columns[i].editor.helpCustom || false,
                                    viewUrl: columns[i].editor.helpViewUrl,
                                    apiUrl: columns[i].editor.helpApiUrl,
                                    useAjax: $.type(columns[i].editor.useAjax) === 'boolean' ? columns[i].editor.useAjax : true,
                                    validation: $.type(columns[i].editor.validation) === 'boolean' ? columns[i].editor.validation : true,
                                    value: {}
                                };
                                break;
                            case 'BUTTON':
                                columns[i].buttonVisibility = 'always';
                                columns[i].renderer = {
                                    type: 'imageButton',
                                    text: columns[i].editor.buttonText || '',
                                    width: $.type(columns[i].editor.buttonWidth) === 'undefined' ? 50 : columns[i].editor.buttonWidth,
                                    height: $.type(columns[i].editor.buttonHeight) === 'undefined' ? 25 : columns[i].editor.buttonHeight,
                                    imageUrl: columns[i].editor.basicImg,
                                    hoverUrl: columns[i].editor.hoverImg,
                                    activeUrl: columns[i].editor.clickImg
                                };
                                break;
                            case 'CHECK':
                                columns[i].renderer = {
                                    'type': 'check',
                                    'shape': 'box',
                                    'editable': true,
                                    'startEditOnClick': true,
                                    'trueValues': $.type(columns[i].editor.trueValue) === 'undefined' ? 'true' : columns[i].editor.trueValue,
                                    'falseValues': $.type(columns[i].editor.falseValue) === 'undefined' ? 'false' : columns[i].editor.falseValue,
                                    'trueImage': opt.gridStyle.body.checkedImg,
                                    'falseImage': opt.gridStyle.body.unCheckImg,
                                    'labelPosition': 'none',
                                    'showInnerFocus': false
                                };
                                /*if (columns[i].formats.header) {
                                    columns[i].header.checkLocation = 'center';
                                    grid.setColumnHeaderOptions({
                                        checkColor: '#ff4995ff',
                                        hoveredCheckColor: '#ff4995ff'
                                    });
                                    opt.headerClick = true;
                                }*/
                                columns[i].editable = false;
                                columns[i].styles.figureBackground = '#ff4995ff';
                                break;
                            case 'ZIPCODEPICKER':
                                columns[i].button = 'image';
                                columns[i].buttonVisibility = 'visible';
                                columns[i].imageButtons = {
                                    'width': 24,
                                    'height': 22,
                                    'images': [{
                                        'name': 'zipcodepickerbutton',
                                        'up': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'hover': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'down': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png'
                                    }]
                                };
                                opt._grid = true;
                                columns[i].codeOption = {
                                    field: columns[i].field,
                                    addressType: $.type(columns[i].editor.addressType) === 'undefined' ? 'zipcode' : columns[i].editor.addressType,
                                    callback: columns[i].editor.callback
                                };
                                break;

                            case 'MULTILINE':
                                columns[i].editor.type = 'multiline';
                                columns[i].styles.textWrap = 'explicit';
                        }
                    }
                    // 그리드 필수값,읽기전용 색상 설정
                    if (columns[i].attributes) {
                        if (columns[i].attributes.class === 'required') {
                            columns[i].styles.background = opt.gridStyle.body.requiredBackground;
                        } else if (columns[i].attributes.class === 'readonly') {
                            columns[i].styles.background = '#f8f7f6';
                            columns[i].readOnly = true;
                            columns[i].editable = false;
                        }
                    }
                    // 그리드 푸터 사용
                    if (columns[i].footer) {
                        opt.footer.visible = true;
                        if (columns[i].footer.styles === undefined) {
                            var footerAlign = 'center';
                            if (columns[i].styles.textAlignment) {
                                footerAlign = columns[i].styles.textAlignment;
                            }
                            columns[i].footer.styles = {
                                textAlignment: footerAlign
                            };
                        }

                        if ($.type(columns[i].footer.align) !== 'undefined') {
                            switch (columns[i].footer.align.toLowerCase()) {
                                case 'left':
                                    columns[i].footer.styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    columns[i].footer.styles.textAlignment = 'far';
                                    break;
                                default:
                                    columns[i].footer.styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if (columns[i].footer.type) {
                            if ($.type(opt.fieldIndex) !== 'undefined' && columns[i].footer.type.toLowerCase() !== 'count') {
                                dataSource.field[opt.fieldIndex].dataType = 'number';
                                dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                            }
                            columns[i].footer.expression = columns[i].footer.type;
                            columns[i].footer.styles.numberFormat = $.type(columns[i].footer.format) === 'undefined' ? '#,##0.##' : columns[i].footer.format;

                            if (columns[i].footer.predefined === true) {
                                if ($.type(columns[i].footer.preFormat) === 'undefined') {
                                    columns[i].footer.preFormat = columns[i].footer.format;
                                }
                                var preDefinedFormat = dews.getPreDefinedFormat(columns[i].footer);

                                if (preDefinedFormat) {
                                    columns[i].footer.styles.numberFormat = preDefinedFormat;
                                } else {
                                    columns[i].footer.styles.numberFormat = '#,##0.##';
                                }
                            }
                        }

                        if (columns[i].footer.group) {
                            columns[i].footer.groupExpression = columns[i].footer.group.type;
                        }

                        // 그리드 푸터 접두사
                        if (columns[i].footer.prefix) {
                            columns[i].footer.styles.prefix = columns[i].footer.prefix;
                        }
                        // 그리드 푸터 접미사
                        if (columns[i].footer.suffix) {
                            columns[i].footer.styles.suffix = columns[i].footer.suffix;
                        }
                    }
                    // 그리드 접두사
                    if (columns[i].suffix) {
                        columns[i].styles.suffix = columns[i].suffix;
                    }
                    // 그리드 접미사
                    if (columns[i].prefix) {
                        columns[i].styles.prefix = columns[i].prefix;
                    }
                    // 그리드 그룹핑 사용
                    if ($.type(columns[i].grouping) === 'boolean' && columns[i].grouping) {
                        columns[i].type = 'group';
                        columns[i].orientation = 'vertical';
                        opt.grouping = true;
                        opt.groupCol = columns[i].columns.length;
                        if (opt.groupCol > opt.maxGroupCol) {
                            opt.maxGroupCol = opt.groupCol;
                        }
                    }
                    // 그리드 다중 헤더 컬럼 사용시
                    if (columns[i].columns) {
                        columns[i].type = 'group';
                        if (!columns[i].hideChildHeaders) {
                            opt.depth += 1;
                        }

                        if ($.type(columns[i].name) === 'undefined') {
                            columns[i].name = '_he@der_name_' + opt.depth + '' + i + '' + parseInt(Math.random() * 1000);
                        }

                        // 그리드 헤더 컬럼 visible 설정
                        if ($.type(columns[i].visible) === 'boolean') {
                            columns[i].header.visible = columns[i].visible;
                            delete columns[i].visible;
                        } else if (columns[i].visible === 'hideChildren') {
                            columns[i].visible = false;
                            columns[i].header.visible = false;
                        }
                        customizingColumn(columns[i].columns, opt, grid);
                    } else {
                        if (opt.depth > opt.maxDepth) {
                            opt.maxDepth = opt.depth;
                        }
                        opt.depth = 1;
                    }
                    // 셀 머지
                    if ($.type(columns[i].merge) !== 'undefined') {
                        if ($.type(columns[i].merge.verticalTop) === 'boolean' && columns[i].merge.verticalTop) {
                            columns[i].equalBlank = true;
                        } else {
                            columns[i].mergeRule = {
                                criteria: 'value'
                            };
                            // 내부 포커스 설정
                            if ($.type(columns[i].merge) === 'object' && $.type(columns[i].merge.innerFocus) !== 'undefined') {
                                opt.display.showInnerFocus = columns[i].merge.innerFocus;
                            }
                        }
                    }
                }
            }
            opt.columns = columns;
            opt.dataSource.options = dataSource;
            grid.dataSource = opt.dataSource;
        }
        return opt;
    }

    // 그리드 스타일 재정의
    function setStyles(grid, options) {
        var self = grid,
            opt = options;

        return opt = dews.ui.gridUtil.setStyles(self, opt);
    }

    dews = $.extend(true, dews, {
        ui: {
            /**
             * 그리드 컨트롤을 생성합니다.
             *
             * @param {jQuery|String} selector 그리드 생성 대상
             * @param {Object} [options] 그리드 옵션
             */
            grid: function (selector, options) {
                var $el, grid, $content;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    if (dews.ui.dialogPage) {
                        $content = dews.ui.dialogPage.$content;
                    } else if (dews.ui.page) {
                        $content = dews.ui.page.$content;
                    } else {
                        $content = $(document);
                    }
                    $el = $(selector, $content);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var gridView, $this = $(this);

                    gridView = $this.data('dews-control');

                    if (!gridView) {
                        if ($.type(options) === 'undefined') {
                            options = {};
                        }

                        if (!$this.hasClass('dews-data-control')) {
                            $this.addClass('dews-data-control');
                        }

                        RealGridJS.setRootContext(dews._environments.scriptBase + 'realgrid');
                        gridView = new Grid($el, options);
                        $this.data('dews-control', gridView);
                    }

                    grid = gridView;
                });

                return grid;
            }
        }
    });

    // 그리드 객체 생성
    function Grid(selector, options) {
        var self = this, option, realGrid, realGridID, id = selector.attr('ID');

        realGrid = $('<div></div>');
        if (dews.ui.dialogPage && selector.closest(dews.ui.dialogPage.$content).length) {
            options.$content = dews.ui.dialogPage.$content;
            realGridID = dews.ui.dialogPage.id + '_' + id;
        } else if (dews.ui.page && selector.closest(dews.ui.page.$content).length) {
            options.$content = dews.ui.page.$content;
            realGridID = dews.ui.page.id + '_' + id;
        } else {
            options.$content = $(document);
            realGridID = 'child_' + id;
        }
        realGrid.attr('ID', realGridID);
        $('#' + id, options.$content).append(realGrid);

        if (options.height) {
            realGrid.css('height', options.height + 'px');
        } else {
            realGrid.css('height', '635px');
        }

        self._grid = new RealGridJS.GridView(realGridID);
        self._grid.name = realGridID;
        self.$element = $('#' + self._grid.name);
        if ($.type(loadGridStyle) === 'undefined') {
            var gridTheme = 'grid.json';
            var themeUrl = $.type(dews.theme) === 'undefined' ? $('head link[data-role="dews-theme"]').attr('href') : dews.theme.getCurrentThemeUrl();
            if (themeUrl.length === 0) {
                $('head link[href*="dews."]').each(function (idx, link) {
                    if ($(link).attr('href').match(/(dews\.?[^./]*\.css.*)/) && $(link).attr('disabled') !== 'disabled') {
                        options.url = $(link).attr('href').replace(/(dews\.?[^./]*\.css.*)/, '');
                    }
                });
            } else {
                options.url = themeUrl.replace(/([^\/]*\.css$)/, '');
                var theme = $.isFunction(window.getThemes) ? window.getThemes() : '';
                if (theme && theme[0] && theme[0].colors) {
                    $.each(theme[0].colors, function (idx, item) {
                        if (themeUrl.match(item.name)) {
                            gridTheme = 'grid.' + item.name + '.json';
                        }
                    });
                }
            }

            dews.ajax.get(options.url + gridTheme, {async: false, dataType: 'json'}).done(function (style) {
                loadGridStyle = style;
                options.gridStyle = style;
            }).fail(function () {
                options.gridStyle = dews.ui.gridUtil.gridStyle;
                console.log('그리드 스타일 로드 실패');
            });
        } else {
            options.gridStyle = loadGridStyle;
        }
        self._grid.setStyles(options.gridStyle);
        option = getOptions(self, options);
        self._grid.setOptions(option);
        self.options = option;
        self.focused = false;
        self.columns = {};
        if (self.options.columns) {
            dews.ui.gridUtil._setColumns(self, self.options.columns);
        }

        self._bindEvent();

        if (self.options.dataSource && self.options.autoBind) {
            self.options.dataSource.read();
        }

        // 그리드 컨텍스트메뉴 설정
        if (self.options.context !== false) {
            self.setContextMenu(self.options.context);
        }

        setTimeout(function () {
            self._grid.resetSize();
        }, 100);

        if (dews.ui.dialogPage) {
            setTimeout(function () {
                self._grid.resetSize();
            }, 100);
        }
        // 그리드 브라우저 resize 시 다른탭 이동할 경우 그리드 사라지는 문
        setInterval(function () {
            if (!self.options.isVisible && isVisible(self)) {
                self._grid.resetSize();
                self.options.isVisible = true;
            } else {
                self.options.isVisible = false;
            }
        }, 100);

        if (self.options.columns) {
            dews.ui.gridUtil.displayColumns(self, self._grid.getDisplayColumns())
        }

        return self;
    }

    /**
     * 그리드 행 추가
     * @param row (number) 해당 행 다음 추가할 index
     */
    Grid.prototype.addRow = function (row) {
        var self = this;

        self.options.add = true;
        delete self.options._addParams;

        self._grid.commit();
        self._grid.setOptions({edit: {insertable: true, appendable: true}});
        if ($.type(self.options.dataBounding) === 'boolean' && !self.options.dataBounding && $.type(self.options.dataSource) !== 'undefined') {
            self.options.dataBounding = true;
            self.options.dataSource.add({});
        } else if ($.type(row) === 'number') {
            self.options._addParams = row;
            self._grid.beginInsertRow(row);
        } else {
            self._grid.beginAppendRow();
        }
        self._grid.setOptions({edit: {insertable: false, appendable: false}});

        setTimeout(function () {
            if (self._grid.getEditOptions().editable) {
                var parameter = {
                    grid: self,
                    row: {
                        index: self._grid.getCurrent().itemIndex,
                        data: self._grid.getValues(self._grid.getCurrent().itemIndex)
                    },
                    cell: {
                        field: ''
                    }
                };
                for (var i = 0; i < self.options.displayColumns.length; i += 1) {
                    parameter.cell.field = self.options.displayColumns[i].field;
                    if (self._grid.getColumnProperty(self.options.displayColumns[i].field, 'editable') && self._grid.getColumnProperty(self.options.displayColumns[i].field, 'visible')) {
                        if ($.type(self.options.displayColumns[i].editor.editable) !== 'undefined' && self.options.displayColumns[i].editor.editable.call(self, parameter)) {
                            if (self._grid.getColumnProperty(self.options.displayColumns[i].field, 'editor').toLowerCase() === 'codepicker') {
                                self._grid.setColumnProperty(self.options.displayColumns[i].field, 'buttonVisibility', 'visible');
                            }
                            self._grid.setCurrent({
                                itemIndex: self._grid.getCurrent().itemIndex,
                                columns: self.options.displayColumns[i].field,
                                dataRow: self._grid.getCurrent().dataRow,
                                fieldIndex: i,
                                fieldName: self.options.displayColumns[i].field
                            });
                            self._grid.showEditor();
                            break;
                        } else if ($.type(self.options.displayColumns[i].editor.editable) === 'undefined') {
                            self._grid.setCurrent({
                                itemIndex: self._grid.getCurrent().itemIndex,
                                columns: self.options.displayColumns[i].field,
                                dataRow: self._grid.getCurrent().dataRow,
                                fieldIndex: i,
                                fieldName: self.options.displayColumns[i].field
                            });
                            self._grid.showEditor();
                            break;
                        }
                    }
                }
            }
        });
    };
    /**
     * 그리드 행 삭제
     * @param row (number || array) 삭제할 행의 index
     */
    Grid.prototype.removeRow = function (row) {
        var self = this,
            event,
            parameter,
            rows = [],
            previous = self._grid.getCurrent(),
            dynamicRow = [];
        var dataProvider = self.options.dataSource.dataProvider;

        if ($.type(row) === 'array') {
            rows = row;
        } else {
            rows.push(row);
        }

        if (rows[0] > -1 && self._grid._dataSource.getJsonRow(rows[0])) {
            parameter = {
                grid: self,
                row: {
                    data: self.dataItems(rows),
                    index: rows
                }
            };

            event = new $.Event('rowRemove', parameter);
            self.$element.trigger(event);

            if (self.options.rowDynamic.length !== 0) {
                for (var d = 0; d < self.options.rowDynamic.length; d += 1) {
                    var criteria = self.options.rowDynamic[d].criteria.replace('(dataRow = ', '');
                    criteria = parseInt(criteria.replace(')', ''));
                    dynamicRow.push(criteria);
                }
            }

            for (var j = rows.length - 1; j >= 0; j -= 1) {
                if (dynamicRow.length !== 0) {
                    for (var r = dynamicRow.length - 1; r >= 0; r -= 1) {
                        if (rows[j] === dynamicRow[r] && rows[j] > -1) {
                            self.options.rowDynamic.splice(rows[j], 1);
                        } else if (rows[j] < dynamicRow[r]) {
                            self.options.rowDynamic[r].criteria = '(dataRow = ' + parseInt(dynamicRow[r] - 1) + ')';
                        }
                    }

                    self._grid.setStyles({
                        body: {
                            dynamicStyles: self.options.rowDynamic
                        }
                    });
                }

                if (dataProvider.getRowState(rows[j]) !== 'created') {
                    self.options.dataSource.options._destroy.push(dataProvider.getJsonRow(rows[j]));
                }
                dataProvider.removeRow(rows[j]);
            }
            if (self._grid.getCurrent().itemIndex !== -1 && self.options.dataSource.data().length !== self._grid.getCurrent().itemIndex) {
                self._grid.onCurrentChanging.call(self, self._grid, previous, self._grid.getCurrent());
                self.options.rowChange = true;
                self._grid.onCurrentChanged.call(self, self._grid, self._grid.getCurrent());
            }
        }
    };
    /**
     * 그리드 변경 내용 취소
     */
    Grid.prototype.cancelChanges = function () {
        var self = this;
        self.options.dataSource.dataProvider.rollback(self.options.dataSource.options.rollback);
    };
    /**
     * 그리드 현재 행 변경 취소
     */
    Grid.prototype.cancelRow = function () {
        var self = this,
            data = self.options.dataSource.dataProvider,
            current = self._grid.getCurrent();

        dews.ui.gridUtil.cancelRow(self, data, current.dataRow);
    };
    /**
     * 그리드 현제 셀 변경 취소
     */
    Grid.prototype.cancelCell = function () {
        var self = this,
            column = self._grid.getCurrent().column.toUpperCase(),
            row = self._grid.getCurrent().dataRow,
            dataSource = self.options.dataSource,
            fieldIndex = 0,
            originData;

        if (dataSource && dataSource.dataProvider) {
            fieldIndex = dataSource.dataProvider._dp._fieldNames.indexOf(column);
            originData = dataSource.dataProvider._dp._orgValues[row];

            if ($.type(originData) !== 'undefined') {
                self._grid.setValue(row, column, originData[fieldIndex]);
            } else if (dataSource.dataProvider.getRowState(row) === 'created') {
                self._grid.setValue(row, column, undefined);
            }
        }
    };
    /**
     * 그리드 지정한 행의 데이터 반환
     * @param row (number) 데이터를 반환할 행 index
     * @returns {*} 지정한 행의 데이터
     */
    Grid.prototype.dataItem = function (row) {
        var self = this,
            data = self._grid.getValues(row);

        if (data) {
            delete data.__rowId;
        }

        return data;
    };
    /**
     * 그리드 지정한 행 또는 전체 데이터 반환
     * @param row (number || array || {}) 지정한 행 또는 지정한 행의 배열 형태의 index
     * @returns {Array} 지정한 행의 데이터 또는 그리드 전체 행 데이터
     */
    Grid.prototype.dataItems = function (row) {
        var self = this, datasource = [];
        if (row > -1 && self.options.dataSource) {
            if (row.length === 1 || $.type(row) === 'number') {
                if ($.type(row) === 'array') {
                    return self.options.dataSource.at(self._grid.getValues(row).__rowId);
                }
                return self.options.dataSource.at(self._grid.getValues(row).__rowId);
            }
            for (var j = 0; j < row.length; j += 1) {
                datasource.push(self.options.dataSource.at(self._grid.getValues(row).__rowId));
            }
            return datasource;
        } else {
            return self.options.dataSource.data();
        }
    };
    /**
     * 그리드 수정모드 발생
     */
    Grid.prototype.editCell = function () {
        this._grid.showEditor();
    };
    /**
     * 그리드 현재 값 저장 후 수정모드 종료
     */
    Grid.prototype.commitCell = function () {
        this._grid.commitEditor();
    };
    /**
     * 그리드 현재 값 취소 후 수정모드 종료
     */
    Grid.prototype.closeCell = function () {
        this._grid.cancelEditor();
    };
    /**
     * 그리드에서 지정한 셀 값 가져오기
     * @param row (number) 값을 가져올 행 index
     * @param field (string) 값을 가져올 field 명
     */
    Grid.prototype.getCellValue = function (row, field) {
        return this._grid.getValue(row, field);
    };
    /**
     * 그리드에서 지정한 행의 셀 값 설정하기
     * @param row (number) 값을 지정할 행의 index
     * @param field (string) 값을 설정할 셀의 field 명
     * @param value (any) 해당 셀에 설정할 값
     */
    Grid.prototype.setCellValue = function (row, field, value, boolean) {
        var self = this,
            previous = self._grid.getValue(row, field),
            onEditCell = true;

        if ($.type(row) === 'array') {
            for (var i = 0; i < row.length; i += 1) {
                if (row[i] !== -1) {
                    self._grid.setValue(row[i], field, value);
                }
            }
        } else {
            if (row !== -1) {
                self._grid.setValue(row, field, value);
            }
        }

        if ($.type(boolean) === 'boolean') {
            onEditCell = boolean;
        }

        if (value !== previous && $.type(self._grid.columnByField(field)) !== 'null') {
            self._grid.onCellEdited.call(self, self._grid, row, row, self._grid.columnByField(field).dataIndex, onEditCell);
        }

        self.options.commit = true;
        self._grid.commit();
    };
    /**
     * 체크 바에 지정한 행을 체크 혹은 해제 합니다.
     * @param index 체크 혹은 해제 할 행의 index
     * @param value 체크 혹은 해제 할 값 boolean
     */
    Grid.prototype.setCheck = function (index, value) {
        var self = this,
            row = [];

        if ($.type(index) === 'number') {
            row.push(index);
        } else if ($.type(index) === 'array') {
            row = index;
        }

        self._grid.checkItems(row, value);
    };
    /**
     * 그리드 체크바 disabled 설정
     * @param index disabled 설정할 index
     * @param boolean disabled 설정 유무
     */
    Grid.prototype.setDisableCheck = function (index, boolean) {
        var self = this,
            row = [],
            bool = false;

        if ($.type(index) === 'number') {
            row.push(index)
        } else if ($.type(index) === 'array') {
            row = index;
        }

        if ($.type(boolean) === 'boolean') {
            bool = !boolean;
        }

        for (var i = 0; i < row.length; i++) {
            self._grid.setCheckable(row[i], bool);
        }
    };

    /**
     * 헤더 체크박스 설정
     * @param bool check: true, uncheck: false
     */
    Grid.prototype.setHeaderCheck = function (boolean) {
        this._grid.setAllCheck(boolean);
        this._grid.checkAll(boolean);
    };

    /**
     * 체크 바에 체크된 행의 데이터 반환
     * @returns {Array} 체크된 행의 데이터
     */
    Grid.prototype.getCheckedRows = function () {
        return dews.ui.gridUtil.getCheckedRows(this);
    };
    /**
     * 체크 바에 체크된 항목의 값 반환
     * @param field (string) 반환 할 값의 field 명
     * @returns {Array} 체크 바에 체크된 항목에서 지정한 field의 데이터
     */
    Grid.prototype.getCheckedValues = function (field) {
        return dews.ui.gridUtil.getCheckedValues(this, field);
    };
    /**
     * 체크 바에 체크된 행 index 반환
     * @returns {array} 체크된 행의 index
     */
    Grid.prototype.getCheckedIndex = function () {
        /*var self = this, data = self.options.dataSource.dataProvider.getRowCount(), index = [];

        for (var i = 0; i < data; i++) {
            if (self._grid.getValue(i, field) && self._grid.getValue(i, field) === 'checked') {
                index.push(i);
            }
        }

        return index;*/
        return this._grid.getCheckedItems();
    };
    /**
     * 그리드 컬럼 노출 기능
     * @param field (string) 노출할 컬럼명
     */
    Grid.prototype.showColumn = function (field) {
        dews.ui.gridUtil.showColumn(this, field);
    };
    /**
     * 그리드 컬럼 숨기기 기능
     * @param field (string) 숨길 컬럼명
     */
    Grid.prototype.hideColumn = function (field) {
        dews.ui.gridUtil.hideColumn(this, field);
    };
    /**
     * 그리드 새로 고침
     */
    Grid.prototype.refresh = function () {
        this._grid.refresh();
    };
    /**
     * 그리드 프로그래스바 노출
     */
    Grid.prototype.showProgress = function () {
        dews.ui.loading.show({
            'type': 'tiny',
            'text': '데이터 로딩 중 입니다.'
        });
    };
    /**
     * 그리드 프로그래스바 종료
     */
    Grid.prototype.hideProgress = function () {
        dews.ui.loading.hide();
    };
    /**
     * 그리드 엑셀 저장
     * @param option (object)
     * target (string) 저장할 위치
     * fileName (string) 저장한 파일명
     * allPages (boolean) 전체 다운 유무 설정
     */
    Grid.prototype.saveAsExcel = function (option) {
        dews.ui.gridUtil.saveAsExcel(this, option);
    };
    /**
     * 그리드 엑셀 import
     * @param option file명, sheet명, 데이터 채우는 형식
     */
    Grid.prototype.importExcel = function (option) {
        var self = this,
            opt = {
                sheetName: 'Sheet1',        // 시트명 설정
                fillData: 'replace',        // 데이터 설정 방법
                mapping: {},                // 컬럼 매핑 설정
                result: {
                    totalCount: 0,              // 전체 데이터 갯수
                    success: {
                        count: 0,               // 변환 성공한 데이터 갯수
                        data: []                // 변환 성공한 데이터
                    },
                    fail: {
                        count: 0,               // 변환 실패한 데이터 갯수
                        data: []                // 변환 실패한 데이터
                    }
                }
            },
            deferred = $.Deferred(),
            link = dews._environments.scriptBase + 'xlsx.js';

        dews.ajax.script(link, {once: true}).done(function () {
            opt = $.extend(true, opt, option);
            // 변경된 파일 명을 설정하지 않았을 경우 취소 시킴
            if ($.type(opt.file) === 'undefined') {
                return;
            }

            var files = opt.file;
            var i, f;
            for (i = 0, f = files[i]; i != files.length; ++i) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    var data = e.target.result,
                        arr = fixdata(data),
                        workbook = XLSX.read(btoa(arr), {type: 'base64'}),
                        output = to_json(workbook);

                    self.options.dataSource.dataProvider.fillJsonData(output[opt.sheetName], {fillMode: opt.fillData});
                    if (opt.result.fail.count === opt.result.totalCount) {
                        deferred.rejectWith(self, [opt.result]);
                    } else {
                        deferred.resolveWith(self, [opt.result]);
                    }
                };
                reader.onerror = function (e) {
                    deferred.rejectWith(self, [e]);
                };
                //reader.readAsBinaryString(f);
                reader.readAsArrayBuffer(f);
            }

            function fixdata(data) {
                var o = "", l = 0, w = 10240;
                for (; l < data.byteLength / w; ++l) {
                    o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
                }
                o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
                return o;
            }

            // json 데이터로 변환
            function to_json(workbook) {
                var result = {},
                    setData,
                    roa,
                    datas = [];
                !option.titleDepth ? option.titleDepth = 1 : option.titleDepth;
                var headerSize = option.titleDepth - 1;
                var makeJson = XLSX.utils.make_json(workbook.Sheets[opt.sheetName], {header: 1});
                var header = [], data = [];


                if (option.titleDepth === 1) {
                    roa = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[opt.sheetName]);

                    result[opt.sheetName] = roa;
                } else if (option.titleDepth > 1) {
                    for (var j = 0; j <= makeJson[headerSize].length; j++) {
                        var a = option.titleDepth - 1;

                        if (makeJson[a][j] !== undefined) {
                            if (makeJson[a - 1][j] !== undefined) {
                                header.push('m_' + makeJson[a - 1][j]);
                                header.push(makeJson[a][j]);
                            } else {
                                header.push(makeJson[a][j]);
                            }
                        } else {
                            while (0 < a) {
                                header.push(makeJson[a - 1][j]);
                                a--;
                            }
                        }
                    }

                    for (var j = headerSize + 1; j < makeJson.length - headerSize; j++) {
                        var obj = {};

                        for (var i = 0; i < makeJson[j].length; i++) {
                            if (header[i]) {
                                var key = header[i].toString();

                                if (key.slice(0, 2) === 'm_') {
                                    obj[key] = undefined;
                                    makeJson[j].insert(i, undefined);
                                } else {
                                    obj[key] = makeJson[j][i];
                                }
                            }
                        }
                        data.push(obj);
                    }

                    if (data.length > 0) {
                        result[opt.sheetName] = data;
                    }
                }

                setData = result;

                Object.size = function (obj) {
                    var size = 0, key;
                    var bool = 0;

                    for (key in obj) {
                        if (obj.hasOwnProperty(key)) size++;

                        if (!obj[key]) bool++;
                    }
                    return size !== bool;
                };

                for (var i = 0; i <= setData[opt.sheetName].length - 1; i++) {
                    var rows = mapping(setData[opt.sheetName][i], setData[opt.sheetName], i);
                    var check;

                    check = Object.size(rows);

                    if (($.type(rows) === 'object' && check) || ($.type(rows) === 'boolean' && rows)) {
                        if ($.type(rows) === 'object' || ($.type(rows) === 'boolean' && rows)) {
                            datas.push(rows);
                            opt.result.success.data.push(result[opt.sheetName][i]);
                            opt.result.success.count++;
                        } else if ($.type(rows) === 'boolean' && !rows) {
                            opt.result.fail.data.push(result[opt.sheetName][i]);
                            opt.result.fail.count++;
                        }
                    }
                }
                opt.result.totalCount = setData[opt.sheetName].length;
                setData[opt.sheetName] = datas;

                return setData;
            }

            // 데이터 변환후 각 행에 대해 설정
            function mapping(row, total, index) {
                var data = {},
                    originRow = row;
                // 매핑 사용
                if (Object.keys(opt.mapping).length === 0) {
                    setMapping(self.options.columns);
                }
                // Excel 데이터 - > 데이터 변환
                for (var j = 0; j <= Object.keys(opt.mapping).length - 1; j++) {
                    data[Object.keys(opt.mapping)[j]] = originRow[opt.mapping[Object.keys(opt.mapping)[j]]];
                }

                // 변환기 사용시
                if ($.type(opt.convertor) === 'function') {
                    data = opt.convertor.call(self, data);
                }
                // 검증기 사용시
                if ($.type(opt.validator) === 'function') {
                    var validte = opt.validator.call(self, data);
                    if ($.type(validte) === 'boolean' && !validte) {
                        return false;
                    }

                }
                // 중복기 사용시
                if ($.type(opt.dupCheck) === 'array' && opt.dupCheck.length !== 0) {
                    var keys = opt.dupCheck,
                        totals = total.slice(),
                        dupData = [];

                    totals.filter(function (row) {
                        var dupCount = 0;
                        $.each(keys, function (idx, value) {
                            if (data[value] === row[opt.mapping[value]]) {
                                dupCount++;
                            }
                        });
                        // 전체다 중복되는 경우 설정
                        if (dupCount === opt.dupCheck.length) {
                            dupData.push(row);
                        }
                    });

                    if (dupData.length > 0 && dupData[0] !== row) {
                        return false;
                    }
                }
                // 실패한 데이터가 있으면 반환을 안합니다.
                if (Object.keys(data).length !== 0) {
                    return data;
                }
            }

            // 그리드 컬럼을 사용한 경우
            function setMapping(col) {
                var columns = col;

                for (var k = 0; k <= columns.length - 1; k++) {
                    if ($.type(columns[k].field) !== 'undefined') {
                        opt.mapping[columns[k].field] = columns[k].title;
                    }

                    if (columns[k].columns) {
                        setMapping(columns[k].columns);
                    }
                }
            }

            // 데이터 중복 검사기
        });

        return deferred;
    };
    /**
     * 그리드 컬럼 설정
     * @param columns (object) 그리드에 설정할 컬럼
     */
    Grid.prototype.setColumns = function (columns) {
        var self = this,
            result = customizingColumn(columns, self.options, self);

        dews.ui.gridUtil.setColumns(self, result);
    };
    /**
     * 그리드 특정 행 선택 및 현재 행 반환
     * @param row (number) 포커스를 설정할 그리드 행의 index 값
     * @param field (string) 포커스를 설정할 그리드 행의 필드명
     * @returns {number} 현재 포커스 된 행의 index
     */
    Grid.prototype.select = function (row, field) {
        var self = this,
            column = self._grid.getCurrent().column;

        if (row !== undefined) {
            if ($.type(field) !== 'undefined') {
                column = field;
            }
            self._grid.setCurrent({
                itemIndex: row,
                column: column,
                dataRow: row
            });
        } else {
            if (self.options.dataBounding && self.options.dataSource.data().length !== 0) {
                return 0;
            } else {
                return self._grid.getCurrent().itemIndex;
            }
        }
    };
    /**
     * 그리드 내 정렬 설정
     * @param options (object)
     * field (string) 정렬을 설정할 필드명
     * dir (string) 오름차순, 내림차순 설정
     */
    Grid.prototype.sort = function (options) {
        dews.ui.gridUtil.sort(this, options);
    };
    /**
     * 그리드 컨텍스트 메뉴 설정
     * @param options (object)
     * excelDownload 엑셀 다운로드 설정 유무
     * items (array)
     *      text (string) 컨텍스트 메뉴에 나올 텍스트 명
     *      handler (function) 컨텍스트 메뉴 클릭 시 실행 함수
     *      display (function) 컨텍스트 메뉴 행에 따른 노출 여부
     */
    Grid.prototype.setContextMenu = function (options) {
        dews.ui.gridUtil.setContextMenu(this, options);
    };
    /**
     * 그리드 데이터소스 설정
     * @param datasource (dataSource) 설정할 그리드 데이터소스 객체
     */
    Grid.prototype.setDataSource = function (datasource) {
        var self = this;

        self.options.dataSource = datasource;
        self.options = customizingColumn(self.options.columns, self.options, self);
        delete self.options.fieldIndex;
        self.options.dataSource.dataProvider._dp.setRows = setRow(self, self.options.dataSource.dataProvider._dp.setRows);
        self._grid.setDataProvider(this.options.dataSource.dataProvider);
        self._grid.setColumns(self.options.columns);
        self._grid.setHeader({height: self.options.maxDepth * self.options.header.minHeight});
        if (self.options.grouping) {
            self.options.display.rowHeight = self.options.display.minHeight * self.options.maxGroupCol;
        }
        // 그리드 그룹 지정 시,
        if (this.options.dataSource && this.options.dataSource.options.group) {
            setGroup(this._grid, this.options);
        }

        this._grid.setOptions(this.options);
    };
    /**
     * 그리드 focus 설정
     */
    Grid.prototype.setFocus = function () {
        dews.ui.gridUtil.setFocus(this);
    };
    /**
     * 그리드의 행 수정
     * @param row (index) 수정할 행의 index
     * @param data (object) 수정할 행의 데이터
     */
    Grid.prototype.updateRow = function (row, data) {
        dews.ui.gridUtil.updateRow(this, row, data);
    };
    /**
     * 그리드의 옵션 설정
     * @param options (object)
     */
    Grid.prototype.setOptions = function (options) {
        var self = this;

        options = $.extend(true, {}, self.options, options);
        self.options = getOptions(self, options);
        self._grid.setOptions(self.options);
        self.columns = {};
        dews.ui.gridUtil._setColumns(self, self.options.columns);
    };
    /**
     * 그리드 이벤트 추가
     */
    Grid.prototype.on = function () {
        var self = this;

        self.$element.on.apply(self.$element, arguments);
    };
    /**
     * 그리드 이벤트 해제
     */
    Grid.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'all') {
            self.$element.off();
        } else {
            self.$element.off.apply(self.$element, arguments);
        }
    };
    /**
     * 그리드 값 찾기 검색
     * @param options
     * fields (array) 검색할 fields
     * value (string) 검색할 키워드
     * startIndex (number) n번째 행부터 검색
     * wrap (boolean) 해당 글자 없으면 다시 검색 유무 설정
     * partialMatch (boolean) 문구 완벽 일치 혹은 일치 설정
     * caseSensitive (boolean) 대소문자 구분 설정
     */
    Grid.prototype.searchCell = function (options) {
        var self = this, opt = {
            select: true,
            partialMatch: true,
            caseMatch: false
        };
        if ($.type(options) === 'undefined') {
            return;
        }
        opt.startItemIndex = options.startIndex === undefined ? 0 : options.startIndex;
        opt = $.extend(true, opt, options);
        opt.caseSensitive = opt.caseMatch;

        if (self._grid.searchCell(opt)) {
            return self._grid.searchCell(opt).itemIndex;
        }
    };
    /**
     * 현재 focus 된 컬럼의 field명 반환
     */
    Grid.prototype.getCurrentColumn = function () {
        return this._grid.getCurrent().column;
    };
    /**
     * 지정한 행의 상태값 반환
     * @param index (number) 지정한 행의 index
     * @returns {string} 지정한 행의 상태 값 반환
     */
    Grid.prototype.getRowState = function (index) {
        return dews.ui.gridUtil.getRowState(this, index);
    };
    /**
     * 그리드 컬럼 정보 반환
     * @returns {object} 그리드 컬럼 정보
     */
    Grid.prototype.getColumns = function () {
        return this._grid.getColumns();
    };
    /**
     * 마스터 디테일 구조 설정
     * @param target (object) 디테일 그리드 객체
     */
    Grid.prototype.setDetail = function (target) {
        dews.ui.gridUtil.setDetail(this, target);
    };
    /**
     * 마스터 디테일 구조 설정
     * @param detail (object) 디테일 그리드 객체
     */
    Grid.prototype.setDetailGrid = function (detailGrid) {
        this.setDetail(detailGrid);
    };
    /**
     * 그리드 validate 체크
     * @param {boolean} row 변경 할 경우에 검증 유무
     * @returns {{result: boolean, fields: Array}}
     * result (boolean) validate 체크 결과 값
     * fields (array) validate 체크 결과 후 안된 부분에 대한 field, 행 index 반환
     */
    Grid.prototype.validate = function (mode) {
        var self = this,
            validate = {
                result: true,
                fields: []
            },
            gridDatas = self.options.dataSource.data(),
            required = [],
            columns;

        for (var i = 0; i < self._grid.getColumnNames().length; i += 1) {
            columns = self.columns[self._grid.getColumnNames()[i]];

            if (columns && $.type(columns.field) !== 'undefined') {
                if (columns.attributes && columns.attributes.class === 'required') {
                    required.push(columns.field);
                }
            }
        }

        if (mode) {
            for (var d = 0; d < gridDatas.length; d += 1) {
                if (self.getRowState(d) === 'updated' || self.getRowState(d) === 'added') {
                    var rowData = self.dataItem(d);
                    for (var j = 0; j < required.length; j += 1) {
                        if ($.type(rowData[required[j]]) === 'number' && rowData[required[j]] === 0) {
                            // 숫자 타입이고 값이 0일때 validate에 들어가는것을 막아줌
                        } else if (!rowData[required[j]]) {
                            validate.result = false;
                            validate.fields.push({columnName: required[j], rowIndex: d, validate: 'required'});
                        }
                    }
                }
            }
        } else {
            for (var d = 0; d < gridDatas.length; d += 1) {
                var rowData = self.dataItem(d);
                for (var j = 0; j < required.length; j += 1) {
                    if ($.type(rowData[required[j]]) === 'number' && rowData[required[j]] === 0) {
                        // 숫자 타입이고 값이 0일때 validate에 들어가는것을 막아줌
                    } else if (!rowData[required[j]]) {
                        validate.result = false;
                        validate.fields.push({columnName: required[j], rowIndex: d, validate: 'required'});
                    }
                }
            }
        }
        return validate;
    };
    /**
     * 그리드 색상 적용
     * @param row (array || index) 색상을 적용할 행의 index
     * @param style (object) 적용할 스타일
     */
    Grid.prototype.setRowStyle = function (row, style) {
        dews.ui.gridUtil.setRowStyle(this, row, style);
    };
    /**
     * 그리드 색상 설정
     * @param styles 설절항 스타일 json
     */
    Grid.prototype.setStyles = function (styles) {
        var self = this;

        self.options.styles = styles;
        self.options = setStyles(self._grid, self.options);
        self._grid.setOptions(self.options);
    };
    /**
     * 그리드 행 색상 적용 취소
     * @param row (number || array) 그리드 색상을 해제할 행의 index
     */
    Grid.prototype.resetRowStyle = function (row) {
        dews.ui.gridUtil.resetRowStyle(this, row);
    };
    /**
     * 그리드 행에서 현재 지정된 셀이 마지막으로 수정 가능한지 검사
     * @returns {boolean} 수정 가능한 마지막 셀인지에 대한 유무 반환
     */
    Grid.prototype.lastEditCell = function () {
        var self = this,
            current = self._grid.getCurrent(),
            displayColumn = self.options.displayColumns,
            displayIndex = self._grid.getColumnProperty(current.column, 'displayIndex'),
            value = false,
            editParams = {
                grid: self,
                row: {
                    index: current.itemIndex,
                    data: self.dataItem(current.itemIndex)
                },
                cell: {
                    field: ''
                }
            };

        return dews.ui.gridUtil.lastEditCell(self, displayColumn, displayIndex, value, editParams);
    };
    /**
     * 그리드 내 해당 footer 연산 값을 얻을수 있습니다.
     * @param field 연산을 하고자 하는 field 명
     * @param cal 연산을 하고자 하는 결과 (sum, avg, count, max, min)
     */
    Grid.prototype.getSummary = function (field, cal) {
        var self = this,
            calculate = cal || 'SUM';

        return self._grid.getSummary(field, calculate);
    };
    /**
     * 행 상태 값을 변경합니다.
     * @param index 변경할 행의 index
     * @param state added, updated, deleted, none 중에 선택해서 값을 설정
     */
    Grid.prototype.setRowState = function (index, state) {
        dews.ui.gridUtil.setRowState(this, index, state);
    };
    /**
     * 그리드 높이 설정
     * @param height 설정할 높이
     */
    Grid.prototype.setHeight = function (height) {
        dews.ui.gridUtil.setHeight(this, height);
    };
    /**
     * 그리드 maxLength 설정
     * @param field 컬럼명
     * @param length maxLength
     */
    Grid.prototype.setMaxLength = function (field, length) {
        dews.ui.gridUtil.setMaxLength(this, field, length);
    };
    /**
     * 그리드 헤더 체크바 노출 여부 설정
     * @param visible 노출 여부 설정
     */
    Grid.prototype.setHeaderCheckVisible = function (visible) {
        dews.ui.gridUtil.setHeaderCheckVisible(this, visible);
    };
    /**
     * 그리드에서 부모 데이터 컨트롤의 데이터 반환
     * @return {*} 부모 데이터 컨트롤의 데이터
     */
    Grid.prototype.getParentData = function () {
        return dews.ui.gridUtil.getParentData(this);
    };
    /**
     * 그리드에서 자식 데이터 컨트롤의 데이터 반환
     * @param index 가져올 행의 자식 데이터의 인덱스
     * @param gridId 가져올 그리드 아이디 설정
     * @return {*} 가져올 자식 데이터
     */
    Grid.prototype.getChildData = function (index, gridId) {
        return dews.ui.gridUtil.getChildData(this, index, gridId);
    };
    /**
     * 그리드 엑셀 업로드 후 다운로드 가능한 URL 반환
     * @param menuName 메뉴 페이지 명
     * @private
     */
    Grid.prototype._getExcelUrlForPrint = function (menuName) {
        return dews.ui.gridUtil._getExcelUrlForPrint(this, menuName);
    };

    Grid.prototype._bindEvent = function () {
        var self = this;
        // 그리드 내 이미지 버튼 클릭시 발생하는 함수
        self._grid.onImageButtonClicked = function (grid, itemIndex, column, buttonIndex, name) {
            var parameter = {
                grid: self,
                row: {
                    index: itemIndex,
                    data: self.dataItem(itemIndex)
                },
                cell: {
                    field: column.fieldName,
                    data: self.getCellValue(itemIndex, column.fieldName)
                }
            };

            dews.ui.gridUtil.onImageButtonClicked(self, itemIndex, column, parameter);
        };
        // 그리드 내 코드 피커 콜백 함수
        self.options._gridCallback = function (data, column, index) {
            dews.ui.gridUtil._gridCallback(self, data, column, index);
        };
        // 링크 포맷 사용, 링크 클릭 시 발생하는 이벤트
        self._grid.onLinkableCellClicked = function (grid, index, url) {
            var linkUrl = self.options.dataSource.options.data[index.dataRow][self.columns[index.column].formats.urlField],
                parameter = {
                    grid: self,
                    row: {
                        index: index.itemIndex,
                        data: self.dataItem(index.itemIndex)
                    },
                    cell: {
                        field: index.column,
                        data: self.getCellValue(index.itemIndex, index.column)
                    }
                };
            dews.ui.gridUtil.onLinkableCellClicked(self, index, linkUrl, parameter);
        };
        // 에디터 수정 발생 시 textAlign 설정 하는 이벤트
        self._grid.onShowEditor = function (id, index) {
            var parameter = {
                grid: self,
                row: {
                    index: index.dataRow === -1 ? index.itemIndex : index.dataRow
                },
                cell: {
                    field: index.fieldName
                }
            };

            window.addEventListener('scroll', windowScroll);
            dews.ui.gridUtil.onShowEditor(self, id, index, parameter);
        };
        // 에디터 수정 종료 시 발생하는 이벤트
        self._grid.onHideEditor = function (grid, index) {
            if (!self.options.commit) {
                dews.ui.gridUtil.onHideEditor(self, grid, index);
                window.removeEventListener('scroll', windowScroll);
            }
            self.options.commit = false;
        };
        // 체크 포맷 사용, 컬럼 헤더 체크 변경시 발생하는 이벤트
        self._grid.onColumnCheckedChanged = function (grid, column, check) {
            var i = 0, data = self.options.dataSource.dataProvider;
            if (self.options.headerClick) {
                if (check) {
                    for (i = 0; i < data.getRowCount(); i++) {
                        grid.setValue(i, column.fieldName, 'checked');
                        grid.commit(true);
                    }
                } else {
                    for (i = 0; i < data.getRowCount(); i++) {
                        grid.setValue(i, column.fieldName, 'unchecked');
                        grid.commit(true);
                    }
                }
            }
            self.options.headerClick = true;
        };
        // 셀 수정 후 발생하는 이벤트
        self._grid.onCellEdited = function (grid, itemIndex, dataRow, field) {
            var fields = self.options.dataSource.dataProvider.getFieldName(field);
            var column = dews.ui.gridUtil.findColumn(self.options.columns, fields);

            // 그리드 시간 포맷 수정시 값에 맞지 않는 경우 되돌리기
            if (column && column.editor && column.editor.type.toLowerCase() === 'time') {
                if (grid.getEditingItem() && grid.getEditingItem().values[column.fieldName]) {
                    if (!column.displayRegExp.test(grid.getEditingItem().values[column.fieldName])) {
                        self.setCellValue(dataRow, column.fieldName, '');
                    }
                }
            }

            self.options.commit = true;
            grid.commit(true);
            self.editable = false;
            // 그리드 컬럼 내 특정 값에 따라 색상이 변경되는 경우
            if (column && column.style && column.cellDynamic) {
                var styles = {}, styleParameter = {
                    grid: self,
                    row: {
                        index: dataRow,
                        data: self.dataItem(dataRow)
                    }
                }, style;

                // 정렬시 변경되어야 할 부
                if ($.type(grid.getSortedFields() !== 'null')) {
                    styleParameter.row.index = itemIndex;
                    styleParameter.row.data = self.dataItem(itemIndex);
                }

                style = column.style.call(self, styleParameter);

                if (style) {
                    if (style.color) {
                        styles.foreground = style.color;
                    }
                    if (style.textAlign) {
                        switch (style.textAlign) {
                            case 'left':
                                styles.textAlignment = 'near';
                                break;
                            case 'right':
                                styles.textAlignment = 'far';
                                break;
                            case 'center':
                                styles.textAlignment = 'center';
                                break;
                        }
                    }
                    if (style.verticalAlign) {
                        switch (style.verticalAlign.toLowerCase()) {
                            case 'top' :
                                styles.lineAlignment = 'near';
                                break;
                            case 'bottom':
                                styles.lineAlignment = 'far';
                                break;
                            case 'middle':
                                styles.lineAlignment = 'center';
                                break;
                        }
                    }

                    if (style.icon) {
                        var image;
                        if (self.options.iconImagelist) {
                            image = self.options.iconImagelist;
                        } else {
                            image = new RealGridJS.ImageList('iconImage', '');
                        }

                        if (self.options.images.indexOf(style.icon.image) === -1) {
                            self.options.images.push(style.icon.image);
                            image.addUrls(self.options.images);
                            self._grid.registerImageList(image);
                            self._grid.setColumnProperty(self._grid.columnByField(column.field), "imageList", "iconImage");
                            self._grid.setColumnProperty(self._grid.columnByField(column.field), "renderer", {type: "icon"});
                            self.options.iconImagelist = image;

                            column.cellDynamic.push({
                                criteria: "(values['" + column.field + "'] = '" + self._grid.getValue(dataRow, column.field) + "')",
                                styles: 'iconIndex=' + (self.options.images.length - 1) + ';iconOffset=0;iconPadding=5;iconAlignment=center;iconLocation=left'
                            });
                        }
                    }

                    styles = $.extend(true, styles, style);
                    column.cellDynamic.push({
                        criteria: "(values['" + self.options.dataSource.dataProvider.getFieldName(field) + "'] = '" + self._grid.getValue(dataRow, self.options.dataSource.dataProvider.getFieldName(field)) + "')",
                        styles: styles
                    });
                    self._grid.setColumnProperty(self._grid.columnByField(self.options.dataSource.dataProvider.getFieldName(field)), 'dynamicStyles', column.cellDynamic);
                }
            }
            // 그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
            if (column && column.editor && column.editor.type.toLowerCase() === 'dropdown' && $.type(column.editor.dataSource) === 'function') {
                var col = self._grid.columnByField(column.fieldName),
                    e = {
                        grid: self,
                        row: {
                            data: self.dataItem(dataRow),
                            index: dataRow
                        }
                    },
                    datasource = column.editor.dataSource.call(self, e);
                col.values = [];
                col.labels = [];
                // 데이터 소스가 undefined 또는 데이터 유무 체크
                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                    var index = {
                        itemIndex: itemIndex,
                        dataRow: dataRow,
                        fieldIndex: field,
                        column: column.field,
                        fieldName: column.field
                    }, editResult = {
                        text: '',
                        value: self.getCellValue(dataRow, column.field)
                    };
                    // 데이터소스 labels, values 설정
                    for (var l = 0; l < datasource.transport.data.length; l += 1) {
                        col.values.push(datasource.transport.data[l][column.editor.dataValueField]);
                        col.labels.push(datasource.transport.data[l][column.editor.dataTextField]);
                        if (datasource.transport.data[l][column.editor.dataValueField] === editResult.value) {
                            editResult.text = datasource.transport.data[l][column.editor.dataTextField];
                        }
                    }
                    col.labelField = column.editor.dataTextField;
                    col.lookupDisplay = true;
                    self._grid.setColumn(col);

                    self._grid.onGetEditValue.call(self, self._grid, index, editResult);
                }
            }

            var event, parameter, subSave = true;

            if ($.type(arguments[4]) === 'boolean') {
                subSave = arguments[4];
            }

            parameter = {
                grid: self,
                row: {
                    index: itemIndex,
                    data: self.dataItem(itemIndex)
                },
                cell: {
                    field: $.type(column) === 'undefined' ? fields : column.field
                }
            };

            if (subSave) {
                event = new $.Event('save', parameter);
                self.$element.trigger(event);
            }
        };
        // 그리드 현재 선택된 로우가 변경 되었을 경우 실행
        self._grid.onCurrentRowChanged = function (grid, oldIndex, newIndex) {
            // 그리드 상하단 그리드에서 상단 그리드 change 이벤트에서 하단 그리드 datasource.read() 할때 하단 그리드 change 이벤트 발생이 안되는 문제 해결
            if (oldIndex === newIndex) {
                self._grid.onCurrentChanging.call(self, self._grid, self._grid.getCurrent(), self._grid.getCurrent());
                self.options.rowChange = true;
                self._grid.onCurrentChanged.call(self, self._grid, self._grid.getCurrent());
            }
        };
        // 그리드 이전 선택한 행 적용
        self._grid.onCurrentChanging = function (grid, oldIndex, newIndex) {
            var dataRow = newIndex.dataRow;
            self.options.rowChange = false;
            // 행이 변경됬는지 확인
            if (newIndex.dataRow === -1 ? oldIndex.itemIndex !== newIndex.itemIndex : oldIndex.dataRow !== newIndex.dataRow) {
                self.options.rowChange = true;
            }
            self.options.previousData = self.dataItem(oldIndex.dataRow);
            self.options.previous = oldIndex;

            // 그리드 포커스 설정
            if (oldIndex.dataRow !== -1 && self.focused) {
                // 코드피커 호출 시 그리드에 포커스가 가지 않고 다이얼로그 페이지에 포커스가 지정되는 코드로 주석 처리
                // if (dews.ui.dialogPage && dews.ui.dialogPage.$content && dews.ui.dialogPage.$content.find('.dews-ui-grid').length !== 0) {
                self.setFocus();
                // }
            }

            if (newIndex.dataRow === -1) {
                if (self._grid.getItemState(newIndex.itemIndex) === 'appending') {
                    self._grid.commit(true);
                    dataRow = newIndex.itemIndex;
                }
            }

            var columns = self.columns[newIndex.fieldName];
            // 그리드 컬럼에서 특정 값에 따라 수정 유무 적용
            if (grid.getColumnProperty(newIndex.column, 'editor') && newIndex.fieldIndex !== -1
                && self.dataItem(newIndex.itemIndex)) {
                if (columns && columns.editor && columns.editor.editable && self.options.dataSource) {
                    var editor, visible, parameter = {
                        grid: self,
                        row: {
                            index: dataRow,
                            data: self._grid.getValues(newIndex.dataRow === -1 ? newIndex.itemIndex : newIndex.dataRow)
                        },
                        cell: {
                            field: newIndex.fieldName
                        }
                    };
                    // 소팅 여부 확인
                    if ($.type(grid.getSortedFields()) !== 'null') {
                        parameter.row.index = newIndex.itemIndex;
                        parameter.row.data = self._grid.getValues(newIndex.itemIndex);
                    }
                    if ($.type(columns.editor.editable) === 'function') {
                        editor = columns.editor.editable.call(self, parameter);
                    } else {
                        editor = columns.editor.editable;
                    }
                    columns.editor.editResult = editor;

                    if (columns.editor.type.toLowerCase() === 'codepicker') {
                        visible = 'visible';
                        if (!editor) {
                            visible = 'hidden';
                        }
                        if (!self.options.edit.editable) {
                            visible = 'hidden';
                        }
                        columns.buttonVisibility = visible;
                        self._grid.setColumnProperty(columns.name, 'buttonVisibility', visible);
                    }

                    if (columns.editor.type.toLowerCase() === 'zipcodepicker') {
                        visible = 'visible';
                        if (!editor) {
                            visible = 'hidden';
                        }
                        if (!self.options.edit.editable) {
                            visible = 'hidden';
                        }
                        columns.buttonVisibility = visible;
                        self._grid.setColumnProperty(columns.name, 'buttonVisibility', visible);
                    }

                    if (columns.editor.type.toLowerCase() === 'check') {
                        var options = self._grid.getColumnProperty(columns.name, 'renderer');
                        self._grid.setColumnProperty(columns.name, 'renderer', $.extend(true, options, {editable: editor}));
                    }

                    if (!editor) {
                        self._grid.addCellStyle('editable', {
                            editable: false
                        }, true);
                        self._grid.setCellStyles(newIndex.dataRow, newIndex.fieldName, 'editable');
                    }
                }
            }
            // 그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
            if (columns && columns.editor && columns.editor.type.toLowerCase() === 'dropdown' && $.type(columns.editor.dataSource) === 'function'
                && self.dataItem(newIndex.itemIndex)) {
                var col = self._grid.columnByField(columns.fieldName),
                    e = {
                        grid: self,
                        row: {
                            index: newIndex.dataRow,
                            data: self.dataItem(newIndex.dataRow)
                        }
                    },
                    datasource = columns.editor.dataSource.call(self, e);
                col.values = [];
                col.labels = [];

                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                    for (var l = 0; l < datasource.transport.data.length; l += 1) {
                        col.values.push(datasource.transport.data[l][columns.editor.dataValueField]);
                        col.labels.push(datasource.transport.data[l][columns.editor.dataTextField]);
                    }
                    col.labelField = columns.editor.dataTextField;
                    col.lookupDisplay = true;
                    self._grid.setColumn(col);
                }
            }
            // dataBound 이벤트
            if (self.options.dataBounding) {
                var column = self.options.columns,
                    dataBoundParameter = {
                        grid: self,
                        row: {
                            data: self.options.dataSource.data()
                        },
                        column: column
                    },
                    dataBoundEvent;

                dataBoundEvent = new $.Event('dataBound', dataBoundParameter);
                self.$element.trigger(dataBoundEvent);
                delete self.options.dataBounding;
            }

            if ($.type(self.options.previousData) === 'undefined') {
                self.options.previousData = '';
            }

            if ($.type(self.options.previous) === 'undefined') {
                self.options.previous = newIndex;
            }
            var nIndex = newIndex.dataRow;
            if (self._grid.getGroupFields() && self._grid.getGroupFields().length !== 0) {
                nIndex = newIndex.itemIndex;
            }

            if (self.dataItem(nIndex)) {
                // changing 이벤트
                var changingParameter = {
                    grid: self,
                    row: {
                        next: {
                            index: newIndex.dataRow,
                            data: self.dataItem(nIndex)
                        },
                        isChange: self.options.rowChange,
                        index: oldIndex.dataRow !== -1 ? oldIndex.dataRow : oldIndex.itemIndex,
                        data: self.dataItem(oldIndex.dataRow)
                    },
                    cell: {
                        next: {
                            field: newIndex.fieldName,
                            data: self._grid.getValue(nIndex, newIndex.fieldName),
                        },
                        field: oldIndex.fieldName
                    }
                };
                if ($.type(self._grid.getGroupFields()) === 'null' || self._grid.getGroupFields().length === 0) {
                    changingParameter.cell.data = self._grid.getValue(oldIndex.dataRow, oldIndex.fieldName);
                }
                // 소팅 여부 확인
                if ($.type(grid.getSortedFields()) !== 'null') {
                    changingParameter.row.next.index = newIndex.itemIndex;
                    changingParameter.row.next.data = self.dataItem(newIndex.itemIndex);
                    changingParameter.row.index = oldIndex.itemIndex;
                    changingParameter.row.data = self.dataItem(oldIndex.itemIndex);
                    changingParameter.cell.next.data = self._grid.getValue(newIndex.itemIndex, newIndex.fieldName);
                    if (oldIndex.itemIndex !== -1 && oldIndex.dataRow === -1) {
                        changingParameter.cell.data = undefined;
                    } else {
                        changingParameter.cell.data = self._grid.getValue(oldIndex.itemIndex, oldIndex.fieldName);
                    }
                }

                var event = new $.Event('changing', changingParameter);
                self.$element.trigger(event);

                if (event.isDefaultPrevented()) {
                    return false;
                }
            }
        };
        // 그리드의 선택한 행이 변경 됬을 때 발생하는 이벤트
        self._grid.onCurrentChanged = function (grid, newIndex) {
            var index = newIndex.dataRow;
            // rowAdd 이벤트
            if (newIndex.itemIndex !== -1 && self.options.add) {
                if (self.options.dataSource) {
                    var addParameter, addEvent;
                    addParameter = {
                        grid: self,
                        row: {
                            index: $.type(self.options._addParams) !== 'undefined' ? self.options._addParams : self.options.dataSource.data().length,
                            data: self.dataItem(self.select())
                        }
                    };

                    addEvent = new $.Event('rowAdd', addParameter);
                    self.$element.trigger(addEvent);
                }

                delete self.options.add;
            }

            if (self.dataItem(newIndex.itemIndex)) {
                // change 이벤트
                var parameter = {
                    grid: self,
                    row: {
                        index: newIndex.itemIndex,
                        data: self.dataItem(newIndex.itemIndex),
                        isChange: self.options.rowChange,
                        previous: {
                            index: self.options.previous.dataRow !== -1 ? self.options.previous.dataRow : self.options.previous.itemIndex,
                            data: self.dataItem(self.options.previous.dataRow)
                        }
                    },
                    cell: {
                        field: newIndex.fieldName,
                        data: self._grid.getValue(newIndex.itemIndex, newIndex.fieldName),
                        previous: {
                            field: self.options.previous.fieldName
                        }
                    }
                };

                if ($.type(self._grid.getGroupFields()) === 'null' || self._grid.getGroupFields().length === 0) {
                    parameter.cell.previous.data = self._grid.getValue(self.options.previous.dataRow, self.options.previous.fieldName);
                }
                // 소팅 여부 확인
                if ($.type(grid.getSortedFields()) !== 'null') {
                    parameter.row.index = newIndex.itemIndex;
                    parameter.row.data = self.dataItem(newIndex.itemIndex);
                    parameter.row.previous.index = self.options.previous.itemIndex;
                    parameter.row.previous.data = self.dataItem(self.options.previous.itemIndex);
                    parameter.cell.data = self._grid.getValue(newIndex.itemIndex, newIndex.fieldName);
                    if (self.options.previous.itemIndex !== -1 && self.options.previous.dataRow === -1) {
                        parameter.cell.previous.data = self._grid.getValue(self.options.previous.dataRow, self.options.previous.fieldName);
                    } else {
                        parameter.cell.previous.data = self._grid.getValue(self.options.previous.itemIndex, self.options.previous.fieldName);
                    }
                }

                var event = new $.Event('change', parameter);
                self.$element.trigger(event);
            }

            if (self._grid.getCurrent().dataRow === -1) {
                if (self._grid.getItemState(newIndex.itemIndex) === 'appending') {
                    self._grid.commit(true);
                    index = self._grid.getCurrent().dataRow;
                } else {
                    self._grid.removeCellStyles(["selection"]);
                    return;
                }
            }
            // 그리드 포커스 설정 시 색상 변경
            if (self._grid.getSelectOptions().style !== 'none') {
                var ids = ["selection"];
                self._grid.removeCellStyles(ids);
                if (self._grid.getCellStyle(index, newIndex.fieldIndex) === 'editable') {
                    self._grid.addCellStyle('selection', {
                        editable: false,
                        background: self.options.gridStyle.selection.focusBackgroundColor
                    }, true);
                    self._grid.setCellStyle(index, newIndex.fieldIndex, "selection");
                } else {
                    self._grid.addCellStyle("selection", {
                        background: self.options.gridStyle.selection.focusBackgroundColor
                    }, true);
                    self._grid.setCellStyle(index, newIndex.fieldIndex, "selection");
                }
            }

            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && newIndex.column) {
                    dews.ui.page.focusGuideItem('#' + newIndex.column);
                }
            }


            // 드롭다운리스트에 포커스가 들어왔을 때, 자동으로 항목을 열지 말지 결정
            var column = self.columns[newIndex.fieldName];
            if (column && column.editor) {
                if (column.editor.type.toLowerCase() === 'dropdown' && column.editor.editResult && column.editor.autoOpen === true) {
                    self.editCell();
                    self._grid._gv._editController._editor.dropDown();
                    window.event.stopPropagation();
                    window.event.preventDefault();
                }
            }

        };
        // 그리드의 validation check 이벤트
        self._grid.onValidateColumn = function (grid, column, inserting, value) {
            var event, parameter = {
                grid: self,
                cell: {
                    field: column.fieldName,
                    data: value
                },
                row: {
                    index: self._grid.getCurrent().itemIndex
                }
            };

            if (column.fieldName === grid.getCurrent().fieldName) {
                event = new $.Event('validate', parameter);
                self.$element.trigger(event);
            }
        };
        // 그리드 contextMenu 메뉴 출력 이벤트
        self._grid.onContextMenuPopup = function (grid, x, y, elementName) {
            if (elementName === 'DataCell' && self.options.dataSource) {
                var currentCell = grid.mouseToIndex(x, y),
                    parameter = {
                        grid: self,
                        row: {
                            index: currentCell.dataRow,
                            data: self.dataItem(currentCell.dataRow)
                        },
                        cell: {
                            field: currentCell.fieldName,
                            data: grid.getValue(currentCell.dataRow, currentCell.fieldName)
                        }
                    };
                dews.ui.gridUtil.onContextMenuPopup(self, currentCell, parameter);
            } else {
                return false;
            }
        };
        // 그리드 contextMenu click 이벤트
        self._grid.onContextMenuItemClicked = function (grid, label, index) {
            if (self.options.dataSource) {
                var parameter = {
                    grid: self,
                    row: {
                        index: index.dataRow,
                        data: self.options.dataSource.at(self._grid.getValues(index.dataRow).__rowId)
                    },
                    cell: {
                        field: index.fieldName,
                        data: grid.getValue(index.dataRow, index.fieldName)
                    }
                };

                dews.ui.gridUtil.onContextMenuItemClicked(self, index, label, parameter);
            }
        };
        // 그리드 체크바 클릭시 발생하는 이벤트
        self._grid.onItemChecked = function (grid, itemIndex, checked) {
            var event, parameter = {
                grid: self,
                row: {
                    index: itemIndex,
                    data: self.dataItem(itemIndex)
                },
                cell: {
                    isClicked: checked,
                    header: {
                        isClicked: false
                    }
                }
            };

            event = new $.Event('selected', parameter);
            self.$element.trigger(event);
        };
        // 그리드 체크바 헤더 클릭시 발생하는 이벤트
        self._grid.onItemAllChecked = function (grid, checked) {
            var event, parameter = {
                grid: self,
                row: {
                    index: self.getCheckedIndex(),
                    data: self.dataItem(self.getCheckedIndex())
                },
                cell: {
                    isClicked: checked,
                    header: {
                        isClicked: true
                    }
                }
            };

            event = new $.Event('selected', parameter);
            self.$element.trigger(event);
        };
        // 그리드 드롭다운리스트 데이터 소스 2개 사용시
        self._grid.onGetEditValue = function (grid, index, editResult) {
            dews.ui.gridUtil.onGetEditValue(self, index, editResult);
        };
        // 그리드 셀 클릭 이벤트
        self._grid.onDataCellClicked = function (grid, index) {
            var parameter = {
                grid: self,
                row: {
                    index: index.itemIndex,
                    data: self.dataItem(index.itemIndex)
                },
                cell: {
                    field: index.fieldName,
                    data: self.getCellValue(index.itemIndex, index.fieldName)
                }
            };

            var event = new $.Event('clicked', parameter);
            self.$element.trigger(event);
        };
        // 그리드 셀 더블 클릭 이벤트
        self._grid.onDataCellDblClicked = function (grid, index) {
            var dblParameter = {
                grid: self,
                row: {
                    index: index.itemIndex,
                    data: self.dataItem(index.itemIndex)
                },
                cell: {
                    field: index.fieldName,
                    data: self.getCellValue(index.itemIndex, index.fieldName)
                }
            };

            var dblEvent = new $.Event('dblClicked', dblParameter);
            self.$element.trigger(dblEvent);
        };
        // 그리드 키보드 이벤트
        self._grid.onKeyDown = function (grid, key, ctrl, shift, alt) {
            var parameter = {
                    grid: self,
                    keyCode: key,
                    row: {
                        index: self._grid.getCurrent().itemIndex
                    },
                    cell: {
                        field: self._grid.getCurrent().column
                    },
                    ctrl: ctrl,
                    shift: shift,
                    alt: alt
                },
                event = $.Event('keyDown', parameter);

            self.$element.trigger(event);

            if (event.isDefaultPrevented()) {
                return false;
            }
            // 스페이스 바로 그리드 체크바 체크 설정
            if (self._grid.getCheckBar().visible && key === 32) {
                if (self._grid.isCheckedRow(self.select())) {
                    self._grid.checkRow(self.select(), false, false);
                } else {
                    self._grid.checkRow(self.select(), true, false);
                }

                return false;
            }
            // 그리드 셀스킵 관련 코드
            var current = self._grid.getCurrent(),
                rowIndex = current.itemIndex,
                rowData = self.dataItem(rowIndex),
                editParams = {
                    grid: self,
                    row: {
                        index: rowIndex,
                        data: rowData
                    },
                    cell: {
                        field: ''
                    }
                };
            // 셀 스킵 관련 코드
            if ($.type(self._grid.getEditValue()) === 'undefined' && $.type(self.options.editSkip) !== 'undefined' && self.options.editSkip) {
                var disPlayColumn = self.options.displayColumns,
                    index = 0,
                    i = 0,
                    column;

                $.each(self.options.displayColumns, function (idx, column) {
                    if (column.field === current.column) {
                        index = idx;
                    }
                });
                // 엔터키를 이용할 경우의 셀 스킵 사용
                if (key === 13) {
                    for (var j = rowIndex; j < self.dataItems().length; j += 1) {
                        editParams.row.index = j;
                        editParams.row.data = self.dataItem(j);
                        for (i = index + 1; i < disPlayColumn.length; i += 1) {
                            editParams.cell.field = disPlayColumn[i].field;
                            column = self.columns[disPlayColumn[i].field];
                            if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    self._grid.setCurrent({
                                        itemIndex: j,
                                        columns: column.fieldName,
                                        dataRow: j,
                                        fieldIndex: i,
                                        fieldName: column.fieldName
                                    });
                                    return false;
                                }
                            } else if (i === disPlayColumn.length - 1 && j === self.dataItems().length - 1) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    self.commitCell();
                                    return false;
                                }
                            }
                        }
                        index = -1;
                    }
                    // 오른쪽 방향키를 사용했을 경우 셀 스킵 사용
                } else if (key === 39 && index !== disPlayColumn.length - 1) {
                    for (i = index + 1; i < disPlayColumn.length; i += 1) {
                        editParams.cell.field = disPlayColumn[i].field;
                        column = self.columns[disPlayColumn[i].field];
                        if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                            if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                self._grid.setCurrent({
                                    itemIndex: self._grid.getCurrent().itemIndex,
                                    columns: column.fieldName,
                                    dataRow: self._grid.getCurrent().dataRow,
                                    fieldIndex: i,
                                    fieldName: column.fieldName
                                });
                                return false;
                            } else if (i === disPlayColumn.length - 1) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    return false;
                                }
                            }
                        } else if (i === disPlayColumn.length - 1) {
                            return false;
                        }
                    }
                    // 왼쪽 방향키를 눌렀을 경우 셀 스킵 사용
                } else if (key === 37 && index !== 0) {
                    for (i = index - 1; i >= 0; i -= 1) {
                        editParams.cell.field = disPlayColumn[i].field;
                        column = self.columns[disPlayColumn[i].field];
                        if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                            if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                self._grid.setCurrent({
                                    itemIndex: self._grid.getCurrent().itemIndex,
                                    columns: column.fieldName,
                                    dataRow: self._grid.getCurrent().dataRow,
                                    fieldIndex: i,
                                    fieldName: column.fieldName
                                });
                                return false;
                            } else if (i === 0) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    return false;
                                }
                            }
                        } else if (i === 0) {
                            return false;
                        }
                    }
                }
            }
            // esc 관련 코드
            if (key === 27) {
                if (dews.ui.dialogPage && $.type(self._grid.getEditValue()) === 'undefined') {
                    dews.ui.dialogPage.dialog.close();
                }
            }
            // shift+tab 관련 코드
            if (shift && key === 9) {
                // 셀 스킵 사용시
                if (self.options.editSkip) {
                    for (var row = rowIndex; row >= 0; row -= 1) {
                        editParams.row.index = row;
                        editParams.row.data = self.dataItem(row);
                        for (i = index - 1; i >= 0; i -= 1) {
                            editParams.cell.field = disPlayColumn[i].field;
                            column = self.columns[disPlayColumn[i].field];
                            if (self._grid.getColumnProperty(column.field, 'editable')) {
                                if (column.editor && $.type(column.editor.editable) !== 'undefined' && column.editor.editable.call(self, editParams)) {
                                    if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                        self.select(row, column.fieldName);
                                        return false;
                                    }
                                } else if (column.editor && ($.type(column.editor.editable) === 'undefined' || column.editor.editable.call(self, editParams))) {
                                    if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                        self.select(row, column.fieldName);
                                        return false;
                                    }
                                }
                            }
                        }
                        index = self.options.displayColumns.length;
                    }
                }
            }
        };
        // 코드피커 복사 붙여 넣기 문제로 인한 이벤트 추가
        self._grid.onEditRowPasted = function (grid, itemIndex, dataRow, fields, oldValues, newValues) {
            var className = '.dews-ui-grid';
            dews.ui.gridUtil.onEditRowPasted(self, newValues, className);
        };

        self.$element.on('changing', function (e) {
            if (self.options.changing && $.type(self.options.changing) === 'function' && e.grid) {
                self.options.changing.call(self, e);
            }
        });

        self.$element.on('change', function (e) {
            if (self.options.change && $.type(self.options.change) === 'function' && e.grid) {
                self.options.change.call(self, e);
            }
        });

        self.$element.on('save', function (e) {
            if (self.options.save && $.type(self.options.save) === 'function' && e.grid) {
                self.options.save.call(self, e);
            }
        });

        self.$element.on('validate', function (e) {
            if (self.options.validationCheck && $.type(self.options.validationCheck) === 'function' && e.grid) {
                self.options.validationCheck.call(self, e);
            }
        });

        self.$element.on('dataBound', function (e) {
            if (self.options.dataBound && $.type(self.options.dataBound) === 'function' && e.grid) {
                self.options.dataBound.call(self, e);
            }
        });

        self.$element.on('rowAdd', function (e) {
            if (self.options.rowAdd && $.type(self.options.rowAdd) === 'function' && e.grid) {
                self.options.rowAdd.call(self, e);
            }
        });

        self.$element.on('rowRemove', function (e) {
            if (self.options.rowRemove && $.type(self.options.rowRemove) === 'function' && e.grid) {
                self.options.rowRemove.call(self, e);
            }
        });

        self.$element.on('cellEditing', function (e) {
            if (self.options.cellEditing && $.type(self.options.cellEditing) === 'function' && e.grid) {
                self.options.editValue = self.options.cellEditing.call(self, e);
            }
        });

        self.$element.on('selected', function (e) {
            if (self.options.selected && $.type(self.options.selected) === 'function' && e.grid) {
                self.options.selected.call(self, e);
            }
        });

        self.$element.on('clicked', function (e) {
            if (self.options.clicked && $.type(self.options.clicked) === 'function' && e.grid) {
                self.options.clicked.call(self, e);
            }
        });

        self.$element.on('dblClicked', function (e) {
            if (self.options.dblClicked && $.type(self.options.dblClicked) === 'function' && e.grid) {
                self.options.dblClicked.call(self, e);
            }
        });

        self.$element.on('keyDown', function (e) {
            if (self.options.keyDown && $.type(self.options.keyDown) === 'function' && e.grid) {
                self.options.keyDown.call(self, e);
            }
        });

        // 그리드 에디터 창이 열려 있을 경우 스크롤시 닫기
        function windowScroll(e) {
            if ($(e.target).closest(document.body).length !== 0) {
                self.commitCell();
            }
        }

        // 그리드 에디터 창이 열려 있을 경우에 다른 화면 클릭 시 에디터 창을 종료 하기 위한 이벤트
        $(window).on('click', function (e) {
            var target = $(e.target).closest('.dews-ui-grid'),
                grid = self.$element.closest('.dews-ui-grid'),
                inGrid = false;
            // 선택한 항목이 해당 그리드 내에 위치 했을 경우 종료하지 않음(datepicker 와 같은 컨트롤 때문에)
            if (grid.length !== 0 && grid.offset().left - window.pageXOffset < e.clientX && grid.offset().left + grid.width() - window.pageXOffset > e.clientX &&
                grid.offset().top - window.pageYOffset < e.clientY && grid.offset().top + grid.height() - window.pageYOffset > e.clientY) {
                inGrid = true;
            }
            if ($(e.target).closest(document.body).length === 0) {
                inGrid = true;
            }
            // 그리드를 제외하고 다른 엘리먼트를 클릭했을 경우
            if (target.length === 0 && !inGrid) {
                self.commitCell();
                self.editable = false;
            }
            // 다른 그리드를 클릭했을 경우 (수정중인 그리드에서 일반 그리드 클릭 시 수정중인 그리드 수정 종료)
            if (target.length !== 0 && target.children().attr('ID') !== self._grid.name) {
                self.commitCell();
                self.editable = false;
            }
        });
        // 그리드 내 빈 영역 선택시 에디터 종료
        self.$element.on('click', function (e) {
            var grid = self.options.$content.find('.dews-ui-grid');
            // 그리드 내 빈 영역 선택시 에디터 종료
            if (e.target.tagName !== 'INPUT' && self._grid.mouseToIndex(e.offsetX, e.offsetY).itemIndex === -1) {
                self.commitCell();
                self.editable = false;
            }
        });
        // 그리드 내 키보드 이벤트 실행
        self.$element.on('keyDown', function (e) {
            var column;
            if (self.options.columns) {
                column = self.columns[self._grid.getCurrent().fieldName];
                var index = self.select();
                if (column && column.editor) {
                    // 코드피커 키보드 이벤트
                    if ((column.editor.type).toLowerCase() === 'codepicker' && self._grid.getColumnProperty(column.name, 'buttonVisibility') === 'visible') {
                        if (column.codeOption.validation) {
                            if ($.type(column.codeOption.value[self.select()]) === 'undefined') {
                                column.codeOption.value[self.select()] = {
                                    code: '',
                                    text: '',
                                    value: self.getCellValue(self._grid.getCurrent().itemIndex, column.fieldName)
                                };
                            }
                        }

                        if (e.keyCode === 115) {
                            self._grid.onImageButtonClicked.call(self, self._grid, self._grid.getCurrent().itemIndex, column);
                            e.preventDefault();
                            e.stopPropagation();
                        }
                    }
                    // 날짜피커 키보드 이벤트
                    if (self._grid._gv._editController._editor && column.editor.type.toLowerCase() === 'date' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 115) {
                            self.editCell();
                            self._grid._gv._editController._editor.dropDown();
                            e.stopPropagation();
                            e.preventDefault();
                        }
                    }
                    // 숫자 텍스트박스 + 키 눌렀을 시 이벤트
                    if (column.editor.type.toLowerCase() === 'number' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 107) {
                            if ($.type(self._grid.getEditValue()) !== 'undefined') {
                                e.preventDefault();
                                var currentValue = self._grid.getEditValue().replace(/,/, ''),
                                    resultValue = 0;

                                if (column.editor.increaseType === 'plus') {
                                    resultValue = parseFloat(currentValue) + parseFloat(column.editor.increaseValue);
                                } else {
                                    resultValue = parseFloat(currentValue) * parseFloat(column.editor.increaseValue);
                                }
                                self.$element.find('#' + self._grid.name + '_number').val(dews.number.format(resultValue.toString(), column.editor.format));

                                self._grid._gv._editController.onEditorChange.call(self._grid._gv._editController, self._grid._gv._editController._editIndex);
                            } else {
                                e.preventDefault();
                                self._grid.showEditor();
                            }
                        }
                    }
                    // 드롭다운리스트 키보드 이벤트
                    if (self._grid._gv._editController._editor && column.editor.type.toLowerCase() === 'dropdown' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 115) {
                            self.editCell();
                            self._grid._gv._editController._editor.dropDown();
                            e.stopPropagation();
                            e.preventDefault();
                        }

                        if (self._grid._gv._editController._editor.isVisible() && column.editor.textReadOnly) {
                            if (e.keyCode >= 49 && e.keyCode <= 57 || e.keyCode >= 97 && e.keyCode <= 105) {
                                var number = (e.keyCode >= 49 && e.keyCode <= 57) ? e.keyCode - 49 : e.keyCode - 97;

                                if (column.values.length > number) {
                                    self.setCellValue(self.select(), column.fieldName, column.values[number]);
                                    e.preventDefault();
                                }
                            }
                        }
                    }
                    // 우편번호피커 키보드 이벤트
                    if ((column.editor.type).toLowerCase() === 'zipcodepicker' && self._grid.getColumnProperty(column.name, 'buttonVisibility') === 'visible') {
                        if (e.keyCode === 115) {
                            self._grid.onImageButtonClicked.call(self, self._grid, self._grid.getCurrent().itemIndex, column);
                            e.preventDefault();
                            e.stopPropagation();
                        }
                    }
                }
            }
        });

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            self.options.dataSource.dataProvider._dp.setRows = setRow(self, self.options.dataSource.dataProvider._dp.setRows);
        }
    };
    // 그리드 패널 바인딩
    Grid.prototype.bindPanel = function (panel) {
        dews.ui.gridUtil.bindPanel(this, panel);
    };
    // 그리드 패널 바인딩
    Grid.prototype.updateRowFromPanel = function (data) {
        var self = this;
        if (data) {
            self._grid.setValues(self.select(), data);
        }
    };

    /**
     * 그리드 특정 cell 스타일 설정
     * @param index row index
     * @param field field index
     * @param styles 설정할 스타일
     */
    Grid.prototype.setCellStyle = function (index, field, styles) {
        dews.ui.gridUtil.setCellStyle(this, index, field, styles);
    };

    // 해당 그리드 display: none 인지 확인
    function isVisible(grid) {
        var self = grid;

        return self.$element.is(':visible');
    }

    // 그리드 데이터 뿌려주는 시점
    function setRow(grid, rows) {
        return function (data, start, count) {
            var self = this;

            grid.options.dataBounding = true;
            grid.options.data = data;

            if (grid.options.rowDynamic.length !== 0) {
                grid.options.rowDynamic = [];
            }

            if (!self._checkClientState()) return;
            start = arguments.length > 1 ? start : 0;
            count = arguments.length > 2 ? count : -1;
            if (count == 0) {
                return;
            }
            self.refreshFieldFormats();
            self.beginUpdate();
            try {
                self.$_clearRows();
                var checkSt = self.isCheckStates();
                var filters = self._filters;
                var len, end, n, r, i, row;
                if (data && (len = data.length) > 0 && start < len) {
                    start = Math.max(0, start);
                    if (count < 0) {
                        count = len;
                    } else {
                        count = Math.min(count, len - start);
                    }
                    if (filters) {
                        self._values.length = self._rowIds.length = self._rowStates.length = count;
                        filters.prepare(self);
                        end = len;
                        r = n = 0;
                        for (i = start; i < end && r < count; i++) {
                            row = data[i];
                            if (!$.isArray(row)) {
                                row = objectToRow(self, grid, row, i);
                            }
                            if (filters.select(n++, row)) {
                                self._internalSetRow(r++, row, checkSt);
                            }
                        }
                        self._values.length = self._rowIds.length = self._rowStates.length = r;
                    } else {
                        end = Math.min(len, start + count);
                        if (end > start) {
                            self._values.length = self._rowIds.length = self._rowStates.length = end - start;
                            r = 0;
                            for (i = start; i < end; i++) {
                                row = data[i];
                                if (!$.isArray(row)) {
                                    row = objectToRow(self, grid, row, i);
                                }
                                self._internalSetRow(r++, row, checkSt);
                            }
                        }
                    }
                }
            } finally {
                self.endUpdate(false);
            }
            self.tags().setRows();
            self._fireRefresh();
            self._fireRowCountChanged();
            if (data && data.length === 0) {
                grid._grid.onCurrentChanging.call(grid, grid._grid, grid._grid.getCurrent(), grid._grid.getCurrent());
                grid._grid.onCurrentChanged.call(grid, grid._grid, grid._grid.getCurrent());
            }
        };
    }

    // 그리드 컬럼 데이터 설정
    function objectToRow(self, gridObj, values, index) {
        var row = [];
        var grid = gridObj;
        if (values) {
            var i, fld, columns,
                cnt = self.fieldCount();
            for (i = 0; i < cnt; i++) {
                fld = self.getOrgFieldName(i);
                columns = grid.columns[fld];
                if (values.hasOwnProperty(fld)) {
                    row[i] = values[fld];
                }
                // 그리드 컬럼내 값에 따라 색상 변경
                if (columns && columns.style) {
                    if ($.type(columns.cellDynamic) === 'undefined') {
                        columns.cellDynamic = [];
                    }

                    var styles = {}, styleParameter = {
                        grid: grid,
                        row: {
                            index: index,
                            data: values
                        }
                    }, style;

                    style = columns.style.call(grid, styleParameter);

                    if (style) {
                        if (style.color) {
                            styles.foreground = style.color;
                        }
                        if (style.textAlign) {
                            switch (style.textAlign) {
                                case 'left':
                                    styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    styles.textAlignment = 'far';
                                    break;
                                case 'center':
                                    styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if (style.verticalAlign) {
                            switch (style.verticalAlign.toLowerCase()) {
                                case 'top' :
                                    styles.lineAlignment = 'near';
                                    break;
                                case 'bottom':
                                    styles.lineAlignment = 'far';
                                    break;
                                case 'middle':
                                    styles.lineAlignment = 'center';
                                    break;
                            }
                        }

                        if (style.icon && style.icon.image) {
                            var image,
                                iconIndex = index;

                            if (grid.options.iconImagelist) {
                                image = grid.options.iconImagelist;
                            } else {
                                image = new RealGridJS.ImageList('iconImage', '');
                            }

                            if (grid.options.images.indexOf(style.icon.image) !== -1) {
                                $.each(grid.options.images, function (idx) {
                                    if (grid.options.images[idx] === style.icon.image) {
                                        iconIndex = idx;
                                    }
                                });
                            } else {
                                iconIndex = grid.options.images.length;
                                grid.options.images.push(style.icon.image);
                            }

                            if (grid.options.dataSource.data().length - 1 === index) {
                                image.addUrls(grid.options.images);
                                grid._grid.registerImageList(image);
                                grid._grid.setColumnProperty(grid._grid.columnByField(columns.field), "imageList", "iconImage");
                                grid._grid.setColumnProperty(grid._grid.columnByField(columns.field), "renderer", {type: "icon"});
                                grid.options.iconImagelist = image;
                            }

                            if ($.type(style.icon.position) === 'undefined') {
                                style.icon.position = 'left';
                            }

                            columns.cellDynamic.push({
                                criteria: "(values['" + columns.field + "'] = '" + values[fld] + "')",
                                styles: 'iconIndex=' + iconIndex + ';iconOffset=0;iconPadding=5;iconAlignment=center;iconLocation=' + style.icon.position
                            });
                        }

                        styles = $.extend(true, styles, style);
                        var criteria;
                        if ($.type(values[fld]) === 'undefined') {
                            criteria = "values['" + columns.field + "'] = null";
                        } else {
                            criteria = "(values['" + columns.field + "'] = '" + values[fld] + "')";
                        }
                        columns.cellDynamic.push({
                            criteria: criteria,
                            styles: styles
                        });
                    }
                    grid._grid.setColumnProperty(grid._grid.columnByField(columns.field), 'dynamicStyles', columns.cellDynamic);
                }
                // 그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
                if (columns && columns.editor && columns.editor.type.toLowerCase() === 'dropdown') {
                    var col,
                        fetchData,
                        datasource;
                    if ($.type(columns.editor.dataSource) === 'function') {
                        col = grid._grid.columnByField(columns.fieldName);
                        datasource = columns.editor.dataSource;

                        // 추후 수정해야할 코드입니다.
                        var e = {
                            grid: grid,
                            row: {
                                index: index,
                                data: values
                            }
                        };

                        if ($.type(columns.editor.dataSource) === 'function') {
                            datasource = columns.editor.dataSource.call(grid, e);
                        }

                        col.values = [];
                        col.labels = [];

                        datasource.col = col;

                        datasource.fetch(function () {
                            fetchData = this;
                        }).done(function () {
                            var dropdownColumn = grid.columns[fetchData.col.fieldName];
                            $.each(fetchData.data(), function (idx, data) {
                                fetchData.col.values.push(data[dropdownColumn.editor.dataValueField]);
                                fetchData.col.labels.push(data[dropdownColumn.editor.dataTextField]);
                            });
                            fetchData.col.labelField = columns.editor.dataTextField;
                            fetchData.col.lookupDisplay = true;
                            grid._grid.setColumn(fetchData.col);
                            delete fetchData.col;
                        });
                    } else if ($.type(columns.editor.dataSource) !== 'function' && index === 0) {
                        col = grid._grid.columnByField(columns.fieldName);
                        datasource = columns.editor.dataSource;
                        col.values = [];
                        col.labels = [];

                        datasource.col = col;

                        datasource.fetch(function () {
                            fetchData = this;
                        }).done(function () {
                            var dropdownColumn = grid.columns[fetchData.col.fieldName];
                            $.each(fetchData.data(), function (idx, data) {
                                fetchData.col.values.push(data[dropdownColumn.editor.dataValueField]);
                                fetchData.col.labels.push(data[dropdownColumn.editor.dataTextField]);
                            });
                            fetchData.col.labelField = columns.editor.dataTextField;
                            fetchData.col.lookupDisplay = true;
                            grid._grid.setColumn(fetchData.col);
                            delete fetchData.col;
                        });
                    }
                }
            }
        }
        return row;
    }

})(jQuery, window.dews || {});


(function ($, dews) {
    dews = $.extend(true, dews, {
        ui: {
            gridUtil: {
                // 그리드 기본스타일 설정
                gridStyle: {
                    "grid": {
                        "background": "#fafafa",
                        "iconLocation": "left",
                        "border": "#ffe1e1e1,1",
                        "iconAlignment": "center",
                        "borderBottom": "#ffc4c7cd,1",
                        "font": "Graphic",
                        "iconPadding": "0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBackground": "#ffff7000",
                        "hoveredMaskBorder": "#ffff0000,1",
                        "paddingRight": "2",
                        "paddingBottom": "2",
                        "paddingTop": "2",
                        "figureBackground": "#ff657082",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#ff000000",
                        "inactiveForeground": "#ff808080",
                        "line": "#ffb7bdc7,1",
                        "textAlignment": "center",
                        "lineAlignment": "center",
                        "iconIndex": "0"
                    },
                    "panel": {
                        "background": "#ffa4a8b1",
                        "paddingRight": "2",
                        "iconLocation": "left",
                        "border": "#ffff0000,1",
                        "selectedForeground": "#ffffffff",
                        "iconAlignment": "center",
                        "foreground": "#ffffffff",
                        "inactiveForeground": "#ff808080",
                        "borderBottom": "#ff5a5f6c,1",
                        "textAlignment": "near",
                        "selectedBackground": "#ff696969",
                        "lineAlignment": "center",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBorder": "#335292f7,1",
                        "iconPadding": "0",
                        "hoveredMaskBackground": "#1f5292f7",
                        "contentFit": "auto",
                        "paddingTop": "4",
                        "borderRight": "#ff777777,1",
                        "figureBackground": "#ff008800",
                        "paddingBottom": "5",
                        "iconIndex": "0"
                    },
                    "body": {
                        "height": 32,
                        "checkedImg": "https://dews.comet.duzon.net/dews/themes/d-erp/images/checked.png",
                        "unCheckImg": "https://dews.comet.duzon.net/dews/themes/d-erp/images/uncheck.png",
                        "requiredBackground": "#fff9f9",
                        "background": "#ffffffff",
                        "iconLocation": "left",
                        "border": "#ffffffff,0",
                        "iconAlignment": "center",
                        "borderBottom": "#ffe1e1e1,1",
                        "font": "Graphic",
                        "borderTop": "#ffffffff,0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "iconPadding": "0",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1",
                        "figureBackground": "#ff008800",
                        "paddingLeft": "8",
                        "paddingRight": "8",
                        "paddingBottom": "2",
                        "paddingTop": "2",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#000000",
                        "inactiveForeground": "#ff808080",
                        "line": "#ffe1e1e1,1",
                        "textAlignment": "center",
                        "borderLeft": "#ffe1e1e1,0",
                        "lineAlignment": "center",
                        "borderRight": "#ffe1e1e1,1",
                        "iconIndex": "0",
                        "empty": {}
                    },
                    "fixed": {
                        "background": "#ffffffff",
                        "iconLocation": "left",
                        "border": "#ffe1e1e1,1",
                        "iconAlignment": "center",
                        "borderBottom": "#ffe1e1e1,1",
                        "font": "Graphic",
                        "iconPadding": "0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1",
                        "paddingLeft": "6",
                        "paddingRight": "6",
                        "paddingBottom": "0",
                        "paddingTop": "0",
                        "figureBackground": "#ff008800",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#ff000000",
                        "inactiveForeground": "#ff808080",
                        "textAlignment": "center",
                        "lineAlignment": "center",
                        "borderRight": "#ffe1e1e1,1",
                        "iconIndex": "0",
                        "colBar": {
                            "background": "#a6a6a6",
                            "iconLocation": "left",
                            "border": "#a6a6a6,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ff808080,1",
                            "font": "Graphic",
                            "iconPadding": "0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "hoveredMaskBackground": "#ffff7000",
                            "hoveredMaskBorder": "#ffff0000,1",
                            "paddingRight": "0",
                            "paddingBottom": "0",
                            "paddingTop": "0",
                            "figureBackground": "#ffe1e1e1",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "lineAlignment": "center",
                            "borderRight": "#a6a6a6,1",
                            "borderLeft": "#a6a6a6,1",
                            "iconIndex": "0"
                        },
                        "rowBar": {
                            "background": "#ffd3d3d3",
                            "iconLocation": "left",
                            "border": "#a6a6a6,1",
                            "iconAlignment": "center",
                            "borderBottom": "#a6a6a6,1",
                            "font": "Graphic",
                            "iconPadding": "0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "paddingRight": "2",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "figureBackground": "#ff008800",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "lineAlignment": "center",
                            "borderRight": "#a6a6a6,1",
                            "iconIndex": "0"
                        }
                    },
                    "header": {
                        "height": "32",
                        "background": "#f0f0f0",
                        "iconLocation": "left",
                        "border": "#ffffffff,0",
                        "iconAlignment": "center",
                        "borderBottom": "#e1e1e1,1",
                        "font": "Graphic",
                        "fontSize": "12",
                        "selectedBackground": "#fff0f0f0",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "iconPadding": "0",
                        "hoveredMaskBackground": "#22002b5b",
                        "hoveredBackground": "#fff0f0f0",
                        "paddingTop": "2",
                        "fontBold": "true",
                        "figureBackground": "#ff008800",
                        "paddingBottom": "2",
                        "hoveredMaskBorder": "#ffff0000,1",
                        "paddingRight": "8",
                        "paddingLeft": "8",
                        "selectedForeground": "#ff000000",
                        "foreground": "#000000",
                        "inactiveForeground": "#ff808080",
                        "textAlignment": "center",
                        "borderLeft": "#ffffffff,0",
                        "lineAlignment": "center",
                        "borderRight": "#ffe1e1e1,1",
                        "iconIndex": "0",
                        "group": {
                            "background": "#fff0f0f0",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ffe1e1e1,1",
                            "font": "Graphic",
                            "fontSize": "12",
                            "borderTop": "#ffffffff,0",
                            "selectedBackground": "linear,#ffcad0d7,#ffb7bec7,90",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#22002b5b",
                            "paddingTop": "2",
                            "fontBold": "true",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "hoveredMaskBorder": "#ffff0000,1",
                            "paddingRight": "2",
                            "selectedForeground": "#ff000000",
                            "foreground": "#ff222530",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffe1e1e1,1",
                            "iconIndex": "0"
                        }
                    },
                    "footer": {
                        "height": "32",
                        "background": "#ffecdb",
                        "iconLocation": "left",
                        "border": "#f5d3b6,0",
                        "iconAlignment": "center",
                        "font": "Graphic",
                        "fontBold": "true",
                        "fontSize": "12",
                        "borderTop": "#f5d3b6,1",
                        "borderRight": "#f5d3b6,1",
                        "borderLeft": "#f5d3b6,0",
                        "borderBottom": "#f5d3b6,0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "iconPadding": "0",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1",
                        "figureBackground": "#ff008800",
                        "paddingBottom": "1",
                        "paddingTop": "2",
                        "paddingRight": "5",
                        "paddingLeft": "5",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#000000",
                        "inactiveForeground": "#ff808080",
                        "textAlignment": "near",
                        "lineAlignment": "center",
                        "iconIndex": "0"
                    },
                    "rowGroup": {
                        "header": {
                            "background": "#ff464c58",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ff272d37,1",
                            "borderTop": "#ff464c58,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ffe2ecff",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "near",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ff272d37,1",
                            "iconIndex": "0"
                        },
                        "footer": {
                            "background": "#ffd8dee6",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ff6e7b8c,0",
                            "font": "Graphic",
                            "borderTop": "#ff6e7b8c,1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "4",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "far",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ff6e7b8c,1",
                            "iconIndex": "0"
                        },
                        "head": {
                            "background": "linear,#f0f0f0,#f0f0f0,90",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ff767b87,0",
                            "font": "Graphic",
                            "borderTop": "#ffffffff,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#22002b5b",
                            "hoveredMaskBorder": "#ffff0000,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff222530",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffe1e1e1,1",
                            "iconIndex": "0"
                        },
                        "foot": {
                            "background": "#ffecdb",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#f5d3b6,0",
                            "font": "Graphic",
                            "borderTop": "#f5d3b6,1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "1",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff222530",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "near",
                            "borderLeft": "#f5d3b6,0",
                            "lineAlignment": "center",
                            "borderRight": "#f5d3b6,1",
                            "iconIndex": "0"
                        },
                        "headerBar": {
                            "background": "#ff464c58",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ffffffff,0",
                            "font": "Graphic",
                            "borderTop": "#ffffffff,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "fontSize": "11",
                            "paddingTop": "2",
                            "figureBackground": "#ffffffff",
                            "paddingBottom": "2",
                            "hoveredMaskBorder": "#335292f7,1",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ffe2ecff",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "near",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffffffff,0",
                            "iconIndex": "0"
                        },
                        "footerBar": {
                            "background": "#ffd8dee6",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ff6e7b8c,0",
                            "font": "Graphic",
                            "borderTop": "#ff6e7b8c,1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "near",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ff6e7b8c,1",
                            "iconIndex": "0"
                        },
                        "bar": {
                            "background": "#ff464c58",
                            "iconLocation": "left",
                            "border": "#ffffffff,0",
                            "iconAlignment": "center",
                            "borderBottom": "#ff272d37,0",
                            "font": "Graphic",
                            "borderTop": "#ff464c58,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "fontSize": "11",
                            "paddingTop": "2",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "hoveredMaskBorder": "#335292f7,1",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ffe2ecff",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "near",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ff272d37,1",
                            "iconIndex": "0"
                        },
                        "panel": {
                            "background": "#ff464c58",
                            "iconLocation": "left",
                            "border": "#ff393c42,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ffffffff,0",
                            "borderTop": "#ffffffff,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#ff393c42",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "1",
                            "paddingTop": "1",
                            "paddingRight": "1",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ffe2ecff",
                            "inactiveForeground": "#ff808080",
                            "line": "#ff464c58,1",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffffffff,0",
                            "iconIndex": "0"
                        }
                    },
                    "indicator": {
                        "background": "#ffffffff",
                        "paddingRight": "2",
                        "iconLocation": "none",
                        "border": "#ff464b58,1",
                        "selectedForeground": "#ffffffff",
                        "iconAlignment": "center",
                        "foreground": "#ff222530",
                        "inactiveForeground": "#ff808080",
                        "borderBottom": "#ffe1e1e1,1",
                        "textAlignment": "center",
                        "selectedBackground": "#edf8fe",
                        "lineAlignment": "center",
                        "inactiveBackground": "#edf8fe",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBorder": "#ff000000,1",
                        "iconPadding": "0",
                        "hoveredMaskBackground": "#ffd1d5db",
                        "hoveredBackground": "#ffffffff",
                        "contentFit": "auto",
                        "paddingTop": "2",
                        "borderRight": "#ffe1e1e1,1",
                        "figureBackground": "#ff2f363f",
                        "paddingBottom": "2",
                        "iconIndex": "0",
                        "head": {
                            "paddingRight": "0",
                            "paddingLeft": "0",
                            "background": "#fff0f0f0",
                            "iconLocation": "left",
                            "border": "#ffff0000,1",
                            "iconAlignment": "center",
                            "borderBottom": "#e1e1e1,1",
                            "font": "Graphic",
                            "fontSize": "12",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "fontBold": true,
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#e1e1e1,1",
                            "lineAlignment": "center",
                            "borderRight": "#e1e1e1,1",
                            "iconIndex": "0"
                        },
                        "foot": {
                            "background": "#ffecdb",
                            "iconLocation": "left",
                            "border": "#f5d3b6,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ff5d3b6,0",
                            "font": "Graphic",
                            "borderTop": "#f5d3b6,1",
                            "borderRight": "#f5d3b6, 1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff2f363f",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "iconIndex": "0"
                        }
                    },
                    "checkBar": {
                        "background": "#ffffffff",
                        "iconLocation": "left",
                        "border": "#ff464b58,1",
                        "iconAlignment": "center",
                        "borderBottom": "#ffe1e1e1,1",
                        "font": "Graphic",
                        "iconPadding": "0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ffd3d3d3",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1",
                        "paddingRight": "2",
                        "paddingBottom": "2",
                        "paddingTop": "2",
                        "figureBackground": "#ff4995ff",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#ff555555",
                        "inactiveForeground": "#ff808080",
                        "textAlignment": "center",
                        "lineAlignment": "center",
                        "borderRight": "#ffe1e1e1,1",
                        "iconIndex": "0",
                        "head": {
                            "background": "#fff0f0f0",
                            "iconLocation": "left",
                            "border": "#ffff0000,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ffe1e1e1,1",
                            "font": "Graphic",
                            "borderTop": "#ffffff, 0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff4995ff",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "0",
                            "paddingLeft": "0",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffe1e1e1,1",
                            "iconIndex": "0"
                        },
                        "foot": {
                            "background": "#ffecdb",
                            "iconLocation": "left",
                            "border": "#f5d3b6,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ffe1e1e1,0",
                            "font": "Graphic",
                            "borderTop": "#f5d3b6,1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#f5d3b6,1",
                            "iconIndex": "0"
                        }
                    },
                    "statusBar": {
                        "background": "#ffffffff",
                        "iconLocation": "left",
                        "border": "#ff464b58,1",
                        "iconAlignment": "center",
                        "borderBottom": "#ffe1e1e1,1",
                        "font": "Graphic",
                        "iconPadding": "0",
                        "selectedBackground": "#ff696969",
                        "contentFit": "auto",
                        "inactiveBackground": "#ff696969",
                        "iconOffset": "0",
                        "selectionDisplay": "mask",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1",
                        "paddingRight": "2",
                        "paddingBottom": "2",
                        "paddingTop": "2",
                        "figureBackground": "#ff008800",
                        "selectedForeground": "#ffffffff",
                        "foreground": "#ff000000",
                        "inactiveForeground": "#ff808080",
                        "textAlignment": "center",
                        "lineAlignment": "center",
                        "borderRight": "#ffe1e1e1,1",
                        "iconIndex": "0",
                        "head": {
                            "background": "#fff0f0f0",
                            "iconLocation": "left",
                            "border": "#ffff0000,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ffe1e1e1,1",
                            "font": "Graphic",
                            "borderTop": "#ffffffff,0",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#ffe1e1e1,1",
                            "iconIndex": "0"
                        },
                        "foot": {
                            "background": "#ffecdb",
                            "iconLocation": "left",
                            "border": "#f5d3b6,1",
                            "iconAlignment": "center",
                            "borderBottom": "#ffe1e1e1,0",
                            "font": "Graphic",
                            "borderTop": "#f5d3b6,1",
                            "selectedBackground": "#ff696969",
                            "contentFit": "auto",
                            "inactiveBackground": "#ffd3d3d3",
                            "iconOffset": "0",
                            "selectionDisplay": "mask",
                            "iconPadding": "0",
                            "hoveredMaskBackground": "#1f5292f7",
                            "hoveredMaskBorder": "#335292f7,1",
                            "figureBackground": "#ff008800",
                            "paddingBottom": "2",
                            "paddingTop": "2",
                            "paddingRight": "2",
                            "selectedForeground": "#ffffffff",
                            "foreground": "#ff000000",
                            "inactiveForeground": "#ff808080",
                            "textAlignment": "center",
                            "borderLeft": "#ffffffff,0",
                            "lineAlignment": "center",
                            "borderRight": "#f5d3b6,1",
                            "iconIndex": "0"
                        }
                    },
                    "selection": {
                        "focusBorderColor": "#1c90fb",
                        "focusBackgroundColor": "#cee4ff",
                        "background": "#12008aff",
                        "selectedBackground": "#ff696969",
                        "inactiveBackground": "#ff696969",
                        "border": "#cce9f5ff,1px",
                        "foreground": "#ff000000",
                        "selectedForeground": "#ffffffff",
                        "inactiveForeground": "#ff808080",
                        "paddingLeft": 0,
                        "paddingRight": 0,
                        "paddingTop": 0,
                        "paddingBottom": 0,
                        "iconIndex": "0",
                        "iconLocation": "left",
                        "iconAlignment": "center",
                        "iconOffset": 0,
                        "iconPadding": 0,
                        "contentFit": "auto",
                        "selectionDisplay": "mask",
                        "hoveredMaskBackground": "#1f5292f7",
                        "hoveredMaskBorder": "#335292f7,1px",
                        "focusBackground": "#ff000000",
                        "figureBackground": "#ff008800",
                        "figureInactiveBackground": "#ffd3d3d3"
                    },
                    "tree": {
                        "expander": {
                            "figureBackground": "#1c90fb",
                            "paddingRight": 0
                        }
                    }
                },
                // 컬럼 찾기
                findColumn: function (columns, fieldName) {
                    if (columns && fieldName) {
                        var column;
                        for (var i = 0; i < columns.length; i+=1) {
                            if (columns[i].columns) {
                                column = dews.ui.gridUtil.findColumn(columns[i].columns, fieldName);
                                if ($.type(column) !== 'undefined') {
                                    return column;
                                }
                            }
                            if (columns[i].name && columns[i].name.toUpperCase() === fieldName.toUpperCase()) {
                                column = columns[i];
                                break;
                            }
                        }
                        return column;
                    }
                },
                // 보이는 컬럼 반환
                displayColumns: function (self, columns) {
                    for (var i = 0; i < columns.length; i++) {
                        if (columns[i].columns) {
                            dews.ui.gridUtil.displayColumns(self, columns[i].columns);
                        } else {
                            self.options.displayColumns.push(self.columns[columns[i]]);
                        }
                    }
                },
                // 그리드 스타일 설정
                setStyles: function (grid, opt) {
                    if ($.type(opt.styles) !== 'undefined') {
                        var styles = $.extend(true, {}, opt.gridStyle);
                        // rowNo 설정
                        if ($.type(opt.styles.rowNo) !== 'undefined') {
                            styles.indicator.foreground = $.type(opt.styles.rowNo.color) === 'undefined' ? styles.indicator.foreground : opt.styles.rowNo.color;
                            styles.indicator.hoveredForeground = styles.indicator.foreground;
                            styles.indicator.background = $.type(opt.styles.rowNo.background) === 'undefined' ? styles.indicator.background : opt.styles.rowNo.background;
                            styles.indicator.hoveredBackground = styles.indicator.background;
                            styles.indicator.selectedBackground = $.type(opt.styles.rowNo.selectedBackground) === 'undefined' ? styles.indicator.selectedBackground : opt.styles.rowNo.selectedBackground;
                        }
                        // 셀 보더 설정
                        if ($.type(opt.styles.cellBorder) !== 'undefined') {
                            var border = '';
                            if ($.type(opt.styles.cellBorder.color) !== 'undefined') {
                                border = opt.styles.cellBorder.color + ', ';
                            } else {
                                border = styles.body.border.split(',')[0] + ', ';
                            }

                            if ($.type(opt.styles.cellBorder.width) !== 'undefined') {
                                border += opt.styles.cellBorder.width;
                            } else {
                                border += styles.body.border.split(',')[1];
                            }

                            styles.body.borderRight = border;
                            styles.body.borderBottom = border;
                        }
                        // 그리드 폰트 설정
                        if ($.type(opt.styles.font) !== 'undefined') {
                            styles.body.fontFamily = $.type(opt.styles.font.family) === 'undefined' ? styles.body.fontFamily : opt.styles.font.family;
                            styles.body.fontSize = $.type(opt.styles.font.size) === 'undefined' ? styles.body.fontSize : opt.styles.font.size;
                            styles.body.fontBold = $.type(opt.styles.font.bold) === 'undefined' ? styles.body.fontBold : opt.styles.font.bold;
                        }
                        // 그리드 패딩 설정
                        if ($.type(opt.styles.padding) !== 'undefined') {
                            styles.body.paddingTop = $.type(opt.styles.padding.top) === 'undefined' ? styles.body.paddingTop : opt.styles.padding.top;
                            styles.body.paddingBottom = $.type(opt.styles.padding.bottom) === 'undefined' ? styles.body.paddingBottom : opt.styles.padding.bottom;
                            styles.body.paddingLeft = $.type(opt.styles.padding.left) === 'undefined' ? styles.body.paddingLeft : opt.styles.padding.left;
                            styles.body.paddingRight = $.type(opt.styles.padding.right) === 'undefined' ? styles.body.paddingRight : opt.styles.padding.right;
                        }
                        // 그리드 높이 설정
                        if ($.type(opt.styles.height) !== 'undefined') {
                            if ($.type(opt.styles.height) === 'number') {
                                opt.display.minHeight = opt.styles.height;
                                opt.display.rowHeight = opt.styles.height;
                                opt.header.height = opt.styles.height;
                                opt.header.minHeight = opt.styles.height;
                                opt.footer.height = opt.styles.height;
                                opt.footer.minHeight = opt.styles.height;
                            } else {
                                opt.display.rowHeight = $.type(opt.styles.height.row) === 'undefined' ? opt.display.rowHeight : opt.styles.height.row;
                                opt.header.height = $.type(opt.styles.height.header) === 'undefined' ? opt.header.height : opt.styles.height.header;
                                opt.footer.height = $.type(opt.styles.height.footer) === 'undefined' ? opt.footer.height : opt.styles.height.footer;
                                opt.display.minHeight = opt.display.rowHeight;
                                opt.header.minHeight = opt.header.height;
                                opt.footer.minHeight = opt.footer.height;
                            }
                        }
                        // 그리드 상하 정렬
                        if ($.type(opt.styles.verticalAlign) !== 'undefined') {
                            var position = 'middle';
                            switch (opt.styles.verticalAlign.toLowerCase()) {
                                case 'top' :
                                    position = 'near';
                                    break;
                                case 'bottom':
                                    position = 'far';
                                    break;
                            }
                            styles.body.lineAlignment = position;
                        }
                        // 그리드 셀내 폰트 색상 설정
                        styles.body.foreground = $.type(opt.styles.color) === 'undefined' ? styles.body.foreground : opt.styles.color;
                        // 그리드 내 배경색상 설정
                        styles.body.background = $.type(opt.styles.background) === 'undefined' ? styles.body.background : opt.styles.background;

                        grid.setStyles(styles);
                    }

                    return opt;
                },
                // cancelRow API
                cancelRow: function (self, data, rowId) {
                    // 추가된 행에 대해 cancelRow를 실행 할 시에 해당 row를 삭제 해줌
                    if (data.getRowState(rowId) === 'created') {
                        self.removeRow(rowId);
                    } else {
                        self._grid.cancel();
                        data.restoreUpdatedRows(rowId);
                    }
                },
                // 폼패널 바인딩
                bindPanel: function (self, panel) {
                    var current = self.dataItem(self.select());
                    if ($.type(panel) === 'object' && panel.length) {
                        panel = dews.ui.formpanel(panel);
                    }

                    panel.bindData(current);
                },
                // 마스터 디테일 구조 설정
                setDetail: function (self, target) {
                    var master = self,
                        detail = target,
                        masterDataSource = master.options.dataSource,
                        detailDataSource = detail.options.dataSource;

                    detailDataSource.options.detail = true;
                    detailDataSource.options.lineDataSources = {};
                    detailDataSource.options.masterDataSource = masterDataSource;
                    masterDataSource.options.master = {};
                    masterDataSource.options.detailDataSource = detailDataSource;

                    self.on('change', function (e) {
                        var currentHDataItem = master.dataItem(master.select()), uid = currentHDataItem._uid;
                        if (e.grid) {
                            if (masterDataSource.options._dataChange) {
                                detailDataSource._detailDataChange();
                            }
                            if ($.type(detailDataSource.options.lineDataSources[uid]) === "undefined") {
                                detailDataSource.options.lineDataSources[uid] = dews.ui.dataSource("__ds_" + uid, detailDataSource.options);
                                detailDataSource.options.lineDataSources[uid].options.master = {};
                                detailDataSource.options.id = detailDataSource.id;
                                detail.setDataSource(detailDataSource.options.lineDataSources[uid]);
                                detailDataSource.options.lineDataSources[uid].read();

                                detailDataSource.options.lineDataSources[uid].options.parentDataSource = detailDataSource;
                                if (masterDataSource.options._dataChange) {
                                    detailDataSource.options.lineDataSources[uid]._detailDataChange();
                                }
                            } else {
                                detail.setDataSource(detailDataSource.options.lineDataSources[uid]);
                            }
                            masterDataSource.options.master[detailDataSource.options.id] = detailDataSource;
                            detailDataSource.options.lineDataSources[uid].options.parent = master.options.dataSource;
                        }
                    });

                    self.on('rowAdd', function (e) {
                        var data = master.dataItem(master.select());
                        data._uid = guid();
                        master.updateRow(master.select(), data);
                    });

                    function guid() {
                        return 'xxxxxxxx-xxxx-4xxx-9xxx-xxxxxxxxxxxx'.replace(/[xy]/g,
                            function(c) {
                                var r = Math.random() * 16|0, v = c == 'x' ? r : (r&0x3|0x8);
                                return v.toString(16);
                            });
                    }
                },
                // 높이 설정
                setHeight: function (self, height) {
                    self.options.height = height;
                    self.$element.css('height', height);
                    self._grid.resetSize();
                },
                // 행 스타일 설정
                setRowStyle: function (self, row, style) {
                    var styles = {}, index = [];

                    if (style) {
                        if (style.color) {
                            styles.foreground = style.color;
                        }
                        if (style.textAlign) {
                            switch (style.textAlign) {
                                case 'left':
                                    styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    styles.textAlignment = 'far';
                                    break;
                                case 'center':
                                    styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if ($.type(row) !== 'array' && $.type(row) === 'number') {
                            index.push(row);
                        } else if ($.type(row) === 'array'){
                            index = row;
                        } else {
                            return;
                        }

                        styles = $.extend(true, styles, style);

                        for (var i = 0; i < index.length; i += 1) {
                            self.options.rowDynamic.push({
                                criteria: '(dataRow = ' + index[i] + ')',
                                styles: styles
                            });
                        }
                        self._grid.setStyles({
                            body: {
                                dynamicStyles: self.options.rowDynamic
                            }
                        });
                    }
                },
                // 행 스타일 제거
                resetRowStyle: function (self, row) {
                    var index = [];

                    if ($.type(row) !== 'array' && $.type(row) === 'number') {
                        index.push(row);
                    } else if ($.type(row) === 'array') {
                        index = row;
                    } else {
                        return;
                    }

                    for (var i = self.options.rowDynamic.length - 1; i >= 0; i-=1) {
                        for (var j = 0; j < index.length; j+=1) {
                            if (self.options.rowDynamic[i].criteria === '(dataRow = ' + index[j] + ')') {
                                self.options.rowDynamic.splice(i, 1);
                            }
                        }
                    }
                    self._grid.setStyles({
                        body: {
                            dynamicStyles: self.options.rowDynamic
                        }
                    });
                },
                // 행 데이터 변경
                updateRow: function (self, row, data) {
                    if (self.options.dataSource) {
                        self._grid.commit(true);
                        self.options.dataSource.dataProvider.updateRow(row, data);

                        for (var i = 0; i < Object.keys(data).length; i+=1) {
                            if (self.options.dataSource.dataProvider.getFieldIndex(Object.keys(data)[i]) !== -1) {
                                self._grid.onCellEdited.call(self, self._grid, row, row, self.options.dataSource.dataProvider.getFieldIndex(Object.keys(data)[i]));
                            }
                        }
                    }
                },
                // 행 상태값 변경
                setRowState: function (self, index, state) {
                    var dataRow = index,
                        status;

                    if (state.toLowerCase() === 'added') {
                        state = 'created';
                    }

                    status = state.toLowerCase();

                    if (index === self._grid.getCurrent().itemIndex) {
                        dataRow = self._grid.getDataRow(index);
                    }

                    if (self.options.dataSource && self.options.dataSource.dataProvider) {
                        self.options.dataSource.dataProvider.setRowState(dataRow, status);
                    }
                },
                // 행 상태값 호출
                getRowState: function (self, index) {
                    if (self.options.dataSource && index !== -1) {
                        var state;
                        if (self._grid.getItemState(index) === 'appending') {
                            state = 'added';
                        } else {
                            state = self.options.dataSource.dataProvider.getRowState(index);
                            if (state === 'created') {
                                state = 'added';
                            }
                        }
                        return state;
                    }
                },
                // 컬럼 보이기
                showColumn: function (self, field) {
                    var column = self._grid.columnByName(field);

                    if ($.type(column) !== 'undefined' && $.type(column) !== 'null') {
                        self._grid.setColumnProperty(column, 'visible', true);
                        self.columns[column.name].visible = true;
                        // 부모 요소 visible 설정
                        if ($.type(column.parent) !== 'undefined') {
                            self.showColumn(column.parent);
                        }

                        self.options.displayColumns = [];
                        dews.ui.gridUtil.displayColumns(self, self._grid.getDisplayColumns());
                    }
                },
                // 컬럼 숨기기
                hideColumn: function (self, field) {
                    var column = self._grid.columnByName(field);

                    if ($.type(column) !== 'undefined' && $.type(column) !== 'null') {
                        self._grid.setColumnProperty(column, 'visible', false);
                        self.columns[column.name].visible = false;
                        // 부모요소가 있을 경우 적용
                        if ($.type(column.parent) !== 'null') {
                            var parent = self.columns[column.parent],
                                flag = true;

                            if ($.type(parent) !== 'undefined') {
                                // 자식 요소의 visible 상태 확인
                                $.each(parent.columns, function (idx, col) {
                                    if (self._grid.columnByName(col.name).visible) {
                                        flag = false;
                                    }
                                });

                                if (flag) {
                                    self.hideColumn(column.parent);
                                }
                            }
                        }

                        self.options.displayColumns = [];
                        dews.ui.gridUtil.displayColumns(self, self._grid.getDisplayColumns());
                    }
                },
                // 정렬
                sort: function (self, options) {
                    var field = [],
                        dir = [];

                    if (options.length > 1) {
                        for (var i = 0; i < options.length; i+=1) {
                            field.push(options[i].field);
                            if (options[i].dir === 'asc') {
                                dir.push('ASCENDING');
                            } else {
                                dir.push('DESCENDING ');
                            }
                        }
                    } else {
                        field.push(options.field);
                        if (options.dir === 'asc') {
                            dir.push('ASCENDING');
                        } else {
                            dir.push('DESCENDING ');
                        }
                    }

                    self._grid.orderBy(field, dir);
                },
                // 엑셀 다운로드
                saveAsExcel: function (self, option) {
                    var opt = {
                            allPages: true,
                            target: 'local'
                        };

                    opt = $.extend(true, opt, option);

                    self._grid.exportGrid({
                        'type': 'excel',
                        'target': opt.target,
                        'fileName': opt.fileName,
                        'allItem': opt.allPages,
                        'applyDynamicStyles': true
                    });
                },
                // 컨텍스트 메뉴 설정
                setContextMenu: function (self, options) {
                    var items = [],
                        option = {
                            excelDownload: true,
                            items: []
                        };

                    if ($.type(options) === 'object') {
                        $.extend(true, option, options);
                    } else if($.type(options) === 'array') {
                        $.extend(true, option.items, options);
                    }

                    if ($.type(option) === 'boolean' || $.type(option) !== 'undefined') {
                        if (option.excelDownload) {
                            var fieldName = self._grid.name;
                            option.items.unshift(
                                {
                                    id: 'downLoad_excel',
                                    text: '엑셀 내려 받기',
                                    handler: function (e) {
                                        self.saveAsExcel({fileName: fieldName});
                                    },
                                    display: function (e) {
                                        return true;
                                    }
                                }
                            );
                        }
                    }

                    self.options.contextMenu = option.items;

                    for (var i = 0; i < option.items.length; i++) {
                        if (option.items[i].text) {
                            self.options.contextMenu[i].text = option.items[i].text;
                            items.push({label: option.items[i].text});
                        }

                        if (option.items[i].display) {
                            self.options.contextMenu[i].display = option.items[i].display;
                        }

                        if (option.items[i].handler) {
                            self.options.contextMenu[i].handler = option.items[i].handler;
                        }
                    }

                    self._grid.setContextMenu(items);
                },
                // 포커스 설정
                setFocus: function (self) {
                    self.$element.click();
                    self._grid.setFocus();
                },
                // 체크된 행 반환
                getCheckedRows: function (self) {
                    var data = self._grid.getCheckedRows(),
                        datasource = [];

                    if (self.options.dataSource) {
                        for (var i =0; i < data.length; i+=1) {
                            datasource.push(self.options.dataSource.dataProvider.getJsonRow(data[i]));
                        }
                    }

                    return datasource;
                },
                // 체크한 행 필드 값 반환
                getCheckedValues: function (self, field) {
                    var data = [];

                    $.each(self.getCheckedIndex(), function (idx, rowId) {
                        data.push(self.options.dataSource.dataProvider.getJsonRow(rowId)[field]);
                    });

                    return data;
                },
                // 데이터소스 설정
                setDataSource: function (self) {
                    delete self.options.fieldIndex;
                    self._grid.setDataProvider(self.options.dataSource.dataProvider);
                    self._grid.setColumns(self.options.columns);
                    self._grid.setHeader({height: self.options.maxDepth * self.options.header.minHeight});
                    if (self.options.grouping) {
                        self.options.display.rowHeight = self.options.display.minHeight * self.options.maxGroupCol;
                    }
                    self._grid.setOptions(self.options);
                },
                // 컬럼 설정
                setColumns: function (self, result) {
                    delete self.options.fieldIndex;
                    self.options.displayColumns = [];
                    $.extend(true, self.options, result);
                    if (self.options.dataSource) {
                        self.options.dataSource.setFields(self.options.dataSource.options.field);
                    }
                    if (self.options.grouping) {
                        self.options.display.rowHeight = self.options.display.minHeight * self.options.maxGroupCol;
                    }
                    self._grid.setColumns(result.columns);
                    self._grid.setHeader({height: self.options.maxDepth * self.options.header.minHeight});
                    self._grid.setOptions(self.options);
                    self.columns = {};
                    dews.ui.gridUtil._setColumns(self, self.options.columns);
                    dews.ui.gridUtil.displayColumns(self, self._grid.getDisplayColumns());
                },
                // 내부에서 사용할 컬럼 설정
                _setColumns: function (self, columns) {
                    for (var i = 0; i < columns.length; i++) {
                        if (columns[i].columns) {
                            if ($.type(columns[i].name) !== 'undefined') {
                                self.columns[columns[i].name] = columns[i];
                            }
                            dews.ui.gridUtil._setColumns(self, columns[i].columns);
                        } else if ($.type(columns[i].name) !== 'undefined') {
                            self.columns[columns[i].name] = columns[i];
                        }
                    }
                },
                // 수정가능한 마지막셀인지 확인
                lastEditCell: function (self, displayColumn, displayIndex, value, editParams) {
                    var i, column;
                    if (displayIndex === displayColumn.length-1) {
                        value = true;
                    } else {
                        for (i = displayIndex+1; i < displayColumn.length; i+=1) {
                            editParams.cell.field = displayColumn[i].field;
                            column = self.columns[displayColumn[i].field];
                            if (self._grid.getColumnProperty(column.field, 'editable')) {
                                if (column.editor && $.type(column.editor.editable) !== 'undefined' && column.editor.editable.call(self, editParams)) {
                                    break;
                                } else if (column.editor && ($.type(column.editor.editable) === 'undefined' || column.editor.editable.call(self, editParams))) {
                                    break;
                                } else if (i === displayColumn.length -1) {
                                    value = true;
                                    break;
                                }
                            } else if (i === displayColumn.length -1) {
                                value = true;
                                break;
                            }
                        }
                    }
                    return value;
                },
                // 색상 설정
                setCellStyle: function (self, index, field, styles) {
                    var criteria = "dataRow=" + parseInt(index);

                    if ($.type(self.options.cellStyles) !== 'array') {
                        self.options.cellStyles = [];
                    }

                    if (styles) {
                        // 셀 보더 설정
                        if ($.type(styles.cellBorder) !== 'undefined') {
                            var border = '';
                            if ($.type(styles.cellBorder.color) !== 'undefined') {
                                border = styles.cellBorder.color + ', ';
                            }

                            if ($.type(styles.cellBorder.width) !== 'undefined') {
                                border += styles.cellBorder.width;
                            }

                            styles.borderRight = border;
                            styles.borderBottom = border;
                        }
                        // 그리드 폰트 설정
                        if ($.type(styles.font) !== 'undefined') {
                            styles.fontFamily = $.type(styles.font.family) === 'undefined' ? styles.fontFamily : styles.font.family;
                            styles.fontSize = $.type(styles.font.size) === 'undefined' ? styles.fontSize : styles.font.size;
                            styles.fontBold = $.type(styles.font.bold) === 'undefined' ? styles.fontBold : styles.font.bold;
                        }
                        // 그리드 패딩 설정
                        if ($.type(styles.padding) !== 'undefined') {
                            styles.paddingTop = $.type(styles.padding.top) === 'undefined' ? styles.paddingTop : styles.padding.top;
                            styles.paddingBottom = $.type(styles.padding.bottom) === 'undefined' ? styles.paddingBottom : styles.padding.bottom;
                            styles.paddingLeft = $.type(styles.padding.left) === 'undefined' ? styles.paddingLeft : styles.padding.left;
                            styles.paddingRight = $.type(styles.padding.right) === 'undefined' ? styles.paddingRight : styles.padding.right;
                        }

                        if (styles.textAlign) {
                            switch (styles.textAlign) {
                                case 'left':
                                    styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    styles.textAlignment = 'far';
                                    break;
                                case 'center':
                                    styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if (styles.verticalAlign) {
                            switch (styles.verticalAlign) {
                                case 'top' :
                                    styles.lineAlignment = 'near';
                                    break;
                                case 'bottom':
                                    styles.lineAlignment = 'far';
                                    break;
                                case 'middle':
                                    styles.lineAlignment = 'center';
                                    break;
                            }
                        }
                    }

                    self.options.cellStyles.push({criteria: criteria, styles: styles});

                    var cellStyle = [];
                    if (self._grid.getColumnProperty(self._grid.columnByField(field), 'dynamicStyles')) {
                        cellStyle = self._grid.getColumnProperty(self._grid.columnByField(field), 'dynamicStyles');
                    }
                    cellStyle.push({criteria: criteria, styles: styles});

                    self._grid.setColumnProperty(self._grid.columnByField(field), 'dynamicStyles', cellStyle);
                },
                // 그리드 텍스트박스 maxLength 설정
                setMaxLength: function (self, field, length) {
                    var column = self.columns[field];
                    var options = $.extend(true, self._grid.getColumnProperty(field, 'editorOptions'), {maxLength: length});

                    if (column && column.editor && column.editor.type === 'text' && length > -1) {
                        self._grid.setColumnProperty(field, 'editorOptions', options);
                    }
                },
                // 그리드 헤더 체크박시 노출 여부 설정
                setHeaderCheckVisible: function (self, visible) {
                    self._grid.setCheckBar({'showAll': visible});
                },
                // 그리드 부모 데이터 반환
                getParentData: function (self) {
                    if (self.options.dataSource && self.options.dataSource.options.parent) {
                        return self.options.dataSource.options.parent.data();
                    }
                },
                // 그리드 자식 데이터 반환
                getChildData: function (self, index, gridId) {
                    var data = self.dataItem(index),
                        uid,
                        detail,
                        dataSourceId,
                        masterDataSource = self.options.dataSource,
                        detailDatSource;

                    if ($.type(data) === 'undefined') {
                        return;
                    }

                    if ($.type(masterDataSource) !== 'undefined') {
                        detailDatSource = masterDataSource.options.detailDataSource;
                    }

                    if ($.type(gridId) !== 'undefined') {
                        detail = $('#' + gridId, self.$content).data('dews-control');
                        if (detail.options.dataSource && detail.options.dataSource.options.parentDataSource) {
                            dataSourceId = detail.options.dataSource.options.parentDataSource.id;
                        }

                        if ($.type(dataSourceId) !== 'undefined') {
                            detailDatSource = masterDataSource.options.master[dataSourceId];
                        }
                    }

                    uid = data._uid;
                    if ($.type(uid) !== 'undefined') {
                        if (masterDataSource && detailDatSource && detailDatSource.options.lineDataSources[uid]) {
                            return detailDatSource.options.lineDataSources[uid].data();
                        }
                    }
                },
                // 자동화 인쇄 관련 코드
                _getExcelUrlForPrint: function (self, menuName) {
                    var grid = self._grid._gv,
                        $dfd = $.Deferred(),
                        fileName = menuName + '.xlsx',
                        url,
                        exportGrid = new Grids.GridExcelExporter();
                    // 데이터 존재시만 실행
                    if (self.dataItems().length !== 0) {
                        // 엑셀 blob 파일 추출
                        exportGrid.$_export = function (parts, options) {
                            if (JSZip.support.blob || !options.target()) {
                                var zip = new JSZip();
                                for (var i = 0; i < parts.length; i++) {
                                    var s = parts[i].body;
                                    s.indexOf("xmlns=\"\"") >= 0 && (s = s.replace(/ xmlns=""/g, '').replace(/xmlns=""/g, ''));
                                    zip.file(parts[i].key, s);
                                }
                                var blob = zip.generate({type: "blob", compression: "DEFLATE"});
                                blob.name = fileName;
                                url = blob;
                            }
                        };
                        // 엑셀 다운로드 실행
                        exportGrid.export(grid, {target: 'local', 'applyDynamicStyles': true});

                        var token = (dews.ui.page) ? JSON.parse(dews.ui.page.token).access_token : '';
                        var formData = new FormData();
                        formData.append('file', url);
                        formData.append('isText', 'false');
                        formData.append('token', token);

                        var xhr = new XMLHttpRequest();
                        xhr.open('POST', '/upload/file', true);
                        xhr.addEventListener('load', function () {
                            if (this.status === 200) {
                                var data = JSON.parse(this.responseText).data,
                                    downloadUrl;

                                dews.api.get('/auth/temporary/token', {})
                                    .done(function (tokenData) {
                                        downloadUrl = '/download/tempfile?key='+encodeURIComponent(data.newFilename)+'&filename=' + fileName + '&token=' + encodeURIComponent(tokenData);

                                        $dfd.resolve(downloadUrl);
                                    }).fail(function () {
                                    $dfd.reject('error');
                                });
                            } else {
                                $dfd.reject('error');
                            }
                        });
                        xhr.addEventListener('error', function () {
                            $dfd.reject('error');
                        });

                        xhr.send(formData);
                    } else {
                        $dfd.reject('error');
                    }

                    return $dfd.promise();
                },
                // 이미지 버튼 클릭 설정시
                onImageButtonClicked: function (self, itemIndex, column, parameter) {
                    var columns = self.columns[column.fieldName];
                    // 그리드 내 코드피커 클릭 시 발생하는 이벤트
                    if (column.editor === 'codepicker' || column.editor.type === 'codepicker') {
                        if (columns.editor.firstClick) {
                            var codeOption = {},
                                helpEvent,
                                keyword,
                                index = itemIndex;

                            if (columns.codeOption.validation) {
                                if ($.type(columns.codeOption.value[itemIndex]) === 'undefined') {
                                    columns.codeOption.value[itemIndex] = {
                                        code: '',
                                        text: '',
                                        value: self._grid.getValue(itemIndex, columns.fieldName)
                                    };
                                }
                            }

                            codeOption = columns.codeOption;
                            if (columns.editor.callback) {
                                self.options.callback = columns.editor.callback;
                            }

                            if ($.isFunction(columns.editor.helpParams)) {
                                codeOption.params = columns.editor.helpParams.call(self);
                            } else {
                                codeOption.params = columns.editor.helpParams;
                            }

                            if ($.type(self._grid.getEditValue()) !== 'undefined') {
                                keyword = self._grid.getEditValue();
                            } else {
                                keyword = self._grid.getValue(itemIndex, column.fieldName);
                            }
                            codeOption.params = $.extend(true, codeOption.params, {'keyword': keyword});

                            codeOption.callback = function (data) {
                                if ($.type(data) !== 'undefined') {
                                    if ($.isArray(data)) {
                                        throw '두 개 이상의 항목을 코드피커에 설정할 수 없습니다.';
                                    } else {
                                        if (self.options._grid === true && $.type(self.options._gridCallback) === 'function') {
                                            self.options._gridCallback(data, columns, index);
                                        }
                                    }
                                }
                            };

                            helpEvent = new $.Event('codedialog', codeOption);
                            self.$element.trigger(helpEvent);
                            // 그리드 내 코드피커가 실행됫을 경우 닫혔을때 그리드에 포커스 설정
                            var dialog = dews.ui.dialog(helpEvent.code);
                            if (dialog) {
                                dialog._kendoWindow.bind('close', function (e) {
                                    self._grid.setFocus();
                                });
                            }

                            if (self._grid.getEditingItem()) {
                                columns.editor.firstClick = false;
                            }
                        }
                    }
                    // 그리드 내 셀 버튼 클릭 시 발생하는 이벤트
                    if (column.editor === 'button' || column.editor.type ==='button') {
                        if ($.type(columns.editor.click) === 'function') {
                            columns.editor.click.call(self, parameter);
                        }
                    }
                    // 우편번호 피커 사용시
                    if (column.editor === 'zipcodepicker' || column.editor.type === 'zipcodepicker') {
                        var $postCodeWrapper,
                            $postCodeTitle,
                            $postCodeContent,
                            $closeButton;

                        // 우편번호 다이얼로그가 1개만 출력 되도록 설정
                        if ($('#zipcodepicker-dialog').length === 0) {
                            // 우편번호 다이얼로그 생성
                            $postCodeWrapper = $('<div />').attr('id', 'zipcodepicker-dialog')
                                .addClass('postcode-wrapper');
                            $postCodeTitle = $('<div><span>우편번호 서비스</span><span class="close-btn"></span></div>')
                                .addClass('postcode-title');
                            $postCodeContent = $('<div />').addClass('postcode-content');
                            $closeButton = $postCodeTitle.find('.close-btn');

                            $postCodeWrapper.append($postCodeTitle);
                            $postCodeWrapper.append($postCodeContent);

                            $('body').append($postCodeWrapper);

                            var zIndex = dews.ui.getDialogMaxZIndex();

                            if (zIndex > parseInt($postCodeWrapper.css('zIndex'), 10)) {
                                $postCodeWrapper.css('zIndex', zIndex + 2);
                            }

                            var windowWidth = window.innerWidth || document.documentElement.clientWidth,
                                windowHeight = window.innerHeight || document.documentElement.clientHeight,
                                dialogWidth = parseInt($postCodeWrapper.css('width')),
                                dialogHeight = parseInt($postCodeWrapper.css('height'));

                            $postCodeWrapper.css({
                                left: Math.ceil((windowWidth - dialogWidth) / 2),
                                top: Math.ceil((windowHeight - dialogHeight) / 2)
                            });

                            // 닫기 버튼 핸들링
                            $closeButton.on('click', function () {
                                $postCodeWrapper.remove();
                                $postCodeWrapper.css('zIndex', '');
                                $(window).off('keydown', keyEvent);
                            });

                            $(window).on('keydown', keyEvent);

                            function keyEvent(e) {
                                if (e.keyCode === 27) {
                                    $closeButton.click();
                                }
                                e.stopPropagation();
                            }

                            $('#region_name').on('keydown', function (e) {
                                console.log(e);
                            });

                            new daum.Postcode({
                                oncomplete: function (data) {
                                    var result = {
                                        zipcode: data.postcode,
                                        jibun: data.jibunAddress,
                                        street: data.address
                                    };

                                    if (data.bname !== '') {
                                        result.street += data.bname;
                                    }
                                    // 건물명이 있을 경우 추가한다.
                                    if (data.buildingName !== '') {
                                        result.street += ', ' + data.buildingName;
                                    }

                                    if ($.type(columns.codeOption.callback) === 'function') {
                                        columns.codeOption.callback.call(self, self.dataItem(self.select()), result, self.select());
                                    } else {
                                        self._grid.setValue(self.select(), columns.fieldName, result[columns.codeOption.addressType]);
                                    }
                                    $postCodeWrapper.remove();
                                },
                                width: '100%',
                                height: '100%',
                                maxSuggestItems: 5
                            }).embed($postCodeContent[0]);
                        }
                    }
                },
                // 그리드 callback
                _gridCallback: function (self, data, columns, index) {
                    var item, current, column;

                    if ($.type(data) === 'array' && data.length === 1) {
                        item = data[0];
                    } else if ($.type(data) === 'object') {
                        item = data;
                    }

                    if (item) {
                        current = index;
                        column = columns;
                        self.closeCell();
                        if (self.options.callback && $.type(self.options.callback) === 'function') {
                            self.options.callback.call(self, self.dataItem(current), item, index);
                        } else if ($.type(column.editor.textField) !== 'undefined') {
                            self._grid.setValue(current, column.fieldName, item[column.editor.textField]);
                        }

                        if (column.codeOption.validation) {
                            column.codeOption.value[index] = {
                                code: item[column.editor.codeField],
                                text: item[column.editor.textField],
                                value: self._grid.getValue(index, column.fieldName)
                            };
                        }
                        self._grid.commit();
                    }
                },
                // 링크 포맷 이벤트
                onLinkableCellClicked: function (self, index, linkUrl, parameter) {
                    if (self.columns[index.column].formats.useMenu) {
                        var module = self.columns[index.column].formats.module,
                            menu = self.columns[index.column].formats.menu,
                            data = self.columns[index.column].formats.data;

                        if ($.type(module) === 'function') {
                            module = module.call(self, parameter);
                        }

                        if ($.type(menu) === 'function') {
                            menu = menu.call(self, parameter);
                        }

                        if ($.type(data) === 'function') {
                            data = data.call(self, parameter);
                        } else if ($.type(data) !== 'object') {
                            data = {};
                        }

                        dews.ui.openMenu(module, menu, data);
                    } else {
                        window.open(dews.url.getAbsoluteUrl(linkUrl), '_blank');
                    }
                },
                // 수정 모드 진입시점
                onShowEditor: function (self, id, index, parameter) {
                    if ($.type(index.fieldName) !== 'null') {
                        var field = index.fieldName,
                            align = self._grid.getColumnProperty(index.fieldName, 'styles').textAlignment, event,
                            textAlign = 'center',
                            editInput = $('#'+id.name+'_line', self.options.$content),
                            editDropdown = $('#'+id.name+'_dropdown', self.options.$content),
                            multiInput = $('#'+id.name+'_multiline', self.options.$content),
                            editDate = $('#' + id.name + '_date', self.options.$content),
                            editPass = $('#' + id.name + '_password', self.options.$content);

                        event = new $.Event('cellEditing', parameter);
                        self.$element.trigger(event);

                        if ($.type(self.options.editValue) === 'boolean' && !self.options.editValue) {
                            var result = self.options.editValue;
                            delete self.options.editValue;
                            return result;
                        }

                        switch (align) {
                            case 'far':
                                textAlign = 'right';
                                break;
                            case 'near':
                                textAlign = 'left';
                                break;
                            default :
                                break;
                        }

                        if (editInput.length !== 0 && self._grid.columnByField(index.column).editor.toLowerCase() !== 'date' && self._grid.columnByField(index.column).editor.toLowerCase() !== 'dropdown'
                            && self._grid.columnByField(index.column).editor.toLowerCase() !== 'password' && self._grid.columnByField(index.column).editor.toLowerCase() !== 'multiline') {
                            editInput.css('textAlign', textAlign);
                            editInput.select();
                        }

                        if (editDate.length !== 0 && self._grid.columnByField(index.column).editor.toLowerCase() === 'date') {
                            editDate.css('textAlign', textAlign);
                            editDate.select();
                        }

                        if (editDropdown.length !== 0 && self._grid.columnByField(index.column).editor.toLowerCase() === 'dropdown') {
                            editDropdown.css('textAlign', textAlign);
                            editDropdown.select();
                        }

                        if (editPass.length !== 0 && self._grid.columnByField(index.column).editor.toLowerCase() === 'password') {
                            editPass.css('textAlign', textAlign);
                            editPass.select();
                        }

                        if (multiInput.length !== 0 && self._grid.columnByField(index.column).editor.toLowerCase() === 'multiline') {
                            multiInput.css('textAlign', textAlign);
                        }

                        if (self.columns[field] && self.columns[field].editor.type.toLowerCase() === 'codepicker' && self.columns[field].codeOption.validation) {
                            self.columns[field].codeOption.value[index.itemIndex] = {
                                value: self._grid.getValue(index.itemIndex, field)
                            };
                        }

                        self.editable = true;
                        return true;
                    }
                },
                // 수정 모드 종료시점
                onHideEditor: function (self, grid, index) {
                    var column = self.columns[index.fieldName];

                    if (self._grid.getEditValue() !== '') {
                        // 코드피커 키보드 이벤트
                        if (column && column.editor && (column.editor.type).toLowerCase() === 'codepicker' && self._grid.getColumnProperty(column.name, 'buttonVisibility') === 'visible') {
                            var codeOption = {},
                                keyword,
                                helpEvent;

                            codeOption = column.codeOption;

                            if (column.editor.callback) {
                                self.options.callback = column.editor.callback;
                            }

                            if ($.isFunction(column.editor.helpParams)) {
                                codeOption.params = column.editor.helpParams.call(self);
                            } else {
                                codeOption.params = column.editor.helpParams;
                            }
                            keyword = self._grid.getValue(index.itemIndex, column.field);
                            codeOption.params = $.extend(true, codeOption.params, {'keyword': keyword});

                            codeOption.callback = function (data) {
                                if ($.type(data) !== 'undefined') {
                                    if (($.isArray(data) && data.length !== 1) || !column.codeOption.useAjax) {
                                        self._grid.onImageButtonClicked.call(self, self._grid, index.itemIndex, column);
                                    } else {
                                        if (self.options._grid === true && $.type(self.options._gridCallback) === 'function') {
                                            self.options._gridCallback(data, column, index.itemIndex);
                                        }
                                    }
                                } else {
                                    self._grid.onImageButtonClicked.call(self, self._grid, index.itemIndex, column);
                                }
                            };

                            if (self._grid.getValue(index.itemIndex, column.fieldName) !== "") {
                                if ($.type(codeOption.value[index.itemIndex]) !== 'undefined' &&
                                    self._grid.getValue(index.itemIndex, column.fieldName) !== codeOption.value[index.itemIndex].value) {
                                    helpEvent = new $.Event('codesearch', codeOption);
                                    self.$element.closest('.dews-data-control').trigger(helpEvent);
                                }
                            }

                            // 그리드 내 코드피커 사용 하여 공통 도움창 띄운 이후 닫을때 설정
                            self.$element.on('codedialogclosed', function (e) {
                                // 공통도움창에서 ESC키 혹은 close 시켰을 경우에만 발생하게 설정
                                if (column.codeOption.validation) {
                                    if ($.type(column.codeOption.value[index.itemIndex]) === 'undefined') {
                                        column.codeOption.value[index.itemIndex] = {
                                            code: '',
                                            text: '',
                                            value: self._grid.getValue(index.itemIndex, column.fieldName)
                                        };
                                    }

                                    if (column.codeOption.value[index.itemIndex].value === undefined) {
                                        self._grid.setValue(index.itemIndex, column.fieldName, '');
                                    } else {
                                        if (self._grid.getValue(index.itemIndex, column.fieldName) === '') {
                                            self._grid.setValue(index.itemIndex, column.fieldName, '');
                                            column.codeOption.value[index.itemIndex].value = '';
                                        } else {
                                            self._grid.setValue(index.itemIndex, column.fieldName, column.codeOption.value[index.itemIndex].value);
                                        }
                                    }
                                }
                                self._grid.commit();
                                self.$element.off('codedialogclosed');
                                column.editor.firstClick = true;
                            });
                        }
                    }
                },
                // 컨텍스트 메뉴 아이템 설정
                onContextMenuPopup: function (self, currentCell, parameter) {
                    var displayIndex = [], items = [];
                    // 정렬시 변경되어야 할 부
                    if ($.type(self._grid.getSortedFields() !== 'null')) {
                        parameter.row.index = currentCell.itemIndex;
                        parameter.row.data = self.dataItem(currentCell.itemIndex);
                        parameter.cell.data = self._grid.getValue(currentCell.itemIndex, currentCell.fieldName);
                    }

                    for (var i = 0; i < self.options.contextMenu.length; i+=1) {
                        var bool = self.options.contextMenu[i].display.call(self, parameter);

                        if (bool) {
                            displayIndex.push(i);
                        }
                    }

                    for (var j = 0; j < displayIndex.length; j+=1) {
                        items.push({label: self.options.contextMenu[displayIndex[j]].text});
                    }
                    self._grid.setContextMenu(items);
                },
                // 컨텍스트 메뉴 아이템 클릭
                onContextMenuItemClicked: function (self, index, label, parameter) {
                    // 정렬시 변경되어야 할 부
                    if ($.type(self._grid.getSortedFields() !== 'null')) {
                        parameter.row.index = index.itemIndex;
                        parameter.row.data = self.dataItem(index.itemIndex);
                        parameter.cell.data = self._grid.getValue(index.itemIndex, index.fieldName);
                    }

                    for (var i = 0; i < self.options.contextMenu.length; i+=1) {
                        if (self.options.contextMenu[i].text === label.label) {
                            self.options.contextMenu[i].handler.call(self, parameter);
                        }
                    }
                },
                // 드롭다운리스트 2개 사용시
                onGetEditValue: function (self, index, editResult) {
                    var column = self.columns[index.fieldName];
                    if (column && column.editor && column.editor.type.toLowerCase() === 'dropdown' && $.type(column.editor.dataSource) === 'function') {
                        if (column.editor.dataValueField && column.editor.dataTextField) {
                            self._grid.setValue(index.itemIndex, column.editor.dataTextField, editResult.text);
                        }
                    }

                    if (column && column.editor && (column.editor.type).toLowerCase() === 'dropdown' && !column.editor.textReadOnly) {
                        if (column.labels.indexOf(self._grid.getEditValue()) === -1 && column.values.indexOf(self._grid.getEditValue()) === -1) {
                            self._grid.cancel();
                        }
                    }
                },
                // 복사 붙여넣기 사용시
                onEditRowPasted: function (self, newValues, className) {
                    var codeOption = {},
                        keyword,
                        helpEvent,
                        index = self.select(),
                        column = self.columns[self._grid.getCurrent().fieldName];

                    if (column.editor.type.toLowerCase() === 'codepicker') {
                        codeOption = column.codeOption;

                        if (column.editor.callback) {
                            self.options.callback = column.editor.callback;
                        }

                        if ($.isFunction(column.editor.helpParams)) {
                            codeOption.params = column.editor.helpParams.call(self);
                        } else {
                            codeOption.params = column.editor.helpParams;
                        }
                        keyword = newValues[0];
                        codeOption.params = $.extend(true, codeOption.params, {'keyword': keyword});

                        codeOption.callback = function (data) {
                            if ($.type(data) !== 'undefined') {
                                if (($.isArray(data) && data.length !== 1) || !column.codeOption.useAjax) {
                                    self._grid.onImageButtonClicked.call(self, self._grid, self._grid.getCurrent().itemIndex, column);
                                } else {
                                    if (self.options._grid === true && $.type(self.options._gridCallback) === 'function') {
                                        self.options._gridCallback(data, column, index);
                                    }
                                }
                            } else {
                                self._grid.onImageButtonClicked.call(self, self._grid, self._grid.getCurrent().itemIndex, column);
                            }
                        };

                        helpEvent = new $.Event('codesearch', codeOption);
                        self.$element.closest(className).trigger(helpEvent);

                        // 그리드 내 코드피커 사용 하여 공통 도움창 띄운 이후 닫을때 설정
                        self.$element.on('codedialogclosed', function (e) {
                            // 공통도움창에서 ESC키 혹은 close 시켰을 경우에만 발생하게 설정
                            var current = self._grid.getCurrent();
                            if (column.codeOption.validation) {
                                if ($.type(column.codeOption.value[self.select()]) === 'undefined') {
                                    column.codeOption.value[self.select()] = {
                                        code: '',
                                        text: '',
                                        value: self._grid.getValue(current.itemIndex, column.fieldName)
                                    };
                                }

                                if (column.codeOption.value[self.select()].value === undefined) {
                                    self._grid.setValue(current.itemIndex, column.fieldName, '');
                                } else {
                                    if (self._grid.getValue(current.itemIndex, column.fieldName) === '') {
                                        self._grid.setValue(current.itemIndex, column.fieldName, '');
                                        column.codeOption.value[self.select()].value = '';
                                    } else {
                                        self._grid.setValue(current.itemIndex, column.fieldName, column.codeOption.value[self.select()].value);
                                    }
                                }
                            }

                            self.$element.off('codedialogclosed');
                        });
                    }
                }
            }
        }
    });
})(jQuery, window.dews);


/*
 * 레이아웃 관련 기능
 */
(function ($, dews, kendo) {

    /**
     * 버튼그룹
     */
    function buttonGroup($container) {
        // 공백문자를 제거
        $('.dews-button-group').htmlClean();
        $('.dews-dialog-button-group').htmlClean(); // TODO: 다이얼로그 버튼 그룹이라는 클래스는 제거 해야 함 - 제거 후 이 라인 삭제할 것
    }

    $(function () {
        $(document).on("inituicontrols", function (e, target) {
            var $container;

            if (target instanceof jQuery) {
                $container = target;
            } else if ($.type(target) === 'string') {
                $container = $(target);
            } else {
                $container = $(document);
            }

            // 버튼그룹 관련 처리
            buttonGroup($container);

        });
    });
})(jQuery, window.dews, window.kendo);

/*
 * 로딩 화면
 */
(function ($, dews, kendo) {

    function getTarget(main) {
        var target, win;
        if ($.type(main) === 'boolean' || $.type(main) === 'undefined') {
            if (main) {
                win = dews.getMainFrameWindowObject(window);
            } else {
                win = window;
            }
            target = win.$(win.document.body);
        }

        return target;
    }

    function getOptions(options) {
        var defaultOptions = {
            text: 'LOADING...',
            type: 'default'
        };

        return $.extend(true, defaultOptions, options);
    }

    function LoadingIndicator(target, forElement, options) {
        var self = this, opt;

        opt = getOptions(options);

        self.target = target;
        self.forElement = forElement;
        self.option = opt;
    }

    /**
     * 로딩, 배경을 생성합니다.
     */
    LoadingIndicator.prototype.create = function () {
        var self = this,
            $bg, $loading;

        $bg = $('<div class="dews-loading-bg" />');
        $loading = $('<div class="dews-ui-loading"><div class="dews-loading-container">' +
            '<div class="dews-loading-img"></div></div><p class="dews-loading-text"></p></div>');


        if (self.forElement) {
            self.target.css({position: 'relative'});
            $loading.css({position: 'absolute'});
            $bg.css({width: self.target.width() + 'px', height: self.target.height() + 'px', position:'absolute'});
        }
        self.target.append($loading);
        self.target.append($bg);

        if(self.option.text !== false) {
            $loading.find('> .dews-loading-text')[0].innerHTML = this.option.text;
        }

        switch (self.option.type) {
            case 'full':
                $loading.addClass('loading-full');
                $bg.addClass('loading-full');
                break;
            case 'tiny':
                $loading.addClass('loading-tiny');
                break;
            case 'snackbar':
                $loading.addClass('loading-snack');
                break;
            default :
                break;
        }
    };

    /**
     * 로딩, 배경을 삭제합니다.
     */
    LoadingIndicator.prototype.remove = function () {
        var self = this;

        self.target.find('> .dews-loading-bg').remove();
        self.target.find('> .dews-ui-loading').remove();
    };

    $.extend(true, dews, {
        ui: {
            loading: {
                show : function(options){
                    var $target, loading,
                        forElement = false;

                    if ($.type(options) === 'undefined') {
                        options = {target: undefined};
                    }

                    if (options.target instanceof jQuery) {
                        forElement = true;
                        $target = options.target;
                    } else if ($.type(options.target) === "string") {
                        forElement = true;
                        $target = $(options.target);
                    } else {
                        $target = getTarget(options.target);
                    }

                    loading = $target.data('dews-control');

                    if (!loading) {
                        loading = new LoadingIndicator($target, forElement, options);
                        loading.create();

                        $target.data('dews-control', loading);
                    }
                },
                hide : function(options){
                    var $target, loading;

                    if ($.type(options) === 'undefined') {
                        options = {target: undefined};
                    }

                    if (options.target instanceof jQuery) {
                        $target = options.target;
                    } else if ($.type(options.target) === "string") {
                        $target = $(options.target);
                    } else {
                        $target = getTarget(options.target);
                    }

                    loading = $target.data('dews-control');

                    if (loading) {
                        $target.removeData('dews-control');
                        loading.remove();
                    }
                }
            }
        }
    });

})(jQuery, window.dews, window.kendo);


(function (dews) {
    var dictionary = [
        {'key': 'dews_확인', 'ko': '확인', 'en': 'OK', 'ja': '確認', 'zh': '确认'},
        {'key': 'dews_선택', 'ko': '선택', 'en': 'Confirm', 'ja': '選択', 'zh': '选择'},
        {'key': 'dews_오류', 'ko': '오류', 'en': 'Error', 'ja': 'エラー', 'zh': '错误'},
        {'key': 'dews_예', 'ko': '예', 'en': 'Yes', 'ja': '例', 'zh': '是的'},
        {'key': 'dews_아니요', 'ko': '아니요', 'en': 'No', 'ja': 'いいえ', 'zh': '没有'},
        {'key': 'dews_취소', 'ko': '취소', 'en': 'Cancel', 'ja': 'キャンセル', 'zh': '取消'},
        {'key': 'dews_자세히', 'ko': '자세히', 'en': 'Detail', 'ja': '詳細', 'zh': '详细'},
        {'key': 'dews_적용', 'ko': '적용', 'en': 'Apply', 'ja': '適用', 'zh': '适用'},
        {'key': 'dews_오늘', 'ko': '오늘', 'en': 'Today ', 'ja': '今日 ', 'zh': '今天'},
        {'key': 'dews_어제', 'ko': '어제', 'en': 'Yesterday', 'ja': '昨日', 'zh': '昨天'},
        {'key': 'dews_주간', 'ko': '주간', 'en': 'Weekly', 'ja': '週間', 'zh': '周刊'},
        {'key': 'dews_전주', 'ko': '전주', 'en': 'Last week', 'ja': '先週', 'zh': '上周'},
        {'key': 'dews_당월', 'ko': '당월', 'en': 'Month', 'ja': '当月', 'zh': '这个月'},
        {'key': 'dews_전월', 'ko': '전월', 'en': 'Last month', 'ja': '前月', 'zh': '上个月'},
        {'key': 'dews_오늘까지', 'ko': '오늘까지', 'en': 'Until today', 'ja': '今日まで', 'zh': '直到今天'},
        {'key': 'dews_1/4분기', 'ko': '1/4분기', 'en': '1Q', 'ja': '第1四半期', 'zh': '一季度'},
        {'key': 'dews_2/4분기', 'ko': '2/4분기', 'en': '2Q', 'ja': '第2四半期', 'zh': '二季度'},
        {'key': 'dews_3/4분기', 'ko': '3/4분기', 'en': '3Q', 'ja': '第3四半期', 'zh': '三季度'},
        {'key': 'dews_4/4분기', 'ko': '4/4분기', 'en': '4Q', 'ja': '第4四半期', 'zh': '四季度'},
        {'key': 'dews_상반기', 'ko': '상반기', 'en': 'First half', 'ja': '上半期', 'zh': '上半年'},
        {'key': 'dews_하반기', 'ko': '하반기', 'en': 'Second half', 'ja': '下半期', 'zh': '下半年'},
        {'key': 'dews_1월', 'ko': '1월', 'en': 'Jan', 'ja': '1月', 'zh': '1月'},
        {'key': 'dews_2월', 'ko': '2월', 'en': 'Feb', 'ja': '2月', 'zh': '2月'},
        {'key': 'dews_3월', 'ko': '3월', 'en': 'Mar', 'ja': '3月', 'zh': '3月'},
        {'key': 'dews_4월', 'ko': '4월', 'en': 'Apr', 'ja': '4月', 'zh': '4月'},
        {'key': 'dews_5월', 'ko': '5월', 'en': 'May', 'ja': '5月', 'zh': '5月'},
        {'key': 'dews_6월', 'ko': '6월', 'en': 'Jun', 'ja': '6月', 'zh': '6月'},
        {'key': 'dews_7월', 'ko': '7월', 'en': 'Jul', 'ja': '7月', 'zh': '7月'},
        {'key': 'dews_8월', 'ko': '8월', 'en': 'Aug', 'ja': '8月', 'zh': '8月'},
        {'key': 'dews_9월', 'ko': '9월', 'en': 'Sep', 'ja': '9月', 'zh': '9月'},
        {'key': 'dews_10월', 'ko': '10월', 'en': 'Oct', 'ja': '10月', 'zh': '10月'},
        {'key': 'dews_11월', 'ko': '11월', 'en': 'Nov', 'ja': '11月', 'zh': '11月'},
        {'key': 'dews_12월', 'ko': '12월', 'en': 'Dec', 'ja': '12月', 'zh': '12月'},
        {'key': 'dews_선택한 기간', 'ko': '선택한 기간', 'en': 'Selected period', 'ja': '選択した期間', 'zh': '其间'},
        {'key': 'dews_선택 기간', 'ko': '선택 기간', 'en': 'Selected period', 'ja': '選択した期間', 'zh': '其间'},
        {'key': 'dews_올해', 'ko': '올해', 'en': 'This year', 'ja': '今年', 'zh': '今年'},
        {'key': 'dews_적용하기', 'ko': '적용하기', 'en': 'Apply', 'ja': '適用する', 'zh': '适用'},
        {'key': 'dews_닫기', 'ko': '닫기', 'en': 'Close', 'ja': '閉じる', 'zh': '关闭'},
        {'key': 'dews_저장', 'ko': '저장', 'en': 'Save', 'ja': '保存', 'zh': '貯藏'},
        {'key': 'dews_전체삭제', 'ko': '전체삭제', 'en': 'Remove all', 'ja': 'すべて削除', 'zh': '全部删除'},
        {'key': 'dews_데이터가 없습니다.', 'ko': '데이터가 없습니다.', 'en': 'No data.', 'ja': 'データがありません。', 'zh': '没有数据。'},
        {'key': 'dews_외', 'ko': '외', 'en': 'etc', 'ja': '外', 'zh': '外'},
        {'key': 'dews_건', 'ko': '건', 'en': 'case', 'ja': '件', 'zh': '件'},
        {'key': 'dews_필수 입력 항목입니다.', 'ko': '필수 입력 항목입니다.', 'en': 'Required field.', 'ja': '必須入力項目です。', 'zh': '必填。'},
        {'key': 'dews_처음', 'ko': '처음', 'en': 'First', 'ja': '最初のページ', 'zh': '第一页'},
        {'key': 'dews_이전', 'ko': '이전', 'en': 'Previous', 'ja': '前のページ', 'zh': '上一页'},
        {'key': 'dews_다음', 'ko': '다음', 'en': 'Next', 'ja': '次のページ', 'zh': '下一页'},
        {'key': 'dews_마지막', 'ko': '마지막', 'en': 'Last', 'ja': '最後のページ', 'zh': '最后一页'},
        {'key': 'dews_번호', 'ko': '번호', 'en': 'NO', 'ja': 'NO', 'zh': 'NO'},
        {'key': 'dews_전체선택', 'ko': '전체선택', 'en': 'Select All', 'ja': '全選択', 'zh': '选择全部'},
        {'key': 'dews_업로드', 'ko': '업로드', 'en': 'Upload', 'ja': 'アップロード', 'zh': '上传'},
        {'key': 'dews_다운로드', 'ko': '다운로드', 'en': 'Download', 'ja': 'ダウンロード', 'zh': '下载'},
        {'key': 'dews_삭제', 'ko': '삭제', 'en': 'Delete', 'ja': '削除', 'zh': '删除'},
        {'key': 'dews_초기화', 'ko': '초기화', 'en': 'Reset', 'ja': '初期化する', 'zh': '初始化'},
        {'key': 'dews_년Y', 'ko': '년', 'en': ' ', 'ja': '年', 'zh': '年'},
        {
            'key': 'dews_여기에 드래그 하세요.',
            'ko': '여기에 드래그 하세요.',
            'en': 'Drag it here.',
            'ja': 'ここにドラッグしてください.',
            'zh': '拖动到这里.'
        },
        {
            'key': 'dews_위의 항목을 드래그해서 여기로 끌어놓으면 화면에서 보여지지 않습니다.',
            'ko': '위의 항목을 드래그해서 여기로 끌어놓으면 화면에서 보여지지 않습니다.',
            'en': 'If you drag and drop the item above, it will not be shown on the screen.',
            'ja': '上の項目をドラッグアンドドロップすると、画面に表示されません。.',
            'zh': '如果拖放上述项目，它们将不会显示在屏幕上。.'
        }
    ];

    // dews.localization 에 언어별 등록
    var dicForLang = {};
    var language, page;

    if (dews.localize.mode() === 'multiple') {
        page = 'global';
    }

    for (var i = 0; i < dictionary.length; i++) {
        for (var prop in dictionary[i]) {
            if (dictionary[i].hasOwnProperty(prop) && prop !== 'key') {
                if (!dicForLang.hasOwnProperty(prop)) {
                    dicForLang[prop] = {};
                }
                language = dicForLang[prop];
                language[dictionary[i].key] = dictionary[i][prop];
            }
        }
    }

    for (var lang in dicForLang) {
        if (dicForLang.hasOwnProperty(lang)) {
            dews.localize.setResource(dicForLang[lang], lang, page);
        }
    }
})(window.dews);


/*
 * 메인버튼
 */

(function ($, dews) {

    function MainButton(selector) {
        var self = this;
        self._element = selector;

        return self;
    }

    MainButton.prototype.show = function () {
        var self = this;
        $(self._element).parent('li').show();
    };

    MainButton.prototype.hide = function () {
        var self = this;
        $(self._element).parent('li').hide();
    };

    MainButton.prototype.disable = function (bool) {
        var self = this,
            button;

        button = $(self._element);

        bool = (typeof bool === 'undefined') ? true : bool;

        button.attr('disabled', bool);

        return button.prop('disabled');
    };

    MainButton.prototype.on = function () {
        var self = this;
        var $button = $(self._element);
        $button.on.apply($button, arguments);
    };

    MainButton.prototype.click = function () {
        var self = this;
        var $button = $(self._element);
        $button.click.apply($button, arguments);
    };

    dews = $.extend(true, dews, {
        ui: {
            mainbuttons: {
                approval: new MainButton('.main-button.approval'),
                add: new MainButton('.main-button.add'),
                delete: new MainButton('.main-button.delete'),
                save: new MainButton('.main-button.save'),
                search: new MainButton('.main-button.lookup'),
                print: new MainButton('.main-button.print'),
                configure: new MainButton('.main-button.configure')
            }
        }
    });
})(jQuery, window.dews || {});

/*
 * 마스크 텍스트 박스
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        unmaskOnPost: true
    };

    /**
     * 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var inlineOptions;
            // preDefinedFormat;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};
        // preDefinedFormat = dews.getPreDefinedFormat($el);

        // if (preDefinedFormat) {
        //     preDefinedFormat = {mask: preDefinedFormat};
        //     return $.extend(true, {}, defaultOptions, inlineOptions, codeOptions, preDefinedFormat);
        // } else { //마스크텍스트박스에는 기본포맷이 없으므로
            // return $.extend(true, {}, defaultOptions, inlineOptions, codeOptions);
        // }

        return $.extend(true, {}, defaultOptions, inlineOptions, codeOptions);
    }

    /**
     * HTML 코드 상에 선언되어 있는 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 설정 값
     */
    function getInlineOptions($el) {
        var options = {}, mask, prompt;

        if ($el) {
            if ($el.data('dews-mask')) {
                options.mask = $el.data('dews-mask');
            }
            if ($el.data('dews-prompt')) {
                options.promptChar = $el.data('dews-prompt');
                if (!($.type(options.promptChar) === 'string' && options.promptChar.length === 1)) {
                    delete options.promptChar;
                }
            }
            if ($el.data('dews-unmask-on-post')) {
                options.unmaskOnPost = /true/i.test($el.data('dews-unmask-on-post'));
            }
        }

        return options;
    }

    /**
     * 컨트롤을 초기화 합니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체
     * @param {object} [options] 설정 값
     */
    function initControl($el, options) {
        var wrapper = $el.closest('.k-maskedtextbox');

        if (wrapper.hasClass('dews-ui-maskedtextbox')) {
            wrapper.removeClass('dews-ui-maskedtextbox');
        }

        if (wrapper.hasClass('dews-form-control')) {
            wrapper.removeClass('dews-form-control');
        }

        if (!wrapper.hasClass('dews-maskedtextbox-wrapper')) {
            wrapper.addClass('dews-maskedtextbox-wrapper');
        }

        $el.on('click', function () {
            if ($(this).prop('readonly') === false && $(this).prop('disabled') === false) {
                // 읽기 전용이 아닐 경우에는 포커스가 오면 텍스트 전체를 선택합니다.
                $(this).select();
            }
        });

        if($el.attr('placeholder') && $el.data('dews-placeholder-localize-key')) {
            $el.attr('placeholder', dews.localize.get($el.attr('placeholder'), $el.data('dews-placeholder-localize-key'), $el.data('dews-placeholder-localize-lang') || null));
        }

        setUserGuideAPI($el);
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 마스크 텍스트 박스를 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 마스크 텍스트 박스를 생성하거나 가져올 요소에 대한 셀렉터 또는 jQuery 객체
             * @param {object} [options] 생성 시 사용할 옵션
             */
            maskedtextbox: function (selector, options) {
                var $el,
                    textbox;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        text,
                        opt;

                    text = $this.data('dews-control');

                    if (!text) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass('dews-ui-maskedtextbox')) {
                            $this.addClass('dews-ui-maskedtextbox');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        dews.ui.util.ConvertClassAndProperty($this);

                        $this.kendoMaskedTextBox(opt);
                        text = $this.data('kendoMaskedTextBox');

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        initControl($this, opt);

                        $this.data('dews-control', text);
                    }

                    textbox = text;
                });

                return textbox;
            }
        }
    });

    // readonly 함수 확장
    kendo.ui.MaskedTextBox.fn.readonly = (function (readonly) {
        return function (value) {
            var self = this;

            if (typeof value === 'undefined') {
                // 값을 반환
                return self.element.prop('readonly');
            } else {
                // 읽기전용 여부 설정
                if (value) {
                    if (!self.element.hasClass('readonly')) {
                        self.element.addClass('readonly');
                    }
                } else {
                    if (self.element.hasClass('readonly')) {
                        self.element.removeClass('readonly');
                    }
                }
            }

            readonly.call(self, value);
        };
    })(kendo.ui.MaskedTextBox.fn.readonly);

    // enable 함수 확장
    kendo.ui.MaskedTextBox.fn.enable = (function (enable) {
        return function (value) {
            var self = this;

            if (typeof value === 'undefined') {
                // 값을 반환
                return !self.element.prop('disabled');
            } else {
                // 활성화 설정
                if (value) {
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                } else {
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                }
            }

            enable.call(self, value);
        };
    })(kendo.ui.MaskedTextBox.fn.enable);

    kendo.ui.MaskedTextBox.fn.on = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    };

    kendo.ui.MaskedTextBox.fn.off = function() {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    };

    kendo.ui.MaskedTextBox.fn.validate = function () {
        var self = this;
        return !!self.value();
    };

    kendo.ui.MaskedTextBox.fn.bindFromPanel = function(data) {
        var self = this, $element = self.element;
        var column;

        if (data) {

            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.value(data[column]);
            }
        }
    };

    kendo.ui.MaskedTextBox.fn.serializeForPanel = function () {
        var self = this, $element = self.element;
        var column, data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            if (self.options.unmaskOnPost) {
                data[column] = self.raw();
            } else {
                data[column] = self.value();
            }
        }

        return data;
    };

    kendo.ui.MaskedTextBox.fn.applyPanelFocus = function () {
        var self = this, $element = self.element;

        $element.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    kendo.ui.MaskedTextBox.fn.focus = function () {
        var self = this, $element = self.element;

        $element.focus();
    };

    kendo.ui.MaskedTextBox.fn.canFocusable = function () {
        var self = this, $element = self.element;

        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    };

    /**
     * 마스크텍스트박스 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    kendo.ui.MaskedTextBox.fn._getPrintData = function () {
        var self = this,
            $el = self.element,
            data;

        if (self.value()) {
            data = {
                id: $el.attr('id'),
                text: self.value()
            }
        }

        return data;
    };

    dews.ui.addControlInitializer('maskedtextbox', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.maskedtextbox($('input[type="text"].dews-ui-maskedtextbox', $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 월기간피커
 * Created by yejin on 2017. 6. 22..
 */

(function ($, dews, kendo) {

    var defaultOptions = {
        startDate: null,
        endDate: null,
        max: 2100,
        min: 1900,
        format: dews._environments.formats.monthFormat,
        valueFormat: dews._environments.formats.monthValueFormat
    };

    function getOptions($el, srcOptions) {
        var inlineOptions,
            preDefinedFormat,
            options;

        inlineOptions = getInlineOptions($el);
        preDefinedFormat = dews.getPreDefinedFormat($el);

        if(preDefinedFormat) {
            var vf = preDefinedFormat.replace(/[^(a-z)]/gi,"");
            preDefinedFormat = {
                format: preDefinedFormat,
                valueFormat: vf
            };
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions, preDefinedFormat);
        } else if (preDefinedFormat !== false && inlineOptions){
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions);
        } else {
            options = $.extend(true, {}, defaultOptions, srcOptions);
        }

        if ($el.val()) {
            options.value = kendo.parseDate($el.val(), options.valueFormat, kendo.getCulture());
        }

        return options;
    }

    /**
     * HTML 태그에 지정된 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 옵션
     */
    function getInlineOptions($el) {
        var options = {};

        if ($el.data('dews-format')) { //개발자가 기본으로 지정된 포맷(yyyy-MM)말고 다른 포맷을 지정하고 싶을때
            options.format = $el.data('dews-format');
            options.valueFormat = $el.data('dews-format').replace(/[^(a-z)]/gi,"");
        }
        if ($el.data('dews-start-date')) {
            options.startDate = $el.data('dews-start-date');
        }
        if ($el.data('dews-end-date')) {
            options.endDate = $el.data('dews-end-date');
        }
        return options;
    }

    var MonthPeriodPicker = function (element, options) {
        var self = this, $element = element;
        var thisYear = new Date().getYear() + 1900;

        self.options = getOptions($element, options);

        self._wrapper = null;
        self._startInput = null;
        self._endInput = null;
        self._calenderButton = null;
        self._hiddenArea = null;
        self._buttons = null;
        self._buttons2 = null;
        self.okButton = null;
        self.option = null;
        self.oneQuearterButton = null;
        self.twoQuearterButton = null;
        self.threeQuearterButton = null;
        self.fourQuearterButton = null;
        self.firstHalfButton = null;
        self.secondHalfButton = null;
        self.disableButton = false;
        self._thisYear = thisYear;

        self._element = $element;
    };

    MonthPeriodPicker.prototype._createWrapper = function () {
        var self = this, $el = self._element, $wrapper, width;

        $wrapper = $("<span/>").addClass("dews-monthperiodpicker-wrapper").addClass("k-picker-wrap").addClass('k-state-default');

        if ($el.attr('style')) {
            var matches = $el.attr('style').match(/width:([^;]+);?/i);

            if (matches) {
                width = $.trim(matches[1]);
                $wrapper.width(width);
                $el.css("width","");
            }
        }

        if ($el.hasClass('readonly')) {
            $wrapper.addClass('dews-state-readonly');
            self.disableButton = true;
        }
        if ($el.hasClass('disabled')) {
            $wrapper.addClass('dews-state-disabled');
            self.disableButton = true;
        }
        if ($el.hasClass('required')) {
            $wrapper.addClass('dews-state-required');
        }

        // if ($wrapper.width() < 142) {
        //     $wrapper.width(142);
        // }

        self._wrapper = $wrapper;
        $el.append($wrapper);
    };

    // 시작날짜 텍스트박스 생성
    MonthPeriodPicker.prototype._createStartInput = function () {
        var self = this, $el = self._element, $startInput, opt;

        $startInput = $("<input/>").addClass("dews-monthperiodpicker-input dews-monthperiodpicker-startDate k-textbox k-space-right");

        if ($el.hasClass('readonly')) {
            $startInput.addClass('dews-state-readonly');
            $startInput.attr("readonly", "readonly");
        }
        if ($el.hasClass('disabled')) {
            $startInput.addClass('dews-state-disabled');
            $startInput.attr("disabled", "disabled");
        }
        if ($el.hasClass('required')) {
            $startInput.addClass('dews-state-required');
        }

        opt = self.options;

        setMask($startInput, opt.format);
        setEvent($startInput, opt);

        self._wrapper.append($startInput);
        self._startInput = $startInput;
    };

    // 종료날짜 텍스트박스 생성
    MonthPeriodPicker.prototype._createEndInput = function () {
        var self = this, $el = self._element, $endInput, $span, opt;

        $endInput = $("<input/>").addClass("dews-monthperiodpicker-input dews-monthperiodpicker-endDate k-textbox k-space-right");
        $span = $("<span>~</span>").addClass("dews-monthperiodpicker-span");

        if ($el.hasClass('readonly')) {
            $endInput.addClass('dews-state-readonly');
            $endInput.attr("readonly", "readonly");
        }
        if ($el.hasClass('disabled')) {
            $endInput.addClass('dews-state-disabled');
            $endInput.attr("disabled", "disabled");
        }
        if ($el.hasClass('required')) {
            $endInput.addClass('dews-state-required');
        }

        opt = self.options;

        setMask($endInput, opt.format);
        setEvent($endInput, opt);

        self._wrapper.append($span);
        self._wrapper.append($endInput);
        self._endInput = $endInput;
    };

    // 달력버튼 생성
    MonthPeriodPicker.prototype._createCalendarButton = function () {
        var self = this, $calendarButton, $img;

        $calendarButton = $("<span/>").addClass("k-select");
        $img = $("<span/>").addClass("k-icon k-i-calendar");

        self._wrapper.append($calendarButton);
        $calendarButton.append($img);
        self._calenderButton = $calendarButton;
    };

    // 숨겨진 영역 생성
    MonthPeriodPicker.prototype._createHiddenArea = function () {
        var self = this, $el = self._element, $hiddenArea;

        $hiddenArea = $("<div/>").addClass("dews-monthperiodpicker-calendars");

        $(document.body).append($hiddenArea);
        self._hiddenArea = $hiddenArea;
    };

    // 월 버튼 영역 생성
    MonthPeriodPicker.prototype._createMonthButtonArea = function () {
        var self = this, $option;

        $option = $("<div/>").addClass("dews-monthperiodpicker-option");

        self._hiddenArea.empty().append($option);
        self.option = $option;
    };

    // 버튼 생성
    MonthPeriodPicker.prototype._createButtons = function () {
        var self = this,
            $oneQuearterButton, $twoQuearterButton, $threeQuearterButton, $fourQuearterButton,
            $firstHalfButton, $secondHalfButton, $thisYearButton,
            $januaryButton, $februaryButton, $marchButton, $aprilButton, $mayButton,
            $juneButton, $julyButton, $augustButton, $septemberButton, $octoberButton, $novemberButton, $decemberButton;

        $oneQuearterButton = $("<button type='button'>" + dews.localize.get('1/4분기', 'dews_1/4분기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-quearter dews-monthperiod-onequearter");
        $twoQuearterButton = $("<button type='button'>" + dews.localize.get('2/4분기', 'dews_2/4분기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-quearter dews-monthperiod-twoquearter");
        $threeQuearterButton = $("<button type='button'>" + dews.localize.get('3/4분기', 'dews_3/4분기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-quearter dews-monthperiod-threequearter");
        $fourQuearterButton = $("<button type='button'>" + dews.localize.get('4/4분기', 'dews_4/4분기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-quearter dews-monthperiod-fourquearter");
        $firstHalfButton = $("<button type='button'>" + dews.localize.get('상반기', 'dews_상반기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-half dews-monthperiod-onehalf");
        $secondHalfButton = $("<button type='button'>" + dews.localize.get('하반기', 'dews_하반기') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-half dews-monthperiod-twohalf");
        $thisYearButton = $("<button type='button'>" + dews.localize.get('올해', 'dews_올해') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-year dews-monthperiod-thisyear");

        $januaryButton = $("<button type='button'>" + dews.localize.get('1월', 'dews_1월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-january");
        $februaryButton = $("<button type='button'>" + dews.localize.get('2월', 'dews_2월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-february");
        $marchButton = $("<button type='button'>" + dews.localize.get('3월', 'dews_3월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-march");
        $aprilButton = $("<button type='button'>" + dews.localize.get('4월', 'dews_4월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-april");
        $mayButton = $("<button type='button'>" + dews.localize.get('5월', 'dews_5월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-may");
        $juneButton = $("<button type='button'>" + dews.localize.get('6월', 'dews_6월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-june");
        $julyButton = $("<button type='button'>" + dews.localize.get('7월', 'dews_7월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-july");
        $augustButton = $("<button type='button'>" + dews.localize.get('8월', 'dews_8월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-august");
        $septemberButton = $("<button type='button'>" + dews.localize.get('9월', 'dews_9월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-september");
        $octoberButton = $("<button type='button'>" + dews.localize.get('10월', 'dews_10월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-october");
        $novemberButton = $("<button type='button'>" + dews.localize.get('11월', 'dews_11월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-november");
        $decemberButton = $("<button type='button'>" + dews.localize.get('12월', 'dews_12월') + "</button>").addClass("dews-monthperiod-button dews-monthperiod-months dews-monthperiod-december");

        if (dews.localize.getLanguage() === 'en') {
            $('.dews-monthperiod-button').css({
                'letter-spacing': '-1px',
                'font-weight': '200'
            });
        }
        self.option.append($oneQuearterButton).append($twoQuearterButton).append($threeQuearterButton).append($fourQuearterButton);
        self.option.append($firstHalfButton).append($secondHalfButton).append($thisYearButton);
        self.option.append($januaryButton).append($februaryButton).append($marchButton).append($aprilButton);
        self.option.append($mayButton).append($juneButton).append($julyButton).append($augustButton);
        self.option.append($septemberButton).append($octoberButton).append($novemberButton).append($decemberButton);

        self.oneQuearterButton = $oneQuearterButton;
        self.twoQuearterButton = $twoQuearterButton;
        self.threeQuearterButton = $threeQuearterButton;
        self.fourQuearterButton = $fourQuearterButton;
        self.firstHalfButton = $firstHalfButton;
        self.secondHalfButton = $secondHalfButton;
        self.thisYearButton = $thisYearButton;

        self.januaryBtn = $januaryButton;
        self.februaryBtn = $februaryButton;
        self.marchBtn = $marchButton;
        self.aprilBtn = $aprilButton;
        self.mayBtn = $mayButton;
        self.juneBtn = $juneButton;
        self.julyBtn = $julyButton;
        self.augustBtn = $augustButton;
        self.septemberBtn = $septemberButton;
        self.octoberBtn = $octoberButton;
        self.novemberBtn = $novemberButton;
        self.decemberBtn = $decemberButton;
    };

    //선택한 기간, 적용하기 버튼 영역 생성
    MonthPeriodPicker.prototype._createOkButtonArea = function () {
        var self = this, $buttons, $buttons2;

        $buttons = $("<div/>").addClass("dews-monthperiodpicker-buttons");
        $buttons2 = $("<div/>").addClass("dews-monthperiodpicker-buttons2");

        self._hiddenArea.append($buttons).append($buttons2);
        self._buttons = $buttons;
        self._buttons2 = $buttons2;
    };

    //숫자텍스박스 생성
    MonthPeriodPicker.prototype._createNumericTextBox = function () {
        var self = this, $firstYear, $secondYear, $firstMonth, $secondMonth, $periodSelect;

        $periodSelect = $("<p>" + dews.localize.get('선택 기간', 'dews_선택 기간') + " :<br/></p>").addClass("dews-monthperiodpicker-periodSelect");
        $firstYear = $("<input type='text' data-dews-spinners='true' max=2100 min='1900' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-monthperiodpicker-firstyear");
        $firstMonth = $("<input type='text' data-dews-spinners='true' max='12' min='1' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-monthperiodpicker-firstmonth");
        $secondYear = $("<input type='text' data-dews-spinners='true' max='2100' min='1900' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-monthperiodpicker-secondyear");
        $secondMonth = $("<input type='text' data-dews-spinners='true' max='12' min='1' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-monthperiodpicker-secondmonth");

        self._buttons.append($periodSelect).append($firstYear).append("<span class='dews-monthperiodpicker-year'>년</span>").append($firstMonth).append("<span  class='dews-monthperiodpicker-month'>월</span>")
            .append("<span class=dews-monthperiodpicker-period>~</span>").append($secondYear).append("<span class='dews-monthperiodpicker-year'>년</span>").append($secondMonth).append("<span  class='dews-monthperiodpicker-month'>월</span>");

        self.firstYear = dews.ui.numerictextbox($firstYear);
        self.firstMonth = dews.ui.numerictextbox($firstMonth);
        self.secondYear = dews.ui.numerictextbox($secondYear);
        self.secondMonth = dews.ui.numerictextbox($secondMonth);
    };

    //적용하기 버튼 생성
    MonthPeriodPicker.prototype._createOkButton = function () {
        var self = this, $okButton;

        $okButton = $("<button type='button'>" + dews.localize.get('적용하기', 'dews_적용하기') + "</button>").addClass("dews-ui-button small primary dews-monthperiodpicker-ok k-button");

        self._buttons2.append($okButton);
        self.okButton = $okButton;
    };

    MonthPeriodPicker.prototype._setNumericTextBoxValue = function (startY, startM, lastY, lastM) {
        var self = this;

        self.firstYear.value(startY);
        self.firstMonth.value(startM);
        self.secondYear.value(lastY);
        self.secondMonth.value(lastM);
    };

    // 컨트롤 초기화
    MonthPeriodPicker.prototype._initControl = function () {
        var self = this;

        self._createWrapper();
        self._createStartInput();
        self._createEndInput();
        self._createCalendarButton();
        self._createHiddenArea();
        self._createMonthButtonArea();
        self._createButtons();
        self._createOkButtonArea();
        self._createNumericTextBox();
        self._createOkButton();
        self._setNumericTextBoxValue();
        self._bindEvents();

        self.setUserGuideAPI();
    };

    //시작날짜 설정 함수
    MonthPeriodPicker.prototype.setStartDate = function (value) {
        var self = this;

        if (value === "") {
            self._startInput.val("");

        } else if (!isNaN(value)) {
            var newDate, startYear, startMonth;
            if($.type(value) === 'date'){
                newDate = value;
                startYear = newDate.getFullYear();
                startMonth = newDate.getMonth()+1 > 10 ? newDate.getMonth()+1 : '0'+(newDate.getMonth()+1).toString();
            }else {
                var dateValue = value.toString();
                newDate = kendo.parseDate(dateValue, self.options.valueFormat, kendo.getCulture());
                startYear = newDate.getFullYear();
                startMonth = newDate.getMonth() + 1;
            }

            dateValue = kendo.toString(newDate, self.options.format, kendo.getCulture());

            if (self._endInput.val() && (self._endInput.val() < dateValue)) {
                self._startInput.val("");
            } else {
                self.firstYear.value(startYear);
                self.firstMonth.value(startMonth);

                self._startInput.val(dateValue);
            }
        }
    };

    //종료날짜 설정 함수
    MonthPeriodPicker.prototype.setEndDate = function (value) {
        var self = this;

        if (value === "") {
            self._endInput.val("");

        }else if (!isNaN(value)) {
            var newDate, endYear, endMonth;
            if($.type(value) === 'date'){
                newDate = value;
                endYear = newDate.getFullYear();
                endMonth = newDate.getMonth()+1 > 10 ? newDate.getMonth()+1 : '0'+(newDate.getMonth()+1).toString();
            }else {
                var dateValue = value.toString();
                newDate = kendo.parseDate(dateValue, self.options.valueFormat, kendo.getCulture());
                endYear = newDate.getFullYear();
                endMonth = newDate.getMonth() + 1;
            }
            dateValue = kendo.toString(newDate, self.options.format, kendo.getCulture());

            if (self._startInput.val() && self._startInput.val() > dateValue) {
                self._endInput.val('');
            } else {
                self.secondYear.value(endYear);
                self.secondMonth.value(endMonth);

                self._endInput.val(dateValue);
            }
        }
    };

    //시작날짜 가져오는 함수(포맷 지정된 값)
    MonthPeriodPicker.prototype.getStartText = function () {
        var self = this,
            date;

        if (self._startInput.val()) {
            date = kendo.parseDate(self._startInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.monthFormat, kendo.getCulture()) || '';
        } else {
            return '';
        }
    };

    //종료날짜 가져오는 함수(포맷 지정된 값)
    MonthPeriodPicker.prototype.getEndText = function () {
        var self = this,
            date;

        if (self._endInput.val()) {
            date = kendo.parseDate(self._endInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.monthFormat, kendo.getCulture()) || '';
        } else {
            return '';
        }
    };

    //시작날짜 가져오는 함수(포맷 지정되지 않은 값)
    MonthPeriodPicker.prototype.getStartDate = function () {
        var self = this,
            date;

        if(self._startInput.val()){
            date = kendo.parseDate(self._startInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.monthValueFormat, kendo.getCulture()) || '';
        } else {
            return '';
        }
    };

    //종료날짜 가져오는 함수(포맷 지정되지 않은 값)
    MonthPeriodPicker.prototype.getEndDate = function () {
        var self = this,
            date;

        if(self._endInput.val()){
            date = kendo.parseDate(self._endInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.monthValueFormat, kendo.getCulture()) || '';
        } else {
            return '';
        }
    };

    MonthPeriodPicker.prototype.setPeriod = function () {
        var self = this;
        var date = new Date(),
            now = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        var startYear = now.getYear() + 1900;
        var endYear = now.getYear() + 1900;
        var startMonth, endMonth, startDate, endDate;
        var length = arguments.length;

        //파라미터 개수에 따라 다른 처리
        if(length === 1){
            var period = arguments[0];

            if (period.toUpperCase() === 'THIS_YEAR') {
                startMonth = 1;
                endMonth = 12;

            } else if (period.toUpperCase() === 'THIS_MONTH') {
                startMonth = 1;
                endMonth = now.getMonth() + 1 ;

            } else if (period.toUpperCase() === '1ST_HALF') {
                startMonth = 1;
                endMonth = 6;

            } else if (period.toUpperCase() === '2ND_HALF') {
                startMonth =  7;
                endMonth = 12;

            } else if (period.toUpperCase() === '1Q') {
                startMonth = 1;
                endMonth = 3;

            } else if (period.toUpperCase() === '2Q') {
                startMonth = 4;
                endMonth = 6;

            } else if (period.toUpperCase() === '3Q') {
                startMonth = 7;
                endMonth = 9;

            } else if (period.toUpperCase() === '4Q') {
                startMonth = 10;
                endMonth = 12;
            }

            var newStartDate = new Date(startYear, startMonth-1);
            var newEndDate = new Date(endYear, endMonth-1);

            self._startInput.val(kendo.toString(newStartDate, self.options.format, kendo.getCulture()));
            self._endInput.val(kendo.toString(newEndDate, self.options.format, kendo.getCulture()));

            self._setNumericTextBoxValue(startYear, startMonth, endYear, endMonth);

        }
        else if(length === 2){
            startDate = arguments[0];
            endDate = arguments[1];

            if(startDate || endDate) {
                if(typeof startDate === "undefined" || startDate === null) {

                } else {
                    var newStartDate = kendo.parseDate(startDate, dews._environments.formats.monthValueFormat, kendo.getCulture());
                    startYear = newStartDate ? newStartDate.getFullYear() : '';
                    startMonth = newStartDate ? newStartDate.getMonth() + 1 : '';
                }
                if(typeof endDate === "undefined" || endDate === null) {

                } else {
                    var newEndDate = kendo.parseDate(endDate, dews._environments.formats.monthValueFormat, kendo.getCulture());
                    endYear = newEndDate ? newEndDate.getFullYear() : '';
                    endMonth = newEndDate ? newEndDate.getMonth() + 1 : '';
                }

                if((startDate <= endDate) && (startDate && endDate)) {
                    self._startInput.val(kendo.toString(newStartDate, self.options.format, kendo.getCulture()));
                    self._endInput.val(kendo.toString(newEndDate, self.options.format, kendo.getCulture()));
                } else if ((startDate > endDate) && (startDate && endDate)) {
                    self._startInput.val("");
                    self._endInput.val("");
                } else if(startYear && startMonth) {
                    self._startInput.val(kendo.toString(newStartDate, self.options.format, kendo.getCulture()));
                    self._endInput.val("");
                } else if(endYear && endMonth) {
                    self._startInput.val("");
                    self._endInput.val(kendo.toString(newEndDate, self.options.format, kendo.getCulture()));
                } else if(!startDate) {
                    self._startInput.val("");
                } else {
                    self._endInput.val("");
                }
                self._setNumericTextBoxValue(startYear, startMonth, endYear, endMonth);
            } else if(!startDate && !endDate) {
                self._startInput.val("");
                self._endInput.val("");

                self._setNumericTextBoxValue('', '', '', '');
            }
        }
    };

    MonthPeriodPicker.prototype.enable = function (value) {
        var self = this,
            $el = $(self._element),
            enabled;

        enabled = !$el.hasClass("disabled");

        if (typeof value !== 'undefined') {
            if (value === true) {
                $el.removeClass("disabled");
                self._wrapper.removeClass("dews-state-disabled");
                self._startInput.removeAttr("disabled", "disabled");
                self._endInput.removeAttr("disabled", "disabled");
                self._startInput.removeClass("dews-state-disabled");
                self._endInput.removeClass("dews-state-disabled");
                enabled = !value;
            } else if (value === false) {
                $el.addClass("disabled");
                self._wrapper.addClass("dews-state-disabled");
                self._startInput.attr("disabled", "disabled");
                self._endInput.attr("disabled", "disabled");
                self._startInput.addClass("dews-state-disabled");
                self._endInput.addClass("dews-state-disabled");
                enabled = !value;
            }
        }

        return enabled;
    };

    MonthPeriodPicker.prototype.readonly = function (value) {
        var self = this,
            $el = $(self._element),
            readonly;

        readonly = $el.hasClass("readonly");

        if (typeof value !== 'undefined') {
            if (value === false) {
                $el.removeClass("readonly");
                self._wrapper.removeClass("dews-state-readonly");
                self._startInput.removeAttr("readonly", "readonly");
                self._endInput.removeAttr("readonly", "readonly");
                self._startInput.removeClass("dews-state-readonly");
                self._endInput.removeClass("dews-state-readonly");
                self.disableButton = false;
                readonly = !value;
            } else if (value === true) {
                $el.addClass("readonly");
                self._wrapper.addClass("dews-state-readonly");
                self._startInput.attr("readonly", "readonly");
                self._endInput.attr("readonly", "readonly");
                self._startInput.addClass("dews-state-readonly");
                self._endInput.addClass("dews-state-readonly");
                self.disableButton = true;
                readonly = !value;
            }
        }

        return readonly;
    };

    MonthPeriodPicker.prototype.focus = function (options) {
        var self = this;

        if (options === "start") {
            self._startInput.focus();
        } else if (options === "end") {
            self._endInput.focus();
        } else if (options === undefined) {
            if (self._startInput.val()) {
                self._endInput.focus();
            } else {
                self._startInput.focus();
            }
        }
    };

    MonthPeriodPicker.prototype._bindEvents = function () {
        var self = this, $el = self._element;
        var toggle = true;
        var date = new Date(),
            now = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        var $offset = 0;

        self._startInput.on("focus",function (e) {
            self._wrapper.addClass('dews-monthperiodpicker-focus');
            e.stopPropagation();
        });

        self._endInput.on("focus",function (e) {
            self._wrapper.addClass('dews-monthperiodpicker-focus');
            e.stopPropagation();
        });

        self._startInput.on("blur",function (e) {
            self._wrapper.removeClass('dews-monthperiodpicker-focus');
            e.stopPropagation();
        });

        self._endInput.on("blur",function (e) {
            self._wrapper.removeClass('dews-monthperiodpicker-focus');
            e.stopPropagation();
        });


        function clickButtons(fm, lm) {
            clear();
            var firstDate = new Date(date.getFullYear(), fm);
            var lastDate = new Date(date.getFullYear(), lm);

            getYearMonth(firstDate, lastDate);
            addClassToButton(fm, lm);
        }

        var popoverClose = function (e) {
            if((e.type === "scroll" && (!$(e.target).parents('.dews-monthperiodpicker-calendars')[0])) || (e.type === 'keyup' && e.keyCode === 27)) {
                close();
                clear();
                $(e.target).focus();
                if (self._startInput.val() === "") {
                    setNumerictextboxValue("", self._endInput.val());
                } else if (self._endInput.val() === "") {
                    setNumerictextboxValue(self._startInput.val(), "");
                }
            }
        };

        function bindCloseEvent() {
            window.addEventListener('scroll', popoverClose, true);
            window.addEventListener('keyup', popoverClose, true);
            // 버튼, 달력창 영역을 제외한 나머지 부분 클릭시 달력창 닫기
            $(window).on('click', function (event) {
                if(!$(event.target).parents(".dews-monthperiodpicker-calendars")[0]) {
                    close();
                    var startSet = self._startInput.val(),
                        endSet = self._endInput.val();

                    //값을 변경하고 딴 곳을 클릭해 달력닫고, 다시 열었을 때 값 맞추기.
                    if (startSet && endSet) {
                        setNumerictextboxValue(startSet, endSet);
                        removeClassToButton();
                    }
                    if (startSet === "") {
                        setNumerictextboxValue("", endSet);
                        removeClassToButton();
                    }
                    if (endSet === "") {
                        setNumerictextboxValue(startSet, "");
                        removeClassToButton();
                    }
                }
                event.stopPropagation();
            });
        };

        self.oneQuearterButton.on("click", function (e) {
            clickButtons(0, 2);
            e.stopPropagation();
        });

        self.twoQuearterButton.on("click", function (e) {
            clickButtons(3, 5);
            e.stopPropagation();
        });

        self.threeQuearterButton.on("click", function (e) {
            clickButtons(6,8);
            e.stopPropagation();
        });

        self.fourQuearterButton.on("click", function (e) {
            clickButtons(9, 11);
            e.stopPropagation();
        });

        self.firstHalfButton.on("click", function (e) {
            clickButtons(0, 5);
            e.stopPropagation();
        });

        self.secondHalfButton.on("click", function (e) {
            clickButtons(6, 11);
            e.stopPropagation();
        });

        self.thisYearButton.on("click", function (e) {
            clickButtons(0,11);
            e.stopPropagation();
        });

        //1~12월 버튼 클릭시
        $('button.dews-monthperiod-months', self._hiddenArea).on("click", function (e) {
            var months = ["dews-monthperiod-january", "dews-monthperiod-february", "dews-monthperiod-march", "dews-monthperiod-april",
                "dews-monthperiod-may", "dews-monthperiod-june", "dews-monthperiod-july", "dews-monthperiod-august",
                "dews-monthperiod-september", "dews-monthperiod-october", "dews-monthperiod-november", "dews-monthperiod-december"];
            var temp, firstDate, lastDate;

            $('.dews-monthperiod-months', self._hiddenArea).removeClass("dews-monthperiod-select");

            //기간1 선택하고 2선택하면 타는 분기문
            if (self.firstClickItem !== null) {
                if (self.secondClickItem !== null) {
                    clear();
                }
                self.secondClickItem = self.firstClickItem;
            }
            self.firstClickItem = $(this);

            //아이템 1,2 다 선택
            if (self.firstClickItem !== null && self.secondClickItem !== null) {
                var index1 = self.firstClickItem.index() - 7;
                var index2 = self.secondClickItem.index() - 7;

                if (index1 > index2) {
                    temp = index1;
                    index1 = index2;
                    index2 = temp;
                }

                for (var i = index1; i <= index2; i++) {
                    if ($('button.dews-monthperiod-months', self._hiddenArea).hasClass(months[i])) {
                        $('button.dews-monthperiod-months' + "." + months[i], self._hiddenArea).addClass("dews-monthperiod-select");
                    }
                }
                firstDate = new Date(date.getFullYear(), index1, 1);
                lastDate = new Date(date.getFullYear(), index2 + 1, 0);
                getYearMonth(firstDate, lastDate);
                addClassToButton(index1, index2);
            }

            //아이템 1만 선택.
            if (self.firstClickItem !== null && self.secondClickItem === null) {

                firstDate = new Date(date.getFullYear(), self.firstClickItem.index() - 7, 1);
                lastDate = new Date(date.getFullYear(), self.firstClickItem.index() - 6, 0);
                var fMonth = firstDate.getMonth();
                var lMonth = lastDate.getMonth();

                getYearMonth(firstDate, lastDate);
                addClassToButton(fMonth, lMonth);
            }
            e.stopPropagation();
        });

        //달력버튼 클릭 시
        self._calenderButton.on("click", function (e) {
            var firstDate = kendo.parseDate(self._startInput.val(), self.options.format, kendo.getCulture());
            var secondDate = kendo.parseDate(self._endInput.val(), self.options.format, kendo.getCulture());

            if (firstDate) {
                var substrFirstMonth = firstDate.getMonth() + 1;
            }
            if (secondDate) {
                var substrSecondMonth = secondDate.getMonth() + 1;
            }

            var fy = self.firstYear.value();
            var sy = self.secondYear.value();

            removeClassToButton();
            if (!self.disableButton) {
                if (toggle) {
                    bindCloseEvent();
                    var element_offset = $el.offset();
                    var zIndex = dews.ui.getDialogMaxZIndex();

                    if (zIndex > parseInt(self._hiddenArea.css('zIndex'), 10)) {
                        self._hiddenArea.css('zIndex', zIndex+2);
                    }

                    self._hiddenArea.css({
                        'left': parseFloat(element_offset.left) + 'px'
                    });

                    if ($(window).height() < $(this).offset().top - $offset + self._hiddenArea.height() + 24) { //너무 줄엿을때는 위로도 안붙고, 아래 붙게
                        self._hiddenArea.css("top", parseFloat(element_offset.top) - self._hiddenArea.height() - 1);
                        if (($(this).offset().top - $offset) < self._hiddenArea.height()) {
                            self._hiddenArea.css("top", parseFloat(element_offset.top) + 23);
                        }
                    } else {
                        self._hiddenArea.css("top", parseFloat(element_offset.top) + self._wrapper.height() + 1);
                    }
                    if ($(window).width() - (self._wrapper.offset().left + self._hiddenArea.width()) < 0) {
                        var right_width = self._calenderButton.offset().left + 22.7969 - self._hiddenArea.width();
                        self._hiddenArea.css("left", right_width);
                        if ($(window).width() < self._hiddenArea.width()) {
                            self._hiddenArea.css("left", parseFloat(element_offset.left) + 1);
                        }
                    }
                    self._wrapper.addClass('dews-monthperiodpicker-focus');
                    self._calenderButton.addClass('dews-monthperiodpicker-focus');
                    self._hiddenArea.addClass('opened');
                    toggle = false;

                    //setStartDate 함수 이용해 값 설정 시, input에 포커스 놓지않고 바로 달력 누르면 값 입력안됨.
                    if (self._startInput.val() === "") {
                        setNumerictextboxValue("", self._endInput.val());
                    } else if (self._endInput.val() === "") {
                        setNumerictextboxValue(self._startInput.val(), "");
                    }
                    else {
                        setNumerictextboxValue(self._startInput.val(), self._endInput.val());

                        if (self._thisYear === fy) {
                            if (self._thisYear === sy) {
                                substrFirstMonth = self.firstMonth.value();
                                substrSecondMonth = self.secondMonth.value();
                                addClassToButton(substrFirstMonth - 1, substrSecondMonth - 1);
                            }
                        }
                        else {
                            removeClassToButton();
                        }
                    }
                    self.firstClickItem = null;
                    self.secondClickItem = null;
                } else {
                    close();
                    clear();
                    if (self._startInput.val() === "") {
                        setNumerictextboxValue("", self._endInput.val());
                    } else if (self._endInput.val() === "") {
                        setNumerictextboxValue(self._startInput.val(), "");
                    }
                }



            }
            e.stopPropagation();
        });

        $(window).scroll(function() {
            $offset = $(this).scrollTop();
        });

        //적용하기 버튼 클릭시 input에 set
        self.okButton.on("click", function (e) {
            var startDate, endDate;
            var startYear = self._hiddenArea.find('.dews-ui-numerictextbox.dews-monthperiodpicker-firstyear');
            var startMonth = self._hiddenArea.find('.dews-ui-numerictextbox.dews-monthperiodpicker-firstmonth');
            var lastYear = self._hiddenArea.find('.dews-ui-numerictextbox.dews-monthperiodpicker-secondyear');
            var lastMonth = self._hiddenArea.find('.dews-ui-numerictextbox.dews-monthperiodpicker-secondmonth');

            self.startYear = startYear;
            self.startMonth = startMonth;
            self.lastYear = lastYear;
            self.lastMonth = lastMonth;

            var sd = startMonth.val()[1] ? startMonth.val() : '0' + startMonth.val()[0];
            var ld = lastMonth.val()[1] ? lastMonth.val() : '0' + lastMonth.val()[0];

            var date = self._startInput.val();
            var date2 = self._endInput.val();

            var preFirstDate = kendo.parseDate(date, self.options.format, kendo.getCulture()) ? kendo.parseDate(date, self.options.format, kendo.getCulture()) : new Date('', '');
            var preSecondDate = kendo.parseDate(date2, self.options.format, kendo.getCulture()) ? kendo.parseDate(date2, self.options.format, kendo.getCulture()) : new Date('', '');

            var currFirstDate = new Date(startYear.val(), sd-1);
            var currSecondDate = new Date(lastYear.val(), ld-1);

            if (self.startYear.val() && self.startMonth.val()) {
                startDate = kendo.toString(currFirstDate, self.options.format, kendo.getCulture());
                self._startInput.val(startDate);
            }
            if (self.lastYear.val() && self.lastMonth.val()) {
                endDate = kendo.toString(currSecondDate, self.options.format, kendo.getCulture());
                self._endInput.val(endDate);
            }

            //이전 값과 새로 입력한 값이 다를 경우 change 이벤트 실행
            if ((preFirstDate.getTime() !== currFirstDate.getTime()) || (preSecondDate.getTime() !== currSecondDate.getTime())) {
                self._wrapper.trigger('change');
            }

            addClassToButton(self.startMonth.val() - 1, self.lastMonth.val() - 1);
            close();
            e.stopPropagation();
        });

        if (self.options.startDate !== null) {
            self.setStartDate(self.options.startDate);
        }

        if (self.options.endDate !== null) {
            self.setEndDate(self.options.endDate);
        }

        function addClassToButton(index1, index2) {
            var monthArray = [self.januaryBtn, self.februaryBtn, self.marchBtn, self.aprilBtn, self.mayBtn, self.juneBtn,
                self.julyBtn, self.augustBtn, self.septemberBtn, self.octoberBtn, self.novemberBtn, self.decemberBtn];

            var fy = self.firstYear.value();
            var sy = self.secondYear.value();
            var fm = self.firstMonth.value();
            var sm = self.secondMonth.value();

            index1 = Number(index1);
            index2 = Number(index2);

            if (($.type(fm) !== 'null') && ($.type(sm) !== 'null')) {

                $('.dews-monthperiod-button', self.option).removeClass('dews-monthperiod-select');

                for (index1; index1 <= index2; index1++) {
                    monthArray[index1].addClass("dews-monthperiod-select");
                }

                //숫자텍스트 값이 올해면
                if(self._thisYear === fy){
                    if(self._thisYear === sy){
                        if (fm === 1 && sm === 3) { //월 비교해서 add클래스
                            self.oneQuearterButton.addClass('dews-monthperiod-select');
                        } else if (fm === 4 && sm === 6) {
                            self.twoQuearterButton.addClass('dews-monthperiod-select');
                        } else if (fm === 7 && sm === 9) {
                            self.threeQuearterButton.addClass('dews-monthperiod-select');
                        } else if (fm === 10 && sm === 12) {
                            self.fourQuearterButton.addClass('dews-monthperiod-select');
                        } else if (fm === 1 && sm === 6) {
                            self.firstHalfButton.addClass('dews-monthperiod-select');
                        } else if (fm === 7 && sm === 12) {
                            self.secondHalfButton.addClass('dews-monthperiod-select');
                        } else if (fm === 1 && sm === 12) {
                            self.thisYearButton.addClass('dews-monthperiod-select');
                        }
                    }
                    self.okButton.prop("disabled", false);
                    //올해가 아니면 지우기
                }else {
                    $('.dews-monthperiod-button', self.option).removeClass('dews-monthperiod-select');
                }
            }
        }

        function removeClassToButton() {
            var monthArray = [self.januaryBtn, self.februaryBtn, self.februaryBtn, self.marchBtn, self.aprilBtn, self.mayBtn, self.juneBtn,
                self.julyBtn, self.augustBtn, self.septemberBtn, self.octoberBtn, self.novemberBtn, self.decemberBtn];

            for (var i = 0; i < monthArray.length; i++) {
                monthArray[i].removeClass("dews-monthperiod-select");
            }
            $('.dews-monthperiod-button', self.option).removeClass('dews-monthperiod-select');
        }

        //숫자텍스트 값이 바뀌면 실행
        function changeHandler(e) {
            removeClassToButton();

            var fy = self.firstYear.value();
            var fm = self.firstMonth.value();
            var sy = self.secondYear.value();
            var sm = self.secondMonth.value();

            //발생한 이벤트 타입이 'keyup' 일때
            if (e.type === 'keyup') {
                fy = parseInt(self.firstYear.element.val());
                sy = parseInt(self.secondYear.element.val());
            }

            //년도에 아무값도 설정돼있지않으면 올해 년도로 설정
            if ((fy === self.options.min)) {
                self.firstYear.value(self._thisYear);
                // fy = self.firstYear.value();
            } else if ((self.secondYear.value() === self.options.min)) {
                self.secondYear.value(self._thisYear);
                // sy = self.secondYear.value();
            }

            if (fy !== sy) {
                removeClassToButton();
            } else if ((fy === self._thisYear) && (sy === self._thisYear)) {
                addClassToButton(fm - 1, sm - 1);

                if (fm > sm) {
                    removeClassToButton();
                }
            }

            self.okButton.prop("disabled", false);
            self.okButton.removeClass('k-state-disabled');

            if (!fy && !fm) { //첫번째 년 월 없을때
                self._startInput.val("");
            } else if (!sy && !sm) { //두번쨔 년 월 없을때
                self._endInput.val("");
            } else if (!fy || !fm) { //첫번째 년이 없거나 월이 없을때
                self.okButton.prop("disabled", true);
                self.okButton.addClass('k-state-disabled');
            } else if (!sy || !sm) { //두번째 년이 없거나 월이 없을때
                self.okButton.prop("disabled", true);
                self.okButton.addClass('k-state-disabled');
            } else { // 위에것들이 아닐
                if (sy) {//종료날짜가 존재하고,
                    if (fy > sy) { //시작날짜의 년도가 종료날짜의 년도보다 클때
                        self.okButton.prop("disabled", true);
                        self.okButton.addClass('k-state-disabled');
                    } else if(!(fy.toString().length === 4) || !(sy.toString().length === 4)){
                        self.okButton.prop("disabled", true);
                        self.okButton.addClass('k-state-disabled');
                    }
                }
                if (fy === sy && fm > sm) { //시작날짜와 종료날짜의 년도가 같고, 시작날짜 월이 종료날짜 월보다 클때
                    self.okButton.prop("disabled", true);
                    self.okButton.addClass('k-state-disabled');
                }
            }

        }

        //4개 숫자텍스트박스 값이 변경됐을 때 이벤트.
        self.firstYear.bind('spin', changeHandler);

        self.firstMonth.bind('spin', changeHandler);

        self.secondYear.bind('spin', changeHandler);

        self.secondMonth.bind('spin', changeHandler);

        self.firstYear.bind('change', changeHandler);

        self.firstMonth.bind('change', changeHandler);

        self.secondYear.bind('change', changeHandler);

        self.secondMonth.bind('change', changeHandler);

        self.firstYear.element.on('keyup', changeHandler);

        self.firstMonth.element.on('keyup', changeHandler);

        self.secondYear.element.on('keyup', changeHandler);

        self.secondMonth.element.on('keyup', changeHandler);

        self._startInput.on('keyup', function (e) {
            var key = e.key, regex = /[0-9]/; // 입력된 키 값이 숫자인지 매칭
            var preStartDate, currStartDate;
            var startInput = self._startInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preStartDate = $('.dews-monthperiodpicker-startDate', self._wrapper).attr('val');
                currStartDate = self._startInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self._startInput.val() && self._startInput.val().indexOf("_") === -1) {
                    format(self._startInput);
                    if (!(self._endInput.val())) {
                        self.secondYear.value("");
                        self.secondMonth.value("");
                    }

                    $('.dews-monthperiodpicker-startDate', self._wrapper).attr('val', $('.dews-monthperiodpicker-startDate', self._wrapper).val());

                    if(preStartDate !== currStartDate) {
                        self._startInput.trigger('_change');
                    }

                    if (regex.test(key)) {
                        self._endInput.focus();
                    }
                }

                if (self._startInput.val().indexOf("_") === 0) {
                    if(preStartDate !== currStartDate) {
                        self._startInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self._startInput.val().indexOf("_") === 0) {
                    self.secondYear.value("");
                    self.secondMonth.value("");
                }
            }
            e.stopPropagation();
        });

        self._endInput.on('keyup', function (e) {
            var key = e.key, regex = /[0-9]/;
            var preEndDate, currEndDate;
            var endInput = self._endInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preEndDate = $('.dews-monthperiodpicker-endDate', self._wrapper).attr('val');
                currEndDate = self._endInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self._endInput.val() && self._endInput.val().indexOf("_") === -1) {
                    format(self._endInput);

                    if (!(self._startInput.val())) {
                        self.firstYear.value("");
                        self.firstMonth.value("");
                    }

                    $('.dews-monthperiodpicker-endDate', self._wrapper).attr('val', $('.dews-monthperiodpicker-endDate', self._wrapper).val());

                    if(preEndDate !== currEndDate) {
                        self._endInput.trigger('_change');
                    }
                }

                if (self._endInput.val().indexOf("_") === 0) {
                    if(preEndDate !== currEndDate) {
                        self._endInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self._endInput.val().indexOf("_") === 0) {
                    self.firstYear.value("");
                    self.firstMonth.value("");
                    self._startInput.focus();
                }
            }
            e.stopPropagation();
        });

        // 시작 월이나 종료 월을 입력 중인 경우 이벤트 버블링을 막음
        $el.on('keydown', function (e){
            if(e.keyCode === 13 && (self._startInput.is(':focus') || self._endInput.is(':focus'))) {
                e.stopPropagation();
            } else if (e.keyCode === 115 && self._hiddenArea.css('display') === 'none') {
                self._calenderButton.click();
                e.stopPropagation();
                e.preventDefault();
            }
        });

        //시작월, 종료월 가져와서 숫자텍스트박스에
        function getYearMonth(firstDate, lastDate) {
            var firstY = firstDate.getYear() + 1900;
            var firstM = firstDate.getMonth() + 1;
            var lastY = lastDate.getYear() + 1900;
            var lastM = lastDate.getMonth() + 1;

            self._setNumericTextBoxValue(firstY, firstM, lastY, lastM);
        }

        //input에서 값 가져와 숫자텍스트박스에 set.
        function setNumerictextboxValue(firstDate, lastDate) {
            var start = kendo.parseDate(firstDate, self.options.format, kendo.getCulture());
            var end = kendo.parseDate(lastDate, self.options.format, kendo.getCulture());

            if (start) {
                var firstY = start.getFullYear();
                var firstM = start.getMonth() + 1;
            }

            if (end) {
                var lastY = end.getFullYear();
                var lastM = end.getMonth() + 1;
            }

            self._setNumericTextBoxValue(firstY, firstM, lastY, lastM);
        }

        function format(option) {
            var dateValue = $(option).val(), date,
                yyyy, MM;

            if (dateValue) {
               date = kendo.parseDate(dateValue, self.options.format,kendo.getCulture());

               if (date) {
                   yyyy = date.getFullYear();
                   MM = date.getMonth();
               }
            }

            if (parseInt(yyyy) >= 2100 || parseInt(yyyy) <= 1900) {
                yyyy = now.toISOString().substring(0, 4);
            }

            if (parseInt(MM) >= 13 || parseInt(MM) <= 0) {
                MM = now.toISOString().substring(5, 7);
            }

            $(option).val(dateValue);

            var startSet = self._startInput.val(),
                endSet = self._endInput.val();

            var startText = startSet.replace(/[^(0-9)]/gi, ""),
                endText = endSet.replace(/[^(0-9)]/gi, "");

            var startDate = kendo.parseDate(startText, self.options.valueFormat, kendo.getCulture());
            var endDate = kendo.parseDate(endText, self.options.valueFormat, kendo.getCulture());

            if ((startDate && startDate.getTime()) > (endDate && endDate.getTime())) {
                if (endText === "") {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = "";
                } else {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                }
            } else {
                if (startText === "") {
                    startSet = kendo.toString(endDate, self.options.format, kendo.getCulture());
                    endSet = "";
                } else {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = kendo.toString(endDate, self.options.format, kendo.getCulture());
                }
            }

            if (startText !== "" && endText !== "") {
                self._startInput.val(startSet);
                self._endInput.val(endSet);
            }

            //getYearMonth 함수,
            if (option === self._startInput) {
                setNumerictextboxValue(startSet, endSet);
            } else {
                setNumerictextboxValue(startSet, endSet);
            }
        }

        function close() {
            self._wrapper.removeClass('dews-monthperiodpicker-focus');
            self._calenderButton.removeClass('dews-monthperiodpicker-focus');
            self._hiddenArea.removeClass('opened').css('zIndex', '');
            toggle = true;
            window.removeEventListener('scroll', popoverClose, true);
            window.removeEventListener('keyup', popoverClose, true);
            $(window).off("click");
        }

        function clear() {
            self.firstClickItem = null;
            self.secondClickItem = null;
            $('.dews-monthperiod-months', self._hiddenArea).removeClass("dews-monthperiod-select");
        }
    };

    MonthPeriodPicker.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self._wrapper.on.apply(self._wrapper, arguments);
    };

    MonthPeriodPicker.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        self._wrapper.off.apply(self._wrapper, arguments);
    };

    MonthPeriodPicker.prototype.validate = function () {
        var self = this;
        if(!self.getStartDate() || !self.getEndDate()){
            return false;
        } else {
            return true;
        }
    };

    MonthPeriodPicker.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self._element);
        var startDate, endDate;

        if(data) {
            startDate = $element.data('dews-bind-startdate') || "";
            endDate = $element.data('dews-bind-enddate') || "";

            if (startDate && data.hasOwnProperty(startDate)) {
                self.setStartDate(data[startDate]);
            }
            if (endDate && data.hasOwnProperty(endDate)) {
                self.setEndDate(data[endDate]);
            }
        }
    };

    MonthPeriodPicker.prototype.serializeForPanel = function () {
        var self = this, $element = $(self._element);
        var startDate, endDate;
        var data = [];
        startDate = $element.data('dews-bind-startdate') || "";
        endDate = $element.data('dews-bind-enddate') || "";

        if (startDate) {
            data[startDate] = self.getStartDate();
        }
        if(endDate) {
            data[endDate] = self.getEndDate();
        }
        return data;
    };

    MonthPeriodPicker.prototype.applyPanelFocus = function () {
        var self = this;
        var startInput = self._startInput;
        var endInput = self._endInput;

        startInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                startInput.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && startInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                startInput.trigger(evt);
            }
        });

        endInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                endInput.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && endInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                endInput.trigger(evt);
            }
        });
    };

    MonthPeriodPicker.prototype.canFocusable = function () {
        var self = this;
        var $start = self._startInput;
        var $end = self._endInput;

        if(!self._element.hasClass('readonly') && $start && $end){
            return $start.is(':visible') && $start.is(':enabled');
        }
        else {
            return false;
        }
    };

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    MonthPeriodPicker.prototype.setUserGuideAPI = function () {
        var self = this, $element = $(self._element);

        self._startInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });

        self._endInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    };

    /**
     * 월기간피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    MonthPeriodPicker.prototype._getPrintData = function () {
        var self = this,
            $el = $(self._element),
            data;

        if (self.getStartText() && self.getEndText()) {
            data = {
                id: $el.attr('id'),
                text: self.getStartText() + ' ~ ' + self.getEndText()
            }
        }

        return data;
    };

    /**
     * 공통 이벤트를 설정합니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체입니다.
     * @param {object} [options] 피커의 옵션입니다.
     */
    function setEvent($el, options) {
        $el.on('click', function (e) {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 읽기 전용/비활성화 상태가 아니면 포커스가 오면 텍스트 전체를 선택하도록 한다.
                $this.select();
            }
        }).on('blur', function (e) {
            var $this = $(this), val;
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                if (!dews.date.validate($this.val(), options.format)) {
                    //TODO: 값이 유효하지 않을 경우 오류 표시 및 툴팁 표시
                } else {
                    //TODO: 값이 유효할 때 오류 표시가 있으면 제거
                }
            }
        });
    }

    /**
     * 기간달력 텍스트박스에 마스크를 적용합니다.
     * @param {jQuery} $el 적용할 대상 요소의 jQuery 객체
     * @param {string} format 적용 포맷
     */
    function setMask($el, format) {
        var maskJsUrl;

        // jquery.maskedinput.js 를 이용하여 마스크를 적용함
        // script 파일을 로드된 적이 없으면 동적으로 로드합니다.
        maskJsUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', 'jquery.maskedinput.js');

        if ($.mask) {
            $el.mask(format.replace(/[ymdhms]/ig, '9'));
        } else {
            $.getScript(maskJsUrl, function () {
                $el.mask(format.replace(/[ymdhms]/ig, '9'));
            });
        }
    }

    dews = $.extend(true, dews, {
        ui: {
            monthperiodpicker: function (selector, options) {
                var $el, monthperiodpicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }
                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var picker, $this = $(this);

                    picker = $this.data('dews-control');

                    if (!picker) {
                        if (!$this.hasClass("dews-ui-monthperiodpicker")) {
                            $this.addClass("dews-ui-monthperiodpicker");
                        }

                        if(!$this.hasClass("dews-form-control")){
                            $this.addClass("dews-form-control");
                        }

                        picker = new MonthPeriodPicker($this, options);

                        $this.data('dews-control', picker);

                        picker._initControl();

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }
                    }
                    monthperiodpicker = picker;
                });
                return monthperiodpicker;
            }
        }
    });

    dews.ui.addControlInitializer('monthperiodpicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }
        dews.ui.monthperiodpicker($("span.dews-ui-monthperiodpicker", $container));
    });
})(jQuery, window.dews, window.kendo);



/*
 * 다이얼로그 창
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        modal: true,            // 모달 여부
        width: 360,             // 다이얼로그 너비(px)
        height: 'auto',         // 다이얼로그 높이(px)
        draggable: true,        // 다이얼로그 이동 가능 여부
        resizable: false,       // 다이얼로그 사이즈 조절 가능 여부
        size: 'small'           // 다이얼로그 기본 사이즈 설정
    };

    /**
     * 메세지 박스를 생성합니다.
     * @param {string} type alert, confirm, error 종류
     * @param {string, object} msg 메제시 출력 (error에서 자세히가 포함될경우 object가 올수도있다)
     * @param {string} icon align, icon의 종류 설정
     * @param {boolean} cancel confirm메세지 박스일경우 cancel추가 유무 기본값 false
     */
    function MsgBoxWindow(type, msg, icon, cancel) {
        var self = this,
            callbackResult;

        if ($.type(icon) === 'undefined') {
            self.icon = '';
        } else if ($.type(icon) === 'object') {
            self.align = icon.align;
            self.icon = icon.icon;
        } else {
            self.icon = icon;
        }

        self.cancel = cancel || false;

        // resolve와 reject 상태별로 호출할 함수들
        self.resolves = [];
        self.rejects = [];
        self.always = [];

        self.dfd = $.Deferred();

        self.option = defaultOptions;
        self.dialog = null;
        //self.target = window;
        self.message = '';
        self.detailMessage = '';
        self.msgType = type;
        self.$ok = '';
        self.$yes = '';
        self.$no = '';
        self.$cancel = '';
        //self.$detail = '';
        //self.$report = '';
        self.$container = '';
        self.$kwindow = null;
        self.item = null;

        if (typeof msg === 'string') {
            self.message = msg;
            self.option.width = 360;
        } else if (typeof msg === 'object') {
            if (msg.hasOwnProperty('message')) {
                self.message = msg.message;
                self.detailMessage = msg.error;
                self.option.width = 460;
            }
        }

        if ($('.dews-ui-msgbox-dialog').length === 0) {
            // 다이얼로그를 엽니다.
            self._open();
            // 다이얼로그에 컨트롤들을 추가합니다.
            self._insertFrame(msg);
            // 다이얼로그의 각 컨트롤들에 이벤트를 바인딩합니다.
            self._initEventListener();

            self.dfd.promise().done(function () {
                callbackResult = "resolves";
            }).fail(function () {
                callbackResult = "rejects";
            }).always(function () {
                self._close(callbackResult || "");
            });
        }
    }

    MsgBoxWindow.prototype._close = function (callbackType) {
        var idx,
            self = this;

        if (self.dialog._kendoWindow && !self.dialog._kendoWindow._closing) {
            self.dialog._kendoWindow.bind('close', function () {

                if (callbackType && $.isArray(self[callbackType]) && self[callbackType].length > 0) {
                    for (idx = 0; idx < self[callbackType].length; idx++) {
                        self[callbackType][idx].call(self);
                    }
                }

                if ($.isArray(self.always) && self.always.length > 0) {
                    for (idx = 0; idx < self.always.length; idx++) {
                        self.always[idx].call(self);
                    }
                }
            });

            self.dialog._kendoWindow.close();
        }
    };

    MsgBoxWindow.prototype.clean = function () {
        var idx,
            self = this;

        if (!self.dialog._kendoWindow &&
            self.dialog._kendoWindow.is(':visible') &&
            !self._dialog._kendoWindow.closing) {
            self.dialog._kendoWindow.close();
        }

        for (idx = 0; idx < self.always.length; idx++) {
            self.always[idx].call(self);
        }
    };

    MsgBoxWindow.prototype.yes = function (fn) {
        var self = this;
        // 함수 배열에 추가
        self.resolves.push(fn);
        //함수를 계속 순환하여 사용하므로 자기 자신을 계속 반환
        return self;
    };

    MsgBoxWindow.prototype.no = function (fn) {
        var self = this;
        self.rejects.push(fn);
        return self;
    };

    MsgBoxWindow.prototype.done = function (fn) {
        var self = this;
        self.always.push(fn);
        return self;
    };

    MsgBoxWindow.prototype._initEventListener = function () {
        var self = this,
            kWin = self.dialog._kendoWindow;

        self.$ok.on('click', function () {
            self.dfd.resolve();
        });
        self.$yes.on('click', function () {
            self.dfd.resolve();
        });
        self.$no.on('click', function () {
            self.dfd.reject();
        });
        self.$cancel.on('click', function () {
            self._close();
        });

        kWin.bind('activate', function () {
            if (self.msgType === "alert") {
                self.$ok.focus();
            } else if (self.msgType === "confirm") {
                self.$no.focus();

                if (self.cancel === true) {
                    self.$cancel.focus();
                }
            } else if (self.msgType === "error") {
                self.$ok.focus();
            }
        });

        self.item.prev().addClass('msgbox');

        self.item.parent().find('.k-window-action').on('click', function (e) {
            self.clean();
            e.preventDefault();
        });
    };

    MsgBoxWindow.prototype._open = function () {
        var self = this,
            dialog,
            title = '',
            zIndex = dews.ui.getDialogMaxZIndex();

        switch (self.msgType) {
            case 'alert':
                title = dews.localize.get('dews_확인');
                break;
            case 'confirm':
                title = dews.localize.get('dews_선택');
                break;
            case 'error':
                title = dews.localize.get('dews_오류');
                break;
            default:
                title = '';
                break;
        }

        dialog = dews.ui.dialog('dews-msgbox-' + self.msgType, $.extend(true, {}, self.option, {title: title}));
        self.dialog = dialog;
        dialog.open(true);

        if (zIndex > parseInt(self.dialog._kendoWindow.element.closest('.k-window.dialog').css('zIndex'), 10)) {
            self.dialog._kendoWindow.element.closest('.k-window.dialog').css('zIndex', zIndex + 2);
        } else {
            self.dialog._kendoWindow.element.closest('.k-window.dialog').css('zIndex', 1000);
        }
    };

    MsgBoxWindow.prototype._insertFrame = function (msg) {
        var innerHTML = '',
            self = this,
            $buttonGroup;

        self.item = self.dialog.target.$('#dews-msgbox-' + self.msgType);
        self.item.addClass('dews-ui-msgbox-dialog');

        self.$ok = $('<button type="button" class="dews-ui-button ok dews-control confirm k-button dews-control-activate">').text(dews.localize.get('dews_확인'));
        self.$yes = $('<button type="button" class="dews-ui-button yes dews-control confirm k-button dews-control-activate">').text(dews.localize.get('dews_예'));
        self.$no = $('<button type="button" class="dews-ui-button no dews-control confirm k-button dews-control-activate">').text(dews.localize.get('dews_아니요'));
        self.$cancel = $('<button type="button" class="dews-ui-button cancel dews-control confirm k-button dews-control-activate">').text(dews.localize.get('dews_취소'));
        self.$container = $('<div class="dews-ui-msgbox ' + self.icon + '"></div>');

        innerHTML += '    <div class="dews-ui-msgbox-content">';
        if (!self.align) {
            innerHTML += '    <pre>' + self.message + '</pre>';
        } else {
            innerHTML += '    <pre style = "text-align: ' + self.align + ';">' + self.message + '</pre>'
        }
        innerHTML += '    </div>';
        innerHTML += '    <div class="dews-msgbox-botton-group bottom"></div>';

        self.$container.html(innerHTML);
        self.item.prepend(self.$container);

        $buttonGroup = self.$container.find('.dews-msgbox-botton-group');

        if (self.msgType === "alert") {
            $buttonGroup.append(self.$ok);
        } else if (self.msgType === "confirm") {
            $buttonGroup.append(self.$yes);
            $buttonGroup.append(self.$no);
            if (self.cancel === true) {
                $buttonGroup.append(self.$cancel);
            }
        } else if (self.msgType === "error") {
            $buttonGroup.append(self.$ok);
        }
    };

    MsgBoxWindow.prototype.promise = function () {
        var self = this;
        return self.dfd.promise();
    };

    $.extend(true, dews, {
        alert: function (txt, icon) {
            var alertMsg = new MsgBoxWindow("alert", txt, icon);

            return alertMsg;
        },
        confirm: function (txt, icon, cancel) {

            var confirmMsg;

            if (typeof icon === 'boolean') {
                confirmMsg = new MsgBoxWindow("confirm", txt, 'ico1', icon);
            } else {
                confirmMsg = new MsgBoxWindow("confirm", txt, icon, cancel);
            }

            return confirmMsg;
        },
        error: function (txt) {

            var errorMsg = new MsgBoxWindow("error", txt);

            return errorMsg;
        }
    });

})(jQuery, window.dews, window.kendo);


/**
 * 멀티 코드 피커
 */
(function ($, dews) {
    var defaultOptions = {
        useButton: true,    // 찾기 버튼의 사용 여부
        codeField: 'code',  // 검색 결과에서의 코드 필드명
        textField: 'text',  // 검색 결과에서의 텍스트 필드명
        useAjax: true,      // 도움창 오픈 전 AJAX를 통해서 먼저 확인할 지 여부
        helpCode: null,     // 도움창의 아이디 및 코드 도움 요청 코드
        helpParams: null,   // 코드 도움 및 도움창 요청에 추가적으로 필요한 파라미터
        helpTitle: '',      // 도움창의 타이틀
        helpCustom: false,  // 사용자 정의 도움창 사용 여부
        helpViewUrl: '',    // 도움창 URL (생략시 도움창 URL을 자동 생성)
        helpWidth: null,    // 도움창 기본 너비
        helpHeight: null,   // 도움창 기본 높이
        helpSize: 'medium'
    };

    function getOptions($el, srcOptions) {
        var options = {},
            inlineOptions;

        inlineOptions = getInlineOptions($el, defaultOptions);
        $.extend(true, options, defaultOptions, inlineOptions, srcOptions);

        return options;
    }

    function getInlineOptions($el, defaultOptions) {
        var options = {};
        var inlineData = {
            useButton: $el.data('dews-use-button') || defaultOptions.useButton,
            codeField: $el.data('dews-code-field') || defaultOptions.codeField,
            textField: $el.data('dews-text-field') || defaultOptions.textField,
            useAjax: $el.data('dews-ajax'),
            helpCode: $el.data('dews-help-code') || defaultOptions.helpCode,
            helpParams: getHelpParams($el),
            helpTitle: $el.data('dews-help-title') || defaultOptions.helpTitle,
            helpCustom: $el.data('dews-help-custom') || defaultOptions.helpCustom,
            helpViewUrl: $el.data('dews-help-view-url') || defaultOptions.helpViewUrl,
            helpWidth: $el.data('dews-help-width') || defaultOptions.helpWidth,
            helpHeight: $el.data('dews-help-height') || defaultOptions.helpHeight,
            helpSize: $el.data('dews-help-size')  || defaultOptions.helpSize
        };


        options = $.extend(true, options, defaultOptions, inlineData);

        return options;
    }

    function getHelpParams($element) {
        var str = $element.data('dews-help-params'),
            data = defaultOptions.helpParams;

        if (str) {
            data = $.deparam(str);
        }

        return data;
    }

    //멀티코드피커 클래스
    function MultiCodepicker($el, options){
        var self = this;

        self.target = $el;
        self.options = options;

        //초기화 실행
        self._init();
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            var id = $element.parents('.dews-multicodepicker-wrapper').children('select.dews-ui-multicodepicker').attr('id');
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && id) {
                    dews.ui.page.focusGuideItem('#' + id);
                }
            }
        });
    }

    //초기화
    MultiCodepicker.prototype._init = function(){
        var self = this, $element = self.target;

        self.inputText = null;
        self.listPosition = null;
        self.wrapper = null;
        self.container = null;
        self.item = null;
        self.position = 0;
        self.bindLogic;
        self.serializeLogic;

        // input 태그 생성
        self._setInputElement();
        // list 태그 생성
        self._setListElement();
        // 이벤트 바인딩
        self._initEventListener();
        // 상태별 클래스 설정
        self._initSetStateClass();
        // 초기값 설정
        self._setDefaultData();
        // 리스트 갯수 체크후 Text 설정
        self._setText();

        setUserGuideAPI($('.dews-multicodepicker-text', $element.parent('.dews-multicodepicker-wrapper')));
    };

    /**
     * 컨트롤에 설정된 기본 코드 및 텍스트를 적용합니다.
     * @private
     */
    MultiCodepicker.prototype._setDefaultData = function () {
        var self = this,
            $el = self.target,
            code, text, data;

        code = $el.data('code') || '';
        text = $el.data('text') || '';

        data = {};
        data[self.options.codeField] = code;
        data[self.options.textField] = text;

        if(code !== ''){
            self.setData(data);
        }
    };

    /**
     * 멀티코드 피커의 코드 도움 파라미터를 설정합니다.
     * @param {object|function} params 설정할 파라미터 객체 또는 함수
     */
    MultiCodepicker.prototype.setHelpParams = function (params) {
        var self = this;

        self.options.helpParams = params;
    };



    /**
     * 멀티코드피커의 코드와 텍스트를 모두 빈 값으로 초기화합니다.
     */
    MultiCodepicker.prototype.clearData = function () {
        var self = this,
            data = {};

        data[self.options.codeField] = data[self.options.textField] = '';
        if(self.target.find('option').length === 0){
            self.setData(data);
        }
    };

    MultiCodepicker.prototype.clear = function () {
        var self = this,
            data = {};

        data[self.options.codeField] = data[self.options.textField] = '';
        //self._upCloseSetPotion();

        self._blank();
    };

    /**
     * 멀티코드 피커에 설정된 코드를 가져옵니다.
     * @returns {number} 인덱스
     */
    MultiCodepicker.prototype.code = function (num) {
        var self = this,
            $el = self.target.find('option');

        if(typeof num !== 'undefined'){
            return $el.eq(num).attr('value');
        }
    };

    /**
     * 멀티 코드피커에 설정된 모든 코드값을 가져옵니다.
     * @private
     */
    MultiCodepicker.prototype.codes = function () {
        var self = this,
            $options = self.target.find('option'),
            codes = [];

        $.each($options, function () {
            var $this = $(this);
            codes.push($this.val());
        });

        return codes;
    };

    /**
     * 멀티코드 피커에 설정된 텍스트를 가져옵니다.
     * @returns {number} 인덱스
     */
    MultiCodepicker.prototype.text = function (num) {
        var self = this,
            $el = self.target.find('option');

        if(typeof num !== 'undefined'){
            return $el.eq(num).text();
        }
    };

    /**
     * 멀티 코드피커에 설정된 모든 텍스트값을 가져옵니다.
     * @private
     */
    MultiCodepicker.prototype.texts = function(){
        var self = this,
            $options = self.target.find('option'),
            texts = [];

        $.each($options, function(){
            var $this = $(this);

            texts.push($this.text());
        });

        return texts;
    };

    /**
     * 멀티코드피커에 코드와 텍스트를 설정합니다.
     * @param {object} data 코드와 텍스트
     */
    MultiCodepicker.prototype.setData = function(data){

        var self = this,
            selected,
            setDataEvent,
            $option,
            duplicationCheck = function(code){
                var $options = self.target.find('option'),
                    duplicate = false;

                for(var i = 0; i < $options.length; i++){
                    var data = $options.eq(i).data('dews-data');

                    if(data){
                        if(code === data[self.options.codeField]){
                            duplicate = true;
                            break;
                        }
                    }
                }
                return duplicate;
            };

        //배열일 때만 항목을 생성
        if($.type(data) === 'array'){
            //setData 이벤트 발생
            setDataEvent = new $.Event('setData');
            setDataEvent.codeData = data;

            self.target.trigger(setDataEvent);

            if(setDataEvent.isDefaultPrevented()){
                // 이벤트 핸들러에서 preventDefault를 호출했을 때는
                // 값의 변경등을 더 이상 진행하지 않습니다.
                return;
            }

            if(data.length > 0){
                for(var i = 0; i < data.length; i++){
                    if(!duplicationCheck(data[i][self.options.codeField])){
                        $option = $('<option />').val(data[i][self.options.codeField]).text(data[i][self.options.textField])
                            .attr('selected', 'selected').data('dews-data',data[i]);
                        self.target.append($option);
                    }
                }

                // 텍스트를 갱신
                self._setText();
                // 리스트 아이템을 갱신
                self._setListElement();

                self.target.trigger('_change');
            }
        }
    };

    /**
     * 멀티코드피커의 데이터를 가져옵니다.
     */
    MultiCodepicker.prototype.getData = function(){
        var self = this,
            getData = [],
            options = self.target.find('option');

        for(var i = 0;i < options.length;i++){
            getData.push(options.eq(i).data('dews-data'));
        }
        return getData;
    };

    MultiCodepicker.prototype._triggerCodeDialog = function (list, initData) {
        var self = this,
            helpEvent,
            $el = self.target,
            params;

        initData = initData || null;

        if ($.isFunction(self.options.helpParams)) {
            params = self.options.helpParams.call(self);
        } else {
            params = self.options.helpParams;
        }

        helpEvent = new $.Event('codedialog', {
            code: self.options.helpCode,
            params: $.extend(true, {}, params),
            title: self.options.helpTitle,
            mode: 'multi',
            width: self.options.helpWidth,
            height: self.options.helpHeight,
            size: self.options.helpSize,
            custom: self.options.helpCustom,
            viewUrl: self.options.helpViewUrl,
            initData: initData,
            callback: function (data) {
                self.setData(data);
            }
        });

        self._slideUp(self.wrapper);
        $el.trigger(helpEvent);

    };

    /**
     * 멀티코드피커의 상태별 클래스를 설정합니다.
     */
    //상태별 클래스 추가
    MultiCodepicker.prototype._initSetStateClass = function(){
        var self = this,
            $wrapper = self.target,
            $state = self.wrapper.children('.dews-multicodepicker-wrap');

        if ($wrapper.hasClass('required')) {
            $state.addClass('dews-state-required');
            //$wrapper.removeClass('required');
        }
        if ($wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            $wrapper.removeClass('readonly');
            $state.find('.dews-select').hide();
            self.wrapper.off('click');
        }
        if ($wrapper.attr('readonly') && !$wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            $state.find('.dews-select').hide();
            self.wrapper.off('click');
        }
        if ($wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            $wrapper.removeClass('disabled');
            $state.find('.dews-select').hide();
            self.wrapper.off('mouseenter mouseleave mousedown click');
            self.inputText.prop('disabled', true);
        }
        if ($wrapper.attr('disabled') && !$wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            $state.find('.dews-select').hide();
            self.wrapper.off('mouseenter mouseleave mousedown click');
            self.inputText.prop('disabled', true);
        }
        if ($wrapper.hasClass('etc1')) {
            $state.addClass('dews-state-etc1');
            $wrapper.removeClass('etc1');
        }
        if ($wrapper.hasClass('etc2')) {
            $state.addClass('dews-state-etc2');
            $wrapper.removeClass('etc2');
        }
        if ($wrapper.hasClass('etc3')) {
            $state.addClass('dews-state-etc3');
            $wrapper.removeClass('etc3');
        }
    };

    /**
     * 멀티코드피커의 활성화, 비활성화를 체크합니다
     * @param {boolean} true(활성화), false(비활성화)
     */
    MultiCodepicker.prototype.enable = function (value) {
        var self = this,
            $el = self.target,
            enabled;

        enabled = !$el.prop('disabled');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === false) {
                self._setDisabled();
                enabled = !value;
            } else if (value === true) {
                self._removeDisabled();
                enabled = !value;
            }
        }

        return enabled;
    };

    /**
     * 멀티코드피커를 비화성화 합니다.
     * @private
     */
    MultiCodepicker.prototype._setDisabled = function () {
        var self = this,
            $el = self.target,
            $wrapper = self.wrapper,
            $text = self.inputText;

        if (!$wrapper.find('.dews-multicodepicker-wrap').hasClass('dews-state-disabled')) {
            $wrapper.find('.dews-multicodepicker-wrap').addClass('dews-state-disabled');
        }

        $el.prop('disabled', true);

        if (!$el.hasClass('disabled')) {
            $el.addClass('disabled');
            $wrapper.find('.dews-select').hide();
            $wrapper.off('mouseenter mouseleave mousedown click');
            $wrapper.find('.dews-select button').eq(1).off('click');
        }

        $text.prop('disabled', true);
    };

    /**
     * 멀티코드피커를 활성화 합니다.
     * @private
     */
    MultiCodepicker.prototype._removeDisabled = function () {
        var self = this,
            $el = self.target,
            $wrapper = self.wrapper,
            $text = self.inputText;

        if ($wrapper.find('.dews-multicodepicker-wrap').hasClass('dews-state-disabled')) {
            $wrapper.find('.dews-multicodepicker-wrap').removeClass('dews-state-disabled');
        }

        $el.prop('disabled', false);

        if ($el.hasClass('disabled')) {
            $el.removeClass('disabled');
            $wrapper.find('.dews-select').show();
            self._initEventListener();
        }

        $text.prop('disabled', false);
    };

    /**
     * 멀티코드피커의 읽기전용, 일기전용 해제를 설정합니다.
     * @param {boolean} true(읽기전용 설정), false(읽기전용 해제)
     */
    MultiCodepicker.prototype.readonly = function(value){
        var self = this,
            $el = self.target,
            readonly;

        readonly = $el.prop('readonly');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === true) {
                self._setReadonly();
                readonly = value;
            } else if (value === false) {
                self._removeReadonly();
                readonly = value;
            }
        }

        return readonly;
    };

    /**
     * 멀티코드피커의 읽기전용을 설정합니다.
     * @private
     */
    MultiCodepicker.prototype._setReadonly = function () {
        var self = this,
            $el = self.target,
            $wrapper = self.wrapper;


        if (!$wrapper.find('.dews-multicodepicker-wrap').hasClass('dews-state-readonly')) {
            $wrapper.find('.dews-multicodepicker-wrap').addClass('dews-state-readonly');
        }

        $el.prop('readonly', true); // code 컨트롤에 readonly를 설정

        if (!$el.hasClass('reaodnly')) {
            $el.addClass('readonly');
            $wrapper.find('.dews-select').hide();
            $wrapper.off('click');
        }
    };

    /**
     * 멀티코드피커의 읽기전용을 해제합니다.
     * @private
     */
    MultiCodepicker.prototype._removeReadonly = function () {
        var self = this,
            $el = self.target,
            $wrapper = self.wrapper;

        if ($wrapper.find('.dews-multicodepicker-wrap').hasClass('dews-state-readonly')) {
            $wrapper.find('.dews-multicodepicker-wrap').removeClass('dews-state-readonly');
        }

        $el.prop('readonly', false); // code 컨트롤에서 reaodonly를 설정

        if ($el.hasClass('readonly')) {
            $el.removeClass('readonly');
            $wrapper.find('.dews-select').show();
            self._initEventListener();
        }
    };

    /**
     * 멀티코드피커의 포커스를 설정합니다
     */
    MultiCodepicker.prototype.focus = function () {
        var self = this;
        self.inputText.triggerHandler('focus');
        self.inputText.focus();
    };

    /**
     * 멀티코드피커의 옵션을 가져옵니다.
     */
    MultiCodepicker.prototype.getOptions = function () {
        return this.options;
    };

    /**
     * 멀티코드피커의 옵션을 설정합니다.
     */
    MultiCodepicker.prototype.setOptions = function (options) {
        this.options = options;
    };

    /**
     * 멀티코드피커의 이벤트를 설정합니다.
     * @private
     */
    MultiCodepicker.prototype._initEventListener = function(){
        var self = this;

        //input에 포커스시 클래스 추가
        self.inputText.on('focusin',function(e){
            $(this).parent().parent().addClass('dews-state-focused');

            $(this).keypress(function(e) {
                var key = e.keyCode || e.which;
                if ($.type(self.usePanelFocus) === 'boolean' && !self.usePanelFocus) {
                    if (key === 13) {
                        self._setListElementPosition($(window).scrollTop());
                        if ($(this).hasClass('dews-state-active') === true) {
                            self._slideUp($(this));
                        } else {
                            self._slideDown($(this));
                        }

                        event.stopPropagation();
                    }
                }
            });

            e.preventDefault();
        });

        self.inputText.on('focusout',function(){
            $(this).parent().parent().removeClass('dews-state-focused');
            $(this).parent().parent().removeClass('dews-state-active');

            self._slideUp($(this));
        });

        self.inputText.on('keydown', function(e) {
            var key = e.keyCode || e.which;
            if (key === 115) { // F4 - 도움창 단축키
                e.preventDefault();
                var $button = self.wrapper.find('.dews-select button').eq(1);
                if ($button.is(':visible:enabled')) {
                    $button.click();
                }
                e.stopPropagation();
            }
        });

        //input에 관한 각종 이벤트
        self.wrapper.on('mouseenter mouseleave mousedown click', function(event){
            if(event.type === 'mouseenter'){
                $(this).addClass('dews-state-hover');
            } else if(event.type === 'mouseleave'){
                $(this).removeClass('dews-state-hover');
            } else if(event.type === 'mousedown'){
                $(this).addClass('dews-state-focused');
            } else if(event.type === 'click'){
                self._setListElementPosition($(window).scrollTop());

                $(window).on("keyup", function (e) {
                    if(e.keyCode === 27) {
                        popoverClose();
                    }
                });

                $(self.wrapper).parentsUntil("body").on("scroll", popoverClose);

                if($(this).hasClass('dews-state-active') === true){
                    self._slideUp($(this));
                    $(self.wrapper).parentsUntil("body").off("scroll");
                } else{
                    self._slideDown($(this));
                }

                event.stopPropagation();
            }
        });

        self.target.on('setData', function() {
            self.focus();
        });
        self.target.on('codedialogclosed', function() {
            self.focus();
        });

        //리스트 닫기
        $(document).mouseup(function (e){
            if (!self.wrapper.is(e.target) && self.wrapper.has(e.target).length === 0 && !self.container.is(e.target) && self.container.has(e.target).length === 0){
                self._slideUp(self.wrapper);
                $(self.wrapper).parentsUntil("body").off("scroll");
            }
        });

        //화면이 변했을경우 리스트 위치 세팅
        $(window).resize(function(){
            self._setListElementPosition(self.position);
        });
        $(window).scroll(function(){
            self.position = $(this).scrollTop();
        });

        //선택창
        self.wrapper.find('.dews-select button').eq(1).on('click',function(event){
            self._triggerCodeDialog(self.texts, null);
            $(self.wrapper).parentsUntil("body").off("scroll");
            event.stopPropagation();
        });

        //팝오버창 닫힘 + 스크롤 이벤트 해제 함수
        function popoverClose() {
            self.container.stop().slideUp(50);
            $(self.wrapper).parentsUntil("body").off("scroll");
            $(window).off("keyup");
        }
    };

    /**
     * 리스트가 위로 slideup될때 닫기누를시 위치값을 설정합니다.
     * @private
     */
    MultiCodepicker.prototype._upCloseSetPotion = function() {
        var self = this;
        if(self.listPosition === 'up'){
            self.container.css({
                'marginTop' : - (self.container.height() - 2) //마진값 변경 (리스트전체 높이값 - input창 높이값)
            });
        }
    };

    /**
     * 멀티코드피커의 DOM을 세팅합니다.
     * @private
     */
    MultiCodepicker.prototype._setInputElement = function(){
        var self = this,
            wrapper,
            innerHtml = '',
            idName;

        wrapper = $('<span class="dews-multicodepicker-wrapper" />');


        if (self.target.attr('style')) {
            var matches;

            matches = self.target.attr('style').match(/width:([^;]+);?/i);
            if (matches && matches.length > 0) {
                wrapper.width($.trim(matches[1]));
            }
        }

        innerHtml += '<span class="dews-multicodepicker-wrap">';
        innerHtml += '    <input type="text" class="dews-multicodepicker-text" value="" readonly="readonly"/>';
        innerHtml += '    <span class="dews-select">';
        innerHtml += '        <button type="button" class="dews-multicodepicker-button"><span class="dews-icon icon-arrow"></span></button>';
        innerHtml += '        <button type="button" class="dews-multicodepicker-button"><span class="dews-icon icon-search"></span></button>';
        innerHtml += '    </span>';
        innerHtml += '</span>';

        self.target.wrap(wrapper);
        self.wrapper = self.target.parent();
        $(innerHtml).prependTo(self.wrapper);
        idName = self.target.prop('id');

        self.inputText = $('.dews-multicodepicker-text', self.wrapper);
        self.target.prop({
            'multiple':true,
            'name':idName
        });
    };

    /**
     * 멀티코드피커의 리스트에 대한 DOM을 세팅합니다.
     * @private
     */
    MultiCodepicker.prototype._setListElement = function(){
        var self = this,
            container,
            innerHtml = '';

        container = $('<div class="dews-animation-container" />');
        self.container = container;

        innerHtml += '<div class="dews-list-container">';
        innerHtml += '   <ul class="dews-list">';
        innerHtml += '   </ul>';
        innerHtml += '   <div class="dews-footer">';
        innerHtml += '      <button type="button" class="dews-all-delete"><span>'+dews.localize.get("전체삭제", "dews_전체삭제")+'</span></button>';
        innerHtml += '   </div>';
        innerHtml += '</div>';

        self.container.empty().append($(innerHtml));

        $('body').append(self.container);

        self._setListItemElement();

        //리스트 위치값 세팅
        self._setListElementPosition(self.position);

        if(self.target.attr('id') === 'fixwidth'){
            self.inputText.addClass('fixwidth-wrapper');
            self.container.find('.dews-list-container').addClass('fixwidth-wrapper');
        }
    };

    /**
     * 멀티코드피커의 리스트 아이템에 대한 DOM 및 값을 세팅합니다.
     * @private
     */
    MultiCodepicker.prototype._setListItemElement = function(){
        var self = this,
            item = self.target.find('option');

        for(var i=0;i<item.length;i++){
            if ($.type(item.data('dews-localize-key') !== 'undefined')) {
                self.container.find('.dews-list').append('<li class="dews-item" value="'+ item.eq(i).attr('value') +'">' + dews.localize.get(item.eq(i).text(), item.data('dews-localize-key'), item.data('dews-localize-lang') || null) + '<button type="button" class="dews-close"><span> </span></button></li>');
            } else {
                self.container.find('.dews-list').append('<li class="dews-item" value="'+ item.eq(i).attr('value') +'">' + item.eq(i).text() + '<button type="button" class="dews-close"><span> </span></button></li>');
            }
        }

        self._setListInitEventListener();
    };

    MultiCodepicker.prototype._setTooltip = function(item){
        var self = this,
            tooltip = dews.ui.tooltip.show(item, {
                type: 'normal',
                position: 'left',
                text: item.attr('value'),
                fadeOutTime: 0
            });

        self._tooltip = tooltip;
    };

    /**
     * 멀티코드피커의 리스트 아이템에 대한 이벤트를 설정합니다.
     * @private
     */
    MultiCodepicker.prototype._setListInitEventListener = function(){
        var self = this,
            $overItem = null;

        //리스트 아이템
        self.item = self.container.find('.dews-list li');

        //리스트 아이템 오버
        self.item.on('mouseenter',function(){
            if($overItem !== null){
                $overItem.removeClass('dews-state-hover');
                if(self._tooltip) {
                    self._tooltip._delete();
                }
            }
            $(this).addClass('dews-state-hover');

            $overItem = $(this);

            self._setTooltip($(this));
        });

        //리스트컨테이너 아웃
        self.container.find('.dews-list').on('mouseleave',function(){
            if($overItem !== null){
                $overItem.removeClass('dews-state-hover');
                if(self._tooltip) {
                    self._tooltip._delete();
                }
            }
        });

        //전체 삭제
        self.container.find('.dews-all-delete').on('click',function(){
            self.clearData();
            self._blank();
            self._upCloseSetPotion();

            self.target.trigger('_change');
        });

        //닫기 버튼 이벤트
        self.item.find('.dews-close').on('click',function(){
            var length = self.container.find('.dews-list li').length;
            var value = $(this).parent().attr('value');
            var idx = $(this).parent().index();

            $(this).parent().remove();
            self.target.find('option').eq(idx).remove();
            //리스트가 1개일때
            if(length === 1){
                self._blank();
            }

            //리스트가 위로 올라갔을때
            self._upCloseSetPotion();

            if(self._tooltip) {
                self._tooltip._delete();
            }

            self._setText();

            self.target.trigger('_change');
        });
    };

    /**
     * 멀티코드피커의 리스트에 대한 위치 값을 세팅합니다.
     * @param {number} 스크롤값
     */
    MultiCodepicker.prototype._setListElementPosition = function(scrollPos){
        var self = this;

        var positionX = self.wrapper.offset().left; //X위치값
        var positionY = self.wrapper.offset().top; //Y위치값
        var selectHeight = self.wrapper.height(); //input 높이값
        var selectWidth = self.wrapper.width(); //input 넓이값
        var scrollPosition = $(window).scrollTop();
        var zIndex = dews.ui.getDialogMaxZIndex();

        if (zIndex > parseInt(self.container.css('zIndex'), 10)) {
            self.container.css('zIndex', zIndex+2);
        }

        $('.dews-list', self.container).css({ 'maxHeight': '', 'overflow': 'none' });

        // MAX-HEIGHT 설정 및 열리는 방향 설정
        var maxHeight = 0;
        var listMargin = 10;
        var winHeight = $(window).height();
        var listHeight = self.container.height();
        var vaTopHeight = positionY - scrollPosition - listMargin;
        var vaBottomHeight = winHeight - (vaTopHeight + selectHeight) - listMargin;
        var useMaxHeight = listHeight > vaTopHeight && listHeight > vaBottomHeight;
        var openToTop = listHeight > vaBottomHeight && vaTopHeight > vaBottomHeight;

        if (useMaxHeight) {
            maxHeight = openToTop ? vaTopHeight : vaBottomHeight;
            $('.dews-list', self.container).css({ 'maxHeight': (maxHeight - selectHeight * 2) + 'px', 'overflow': 'auto'});
        }

        if (openToTop) {
            //위로 열릴때
            self.container.css({
                'left' : positionX,
                'top' : positionY -1,
                'width' : selectWidth
            });

            self.listPosition = 'up';
            self.container.find('.dews-list-container').addClass('dews-state-border-down').removeClass('dews-state-border-up');
            self.wrapper.find('.dews-multicodepicker-wrap').addClass('dews-state-border-up').removeClass('dews-state-border-down');
        } else {
            //아래로 열릴때
            self.container.css({
                'left' : positionX,
                'top' : positionY + selectHeight,
                'width' : selectWidth
            });

            self.listPosition = 'down';
            self.container.find('.dews-list-container').addClass('dews-state-border-up').removeClass('dews-state-border-down');
            self.wrapper.find('.dews-multicodepicker-wrap').addClass('dews-state-border-down').removeClass('dews-state-border-up');
        }
    };

    /**
     * 멀티코드피커의 리스트 갯수의 text를 세팅합니다.
     * @private
     */
    MultiCodepicker.prototype._setText = function(){
        var self = this,
            item;
        item = self.target.find('option');

        if(item.length === 0){
            self._blank();
        } else if(item.length === 1){
            self.inputText.empty().attr('value',item.eq(0).text());
        } else {
            self.inputText.empty().attr('value',item.eq(0).text() + ' '+dews.localize.get("외", "dews_외")+' '+ (item.length -1) + dews.localize.get("건", "dews_건"));
        }
    };


    /**
     * 멀티코드피커의 리스트에 대한 애니메이션 입니다.
     * @param {string} 슬라이드 대상
     */
    MultiCodepicker.prototype._slideDown = function(item){
        var self = this;
        var moveNum = self.container.height();

        item.addClass('dews-state-active');

        if(self.listPosition === 'down'){
            //아래로 열릴때
            self.container.css({
                'marginTop': 0
            });
            self.container.stop().slideDown(200);
        } else{
            //위로 열릴때
            self.container.css({
                'marginTop': - (moveNum - 2)
            });
            self.container.stop().slideDown(200);
        }
    };

    /**
     * 멀티코드피커의 리스트에 대한 애니메이션 입니다.
     * @param {string} 슬라이드 대상
     */
    MultiCodepicker.prototype._slideUp = function(item){
        var self = this;

        item.removeClass('dews-state-active');
        item.removeClass('dews-state-focused');
        self.container.stop().slideUp(200);
        self.container.css('zIndex', '');
    };

    /**
     * 멀티코드피커에 리스트가 없을때 설정합니다.
     * @private
     */
    MultiCodepicker.prototype._blank = function(){
        var self = this;
        self.container.find('.dews-list').empty().append('<li class="dews-item none">' + dews.localize.get("데이터가 없습니다.", "dews_데이터가 없습니다.")+'</li>');
        self.inputText.attr('value','');
        self.container.find('.dews-footer').hide();
        self.target.empty();
    };

    /**
     * DEWS 객체에 직접 이벤트 핸들러를 등록합니다.
     */
    MultiCodepicker.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        self.target.on.apply(self.target, arguments);
    };

    /**
     * DEWS 객체에 직접 등록한 이벤트 핸들러를 해제합나다.
     */
    MultiCodepicker.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        self.target.off.apply(self.target, arguments);
    };

    MultiCodepicker.prototype.validate = function () {
        var self = this;
        return $.isArray(self.codes()) && self.codes().length > 0;
    };

    // 멀티코드피커의 바인딩 로직을 외부에서 주입 받기 위한 함수
    MultiCodepicker.prototype.setBindFormPanelLogic = function(logic) {
        var self = this;

        if ($.isFunction(logic)) {
            self.bindLogic = logic;
        }
    };

    // 멀티코드피커의 직렬화 로직을 외부에서 주입 받기 위한 함수
    MultiCodepicker.prototype.setSerializeForPanelLogic = function(logic) {
        var self = this;

        if ($.isFunction(logic)) {
            self.serializeLogic = logic;
        }
    };

    MultiCodepicker.prototype.bindFromPanel = function(data) {
        var self = this;

        if (data) {
            if ($.isFunction(self.bindLogic)) {
                self.bindLogic.call(self, data);
            }
        }
    };

    MultiCodepicker.prototype.serializeForPanel = function () {
        var self = this;
        var data;

        if ($.isFunction(self.serializeLogic)) {
            data = self.serializeLogic.call(self)
        }

        return data;
    };

    MultiCodepicker.prototype.applyPanelFocus = function () {
        var self = this, $element = self.target;
        var $wrapper = $element.parent('.dews-multicodepicker-wrapper');
        var $text = $('.dews-multicodepicker-text', $wrapper);

        self.usePanelFocus = true;

        $text.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    MultiCodepicker.prototype.canFocusable = function () {
        var self = this, $element = self.target;
        var $wrapper = $element.parent('.dews-multicodepicker-wrapper');
        var $text = $('.dews-multicodepicker-text', $wrapper);

        return !$text.parent('.dews-multicodepicker-wrap').hasClass('dews-state-readonly') && $text.is(':visible') && $text.is(':enabled');
    };

    /**
     * 멀티코드피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    MultiCodepicker.prototype._getPrintData = function () {
        var self = this,
            $el = self.target,
            text = '',
            data;

        if (self.texts().length !== 0) {
            $.each(self.texts(), function (idx, target) {
               if (idx !== 0) {
                   text += ', ';
               }
               text += target
            });
            data = {
                id: $el.attr('id'),
                text: text,
            }
        }

        return data;
    };


    $.extend(true, dews, {
        ui: {
            multicodepicker: function (selector, options) {
                var $control, codepicker;

                if (selector instanceof jQuery) {
                    $control = selector;
                } else if ($.type(selector) === "string") {
                    $control = $(selector);
                } else {
                    throw "대상이 지정되지 않았습니다.";
                }

                $control.each(function () {
                    var $this = $(this), opt;

                    codepicker = $this.data('dews-control');

                    if (!codepicker) {

                        opt = getOptions($this, options);
                        codepicker = new MultiCodepicker($this, opt);

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', codepicker);
                    }
                });

                return codepicker;
            }
        }
    });

    // DOM Ready 시에 컨트롤들을 초기화
    dews.ui.addControlInitializer('multicodepicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.multicodepicker($("select.dews-ui-multicodepicker", $container));
    });

})(jQuery, window.dews || {});




/**
 * 멀티 드롭다운 리스트
 **/

(function ($, dews) {
    var defaultOptions = {
        dataTextField: 'text',
        dataValueField: 'value',
        autoOpen: false
    };

    /**
     * 설정 값을  가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var inlineOptions;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};

        return $.extend(true, {}, inlineOptions, codeOptions);
    }

    /**
     * HTML 코드 상에 선언되어 있는 옵션값을 가져옵니다.
     * @param $el 대상 요소의 jQuery 객체
     */
    function getInlineOptions($el) {
        var options = {},
            dataSource, dataSourceID, dataSourceUrl, dataSourceParams, dataSourceOptions;

        options = $.extend(true, defaultOptions, options);

        if ($el) {
            if ($el.data('dews-value-field')) {
                options.dataValueField = $el.data('dews-value-field');
            }

            if ($el.data('dews-text-field')) {
                options.dataTextField = $el.data('dews-text-field');
            }

            // 포커스가 들어왔을 때, 자동으로 항목을 여는 기능 추가
            if ($el.data('dews-auto-open')) {
                options.autoOpen = $el.data('dews-auto-open');
            }

            if ($el.attr('id')) {
                dataSourceID = $el.attr('id') + '_DataSource';
            } else {
                dataSourceID = (new Date()).toString() + '_DataSource';
            }

            //url 이 있을 떄
            if ($el.data('dews-data-url')) {
                dataSourceUrl = dews.url.getAbsoluteUrl($el.data('dews-data-url'));

                dataSourceOptions = {
                    transport: {
                        read: {
                            url: dataSourceUrl ,
                            dataType: 'json'
                        }
                    }
                };

                dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);

                //help code(이)가 있을 때
            } else if ($el.data('dews-help-code')) {
                dataSourceUrl = dews.url.getCodeDataUrl($el.data('dews-help-code'));

                dataSourceOptions = {
                    transport: {
                        read: {
                            url: dataSourceUrl,
                            dataType: 'json'
                        }
                    }
                };

                if ($el.data('dews-help-params')) {
                    dataSourceParams = $.deparam($el.data('dews-help-params'));
                    dataSourceOptions.transport.read.data = dataSourceParams;
                }

                dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
            } else {
                dataSourceOptions = {
                    data: []
                };

                //select, option 태그 사용
                $.each($el.find('option'), function (idx, item) {
                    var obj = {},
                        $item = $(item);

                    obj[options.dataValueField] = $item.attr('value');
                    obj[options.dataTextField] = $item.text();

                    dataSourceOptions.data.push(obj);
                });

                dataSource = dews.ui.dataSource(dataSourceID, dataSourceOptions);
            }
            options.dataSource = dataSource;
        }

        return options;
    }

    var MultiDropDownList = function (element, opt) {
        var self = this; //드롭다운리스트 인스턴스 바인딩

        self.$element = $(element);
        self.options = opt;

        self._init();

        return self;
    };

    /**
     * 인스턴스 초기화
     * @private
     */
    MultiDropDownList.prototype._init = function () {
        var self = this;

        self._setMultiDropDownDOM();
        self._setListDOM();

        var $state = self.wrapper.find('.dews-dropdown-wrap'); //상태 값
        self.$state = $state;

        //readonly, disabled, required 상태값 추가
        if ((self.$element).attr('disabled') || self.$element.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
            self.wrapper.addClass('disabled');
        }

        if (self.$element.attr('required') || self.$element.hasClass('required')) {
            $state.addClass('dews-state-required');
            self.wrapper.addClass('required');
        }

        if ((self.$element).attr('readonly') || self.$element.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
            self.wrapper.addClass('readonly');
        }
    };

    /**
     * 멀티 드롭다운 리스트를 비활성화 상태로 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._setDisabled = function () {
        var self = this,
            $el = self.$element,
            $wrapper = self.wrapper;

        if (!$wrapper.find('.dews-dropdown-wrap').hasClass('dews-state-disabled')) {
            $wrapper.find('.dews-dropdown-wrap').addClass('dews-state-disabled');
        }

        $el.prop('disabled', true);

        if (!$el.hasClass('disabled')) {
            $el.addClass('disabled');
        }
    };

    /**
     * 멀티 드롭다운 리스트를 활성화 상태로 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._removeDisabled = function () {
        var self = this,
            $el = self.$element,
            $wrapper = self.wrapper;

        if ($wrapper.find('.dews-dropdown-wrap').hasClass('dews-state-disabled')) {
            $wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-disabled');
        }

        $el.prop('disabled', false);

        if ($el.hasClass('disabled')) {
            $el.removeClass('disabled');
        }
    };

    /**
     * 멀티드롭다운리스트를 읽기전용 상태로 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._setReadonly = function () {
        var self = this,
            $el = self.$element,
            $wrapper = self.wrapper;

        if (!$wrapper.find('.dews-dropdown-wrap').hasClass('dews-state-readonly')) {
            $wrapper.find('.dews-dropdown-wrap').addClass('dews-state-readonly');
        }

        $el.attr('readonly', true); //HTML 초기화 코드에 readonly 옵션 추가

        if (!$el.hasClass('readonly')) {
            $el.addClass('readonly');
            $wrapper.addClass('readonly');
        }
    };

    /**
     * 멀티코드피커의 읽기전용을 해제합니다.
     * @private
     */
    MultiDropDownList.prototype._removeReadonly = function () {
        var self = this,
            $el = self.$element,
            $wrapper = self.wrapper;

        if ($wrapper.find('.dews-dropdown-wrap').hasClass('dews-state-readonly')) {
            $wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-readonly');
        }

        $el.attr('readonly', false); // code 컨트롤에서 reaodonly를 설정

        if ($el.hasClass('readonly')) {
            $el.removeClass('readonly');
            //self._initEventListener();
        }
    };

    MultiDropDownList.prototype._blank = function () {
        var self = this;
        var $div = $('<div class="dews-item-none"></div>');
        var $text =$('<div class="dews-item-none-text">' + dews.localize.get("데이터가 없습니다.", "dews_데이터가 없습니다.") + '</div>');
        var $list = self.listContainer.find('.dews-list');

        if ($list.parent().find('.dews-item-none').length === 0) {
            $list.css('display','none');
            $div.append($text);
            $list.after($div);

            self.listContainer.find('.dews-multidropdown-footer').hide();
            self.$element.empty();
        }
    };

    /**
     * 멀티 드롭다운 리스트의 DOM 구조를 세팅합니다.
     * @private
     */
    MultiDropDownList.prototype._setMultiDropDownDOM = function () {
        //select.dews-ui-multidropdownlist를 받아왔옹
        var self = this,
            wrapper,
            innerHTML = '';

        //Wrapper 세팅
        wrapper = $('<span class="dews-widget dews-dropdown dews-header dews-form-control dews-multidropdownlist-wrapper" >');

        innerHTML += '<span class="dews-dropdown-wrap dews-state-default">';
        innerHTML += '<span class="dews-input" tabindex="0"  ></span>';
        innerHTML += '<span class="dews-select">';
        innerHTML += '<span class="dews-icon dews-i-arrow-60-down"></span>';
        innerHTML += '</span>';
        innerHTML += '</span>';
        innerHTML += '</span>';

        self.$element.wrap(wrapper);
        $(innerHTML).insertBefore(self.$element);

        self.wrapper = self.$element.closest('.dews-multidropdownlist-wrapper');
        self.wrap = self.$element.closest('.dews-dropdown-wrap');
        self.$element.css('display', 'none');
    };

    /**
     * 내부 리스트의 DOM 구조를 세팅합니다. (+체크박스 & 버튼영역)
     * @private
     */
    MultiDropDownList.prototype._setListDOM = function () {
        var self = this,
            container,
            HTML = '';

        container = $('<div class="dews-animation-container">'); //container : 내부 리스트
        self.listContainer = container;

        HTML += '<div class="dews-list-container dews-popup">';
        HTML += '<ul class="dews-list">';
        HTML += '</ul>';
        HTML += '<div class="dews-multidropdown-footer dews-footer">';
        HTML += '<span class="dews-select-deselect dews-checkbox-wrapper"><input type="checkbox" class="dews-ui-checkbox dews-control dews-control-activate"><label class="dews-checkbox-label dews-select-deselect-all" onclick="dews.ui.multidropdownlist.click._check(this,event)"></label></span>';
        HTML += '<button type="button" class="dews-multidropdown-ok"><span>'+dews.localize.get("확인", "dews_확인")+'</span></button>';
        HTML += '</div>';
        HTML += '</div>';
        HTML += '</div>';

        self.listContainer.append($(HTML));
        $('body').append(self.listContainer);
        self._setListItems(); //리스트 아이템 생성

        //리스트 위치값 세팅
        self.listContainer.css('display','none');
        self.listContainer.data('dews-control', self);

        self.footer = self.listContainer.find('.dews-multidropdown-footer');

        self._bindEvents();
    };

    /**
     * 리스트 아이템 생성
     * @private
     */
    MultiDropDownList.prototype._setListItems = function () {
        var self = this,
            data = self.options.dataSource.data(),
            $dfd = $.Deferred();

        $dfd.done(function () {
            self.listContainer.find('.dews-list').empty();

            for (var i=0;i<self.options.dataSource.data().length;i++) {
                self.listContainer.find('.dews-list').append('<li style="display: flex" class="dews-item" data-dews-value="' + self.options.dataSource.data()[i][self.options.dataValueField] +'">' +
                    '<span class="dews-checkbox-wrapper">' +
                    '<input type="checkbox" class="dews-ui-checkbox dews-control dews-control-activate">' +
                    '<label class="dews-checkbox-label" onclick="dews.ui.multidropdownlist.click._check(this,event)">' +
                    '</label>' +
                    '</span>' +
                    '<span class="dews-text">' +
                    self.options.dataSource.data()[i][self.options.dataTextField] +
                    '</span>' +
                    '</li>');
            }
        });

        if (data.length  > 0) { //데이터가 있으면
            $dfd.resolve();
        } else { //데이터가 없으면
            self.options.dataSource.fetch().done(function () { //서버에 다녀옴
                $dfd.resolve();
            });
        }
    };

    /**
     * 멀티 드롭다운 내부 리스트 위치를 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._setListPosition = function () {
        var self = this;

        //드롭다운
        var positionX = self.wrapper.offset().left; //X값
        var positionY = self.wrapper.offset().top; //y값
        var height = self.wrapper.height(); //높이값
        var width = self.wrapper.width(); //너비값
        var scrollPosition = $(window).scrollTop();
        var zIndex = dews.ui.getDialogMaxZIndex();

        //리스트
        var maxHeight;
        var listMargin = 10;
        var windowHeight = $(window).height();
        var listHeight = self.listContainer.height();
        var vaTopHeight = positionY - scrollPosition - listMargin;
        var vaBottomHeight = windowHeight - (vaTopHeight + height) - listMargin;
        var openToTop = listHeight > vaBottomHeight && vaTopHeight > vaBottomHeight;

        maxHeight = openToTop ? vaTopHeight : vaBottomHeight;
        $('.dews-list', self.listContainer).css({ 'max-height': (maxHeight - height * 2) + 'px', 'overflow': 'auto'});

        if (zIndex > parseInt(self.listContainer.css('zIndex'), 10)) {
            self.listContainer.css('zIndex', zIndex+2);
        }

        self.wrapper.positionX = positionX;
        self.wrapper.positionY = positionY;

        //리스트 좌표 새로 설정
        self.listContainer.css({
            'position' : 'absolute',
            'top' : positionY+height,
            'left' : positionX,
            'width' : width
        });

        if (openToTop) {
            //위로 열릴때
            self.listContainer.css({
                'left' : positionX,
                'top' : positionY -1,
                'width' : width
            });

            self.listPosition = 'up';

        } else {
            //아래로 열릴때
            self.listContainer.css({
                'left' : positionX,
                'top' : positionY + height,
                'width' : width
            });

            self.listPosition = 'down';

        }
    };


    /**
     * 멀티 드롭다운 리스트 이벤트를 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._bindEvents = function () {
        var self = this,
            $dropdownwrap = self.wrapper;

        //포커스 아웃시 리스트 열어놓은 멀티 드롭다운 리스트의 리스트 올라가도록
        self.wrapper.find('.dews-input').on('blur', function () {
            $(this).closest('.dews-dropdown-wrap').removeClass('dews-state-focused');
            $(this).closest('.dews-dropdown-wrap').removeClass('dews-state-active');
        });

        //리스트 아이템 이벤트
        self.listContainer.on('mouseenter mouseleave', '.dews-item', function(e) {
            if(e.type === 'mouseenter') {

                $(this).addClass('dews-state-hover');

            } else if (e.type === 'mouseleave') {
                $(this).removeClass('dews-state-hover');
                $(this).removeClass('dews-state-selected');

            }
        });

        //리스트 hover 이벤트
        $dropdownwrap.on('mouseenter mouseleave', function(e) {
            if(e.type === 'mouseenter') {
                $(this).find('.dews-dropdown-wrap').addClass('dews-state-hover');

            } else if (e.type === 'mouseleave') {
                $(this).find('.dews-dropdown-wrap').removeClass('dews-state-hover');
            }
        });

        self.listContainer.on('click', '.dews-item', function (e) {
            dews.ui.multidropdownlist.click._check.call(self, $(this).find('.dews-checkbox-label'));
            e.stopPropagation();
        });

        //리스트 열고 닫는 이벤트
        $dropdownwrap.on('click', function (e) {
            var target = $(this);

            $('.dews-animation-container').css('display', 'none');
            $('.dews-multidropdownlist-wrapper').not(target).removeClass('dews-multidropdown-selected');

            if(!target.find('.dews-dropdown-wrap').hasClass('dews-state-readonly') && !target.find('.dews-dropdown-wrap').hasClass('dews-state-disabled')) {

                if (!target.hasClass('dews-multidropdown-selected')) {
                    target.addClass('dews-multidropdown-selected');
                    self._listDown();
                    self._triggerOpenEvent();
                    documentClick();
                    documentWheel();
                } else {
                    target.removeClass('dews-multidropdown-selected');
                    self._listUp();
                }
            }
            e.stopPropagation();
        });

        //f4키로 리스트 열기 이벤트, esc키로 닫기 이벤트
        self.wrapper.on('keydown', function (e) {
            var key = e.keyCode || e.which;
            if (key === 13) { //enter
                if ($(this).find('.dews-dropdown-wrap').hasClass('dews-state-active') === true) {
                    self._listUp();
                }
                e.stopPropagation();
            } else  if (e.keyCode === 115) { //f4
                if(!self.$element.attr('readonly') && !self.$element.attr('disabled')) {
                    $dropdownwrap.click();
                    e.stopPropagation();
                    e.preventDefault();
                }
            } else if (e.keyCode === 27) { //esc
                self._listUp();
                self.focus();
                e.stopPropagation();
                e.preventDefault();
            }
        });

        //리스트 외에 영역 클릭시 리스트 닫기
        function documentClick () {
            $(document).on('click', function(e) {
                if ($(e.target).closest('.dews-animation-container').length === 0) {
                    self._listUp();
                }
                e.stopPropagation();
            });
        }

        //스크롤시 리스트 닫기
        function documentWheel () {
            $(document).on('mousewheel DOMMouseScroll', function (e) {
                if ($(e.target).closest('.dews-animation-container').length === 0) {
                    self._listUp();
                }
                e.stopPropagation();
            });
        }

        //확인버튼 이벤트
        $('.dews-multidropdown-ok', self.listContainer).on('click', function(e) {
            self._listUp();
            self._triggerCloseEvent();
            e.stopPropagation();
        });
    };

    /**
     * 멀티 드롭다운 리스트 text를 설정합니다.
     * @private
     */
    MultiDropDownList.prototype._setText = function () {
        var self = this,
            checked = self.listContainer.find('.dews-list').find('input[type="checkbox"]').filter(':checked');

        if (checked.length === 0) {
            self.wrapper.find('.dews-input').empty();
        } else if (checked.length === 1) {
            self.wrapper.find('.dews-input').empty().text(checked.eq(0).parent().siblings().text());
        } else {
            self.wrapper.find('.dews-input').empty().text(checked.eq(0).parent().siblings().text() + ' ' + dews.localize.get("외", "dews_외")+' '+ (checked.length -1) + dews.localize.get("건", "dews_건"));
        }
    };

    /**
     * 리스트를 아래로 내립니다.
     * @private
     */
    MultiDropDownList.prototype._listDown = function () {
        var self = this;
        var dynamicListHeight;
        var count =0;

        //확인버튼, 요소제외 영역 클릭으로 접근시 DOM에 한번 열렸던 멀티드롭다운리스크 클래스 제거해주는 작업
        $('.dews-dropdown-wrap').removeClass('dews-state-active').removeClass('dews-state-focused');

        self._setListPosition();

        //데이터가 없을 떄 처리
        if (self.listContainer.find('.dews-item').length === 0 || !self.options.dataSource) {
            self._blank();
        } else {
            self.listContainer.find('.dews-list').css('display','');
            self.listContainer.find('.dews-item-none').css('display','none');
        }

        dynamicListHeight = self.listContainer.height();

        if (self.listPosition === 'down') {
            //아래로 열릴때
            self.listContainer.css({
                'marginTop': 0
            });
            self.listContainer.stop().slideDown(200);
            self.wrapper.find('.dews-dropdown-wrap').addClass('dews-state-active').addClass('dews-state-focused');

        } else {
            //위로 열릴때
            self.listContainer.css({
                'marginTop': - (dynamicListHeight - 2)
            });
            self.listContainer.stop().slideDown(200);
        }

        //아이콘 up,down 변경
        if (self.listPosition === 'down') {
            self.wrapper.addClass('dews-state-border-down');
            self.wrapper.find('.dews-dropdown-wrap').addClass('dews-state-border-down');
        } else {
            self.wrapper.addClass('dews-state-border-up');
            self.wrapper.find('.dews-dropdown-wrap').addClass('dews-state-border-up');
        }

        $(document).on('keydown', keyboardEvent);

        //keydown 이벤트
        function keyboardEvent(e) {
            var $item = self.listContainer.find('.dews-item');

            if(e.keyCode === 40) { //down arrow
                //item에 focus주기
                if (count >= $item.length) {
                    count =0;
                }
                $item.filter('.dews-state-selected').removeClass('dews-state-selected');
                $item.eq(count).addClass('dews-state-selected');

                count++;
            } else if (e.keyCode === 38) { //up arrow
                if (count < 0) {
                    count =$item.length-1;
                }
                $item.eq(count).removeClass('dews-state-selected');
                count-=1;
                $item.eq(count).addClass('dews-state-selected');
            } else if (e.keyCode === 115) {
                if(!self.$element.attr('readonly') && !self.$element.attr('disabled')) {
                    self.wrapper.click();
                }
            }
            e.stopPropagation();
        }

        self.previousSelectedItems = self.selectedItems();
    };

    /**
     * 리스트를 닫습니다.
     * @private
     */
    MultiDropDownList.prototype._listUp = function () {
        var self = this;

        $(self).blur();

        self.wrapper.removeClass('dews-multidropdown-selected');

        self.wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-active');
        self.wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-focused');

        self.listContainer.slideUp(100, 'linear' , function () {
            self.listContainer.css('display','none');
        });

        $(document).off('click');
        $(document).off('mousewheel');
        $(document).off('keydown');

        self.afterSelectedItems = self.selectedItems();

        if (self.previousSelectedItems !== self.afterSelectedItems) {
            self.$element.trigger('_change');
        }

        self.wrapper.removeClass('dews-state-border-down');
        self.wrapper.removeClass('dews-state-border-up');
        self.wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-border-down');
        self.wrapper.find('.dews-dropdown-wrap').removeClass('dews-state-border-up');

        self._triggerCloseEvent();
    };

    /**
     * close 이벤트
     * @private
     */
    MultiDropDownList.prototype._triggerCloseEvent = function () {
        var self = this;
        var evt = new $.Event('close', {
            multidropdownlist: self
        });

        self.$element.trigger(evt);
    };

    /**
     * select 이벤트
     * @private
     */
    MultiDropDownList.prototype._triggerSelectEvent = function (e) {
        var self = this;
        var evt = new $.Event('select', {
            dataItems: self.selectedItems(),
            selectAll: e ? $(e.currentTarget).closest('.dews-list-container').find('.dews-multidropdown-footer').hasClass('selectedAll') : "" ,
            multidropdownlist: self
        });

        self.$element.trigger(evt);
    };

    /**
     * change 이벤트
     * @private
     */
    MultiDropDownList.prototype._triggerChangeEvent = function () {
        var self = this;
        var evt = new $.Event('_change', {
            dataItems: self.selectedItems(),
            multidropdownlist: self
        });

        self.$element.trigger(evt);
    };

    /**
     * open 이벤트
     * @private
     */
    MultiDropDownList.prototype._triggerOpenEvent = function () {
        var self = this;
        var evt = new $.Event('open', {
            multidropdownlist: self
        });

        self.$element.trigger(evt);
    };

    /**
     * dataBound 이벤트
     * @private
     */
    MultiDropDownList.prototype._triggerDataBound = function () {
        var self = this;
        var evt = new $.Event('dataBound', {
            dataItems: self.dataItems(),
            multidropdownlist: self
        });

        self.$element.trigger(evt);
    };

    /**
     * 데이터소스를 바인딩합니다.
     * @param dataSource
     */
    MultiDropDownList.prototype.setDataSource = function (dataSource) {
        var self = this;

        self.options.dataSource = dataSource;
        self._setListItems();
        self._triggerDataBound();

        if (dataSource) {
            self.footer.css('display', '');
        }

        self._setText();
    };

    /**
     * 멀티 드롭다운 리스트의 아이템을 전체 선택 합니다
     */
    MultiDropDownList.prototype.selectAll = function () {
        var self = this,
            $selectAll = self.listContainer.find('.dews-multidropdown-footer').find('.dews-select-deselect'),
            $checkbox = self.listContainer.find('.dews-checkbox-label').parent('.dews-checkbox-wrapper').find('input[type = "checkbox"]');

        if ($checkbox.filter(':checked').length !== $checkbox.length) {
            $selectAll.find('.dews-select-deselect-all').click();
        }

        self._setText();
    };

    /**
     * 멀티 드롭다운 리스트의 아이템을 전체 해제 합니다.
     */
    MultiDropDownList.prototype.deselectAll = function () {
        var self = this,
            $label = self.listContainer.find('.dews-multidropdown-footer').find('.dews-checkbox-label'),
            $checkbox = $label.parent(".dews-checkbox-wrapper").find('input[type="checkbox"]'),
            footer = $checkbox.closest('.dews-multidropdown-footer'),
            listcheckbox = footer.siblings('.dews-list').find('input[type="checkbox"]');

        listcheckbox.prop('checked', false);
        if (footer.hasClass('selectedAll')) {
            footer.removeClass('selectedAll');
        }

        self._setText();
    };

    /**
     * 멀티 드롭다운 리스트의 활성화/비활성화 상태를 설정및 반환합니다.
     * @param value 활성화/비활성화 여부
     * @returns {boolean}
     */
    MultiDropDownList.prototype.enable = function (value) {
        var self = this,
            $el = self.$element,
            enabled;

        enabled = !$el.prop('disabled');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === false) {
                self._setDisabled();
                enabled = !value;
            } else if (value === true) {
                self._removeDisabled();
                enabled = !value;
            }
        }

        return enabled;
    };

    /**
     * 멀티코드피커의 읽기전용, 일기전용 해제를 설정 및 반환합니다.
     * @param {boolean} true(읽기전용 설정), false(읽기전용 해제)
     */
    MultiDropDownList.prototype.readonly = function(value) {
        var self = this,
            $el = self.$element,
            readonly;

        readonly = $el.prop('readonly');

        if (typeof value !== 'undefined') {
            // 설정
            if (value === true) {
                self._setReadonly();
                readonly = value;
            } else if (value === false) {
                self._removeReadonly();
                readonly = value;
            }
        }

        return readonly;
    };

    /**
     * 멀티 드롭다운 리스트 팝업 열기
     */
    MultiDropDownList.prototype.open = function () {
        var self = this;
        self._listDown();
    };

    /**
     * 멀티 드롭다운 리스트 팝업 닫기
     */
    MultiDropDownList.prototype.close = function () {
        var self = this;
        self._listUp();
    };

    /**
     * 멀티 드롭다운리스트 컴포넌트에 포커스를 줍니다.
     */
    MultiDropDownList.prototype.focus = function () {
        var self = this;
        self.wrapper.find('.dews-input').focus();
        self.wrapper.find('.dews-input').addClass('focused');
        self.wrapper.find('.dews-dropdown-wrap').addClass('dews-state-focused');
    };

    /**
     * 멀티 드롭다운 리스트의 해당 인덱스의 아이템을 선택합니다.
     * @param index 선택할 아이템 인덱스
     */
    MultiDropDownList.prototype.select = function (index) {
        var self = this,
            $items;

        if ($.isNumeric(index)) {
            $items = self.listContainer.find('.dews-item').eq(index);
            if (!$items.find('input[type="checkbox"]').prop('checked')) {
                dews.ui.multidropdownlist.click._check.call(self, $items.find('.dews-checkbox-label'));
            }
        }
    };

    /**
     * 멀티 드롭다운 리스트의 해당 인덱스의 아이템이 선택되어 있을시 해제합니다.
     * @param index 해제할 아이템 인덱스
     */
    MultiDropDownList.prototype.deselect = function (index) {
        var self = this,
            $items;

        if ($.isNumeric(index)) {
            $items = self.listContainer.find('.dews-item').eq(index);
            if ($items.find('input[type="checkbox"]').prop('checked')) {
                dews.ui.multidropdownlist.click._check.call(self, $items.find('.dews-checkbox-label'));
            }
        }
    };


    /**
     * 멀티 드롭다운 리스트의 선택된 아이템들을 반환합니다.
     * @returns {Array} 리스트의 선택된 아이템 배열
     */
    MultiDropDownList.prototype.selectedItems = function () {
        var self = this,
            $items = self.listContainer.find('.dews-item'),
            checkedItems = $items.find('.dews-ui-checkbox:checked');

        return checkedItems;
    };

    /**
     * 멀티 드롭다운 리스트의 <li> 요소로 이루어진 아이템 배열을 반환합니다.
     * @return {Array} 아이템 배열
     */
    MultiDropDownList.prototype.items = function () {
        var self = this,
            $items = self.listContainer.find('.dews-item');

        return $items;
    };

    /**
     * 멀티 드롭다운 리스트의 선택된 아이템의 text를 배열로 반환하거나 설정합니다.
     * @param value 선택할 아이템 text 문자열이나 배열
     * @returns {Array} 드롭다운리스트의 선택된 아이템의 text 배열
     */
    MultiDropDownList.prototype.texts = function (value) {
        var self = this,
            texts = [];

        if ($.type(value) === 'undefined') {
            var $items = self.listContainer.find('.dews-item'),
                $selectedItems = $items.find('.dews-ui-checkbox:checked');

            for (var i = 0; i < $selectedItems.length; i += 1) {
                texts.push($selectedItems.eq(i).closest('.dews-item').find('.dews-text').text());
            }
            return texts;

        } else if ($.isArray(value)) {
            for (var i=0; i<value.length; i++) {
                for (var j=0; j<self.items().length; j++) {
                    var $item = self.listContainer.find('.dews-item').eq(j);
                    if (value[i] === $item.find('.dews-text').text()) {
                        if (!$item.find('input[type="checkbox"]').prop('checked')) {
                            dews.ui.multidropdownlist.click._check.call(self, $item.find('.dews-checkbox-label'));
                        }
                    }
                }
            }
        } else if ($.type(value) === 'string' || $.type(value) === 'number') {
            for (var i=0; i<self.items().length; i++) {
                var $item = self.listContainer.find('.dews-item').eq(i);
                if (value === $item.find('.dews-text').text()) {
                    if (!$item.find('input[type="checkbox"]').prop('checked')) {
                        dews.ui.multidropdownlist.click._check.call(self, $item.find('.dews-checkbox-label'));
                    }
                }
            }
        }
    };

    MultiDropDownList.prototype.values = function (value) {
        var self = this,
            $item;

        if($.type(value) === 'undefined') { //선택된 아이템 반환
            var selectedItems = self.selectedItems(),
                selectedItemsValue = [];
            for (var i=0; i<selectedItems.length; i++) {
                selectedItemsValue.push(selectedItems.eq(i).closest('.dews-item').data('dews-value'));
            }
            return selectedItemsValue;
        } else if ($.type(value) === 'string' || $.type(value) === 'number') {
            for (var i=0; i<self.items().length; i++) {
                $item = self.listContainer.find('.dews-item').eq(i);
                if (value === $item.data('dews-value')) {
                    if (!$item.find('input[type="checkbox"]').prop('checked')) {
                        dews.ui.multidropdownlist.click._check.call(self, $item.find('.dews-checkbox-label'));
                    }
                }
            }
        } else if ($.isArray(value)) {
            for (var i=0; i<value.length; i++) {
                for (var j=0; j<self.items().length; j++) { //월,화,수,목,금
                    $item = self.listContainer.find('.dews-item').eq(j);

                    if (value[i] === $item.data('dews-value')) {
                        if (!$item.find('input[type="checkbox"]').prop('checked')) {
                            dews.ui.multidropdownlist.click._check.call(self, $item.find('.dews-checkbox-label'));
                        }
                    }
                }
            }
        }
    };

    /**
     * 바인딩 된 데이터중 해당 인덱스의 아이템 객체를 반환합니다.
     * @param index
     */
    MultiDropDownList.prototype.dataItem = function (index) {
        var self = this;
        return self.options.dataSource.data()[index];
    };

    /**
     * 멀티 드롭다운 리스트의 모든 아이템을 반환합니다.
     * @returns {Array}
     */
    MultiDropDownList.prototype.dataItems = function () {
        var self = this,
            items = [];

        for (var i =0; i<self.options.dataSource.data().length; i++) {
            items.push(self.options.dataSource.data()[i]);
        }

        return items;
    };

    /**
     * 체크된 항목의 데이터 아이템을 반환합니다.
     * @returns {Array} 체크된 항목의 데이터 객체 배열
     */
    MultiDropDownList.prototype.selectedDataItems = function () {
        var self = this,
            $items = self.listContainer.find('.dews-item'),
            $input = $items.find('input[type="checkbox"]'),
            checkedItemsIndex = [],
            checkedDataItems = [];

        for (var i =0; i<$input.length; i++) {
            if($input.eq(i).prop('checked')) {
                checkedItemsIndex.push(i);
            }
        }

        for (var i =0; i<checkedItemsIndex.length; i++) {
            checkedDataItems.push(self.options.dataSource.data()[checkedItemsIndex[i]]);
        }

        return checkedDataItems;
    };

    /**
     * 필수 입력 상태에서 멀티드롭다운 리스트에 선택된 항목이 존재하는지 여부를 검증합니다.
     * @returns {boolean}
     */
    MultiDropDownList.prototype.validate = function () {
        var self = this;
        return self.selectedItems().length > 0;
    };

    /**
     * 외부에서 바인딩 로직을 주입받기 위한 함수
     * @param logic 외부에서 주입 받는 로직
     */
    MultiDropDownList.prototype.setBindFormPanelLogic = function (logic) {
        var self = this;

        if ($.isFunction(logic)) {
            self.bindLogic = logic;
        }
    };

    /**
     * 패널 컨테이너로 부터 전달 된 JSON 데이터를 멀티드롭다운리스트로 바인딩 합니다.
     * @param data 패널로부터 전달 받은 데이터
     */
    MultiDropDownList.prototype.bindFromPanel = function (data) {
        var self = this;

        if ($.isFunction(self.bindLogic)) {
            self.bindLogic.call(self, data);
        }
    };


    /**
     * 외부에서 직렬화 로직을 주입 받기 위한 함수
     * @param logic 외부에서 주입 받는 로직
     */
    MultiDropDownList.prototype.setSerializeForPanelLogic = function (logic) {
        var self = this;

        if ($.isFunction(logic)) {
            self.serializeLogic = logic;
        }
    };

    /**
     * 패널로 데이터를 보내기 위해 컴포넌트 데이터를 JSON객체로 직렬화 합니다.
     * @return data 패널로 보낼 데이터
     */
    MultiDropDownList.prototype.serializeForPanel = function () {
        var self = this,
            data;

        if ($.isFunction(self.serializeLogic)) {
            data = self.serializeLogic.call(self);
        }

        return data;
    };

    /**
     * 패널 내에서 멀티 드롭다운 리스트가 포커스를 받을 수 있는지 상태값을 반환합니다.
     * @returns {boolean}
     */
    MultiDropDownList.prototype.canFocusable = function () {
        var self = this,
            $element = self.$element;

        return !$element.hasClass('readonly') && $element.is(':enabled') && $element.closest('.dews-dropdown').is(':visible');
    };

    /**
     * 패널 내에서 멀티드롭다운 리스트에 포커스가 들어았을 때, 다음 컴포넌트에 포커스를 줄 수 있는지 확인하는 함수
     */
    MultiDropDownList.prototype.applyPanelFocus = function () {
        var self = this, $element = self.$element;
        var $wrapper = self.wrapper;

        self.usePanelFocus = true;

        $wrapper.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    /**
     * DEWS 객체에 직접 이벤트 핸들러를 등록합니다.
     **/
    MultiDropDownList.prototype.on = function () {
        var self = this;

        if (arguments[0] === "change") {
            Array.prototype.splice.apply(arguments, [0, 1, '_change']);
        }
        self.$element.on.apply(self.$element, arguments);
    };

    $.extend(true, dews, {
        ui: {

            /**
             * 드롭다운리스트 dews 객체를 생성하거나 반환합니다.
             * @param selector
             * @param options
             */
            multidropdownlist: function (selector, options) {
                var $el,
                    mddl;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type(selector) === 'undefined') {
                    throw '대상이 지정되지 않았습니다';
                }

                $el.each(function () {
                    var multidropdownlist,
                        $this = $(this),
                        opt;

                    multidropdownlist = $this.data('dews-control');

                    if (!multidropdownlist) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass('dews-ui-multidropdownlist')) {
                            $this.addClass('dews-ui-multidropdownlist');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        multidropdownlist = new MultiDropDownList($this, opt);
                        $this.data('dews-control', multidropdownlist);
                    }

                    mddl = multidropdownlist;
                });

                return mddl;

            }
        }
    });

    dews.ui.multidropdownlist.click = {
        _check: function (target, e) {
            var $label = $(target),
                $item = $label.closest('.dews-item'),
                $checkbox = $label.parent(".dews-checkbox-wrapper").find('input[type="checkbox"]'),
                $selectAllcheckbox = $checkbox.closest('.dews-list-container').find('.dews-multidropdown-footer').find('input[type="checkbox"]'),
                footer = $checkbox.closest('.dews-multidropdown-footer'),
                listcheckbox = footer.siblings('.dews-list').find('input[type="checkbox"]'),
                self = $item.closest('.dews-animation-container').data('dews-control');

            if (e) {
                e.stopPropagation();
            }

            if (!$checkbox.prop('checked')) { //체크
                $checkbox.prop('checked', true);
                if ($checkbox.closest(".dews-list").find('input[type="checkbox"]').filter(':checked').length === $checkbox.closest(".dews-list").find('input[type="checkbox"]').length) {
                    $checkbox.closest('.dews-list-container').find('.dews-multidropdown-footer').addClass('selectedAll');
                    $selectAllcheckbox.prop('checked', true);
                }

                if ($checkbox.closest('.dews-multidropdown-footer').length === 0) { //선택 이벤트
                    self._triggerSelectEvent();
                }

            } else { //해제
                $checkbox.prop('checked', false);
                if ($checkbox.closest(".dews-list").find('input[type="checkbox"]').filter(':checked').length !== $checkbox.closest(".dews-list").find('input[type="checkbox"]').length) {
                    $selectAllcheckbox.prop('checked', false);
                    $checkbox.closest('.dews-list-container').find('.dews-multidropdown-footer').removeClass('selectedAll');
                }
                $item.removeClass('dews-state-selected');
            }

            if ($checkbox.closest('.dews-select-deselect').length !== 0) { //전체선택
                self = $label.parents('.dews-animation-container').data('dews-control');

                if ($checkbox.filter(':checked').length !== 0) {
                    listcheckbox.prop('checked', true);
                    if (!footer.hasClass('selectedAll')) {
                        footer.addClass('selectedAll');
                    }
                } else { //전체해제
                    listcheckbox.prop('checked', false);
                    if (footer.hasClass('selectedAll')) {
                        footer.removeClass('selectedAll');
                    }
                }
            }

            self.$element.trigger('_change');
            self._setText();
        }
    };

    dews.ui.addControlInitializer('multidropdownlist', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.multidropdownlist($("select.dews-ui-multidropdownlist", $container))
    });

})(jQuery, window.dews || {});



/**
 * 멀티파일 컴포넌트
 */
(function ($, dews) {
    /**
     * @typedef {Object} MultiFileOptions 멀티 파일 컴포넌트 옵션
     * @property {UploadOptions} [upload] 업로드 설정
     * @property {DownloadOptions} [download] 다운로드 설정
     * @property {TokenOptions} [token] 임시 인증토큰 설정
     * @property {BindingOptions} [binding] 바인딩 정보
     * @property {[string]} [filters] 확장자 기반의 파일 필터
     */

    /**
     * 기본 옵션
     * @type {MultiFileOptions}
     */
    var defaultOptions = {
        upload: {
            use: true,
            url: '/upload/file',
            button: {
                disabled: false,
                visible: true
            }
        },
        download: {
            use: true,
            url: '/download/file',
            tempUrl: '/download/tempfile',
            param: 'key',
            button: {
                disabled: false,
                visible: true
            }
        },
        deleted: {
            button: {
                disabled: false,
                visible: true
            }
        },
        token: {
            use: true,
            url: '/auth/temporary/token',
            param: 'token'
        }
    };

    /**
     * DOM 요소에 설정된 멀티 파일 컴포넌트 옵션을 수집하여 가져옵니다.
     * @param {Element} el 옵션이 포함된 DOM 요소
     * @return {MultiFileOptions}}
     */
    function getInlineOptions(el) {
        var $el = $(el);

        /**
         * @type {MultiFileOptions}
         */
        var options = {};

        // 업로드 가능 사용 여부
        if ($.type($el.data('dews-upload-use')) === 'boolean') {
            options.upload = options.upload || {};
            options.upload.use = $el.data('dews-upload-use');
        }

        // 업로드 API URL
        var uploadUrl = $el.data('dews-upload-url');
        if ($.trim(uploadUrl)) {
            options.upload = options.upload || {};
            options.upload.url = uploadUrl;
        }

        // 다운로드 가능 사용 여부
        if ($.type($el.data('dews-download-use')) === 'boolean') {
            options.download = options.download || {};
            options.download.use = $el.data('dews-download-use');
        }

        // 다운로드 API URL
        var downloadUrl = $el.data('dews-download-url');
        if ($.trim(downloadUrl)) {
            options.download = options.download || {};
            options.download.url = downloadUrl;
        }

        // 임시파일 다운로드 API URL
        var downloadTempUrl = $el.data('dews-download-temp-url');
        if ($.trim(downloadTempUrl)) {
            options.download = options.download || {};
            options.download.tempUrl = downloadTempUrl;
        }

        // 다운로드 API URL에 파일 키를 전달할 파라미터 이름
        var downloadParam = $el.data('dews-download-param');
        if ($.trim(downloadParam)) {
            options.download = options.download || {};
            options.download.param = downloadParam;
        }

        var downloadZipname = $el.data('dews-download-zipname');
        if ($.trim(downloadZipname)) {
            options.download = options.download || {};
            options.download.zipname = downloadZipname;
        }

        // 토큰 사용 여부
        if ($.type($el.data('dews-token-use')) === 'boolean') {
            options.token = options.token || {};
            options.token.use = $el.data('dews-token-use');
        }

        // 임시 토큰 발급 API URL
        var tokenUrl = $el.data('dews-token-url');
        if ($.trim(tokenUrl)) {
            options.token = options.token || {};
            options.token.url = tokenUrl;
        }

        // 토큰을 전달하는 파라미터 이름
        var tokenParam = $el.data('dews-token-param');
        if ($.trim(tokenParam)) {
            options.token = options.token || {};
            options.token.param = tokenParam;
        }

        // 확장자 기반의 파일 필터
        var strFilters = $el.data('dews-filters');
        if ($.trim(strFilters)) {
            options.filters = $.map(strFilters.split(','), function (item) {
                return $.trim(item);
            });
        }

        // 전체 너비 설정
        var width = $el.data('dews-width');
        if ($.trim(width)) {
            options.multifileWidth = width;
        }

        // 보여지는 파일 개수 설정
        var fileCount = $el.data('dews-file-count');
        if ($.trim(fileCount)) {
            options.contentsHeight = fileCount;
        }

        // 바인딩 정보
        options.binding = options.binding || {};
        var bindFileKey = $el.data('dews-bind-file-key') || 'fileKey';
        if ($.trim(bindFileKey)) {
            options.binding.fileKey = $.trim(bindFileKey);
        }
        var bindFilename = $el.data('dews-bind-filename') || 'filename';
        if ($.trim(bindFileKey)) {
            options.binding.filename = $.trim(bindFilename);
        }
        var bindExtension = $el.data('dews-bind-extension') || 'extension';
        if ($.trim(bindExtension)) {
            options.binding.extension = $.trim(bindExtension);
        }
        var bindSize = $el.data('dews-bind-size') || 'size';
        if ($.trim(bindSize)) {
            options.binding.size = $.trim(bindSize);
        }
        var bindIsNew = $el.data('dews-bind-is-new') || 'isNewFile';
        if ($.trim(bindIsNew)) {
            options.binding.isNewFile = $.trim(bindIsNew);
        }
        var bindIsDelete = $el.data('dews-bind-is-delete') || 'isDeleteFile';
        if ($.trim(bindIsDelete)) {
            options.binding.isDeleteFile = $.trim(bindIsDelete);
        }

        return options;
    }

    /**
     * 멀티 파일 컴포넌트의 UI를 초기화합니다.
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     */
    function initialize(multifile) {
        // 멀티파일 헤더 생성
        var createHead = function () {
            var $head = $('<div class="dews-multifile-head"></div>');
            multifile.$element.append($head);
            multifile._$head = multifile.$element.children('.dews-multifile-head');
        };

        // 멀티파일 헤더의 체크박스 생성
        var createCheckBox = function () {
            var $checkbox = $('<span class="dews-checkbox-wrapper"><input type="checkbox" class="dews-ui-checkbox dews-form-control dews-control k-checkbox dews-control-activate"><label class="dews-checkbox-label k-checkbox-label" onclick="dews.ui.multifile.click.checkbox(this)"></label></span>');
            var $checkboxLabel = $('<label>' + dews.localize.get('전체선택', 'dews_전체선택') + '</label>');

            multifile._$head.append($checkbox);
            multifile._$head.append($checkboxLabel);
            multifile._$hcheckbox = multifile._$head.find('input[type="checkbox"]');
        };

        // 멀티파일 헤더의 버튼 생성
        var createButtons = function () {
            var $buttonContainer = $('<div class="dews-button-group"></div>'),
                uploadUse, downloadUse, deleteUse;
            multifile.$buttons = {
                $upload: $('<button type="button" class="dews-ui-button icon-fileup dews-control k-button dews-control-activate">' + dews.localize.get('업로드', 'dews_업로드') + '</button>'),
                $download: $('<button type="button" class="dews-ui-button icon-filedown dews-control k-button dews-control-activate">' + dews.localize.get('다운로드', 'dews_다운로드') + '</button>'),
                $delete: $('<button type="button" class="dews-ui-button primary icon-filedel dews-control k-button dews-control-activate">' + dews.localize.get('삭제', 'dews_삭제') + '</button>'),
                $uploadinput: $('<input type="file" multiple="multiple" style="display: none">')
            };
            if (multifile._options.upload.use) {
                $buttonContainer.append(multifile.$buttons.$upload);
            }
            if (multifile._options.download.use) {
                $buttonContainer.append(multifile.$buttons.$download);
            }
            if (multifile._options.upload.use) {
                $buttonContainer.append(multifile.$buttons.$delete);
            }
            multifile._$head.append($buttonContainer);

            if (!multifile._options.upload.button.visible) {
                multifile.$buttons.$upload.css('display', 'none');
            }
            if (!multifile._options.download.button.visible) {
                multifile.$buttons.$download.css('display', 'none');
            }
            if (!multifile._options.deleted.button.visible) {
                multifile.$buttons.$delete.css('display', 'none');
            }


            if (!multifile._options.upload.button.disabled && multifile._options.upload.use) {
                uploadUse = true;
            } else {
                uploadUse = false;
            }
            if (!multifile._options.download.button.disabled && multifile._options.download.use) {
                downloadUse = true;
            } else {
                downloadUse = false;
            }
            if (!multifile._options.deleted.button.disabled) {
                deleteUse = true;
            } else {
                deleteUse = false;
            }

            updateUploadable(multifile, uploadUse);
            updateDownloadable(multifile, downloadUse);
            deletedButtonable(multifile, deleteUse);
        };

        // 멀티파일 콘텐츠 생성
        var createContents = function () {
            var $contents = $('<div class="dews-multifile-contents"></div>');
            multifile.$element.append($contents);
            multifile._$contents = multifile.$element.children('.dews-multifile-contents');
            multifile._$contents.height(multifile._options.contentsHeight * 27 + 'px');
            multifile.$element.width(multifile._options.multifileWidth + '%');
        };

        // 멀티파일 콘텐츠의 내부 생성
        var createContentsData = function (data) {
            var dataSize, innerHtml, $item, binding = multifile._options.binding;
            if (multifile._$contents.find('ul').length === 0) {
                multifile._$contents.append('<ul></ul>');
            }
            dataSize = getSize(data[binding.size]);
            setDelimiter(dataSize);
            innerHtml = '<li>' +
                '<span class="dews-checkbox-wrapper"><input type="checkbox" class="dews-ui-checkbox dews-form-control dews-control k-checkbox dews-control-activate"><label class="dews-checkbox-label k-checkbox-label" onclick="dews.ui.multifile.click.checkbox(this)"></label></span>' +
                '<span class="span-wrapper">' +
                '<span class="icon-sprite ' + data[binding.extension] + '"></span>' +
                '<span class="span-filename">' + data[binding.filename] + '</span>' +
                '<span class="span-data-Size">' + ' (' + dataSize + ') ' + '</span>' +
                '</span>' + '<div class="btn-icon">';
            if (multifile._options.download.use && multifile._options.download.button.visible && !multifile._options.download.button.disabled) {
                innerHtml += '<button class="download"></button>';
            }
            if (multifile._options.deleted.button.visible && multifile._options.upload.use && !multifile._options.deleted.button.disabled) {
                innerHtml += '<button class="delete"></button>';
            }
            innerHtml += '</div>' + '</li>';

            $item = $(innerHtml);
            $item.data('data-uid', data.uid);
            multifile._$contents.find('ul').append($item);
            triggerLayoutChange(multifile, 'multifilename');
            return $item.index();
        };

        // 멀티파일 이벤트 등록
        var bindEvents = function () {
            // 컴포넌트의 레이아웃이 변경되었을 경우
            multifile.$element.on('_layoutChange', function (e) {
                e.preventDefault();
                var exists, existsChecked;
                if (multifile._$contents.find('li').length === 0) {
                    exists = false;
                    updateFileExists(multifile, exists);
                } else {
                    if (multifile._$contents.find(('.k-checkbox:checked')).length === 0) {
                        existsChecked = false;
                        if (!multifile._options.download.button.disabled && multifile._options.download.use) {
                            updateDownloadable(multifile, existsChecked);
                        }
                        if (!multifile._options.deleted.button.disabled) {
                            deletedButtonable(multifile, existsChecked);
                        }
                    } else {
                        existsChecked = true;
                        if (!multifile._options.download.button.disabled && multifile._options.download.use) {
                            updateDownloadable(multifile, existsChecked);
                        }
                        if (!multifile._options.deleted.button.disabled) {
                            deletedButtonable(multifile, existsChecked);
                        }
                    }
                }
            });

            // 업로드 버튼을 클릭하였을 경우
            multifile.$buttons.$upload.on('click', function (e) {
                e.preventDefault();
                if (multifile._options.upload.use) {
                    multifile.$buttons.$uploadinput.eq(0).val('');
                    multifile.$buttons.$uploadinput.click();
                }
            });

            // 다운로드 버튼을 클릭하였을 경우
            multifile.$buttons.$download.on('click', function (e) {
                e.preventDefault();

                var checkedIndex = getcheckedIndex(multifile);
                var checkedData = getcheckedData(multifile);

                downloadFiles(multifile, checkedIndex, checkedData);
            });

            // 삭제 버튼을 클릭하였을 경우
            multifile.$buttons.$delete.on('click', function (e) {
                e.preventDefault();
                dews.confirm('파일을 삭제 하시겟습니까?').yes(function () {
                    var index = getcheckedIndex(multifile);
                    deleteFile(multifile, index);
                });
            });

            // 업로드 대상 파일의 선택이 완료되었을 경우
            multifile.$buttons.$uploadinput.on('change', function (e) {
                if (multifile._options.upload.use && e.target.files.length) {
                    var blob = e.target.files, i = 0, data,
                        dataBinding = {}, binding = multifile._options.binding, index, preUploadParameter;

                    while (i < blob.length) {
                        multifile._options.blob = blob[i];

                        preUploadParameter = {
                            file: {
                                filename: blob[i].name,
                                extension: getExtension(blob[i].name, false)
                            }
                        };
                        var evt = $.Event('preUpload', preUploadParameter);
                        multifile.$element.trigger(evt);
                        if (evt.isDefaultPrevented()) {
                            i++;
                            continue;
                        }

                        dataBinding[binding.fileKey] = "";
                        dataBinding[binding.filename] = blob[i].name;
                        dataBinding[binding.extension] = getExtension(blob[i].name, false);
                        dataBinding[binding.size] = blob[i].size;
                        dataBinding[binding.isNewFile] = false;
                        dataBinding[binding.isDeleteFile] = false;
                        data = multifile._options.dataSource.add(dataBinding);
                        //data[binding.fileKey] = data.uid;
                        i++;
                    }
                }
            });

            // 드래그 파일 요소 지정
            multifile._$contents.on('dragover', function (e) {
                e.preventDefault();
            });

            // 업로드 파일 드랍하였을 경우
            multifile._$contents.on('drop', function (e) {
                e.preventDefault();
                var blob = e.originalEvent.dataTransfer.files, data, i = 0, filters = multifile._options.filters,
                    dotExtension, dataBinding = {}, binding = multifile._options.binding, index, preUploadParameter;

                if (multifile._options.upload.use && blob.length) {
                    while (i < blob.length) {
                        multifile._options.blob = blob[i];
                        preUploadParameter = {
                            file: {
                                filename: blob[i].name,
                                extension: getExtension(blob[i].name, false)
                            }
                        };
                        var evt = $.Event('preUpload', preUploadParameter);
                        multifile.$element.trigger(evt);
                        if (evt.isDefaultPrevented()) {
                            i++;
                            continue;
                        }

                        dataBinding[binding.fileKey] = "";
                        dataBinding[binding.filename] = blob[i].name;
                        dataBinding[binding.extension] = getExtension(blob[i].name, false);
                        dataBinding[binding.size] = blob[i].size;
                        dataBinding[binding.isNewFile] = false;
                        dataBinding[binding.isDeleteFile] = false;
                        // data[binding.fileKey] = data.uid;

                        dotExtension = '.' + dataBinding[binding.extension];

                        if (filters) {
                            for (var j = 0; j < filters.length; j++) {
                                if (filters[j] === dotExtension || compareExtension(blob, filters[j])) {
                                    data = multifile._options.dataSource.add(dataBinding);
                                }
                            }
                        } else {
                            data = multifile._options.dataSource.add(dataBinding);
                        }
                        i++;
                    }
                } else {
                    return;
                }

            });

            multifile._$contents.on('mouseenter', function (e) {
                var $text = $('<p class="dragtxt">파일을 직접 끌어다 놓으면 추가됩니다.</p>');
                if (multifile.$element.hasClass('empty')) {
                    multifile._$contents.append($text);
                }
            }).on('mouseleave', function () {
                if (multifile._$contents.find('.dragtxt')) {
                    multifile._$contents.find('.dragtxt').remove();
                }
            });

            // 콘텐츠 다운로드 이벤트
            multifile._$contents.on('click', '.download', function (e) {
                e.preventDefault();
                var index = $(e.target).closest('li').index();
                var data = getItemData(multifile, index);
                if (!multifile._$contents.find('li').eq(index).hasClass('uploading') && multifile._options.download.use) {
                    if (!multifile._options.download.button.disabled) {
                        downloadFiles(multifile, index, data);
                    } else {
                        dews.alert('다운로드 비활성화 상태입니다.', 'error');
                    }
                }
            });

            // 콘텐츠 삭제 이벤트
            multifile._$contents.on('click', '.delete', function (e) {
                e.preventDefault();
                var index = $(e.target).closest('li').index();
                if (!multifile._$contents.find('li').eq(index).hasClass('uploading') && !multifile._options.deleted.button.disabled) {
                    dews.confirm('파일을 삭제 하시겟습니까?').yes(function () {
                        deleteFile(multifile, index);
                    });
                } else {
                    dews.alert('삭제 비활성화 상태입니다.', 'error');
                }
            });

            // 헤더 라벨 클릭했을 경우 체크박스 이벤트
            multifile._$head.on('click', 'label', function (e) {
                $(e.target).prev().find('label').click();
            });

            // 콘텐츠 라벨 클릭했을 경우 체크박스 이벤트
            multifile._$contents.on('click', '.span-wrapper', function (e) {
                $(e.target).parent().prev().find('label').click();
            });

            // 데이터소스 추가 또는 삭제 발생할 경우 이벤트
            multifile._options.dataSource.bind('change', function (e) {
                // var data, index = [];
                var index, data, filters, dotExtension, blob,
                    binding = multifile._options.binding;
                //
                if (e.action === 'add') {
                    data = e.items;
                    data[0][binding.fileKey] = data[0].uid;
                    blob = multifile._options.blob;
                    multifile._options.blob = "";
                    if (blob) {
                        index = createContentsData(data[0]);
                        updateUploading(multifile, index, true);
                        multifile.uploading = true;

                        startUploading(multifile, data[0], blob, index);

                    } else {
                        createContentsData(data[0]);
                    }
                }
                if (e.action === 'remove') {
                    data = e.items;
                    var element = _getItemElement(multifile, data[0]);
                    var elementIndex = element.index();
                    multifile._$contents.find('li').eq(elementIndex).remove();
                }
            });
        };

        var createDataSource = function () {
            if (multifile._options.dataSource.transport.options.read.url) {
                multifile._options.dataSource.fetch().done(function () {
                    var data = multifile._options.dataSource.data();

                    updateFileExists(multifile, true);
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].isDeleteFile === true) {
                            continue;
                        }
                        createContentsData(data[i]);
                    }
                });
            } else {
                updateFileExists(multifile, false);
            }
        };


        if (!multifile.initialized) {
            // 멀티파일 헤더 부분 생성합니다.
            createHead();
            // 멀티파일 헤더 체크박스 생성합니다.
            createCheckBox();
            // 멀티파일 헤더 버튼들을 생성합니다.
            createButtons();
            // 멀티파일 생성합니다.
            createContents();
            // 멀티파일 확장자 필터를 설정합니다.
            attachExtensionFilters(multifile);
            // 기본 이벤트를 바인딩합니다.
            bindEvents();

            createDataSource();

            multifile.initialized = true;
        }
    }

    /**
     * 파일타입에서 타입 비교
     * @param {object} dragfile 업로드 파일
     * @param {Array} filter 필터 옵션의 제한 된 확장자
     * @returns {boolean} 타입 비교 여부
     */
    function compareExtension(dragfile, filter) {
        var typeParam = typeof filter === "string" ? filter.replace(/\s/g, "") : "image/*",
            file, regex;

        typeParam = typeParam
            .replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g, "\\$&")
            .replace(/,/g, "|")
            .replace(/\/\*/g, "/.*");

        if (dragfile) {
            regex = new RegExp(".?(" + typeParam + ")$", "i");
            file = dragfile[0];

            if (!file.type.match(regex)) {
                return false;
            }
        }
        return true;
    }

    /**
     * 멀티 파일 컴포넌트 콘텐츠에 파일 존재 유무 확인
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {boolean} exists 존재 유무
     */
    function updateFileExists(multifile, exists) {
        if (exists) {
            if (multifile.$element.hasClass('empty')) {
                multifile.$element.removeClass('empty');
            }
            if (multifile._$hcheckbox.hasClass('disabled')) {
                multifile._$hcheckbox.removeClass('disabled');
                multifile._$hcheckbox.removeAttr('disabled');
            }

            if (!multifile._options.download.button.disabled && multifile._options.download.use) {
                updateDownloadable(multifile, exists);
            }
            if (!multifile._options.deleted.button.disabled) {
                deletedButtonable(multifile, exists);
            }
        } else {
            if (!multifile.$element.hasClass('empty')) {
                multifile.$element.addClass('empty');
            }
            if (!multifile._$hcheckbox.hasClass('disabled')) {
                multifile._$hcheckbox.addClass('disabled');
                multifile._$hcheckbox.attr('disabled', true);
            }
            multifile._$hcheckbox.prop('checked', false);

            if (!multifile._options.download.button.disabled && multifile._options.download.use) {
                updateDownloadable(multifile, exists);
            }
            if (!multifile._options.deleted.button.disabled) {
                deletedButtonable(multifile, exists);
            }
        }
    }

    /**
     * 파일크기 단위를 지정
     * @param {number} size 파일에 bytes단위의 크기
     * @return {string} 파일크기 지정값
     */
    function getSize(size) {
        var sizeUnit = ['bytes', 'KB', 'MB', 'GB', 'TB', 'PB'];
        var e = Math.floor(Math.log(size) / Math.log(1024));
        return (size / Math.pow(1024, e)).toFixed((2)) + " " + sizeUnit[e];
    }

    /**
     * 세자리마다 쉼표 생성
     * @param {string} size 파일크기
     * @return {string} 쉼표 생성된 파일크기
     */
    function setDelimiter(size) {
        return String(size).replace(/\B(?=(?:\d{3})+(?!\d))/g, ",");
    }

    /**
     * 파일명에서 확장자명 추출
     * @param {string} filename 파일명
     * @param {boolean} addDot .추가/삭제
     * @returns {string} 확장자명
     */
    function getExtension(filename, addDot) {
        var fileLen = filename.length;
        var lastDot = filename.lastIndexOf('.');
        if (!addDot) {
            lastDot += 1;
        }
        var fileExt = filename.substring(lastDot, fileLen).toLowerCase();
        return fileExt;
    }

    /**
     * 멀티파일 확장자 필터를 설정합니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트 인스턴
     */
    function attachExtensionFilters(multifile) {
        var filter = '';
        if ($.isArray(multifile._options.filters) && multifile._options.filters.length > 0) {
            filter = multifile._options.filters.join(',');
        }
        if (filter) {
            multifile.$buttons.$uploadinput.attr('accept', filter);
        }
    }

    /**
     * 멀티 파일 컴포넌트의 업로드가 진행 중인지 여부에 대한 UI 처리를 수행합니다.
     * @param {MultiFileComponent} multifile 멀치 파일 컴포넌트의 인스턴스
     * @param {boolean} uploading 업로드 진행중인지 여부
     */
    function updateUploading(multifile, index, uploading) {
        var $uploadingElement = multifile._$contents.find('li').eq(index);
        var className = 'uploading';

        if (uploading) {
            if (!$uploadingElement.hasClass(className)) {
                $uploadingElement.addClass(className);
            }
        } else {
            $uploadingElement.removeClass(className);
        }
        triggerLayoutChange(multifile, 'multifilename');
    }

    /**
     * 멀티파일 컴포넌트의 업로드를 시작합니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트의 인스턴스
     * @param {object} data 업로드 할 데이터
     * @param {Blob} blob 첨부파일
     */
    function startUploading(multifile, data, blob, index) {
        // 파일 업로드 시작
        uploadFile(data, multifile, blob)
            .done(function (fileData) {
                updateUploading(multifile, index, false);
                updateFileExists(multifile, true);
            })
            .fail(function (type) {
                updateUploading(multifile, index, false);
                switch (type) {
                    case 'cancel':
                        break;
                    case 'error':
                        break;
                }
            })
            .always(function () {
                updateUploading(multifile, index, false);
                multifile.uploading = false;
            });
    }

    /**
     * 서버로 파일을 업로드합니다.
     * @param {object} data 업로드 할 데이터
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트의 인스턴스
     * @param {Blob} blob 첨부파일
     */
    function uploadFile(data, multifile, blob) {
        var $dfd = $.Deferred();
        var $contents = multifile._$contents;
        var $item = _getItemElement(multifile, data);

        // 업로드 프로그래스 요소 생성
        var createProgress = function () {
            var $progressBox = $('<div class="progress_box">' +
                '<div class="progress">' +
                '<span class="progress-bar"></span>' +
                '</div>' +
                '<button type="button" class="dews-multifile-button icon-close"></button>' +
                '</div>');
            $item.append($progressBox);
            multifile.$buttons.$progressDeleteButton = $item.find('.icon-close');
            multifile.$buttons.$progressDeleteButton.on('click', function (e) {
                var $evt = new $.Event('_uploadCancel');
                $item.trigger($evt);
                multifile._options.dataSource.remove(data);
                $item.remove();
            });
            if (!$item.hasClass('uploading')) {
                $item.addClass('uploading');
            }
        };

        // 업로드 프로그래스 요소 제거
        var removeProgress = function () {
            $item.find('.progress_box').remove();
            $item.removeClass('uploading');
        };

        // 업로드 프로그래스 값 변경
        var updateProgress = function (percent) {
            var $progress = $item.find('.progress-bar');
            $progress.css('width', percent + '%');
        };

        // 업로드 진행률 변경에 대한 핸들러
        var progressHandler = function (e) {
            var percentCompleted = Math.round((e.loaded / e.total) * 100);
            console.log('## 첨부파일 업로드 ##', e.loaded, e.total, percentCompleted);
            updateProgress(percentCompleted);
        };

        // 업로드 완료에 대한 핸들러
        var completeHandler = function (e) {
            removeProgress();
            clearCancelEvent();
            if (this.status === 200) {
                var resdata = JSON.parse(this.responseText);
                var binding = multifile._options.binding;
                if (resdata.success === 'true') {
                    resdata = resdata.data;
                    data[binding.fileKey] = resdata.newFilename;
                    data[binding.filename] = resdata.originalFilename;
                    data[binding.extension] = resdata.originalExtension;
                    data[binding.size] = parseInt(resdata.fileSize, 10);
                    data[binding.isNewFile] = true;
                    data[binding.isDeleteFile] = false;
                }
            }
            $dfd.resolve(data);
        };

        // 업로드 중 에러에 대한 핸들러
        var errorHandler = function (e) {
            removeProgress();
            clearCancelEvent();
            $dfd.reject('error');
        };

        // 업로드 중 취소에 대한 핸들러
        var cancelHandler = function (e) {
            removeProgress();
            clearCancelEvent();
            $dfd.reject('cancel');
        };

        // 업로드 취소에 이벤트에 등록된 핸들러를 제거
        var clearCancelEvent = function () {
            $item.off('_uploadCancel');
        };

        if (!data) return;

        var token = (dews.ui.page) ? JSON.parse(dews.ui.page.token).access_token : '';

        var formData = new FormData;
        formData.append('file', blob);
        formData.append('isText', 'false');
        formData.append(multifile._options.token.param, token);

        var xhr = new XMLHttpRequest();
        xhr.open('POST', multifile._options.upload.url, true);

        xhr.upload.addEventListener('progress', progressHandler);
        xhr.addEventListener('load', completeHandler);
        xhr.addEventListener('error', errorHandler);
        xhr.addEventListener('abort', cancelHandler);

        createProgress();

        $item.on('_uploadCancel', function () {
            if (xhr && xhr.readyState === 1 && $item.hasClass('uploading')) {
                xhr.abort();
                xhr = null;
            }
        });

        xhr.send(formData);

        return $dfd.promise();
    }

    /**
     * 서버에서 파일을 다운로드합니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트 인스턴스입니다.
     * @param {array|number} checkedIndex 체크 된 인덱스
     * @param {array} checkedData 체크 된 데이터
     */
    function downloadFiles(multifile, checkedIndex, checkedData) {
        var $frame;

        if ($.type(checkedIndex) === 'array') {
            for (var i = 0; i < checkedIndex.length; i++) {
                $frame = multifile._$contents.find('li').eq(checkedIndex[i]).find('.download-frame');
                if ($frame.length === 0) {
                    $frame = $('<iframe style="display: none; width: 0; height: 0;"></iframe>');
                    multifile._$contents.find('li').eq(checkedIndex[i]).append($frame);
                }
            }
        } else {
            $frame = multifile._$contents.find('li').eq(checkedIndex).find('.download-frame');
            if ($frame.length === 0) {
                $frame = $('<iframe style="display: none; width: 0; height: 0;"></iframe>');
                multifile._$contents.find('li').eq(checkedIndex).append($frame);
            }
        }

        var startDownload = function (url) {
            $frame.prop('src', url);
        };

        getDownloadUrl(multifile, checkedData).then(startDownload);
    }

    /**
     * 첨부파일 다운로드를 위한 임시 인증 토큰을 획득합니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트의 인스턴스
     * @return {$.Deferred} Promise 객체
     */
    function getTemporaryToken(multifile) {
        var $dfd = $.Deferred();
        var token = '';

        if (multifile._options.token && multifile._options.token.use) {
            dews.api.get(multifile._options.token.url, {})
                .done(function (tokenData) {
                    token = tokenData;
                })
                .always(function () {
                    $dfd.resolve(token);
                });
        } else {
            $dfd.resolve(token);
        }

        return $dfd;
    }


    /**
     * 멀티파일 컴포넌트에 설정된 파일의 다운로드가 가능한 URL을 가져옵니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트의 인스턴스
     * @param {array} checkedData 체크 된 데이터
     * @return {$.Deferred} Promise 객체
     */
    function getDownloadUrl(multifile, checkedData) {
        var $dfd = $.Deferred();

        var makeUrl = function (token) {
            var url;
            var binding = multifile._options.binding;
            var preDownloadParameter, evt;
            if (checkedData.length > 1) {
                url = '/download/files' + '?'
                    + 'keys=';
                for (var i = 0; i < checkedData.length; i++) {
                    preDownloadParameter = {
                        file: {
                            filename: checkedData[i][binding.filename],
                            extension: checkedData[i][binding.extension]
                        }
                    };
                    evt = $.Event('preDownload', preDownloadParameter);
                    multifile.$element.trigger(evt);
                    if (evt.isDefaultPrevented()) {
                        continue;
                    }

                    if (checkedData[i][binding.isNewFile]) {
                        url += encodeURIComponent(checkedData[i][binding.fileKey]) + ':' + encodeURIComponent(checkedData[i][binding.filename]);
                    } else {
                        url += encodeURIComponent(checkedData[i][binding.fileKey]);
                    }
                    if (i !== checkedData.length - 1) {
                        url += ',';
                    }
                }
                url += '&zipname=';
                url += multifile._options.download.zipname;
                if (token) {
                    url += '&' + multifile._options.token.param + '=' + encodeURIComponent(token);
                }
            } else {
                if (checkedData[0][binding.isNewFile]) {
                    preDownloadParameter = {
                        file: {
                            filename: checkedData[0][binding.filename],
                            extension: checkedData[0][binding.extension]
                        }
                    };
                    evt = $.Event('preDownload', preDownloadParameter);
                    multifile.$element.trigger(evt);
                    if (evt.isDefaultPrevented()) {
                        return;
                    }

                    url = multifile._options.download.tempUrl + '?' + multifile._options.download.param + '=' + encodeURIComponent(checkedData[0][binding.fileKey])
                        + '&filename=' + encodeURIComponent(checkedData[0][binding.filename]);
                    if (token) {
                        url += '&' + multifile._options.token.param + '=' + encodeURIComponent(token);
                    }
                } else {
                    preDownloadParameter = {
                        file: {
                            filename: checkedData[0][binding.filename],
                            extension: checkedData[0][binding.extension]
                        }
                    };
                    evt = $.Event('preDownload', preDownloadParameter);
                    multifile.$element.trigger(evt);
                    if (evt.isDefaultPrevented()) {
                        return;
                    }

                    url = multifile._options.download.url + '?' + multifile._options.download.param
                        + '=' + encodeURIComponent(checkedData[0][binding.fileKey]);
                    if (token) {
                        url += '&' + multifile._options.token.param + '=' + encodeURIComponent(token);
                    }
                }
            }
            return url;
        };

        getTemporaryToken(multifile)
            .done(function (token) {
                $dfd.resolve(makeUrl(token));
            });

        return $dfd;
    }

    /**
     * 멀티 파일 컴포넌트의 업로드 가능 여부 UI 처리를 수행합니다.
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트 인스턴스
     * @param {boolean} use 업로드 가능 여부
     */
    function updateUploadable(multifile, use) {
        var $head = multifile._$head;
        var $buttonUpload = multifile.$buttons.$upload;
        var className = 'uploadable';

        if (use) {
            if (!$head.hasClass(className)) {
                $head.addClass(className);
            }
            if ($buttonUpload.hasClass('disabled')) {
                $buttonUpload.removeClass('disabled');
                $buttonUpload.removeClass('k-state-disabled');
            }
            if ($buttonUpload.prop('disabled')) {
                $buttonUpload.prop('disabled', false);
            }
        } else {
            $head.removeClass(className);
            if (!$buttonUpload.hasClass('disabled')) {
                $buttonUpload.addClass('disabled');
                $buttonUpload.addClass('k-state-disabled');
            }
            if (!$buttonUpload.prop('disabled')) {
                $buttonUpload.prop('disabled', true);
            }
        }
    }

    /**
     * 멀티 파일 컴포넌트의 다운로드 가능 여부 UI 처리를 수행합니다.
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {boolean} use 다운로드 사용 여부
     */
    function updateDownloadable(multifile, use) {
        var $head = multifile._$head;
        var $buttonDownload = multifile.$buttons.$download;
        var className = 'downloadable';

        if (use) {
            if (!$head.hasClass(className)) {
                $head.addClass(className);
            }
            if ($buttonDownload.hasClass('disabled')) {
                $buttonDownload.removeClass('disabled');
                $buttonDownload.removeClass('k-state-disabled');
            }
            if ($buttonDownload.prop('disabled')) {
                $buttonDownload.prop('disabled', false);
            }
        } else {
            $head.removeClass(className);
            if (!$buttonDownload.hasClass('disabled')) {
                $buttonDownload.addClass('disabled');
                $buttonDownload.addClass('k-state-disabled');
            }
            if (!$buttonDownload.prop('disabled')) {
                $buttonDownload.prop('disabled', true);
            }
        }
    }

    function deletedButtonable(multifile, use) {
        var $head = multifile._$head;
        var $buttonDelete = multifile.$buttons.$delete;
        var className = 'deletedButtonable';

        if (use) {
            if (!$head.hasClass(className)) {
                $head.addClass(className);
            }
            if ($buttonDelete.hasClass('disabled')) {
                $buttonDelete.removeClass('disabled');
                $buttonDelete.removeClass('k-state-disabled');
            }
            if ($buttonDelete.prop('disabled')) {
                $buttonDelete.prop('disabled', false);
            }
        } else {
            $head.removeClass(className);
            if (!$buttonDelete.hasClass('disabled')) {
                $buttonDelete.addClass('disabled');
                $buttonDelete.addClass('k-state-disabled');
            }
            if (!$buttonDelete.prop('disabled')) {
                $buttonDelete.prop('disabled', true);
            }
        }
    }

    /**
     * 레이아웃 변경이 일어났다는 이벤트를 발생시킴
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {string} mode 변경된 레이아웃의 형식
     */
    function triggerLayoutChange(multifile, mode) {
        var $evt = new $.Event('_layoutChange');
        $evt.changeType = mode;
        if (multifile.$element) {
            multifile.$element.trigger($evt);
        } else {
            $(multifile).trigger($evt);
        }
    }

    /**
     * 멀티파일의 Data에 대한 li요소 가져오기
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {object} data 선택한 Data
     * @return {object}
     * @private
     */
    function _getItemElement(multifile, data) {
        var $li = multifile._$contents.find('li');
        var length = $li.length;
        var $item;
        for (var index = 0; index < length; index++) {
            if ($li.eq(index).data('data-uid') === data.uid) {
                $item = $li.eq(index);
                return $item;
                break;
            }
        }
    }

    /**
     * 멀티파일의 index값으로 data 정보 가져오기
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {array || number} index 원하는 정보의 li 인덱스
     * @return {array}
     */
    function getItemData(multifile, index) {
        var $li = multifile._$contents.find('li');
        var data = multifile._options.dataSource.data();
        var dataArray = [];
        var length = data.length;
        if ($.type(index) === 'array') {
            for (var q = 0; q < index.length; q++) {
                for (var j = 0; j < length; j++) {
                    if ($li.eq(index[q]).data('data-uid') === data[j].uid) {
                        dataArray.push(data[j]);
                        break;
                    }
                }
            }
            return dataArray;
        } else {
            for (var i = 0; i < length; i++) {
                if ($li.eq(index).data('data-uid') === data[i].uid) {
                    dataArray.push(data[i]);
                    return dataArray;
                    break;
                }
            }
        }
    }

    /**
     * 멀티파일의 체크 된 항목의 파일 Data 가져오기
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @return {Array}
     */
    function getcheckedData(multifile) {
        var data = [];

        multifile._$contents.find('.k-checkbox:checked').each(function (idx, value) {
            data.push(multifile._dataItem($(value).closest('li').index()));
        });

        return data;
    }

    /**
     * 멀티파일의 체크 된 항목의 파일 Index 가져오기
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @return {Array}
     */
    function getcheckedIndex(multifile) {
        var index = [];

        multifile._$contents.find('.k-checkbox:checked').each(function (idx, value) {
            index.push($(value).closest('li').index());
        });

        return index;
    }

    /**
     * 멀티파일의 파일 삭제
     * @param {MultiFileComponent} multifile 멀티 파일 컴포넌트의 인스턴스
     * @param {array || number} index li태그의 인덱스
     */
    function deleteFile(multifile, index) {
        var data;
        var binding = multifile._options.binding;
        var deleteIndex = [];
        var deleteParameter;

        data = getItemData(multifile, index);

        if (data) {
            if ($.type(index) === 'array') {
                deleteIndex = index;
            } else {
                deleteIndex.push(index);
            }
            for (var i = data.length - 1; i > -1; i--) {
                deleteParameter = {
                    file: {
                        filename: data[i][binding.filename],
                        extension: data[i][binding.extension]
                    }
                };
                var evt = $.Event('preDelete', deleteParameter);
                multifile.$element.trigger(evt);
                if (evt.isDefaultPrevented()) {
                    continue;
                }

                if (!multifile._$contents.find('li').eq(deleteIndex[i]).hasClass('uploading')) {
                    if (data[i][binding.isNewFile]) {
                        multifile._options.dataSource.remove(data[i]);
                    } else {
                        data[i][binding.isDeleteFile] = true;
                        multifile._$contents.find('li').eq(deleteIndex[i]).remove();
                    }
                }
            }
        }

        triggerLayoutChange(multifile, 'multifilename');
    }

    /**
     * 파일 확장자 필터를 비웁니다.
     * @param {MultiFileComponent} multifile 멀티파일 컴포넌트의 인스턴스
     */
    function clearExtensionFilters(multifile) {
        multifile.$buttons.$uploadinput.removeAttr('accept');
    }

    /**
     * 멀티 파일 컴포넌트의 생성자
     *
     * @class MultiFileComponent
     *
     * @property {boolean|undefined} initialized 컴포넌트가 초기화 되어 있는 상태인지 여부입니다.
     * @property {{$upload: jQuery, $download: jQuery, $delete: jQuery, $uploadinput: jQuery}} $buttons 멀티 파일 컴포넌트 버튼
     * @property {jQuery} _$head 헤더 요소의 jQuery 객체입니다.
     * @property {jQuery} _$hcheckbox 헤더 체크박스 요소의 jQuery 객체입니다.
     * @property {jQuery} _$contents 콘텐츠 요소의 jQuery 객체입니다.
     * @property {jQuery} _$spanwrapper 콘텐츠 요소의 jQuery 객체입니다.
     * @property {boolean} uploading 현재 업로드 중인지 여부를 가져옵니다.
     *
     * @param {Element} el 변환 대상 요소
     * @param {MultiFileOptions} opt 옵션
     * @constructor
     */
    function MultiFileComponent(el, opt) {
        var self = this;
        var options = $.extend(true, {}, defaultOptions, getInlineOptions(el), opt);

        self.element = el;
        self.$element = $(el);
        self._options = options; // 실제 사용되는 옵션
        self.options = options; // 초기화 시 할당된 옵션 정보

        initialize(self);
    }

    /**
     * 멀티파일 컴포넌트에 데이터소스를 새로 설정 합니다.
     * @param {object} dataSource 설정할 데이터소스
     */
    MultiFileComponent.prototype.setDataSource = function (dataSource) {
        var self = this;
        self.$element.children().remove();
        self._options.dataSource = dataSource;
        self.initialized = false;
        initialize(self);
    };

    /**
     * 멀티파일 컴포넌트에 지정한 파일 정보를 삭제합니다.
     * @param {array||number} index 삭제할 인덱스
     */
    MultiFileComponent.prototype.deleteMultiFile = function (index) {
        var self = this;
        deleteFile(self, index);
    };

    /**
     * 멀티파일 컴포넌트에 지정한 파일 정보를 가져옵니다.
     * @param {array||number} index 가져올 인덱스
     * @return {*}
     */
    MultiFileComponent.prototype.getMultiFile = function (index) {
        var self = this;
        return getItemData(self, index);
    };

    /**
     * 이벤트 핸들러를 등록합니다.
     */
    MultiFileComponent.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self.$element.on.apply(self.$element, arguments);
    };

    /**
     * 이벤트 핸들러를 제거합니다.
     */
    MultiFileComponent.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self.$element.off.apply(arguments);
    };

    /**
     * 원하는 행에대한 Data 값을 가져옵니다.
     * @param {number} row 원하는 row
     */
    MultiFileComponent.prototype._dataItem = function (row) {
        var self = this;
        var data = self._options.dataSource.data();

        if (self._options.dataSource && row > -1) {
            var $uid = self._$contents.find('li').eq(row).data('data-uid');
            for (var i = 0; i < data.length; i++) {
                if (data[i].uid === $uid) {
                    return data[i];
                    break;
                }
            }
        }
    };

    /**
     * 멀티파일 컴포넌트에 체크된 파일의 다운로드 주소를 가져옵니다.
     * @return {$.Deferred}
     */
    MultiFileComponent.prototype.getDownloadUrl = function () {
        var self = this;
        var checkedData = getcheckedData(self);
        return getDownloadUrl(self, checkedData);
    };

    /**
     * 업로드 파일 선택 파일 필터를 추가합니다.
     * @param (...string} extensions 필터로 설정할 확장자 입니다.
     */
    MultiFileComponent.prototype.addMultiFileFilters = function (extensions) {
        var self = this;
        var newFilters = Array.prototype.slice.call(arguments);
        if (!$.isArray(self._options.filters)) {
            self._options.filters = [];
        }

        if (newFilters.length > 0) {
            self._options.filters = self._options.filters.concat(newFilters);

            attachExtensionFilters(self);
        }
    };

    /**
     * 업로드 파일 선택 파일 필터에서 지정한 항목들을 제거합니다.
     * @param {...string} extensions 필터에서 제거할 확장자 입니다.
     */
    MultiFileComponent.prototype.removeMultiFileFilters = function (extensions) {
        var self = this;

        if (!$.isArray(self._options.filters)) {
            self._options.filters = [];
        }

        var removes = Array.prototype.slice.call(arguments);
        self._options.filters = self._options.filters.filter(function (item) {
            return removes.indexOf(item) < 0;
        });

        attachExtensionFilters(self);
    };

    /**
     * 설정된 업로드 파일 선택 파일 필터를 가져옵니다.
     * @return {string[]} 파일 필터 배열 객체
     */
    MultiFileComponent.prototype.getMultiFileFilters = function () {
        var self = this;
        return self._options.filters;
    };

    /**
     * 업로드 파일 선택 파일 필터를 초기화합니다.
     */
    MultiFileComponent.prototype.clearMultiFileFilters = function () {
        var self = this;
        self._options.filters = [];
        clearExtensionFilters(self);
    };

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            multifile: function (selector, options) {
                var $el, obj;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var multifile,
                        element = this;

                    if ($(element).data('dews-control')) {
                        multifile = $(element).data('dews-control');
                    } else {
                        if (!$(element).hasClass('dews-ui-multifile')) {
                            $(element).addClass('dews-ui-multifile');
                        }
                        if (!$(element).hasClass('dews-form-control')) {
                            $(element).addClass('dews-form-control');
                        }

                        multifile = new MultiFileComponent(element, options);
                        $(element).data("dews-control", multifile);
                    }

                    obj = multifile;
                });

                return obj;
            }
        }
    });

    dews.ui.multifile.click = {
        checkbox: function (target) {
            var $label = $(target),
                $checkbox = $label.parent('.dews-checkbox-wrapper').find('input[type="checkbox"]'),
                multifile = $checkbox.closest('.dews-ui-multifile'),
                header = multifile.find('.dews-multifile-head'),
                contents = multifile.find('.dews-multifile-contents');

            $checkbox.click();
            if ($checkbox.closest('.dews-multifile-head').length !== 0) {
                if ($checkbox.filter(':checked').length !== 0) {
                    contents.find('.k-checkbox').prop('checked', true);
                } else {
                    contents.find('.k-checkbox').prop('checked', false);
                }
            }
            if (header.find('.k-checkbox').length !== 0 && contents.find('.k-checkbox').length !== 0) {
                if (contents.find('.k-checkbox').filter(':checked').length === contents.find('.k-checkbox').length) {
                    header.find('.k-checkbox').prop('checked', true);
                } else {
                    header.find('.k-checkbox').prop('checked', false);
                }
            }
            triggerLayoutChange(multifile, 'multifilename');
        }
    };
})(jQuery, window.dews);


/**
 * 멀티파일 다이얼로그
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        visible: false,
        upload: {
            use: true,
            url: '/upload/file',
            button: {
                disabled: false,
                visible: true
            }
        },
        download: {
            use: true,
            url: '/download/file',
            tempUrl: '/download/tempfile',
            param: 'key',
            zipname: 'test',
            button: {
                disabled: false,
                visible: true
            }
        },
        deleted: {
            button: {
                disabled: false,
                visible: true
            }
        },
        token: {
            use: true,
            url: '/auth/temporary/token',
            param: 'token'
        },
        binding: {
            fileKey: 'fileKey',
            filename: 'filename',
            extension: 'extension',
            size: 'size'
        },
        content: '<div class="dews-ui-multifiledialog"></div>'
    };

    /**
     * 멀티파일 다이얼로그 창
     * @param {string} id 다이얼로그 아이디
     * @param {object} [options] 다이얼로그 생성 옵션 값
     * @param {boolean} [useMain] 다이얼로그를 메인 프레임에 생성할지 여부
     * @constructor
     */
    function multifileDialogWindow(id, options, useMain) {
        var self = this,
            modal = options.modal, data;
        //initDataSource = dews.ui.dataSource('BackUpDataSource', {});

        self.id = id;
        self.options = $.extend(true, {}, defaultOptions, options);
        self.initData = null; // 확인필요
        self.buttons = {
            ok: $('<button class="dews-ui-button confirm"></button>'),
            cancel: $('<button class="dews-ui-button confirm"></button>')
        };

        // for (var i = 0; i < self.options.dataSource.data().length; i++) {
        //     data.push(self.options.dataSource.at(i));
        // }

        if (!self.options.upload.use) {
            self.options.buttons = 'close';
        }

        if (self.options.size) {
            if ((self.options.size).toLowerCase() === 'small') {
                self.options.width = 660;
                self.options.height = 230;
            }
        } else {
            self.options.width = 660;
            self.options.height = 600;
        }

        if ((self.options.width) < 660) {
            console.log('멀티파일 width 에러');
            self.options.width = 660;
        }

        if ((self.options.height) < 230) {
            console.log('멀티파일 height 에러');
            self.options.height = 230;
        }

        data = self.options.dataSource.data().toJSON();

        self.options.initDataItem = data;

        self.dialog = dews.ui.dialog(id, self.options);

        self.options = $.extend(true, {}, self.options, self.dialog.options);

        self.multifileOptions = {
            dataSource: self.options.dataSource,
            download: self.options.download,
            upload: self.options.upload,
            deleted: self.options.deleted,
            token: self.options.token,
            binding: self.options.binding,
            filters: self.options.filters
        };


    }

    /**
     * 다이얼로그 창을 엽니다.
     */
    multifileDialogWindow.prototype.open = function () {
        var self = this;

        self.dialog.open(true);

        self._initEventListener();
    };

    /**
     * 다이얼로그 윈도우의 처리가 정상적으로 끝나 다이얼로그를 닫습니다.
     */
    multifileDialogWindow.prototype.ok = function () {
        var self = this;

        self.dialog.ok();
    };

    /**
     * 다이얼로그 창을 닫습니다.
     */
    multifileDialogWindow.prototype.close = function () {
        var self = this;

        self.dialog.close();
    };

    /**
     * 다이얼로그 윈도우의 처리를 취소하고 다이얼로그를 닫습니다.
     */
    multifileDialogWindow.prototype.cancel = function () {
        var self = this;

        self.dialog.cancel();
    };

    /**
     * 다이얼로그 윈도우의 사이즈를 조정합니다.
     * @param {number} width 너비
     * @param {number} height 높이
     * @param {boolean} center 가운데 여부(기본값: 중앙)
     */
    multifileDialogWindow.prototype.resize = function (width, height, center) {
        var self = this;

        self.dialog.resize(width, height, center);
    };

    /**
     * 다이얼로그의 제목을 설정하거나 가져옵니다.
     * @param {string} [title] 다이얼로그 제목
     * @returns {string} 다이얼로그 제목
     */
    multifileDialogWindow.prototype.title = function (title) {
        var self = this;

        title = self.dialog.title(title);

        return title;
    };

    /**
     * 멀티파일 다이얼로그에 데이터소스를 설정을 변경합니다.
     * @param {object} dataSource 설정할 데이터소스
     */
    multifileDialogWindow.prototype.setDataSource = function (dataSource) {
        var self = this;

        if (self.multifile) {
            self.multifile.setDataSource(dataSource);
        }
    };

    /**
     * 멀티파일 다이얼로그에 지정한 파일 정보를 삭제합니다.
     * @param {array||number} index 삭제할 위치 정보
     */
    multifileDialogWindow.prototype.deleteMultiFile = function (index) {
        var self = this;

        if (self.multifile) {
            self.multifile.deleteMultiFile(index);
        }
    };

    /**
     * 멀티파일 다이얼로그에 지정한 파일 정보를 가져옵니다.
     * @param {array||number} index 가져올 위치 정보
     * @return {*}
     */
    multifileDialogWindow.prototype.getMultiFile = function (index) {
        var self = this;

        if (self.multifile) {
            return self.multifile.getMultiFile(index);
        }
    };

    /**
     * 이벤트 핸들러를 등록합니다.
     */
    multifileDialogWindow.prototype.on = function () {
        var self = this;

        if (self.multifile) {
            self.multifile.on();
        }
    };

    /**
     * 이벤트 핸들러를 제거합니다.
     */
    multifileDialogWindow.prototype.off = function () {
        var self = this;

        if (self.multifile) {
            self.multifile.off();
        }
    };

    /**
     * 업로드 파일 선택 파일 필터를 추가합니다.
     * @param {...string} extensions 필터로 설정할 확장자 입니다.
     */
    multifileDialogWindow.prototype.addMultiFileFilters = function (extensions) {
        var self = this;

        if (self.multifile) {
            self.multifile.addMultiFileFilters(extensions);
        }
    };

    /**
     * 업로드 파일 선택 파일 필터를 제거합니다.
     * @param {...string} extensions 필터로 제거할 확장자 입니다.
     */
    multifileDialogWindow.prototype.removeMultiFileFilters = function (extensions) {
        var self = this;

        if (self.multifile) {
            self.multifile.removeMultiFileFilters(extensions);
        }
    };

    /**
     * 설정된 업로드 파일 선택 파일 필터를 가져옵니다.
     * @return {string[]} 파일 필터 배열 객체
     */
    multifileDialogWindow.prototype.getMultiFileFilters = function () {
        var self = this;

        if (self.multifile) {
            return self.multifile.getMultiFileFilters()
        }
    };

    /**
     * 업로드 파일 선택 파일 필터를 초기화합니다.
     */
    multifileDialogWindow.prototype.clearMultiFileFilters = function () {
        var self = this;

        if (self.multifile) {
            self.multifile.clearMultiFileFilters();
        }
    };

    /**
     * 다이얼로그 이벤트 바인딩
     * @private
     */
    multifileDialogWindow.prototype._initEventListener = function () {
        var self = this,
            kWin = self.dialog._kendoWindow,
            multifile;

        kWin.bind('activate', function () {
            var $mfile = self.dialog.$content.find('.dews-ui-multifiledialog');
            multifile = dews.ui.multifile($mfile, self.multifileOptions);
            self.multifile = multifile;

            $mfile.closest('.k-window').find('.k-button-icon').on('click', function () {
                self.options.dataSource.data(self.options.initDataItem);
            });
        });

        kWin.bind('close', function () {
            self.options.dataSource.unbind('change');
        });

        self.dialog.buttons.cancel.on('click', function () {
            self.options.dataSource.data(self.options.initDataItem);
        });

        self.dialog.buttons.ok.on('click', function () {
            console.log('ok click');
        });
    };

    /**
     * 다이얼로그가 출력된 메인 프레임 윈도우 객체를 찾아서 반환합니다.
     * @param {object} win 대상 윈도우 객체
     */
    function getMainFrameWindowObject(win) {
        if (win.dews && win.dews.isMainFrame()) {
            return win;
        } else if (win !== window.top) {
            return getMainFrameWindowObject(win.parent); // 메인 프레임이 아니고 부모 프레임이 존재하면 부모 프레임 검사
        } else {
            return win; // 어떤 프레임도 메인 프레임이 아닐 경우에는 현재 프레임 객체를 메인 프레임으로 반환
        }
    }

    function findMultiDialog(multifiledialogID, win) {
        var multifileDialog, $multifileDialog, rootWin;

        if (!win) {
            win = window;
        }

        $multifileDialog = win.$('#' + multifiledialogID + '.dews-ui-dialog');

        if ($multifileDialog.length > 0) {
            multifileDialog = $multifileDialog.eq(0).data('dews-control');
        } else {
            rootWin = getMainFrameWindowObject(win);

            if (rootWin !== win) {
                multifileDialog = findMultiDialog(multifiledialogID, rootWin);
            }
        }

        return multifileDialog;
    }

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 멀티파일 다이얼로그를 생성합니다.
             * @param {string} id 다이얼로그 아이디
             * @param {object} [options] 다이얼로그 생성 옵션 값
             * @param {boolean} [useMain] 다이얼로그를 메인 프레임에 생성할지 여부
             */
            multifiledialog: function (id, options, useMain) {
                var multifiledialog,                        // 멀티파일다이얼로그 객체
                    multifiledialogID,                      // 멀티파일다이얼로그 아이디
                    multifiledialogOptions = {},            // 멀팉파일다이얼로그 옵션 값
                    find = false;                           // 기존에 만들어진 다이얼로그를 찾아야 하는지 여부

                if (arguments[0] && $.type(arguments[0]) === 'string') {
                    multifiledialogID = arguments[0];
                } else {
                    throw '다이얼로그의 아이디가 지정되지 않았습니다.';
                }

                if (arguments.length === 1) {
                    find = true;
                }

                if (!find) {
                    // 멀티파일다이얼로그를 신규로 생성합니다.
                    if ($.isPlainObject(arguments[1])) {
                        multifiledialogOptions = options;
                    }

                    if ($.type(useMain) !== 'boolean') {
                        useMain = true;
                    }

                    multifiledialog = new multifileDialogWindow(multifiledialogID, multifiledialogOptions, useMain);
                }

                if (!multifiledialog) {
                    // 기존에 생성된 멀티파일 다이얼로그의 인스턴스를 찾아서 반환합니다.
                    multifiledialog = findMultiDialog(multifiledialogID);

                    if (!multifiledialog) {
                        throw '지정한 아이디의 다이얼로그를 찾을 수 없습니다.';
                    }
                }

                return multifiledialog;
            }
        }
    });
})(jQuery, window.dews, window.kendo);


/*
 * 숫자 텍스트박스
 */
(function ($, dews, kendo) {
    var defaultOption = {
        spinners: false,
        format: '#,##0.##',
        increaseValue: 1000,
        increaseType: 'multiple'
    };

    /**
     * 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} codeOptions 스크립트 코드에서 전송된 옵션
     */
    function getOptions($el, codeOptions) {
        var inlineOptions,
            preDefinedFormat,
            options;

        inlineOptions = getInlineOptions($el);
        codeOptions = codeOptions || {};
        preDefinedFormat = dews.getPreDefinedFormat($el);

        if (preDefinedFormat) {
            preDefinedFormat = {format: preDefinedFormat};
            options = $.extend(true, {}, defaultOption, inlineOptions, codeOptions, preDefinedFormat);
        } else if (preDefinedFormat !== false && inlineOptions) {
            options = $.extend(true, {}, defaultOption, inlineOptions, codeOptions);
        } else {
            options = $.extend(true, {}, defaultOption, codeOptions);
        }

        // format 문자열에 따라서 decimals 옵션 설정
        if (options.hasOwnProperty('format') && options.format && !options.hasOwnProperty('decimals')) {
            // format 은 지정했는데 decimals 옵션은 설정하지 않은 경우 자동으로 decimals 설정
            var decimals = 2;
            var abbrPattern = /[nN][0]?([1-9])$/; // N2, N02, n3, n03 등의 약어 포맷에 매칭

            var abbrMatches = abbrPattern.exec(options.format);
            if (!abbrMatches) {
                var fullPattern = /[.]([0#]+)$/; // #,##0.## 과 같은 포맷에 매칭
                var fullMatches = fullPattern.exec(options.format);
                decimals = fullMatches ? fullMatches[1].length : decimals;
            } else {
                decimals = parseInt(abbrMatches[1], 10);
            }
            options.decimals = decimals;
        }

        return options;
    }

    /**
     * HTML 코드 상에 선언되어 있는 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     */
    function getInlineOptions($el) {
        var options = {}, format, step;

        if ($el) {

            if ($el.data('dews-spinners')) {
                options.spinners = /true/i.test($el.data('dews-spinners'));
            }

            // 스피너가 표시되지 않을 때는 방향키를 이용한 증감 기능이 동작되지 않도록 step을 0으로 설정
            if (!options.spinners) {
                options.step = 0;
            }

            if ($el.data('dews-placeholder')) {
                options.placeholder = $el.data('dews-placeholder');
            }

            if (typeof $el.data('dews-min') !== 'undefined') {
                options.min = $el.data('dews-min');
            }

            if (typeof $el.data('dews-max') !== 'undefined') {
                options.max = $el.data('dews-max');
            }

            if ($el.data('dews-format')) {
                // 포맷 알리아스에서 검색
                format = dews.getFormatFromAlias($el.data('dews-format'));

                if (format) {
                    options.format = format;
                }
            }

            if (typeof $el.data('dews-step') !== 'undefined') {
                step = parseFloat($el.data('dews-step'));

                if (step >= 0) {
                    options.step = step;
                }
            }

            if (typeof $el.data('dews-select-on-focus') !== 'undefined') {
                options.selectOnFocus = /true/i.test($el.data('dews-select-on-focus'));
            }

            if (typeof $el.data('dews-decimals') !== 'undefined') {
                options.decimals = parseInt($el.data('dews-decimals'), 10);

                if (typeof  $el.data('dews-restrict-decimals') !== 'undefined') {
                    options.restrictDecimals =  $el.data('dews-restrict-decimals');
                }
            }

            if (typeof $el.data('dews-increase-value') !== 'undefined') {
                var increaseValue = parseFloat($el.data('dews-increase-value'));

                if (increaseValue >= 0) {
                    options.increaseValue = increaseValue;
                }
            }

            if (typeof $el.data('dews-increase-type') !== 'undefined') {
                options.increaseType = $el.data('dews-increase-type');
            }
        }

        return options;
    }

    /**
     * 컨트롤을 초기화 합니다.
     * @param {jQuery} $el 대상 DOM 요소의 jQuery 객체
     * @param {object} [options] 설정 값
     */
    function initControl($el, options) {
        var $wrapper, $state, $formatted;

        $wrapper = $el.closest('.k-numerictextbox');
        $state = $wrapper.find('.k-numeric-wrap');
        $formatted = $wrapper.find('.k-formatted-value');

        if ($el.attr('style')) {
            var matches;

            matches = $el.attr('style').match(/width:([^;]+);?/i);
            if (matches && matches.length > 0) {
                $wrapper.width($.trim(matches[1]));
            }
        }

        // 클래스 제거
        if ($wrapper.hasClass('dews-ui-numerictextbox')) {
            $wrapper.removeClass('dews-ui-numerictextbox');
        }
        if ($formatted.hasClass('dews-ui-numerictextbox')) {
            $formatted.removeClass('dews-ui-numerictextbox');
        }
        if ($wrapper.hasClass('dews-control-activate')) {
            $wrapper.removeClass('dews-control-activate');
        }
        if (!$wrapper.hasClass('dews-numerictextbox-wrapper')) {
            $wrapper.addClass('dews-numerictextbox-wrapper');
        }

        //
        // 추가 옵션처리
        //
        if (options && typeof(options.selectOnFocus) !== 'undefined' && options.selectOnFocus) {
            // 포커스 시 전체 선택되도록 설정
            $el.on('focus', function () {
                var $ctl = $(this);
                setTimeout(function () {
                    $ctl.select();
                }, 50);
            });
        }

        if (options.placeholder && $el.data('dews-placeholder-localize-key')) {
            $formatted.attr('placeholder', dews.localize.get(options.placeholder, $el.data('dews-placeholder-localize-key'), $el.data('dews-placeholder-localize-lang') || null));
        }

        // +키를 이용한 숫자 증가 기능
        $el.on("keydown", function (e) {
            if (e.keyCode === 187 || e.keyCode === 107) {
                var step = options.increaseValue, value;

                value = $el.val() ? parseFloat($el.val()) : 0;

                if (options.increaseType === 'plus') {
                    $el.val(value + step);
                } else {
                    $el.val(value * step);
                }
            }
        });

        $el.on('focus', function (e) {
            var self = this;

            if ($(self).hasClass('readonly')){
                $(e.target).val($(e.target).prev().attr('title'));
            }
        });

        //
        // 상태정보 추가
        //
        if ($wrapper.hasClass('disabled')) {
            $state.addClass('dews-state-disabled');
        }
        if ($wrapper.hasClass('readonly')) {
            $state.addClass('dews-state-readonly');
        }
        if ($wrapper.hasClass('required')) {
            $state.addClass('dews-state-required');
        }
        if ($wrapper.hasClass('etc1')) {
            $state.addClass('dews-state-etc1');
        }
        if ($wrapper.hasClass('etc2')) {
            $state.addClass('dews-state-etc2');
        }
        if ($wrapper.hasClass('etc3')) {
            $state.addClass('dews-state-etc3');
        }

        setUserGuideAPI($el);
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    /**
     * 값을 설정하거나 가져옵니다.
     * @param {function} value Kendo UI 의 value 함수
     */
    function getSetValue(value) {
        return function (val) {
            var self = this;

            if ($.type(arguments[1]) === 'undefined' && arguments[1] !== false) {
                self._blur();
            }

            return value.call(self, val);
        };
    }

    $.extend(true, dews, {
        ui: {
            /**
             * 숫자 텍스트 박스를 생성하거나 가져옵니다.
             * @param {String|jQuery} selector 셀렉터 또는 jQuery 객체
             * @param {Object} [options] 설정 값, 생략하면 생성된 숫자 텍스트 박스의 객체를 획득할 수 있습니다.
             */
            numerictextbox: function (selector, options) {
                var $el,
                    textbox;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control,
                        opt;

                    control = $this.data('dews-control');

                    if (!control) {
                        opt = getOptions($this, options);

                        if (!$this.hasClass("dews-ui-numerictextbox")) {
                            $this.addClass("dews-ui-numerictextbox");
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        dews.ui.util.ConvertClassAndProperty($this);

                        $this.kendoNumericTextBox(opt);

                        control = $this.data('kendoNumericTextBox');

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass("dews-control-activate");
                        }

                        initControl($this, opt);

                        $this.data('dews-control', control);
                    }

                    textbox = control;
                });

                return textbox;
            }
        }
    });

    // readonly 함수 재정의
    kendo.ui.NumericTextBox.fn.readonly = (function (readonly) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return self.element.prop('readonly');
            } else {
                state = self.wrapper.find('.k-numeric-wrap');

                if (value) {
                    if (!self.wrapper.hasClass('readonly')) {
                        self.wrapper.addClass('readonly');
                    }
                    if (!self.element.hasClass('readonly')) {
                        self.element.addClass('readonly');
                    }
                    if (!state.hasClass('dews-state-readonly')) {
                        state.addClass('dews-state-readonly');
                    }
                } else {
                    if (self.wrapper.hasClass('readonly')) {
                        self.wrapper.removeClass('readonly');
                    }
                    if (self.element.hasClass('readonly')) {
                        self.element.removeClass('readonly');
                    }
                    if (state.hasClass('dews-state-readonly')) {
                        state.removeClass('dews-state-readonly');
                    }
                }
            }

            readonly.call(self, value);
        };
    })(kendo.ui.NumericTextBox.fn.readonly);

    // enable 함수 재정의
    kendo.ui.NumericTextBox.fn.enable = (function (enable) {
        return function (value) {
            var self = this, state;

            if (typeof value === 'undefined') {
                return !self.element.prop('disabled');
            } else {
                state = self.wrapper.find('.k-numeric-wrap');

                if (value) {
                    if (self.wrapper.hasClass('disabled')) {
                        self.wrapper.removeClass('disabled');
                    }
                    if (self.element.hasClass('disabled')) {
                        self.element.removeClass('disabled');
                    }
                    if (state.hasClass('dews-state-disabled')) {
                        state.removeClass('dews-state-disabled');
                    }
                } else {
                    if (!self.wrapper.hasClass('disabled')) {
                        self.wrapper.addClass('disabled');
                    }
                    if (!self.element.hasClass('disabled')) {
                        self.element.addClass('disabled');
                    }
                    if (!state.hasClass('dews-state-disabled')) {
                        state.addClass('dews-state-disabled');
                    }
                }
            }

            enable.call(self, value);
        };
    })(kendo.ui.NumericTextBox.fn.enable);

    /**
     * 숫자 텍스트박스의 텍스트를 가져옵니다.
     * @returns {string} 숫자 텍스트박스의 설정된 텍스트
     */
    kendo.ui.NumericTextBox.fn.text = function () {
        var self = this;

        return self.wrapper.find('.k-formatted-value').val();
    };

    kendo.ui.NumericTextBox.fn.value = getSetValue(kendo.ui.NumericTextBox.fn.value);

    kendo.ui.NumericTextBox.fn.on = function () {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.on.apply($element, arguments);
        } else {
            self.bind.apply(self, arguments);
        }
    };

    kendo.ui.NumericTextBox.fn.off = function () {
        var self = this, $element = self.element;

        if (arguments[0] === 'nextFocus' || arguments[0] === 'beforeFocus') {
            $element.off.apply($element, arguments);
        } else {
            self.unbind.apply(self, arguments);
        }
    };

    kendo.ui.NumericTextBox.fn.validate = function () {
        var self = this;
        return !!self.text();
    };

    kendo.ui.NumericTextBox.fn.bindFromPanel = function (data) {
        var self = this, $element = self.element;
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.value(data[column]);
            }
        }
    };

    kendo.ui.NumericTextBox.fn.serializeForPanel = function () {
        var self = this, $element = self.element;
        var column, data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = self.value();
        }

        return data;
    };

    kendo.ui.NumericTextBox.fn.applyPanelFocus = function () {
        var self = this, $element = self.element;

        $element.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) { //tab키, enter키
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    // instance.focus = function () { } // 자체적으로 focus 를 가지고 있음

    kendo.ui.NumericTextBox.fn.canFocusable = function () {
        var self = this, $element = self.element;

        return !$element.hasClass('readonly') && $element.is(':enabled') && $element.closest('.k-numerictextbox').is(':visible');
    };

    /**
     * 숫자텍스트박스 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    kendo.ui.NumericTextBox.fn._getPrintData = function () {
        var self = this,
            $el = self.element,
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.value()
            }
        }

        return data;
    };

    dews.ui.addControlInitializer('numerictextbox', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.numerictextbox($("input[type='text'].dews-ui-numerictextbox", $container));
    });
})(jQuery, window.dews || {}, window.kendo);


/**
 * 원그리드
 **/
(function ($, dews) {
    var OneGrid = function (target) {
        var self = this;
        var panel = target;

        self._panel = panel;
        self._$editButton = null;
        self._$hideAreaUL = null;
        self._$resetButton = null;
        self._$saveButton = null;
        self._$cancelButton = null;
        self._$delButton = null;

        return self;
    };

    // 편집 모드로 진입 시, 추가되는 영역 생성
    function createHiddenItemContainer(cp) {
        var self = cp;
        var $clonePanel = self._$clone;
        var $hideAreaUL = $('<ul class="hide-area optional-area"></ul>');
        var $editArea = $('<div/>').addClass('item-edit-area');
        var $dragTxt = $('<p class="drag-txt empty"><span>' + dews.localize.get("위의 항목을 드래그해서 여기로 끌어놓으면 화면에서 보여지지 않습니다.", "dews_위의 항목을 드래그해서 여기로 끌어놓으면 화면에서 보여지지 않습니다.") + '</span></p>');
        var $buttonArea = $('<div class="button-area">');
        var $resetButton = $('<button type="button" class="dews-ui-button reset dews-control k-button dews-control-activate">' + dews.localize.get("초기화", "dews_초기화") + '</button>');
        var $saveButton = $('<button type="button" class="dews-ui-button save dews-control k-button dews-control-activate">' + dews.localize.get("저장", "dews_저장") + '</button>');
        var $cancelButton = $('<button  type="button" class="dews-ui-button cancel dews-control k-button dews-control-activate">' + dews.localize.get("취소", "dews_취소") + '</button>');

        self._$hideAreaUL = $hideAreaUL;
        self._$resetButton = $resetButton;
        self._$saveButton = $saveButton;
        self._$cancelButton = $cancelButton;

        self._$resetButton.on('click', function () {
            self.reset(dews.ui.page);
        });

        self._$saveButton.on('click', function () {
            self.save(dews.ui.page);
        });

        self._$cancelButton.on('click', function () {
            self.endEditMode();
        });

        $clonePanel.find('ul:last').after($editArea);
        $editArea.append($hideAreaUL);
        $hideAreaUL.after($dragTxt);
        $buttonArea.append($resetButton);
        $buttonArea.append($saveButton);
        $buttonArea.append($cancelButton);
        $editArea.after($buttonArea);
    }

    // 드롭 가능한 영역을 나타내는 li 생성
    function appendDropAreaLi(before, col) {
        var cols = 'col-' + col.toString();
        var dropAreaLi = '<li class="drop-area drag"></li>';
        var $dropAreaLi;

        $dropAreaLi = $(dropAreaLi);
        $dropAreaLi.addClass(cols);
        $(before).before($dropAreaLi);

        return $(dropAreaLi).index();
    }

    // li의 컬럼 갯수 가져옴
    function getColNum($item) {
        var cols, colsRegex = /col-(\d+)\s?/;
        var matches = colsRegex.exec($item.attr('class'));

        if ($.isArray(matches) && matches[1]) {
            cols = parseInt(matches[1], 10);

            return cols;
        } else {
            return 1;
        }
    }

    //transparency li 만들어서 붙여줌
    function appendTransparencyLi(panel) {
        $(panel).find('ul').each(function (index, ul) {
            var sum = 0;

            $(ul).find('li').not('.drag-move').not('.transparency').each(function (idx, item) {
                var colsRegex = /col-(\d+)\s?/;
                var emptyLITemplate = '<li class="dews-condition-panel-item-transparency transparency"></li>';
                var $item = $(item);
                var panelCols = $(panel).data('dews-control')._panel ? $(panel).data('dews-control')._panel.options.columns : $(panel).data('dews-control').options.columns;
                var matches = colsRegex.exec(item.className);

                if ($.isArray(matches) && matches[1]) {
                    var cols = parseInt(matches[1], 10);

                    for (var i = 0; i < cols - 1; i++) {
                        var $empty = $(emptyLITemplate);
                        $(item).after($empty);
                    }
                } else {
                    cols = 1;
                }

                var beforeSum = sum;
                sum = sum + cols;

                if (sum === panelCols) {
                    sum = 0;
                } else if (sum > panelCols) {
                    for (var j = 0; j < panelCols - beforeSum; j++) {
                        $empty = $(emptyLITemplate);
                        $item.before($empty);
                    }

                    sum = cols;
                }
            });
        });
    }

    // 드래그가 끝나고 css를 처음 상태로 설정
    function initCss(self) {
        self.css('top', '');
        self.css('left', '');
        self.css('zIndex', '');
    }

    function setEditModeButton($panel) {
        var requiredUlHeight = $panel.find('ul.required-area').innerHeight();
        var $editButton = $panel.find('.dews-condition-edit-button');

        $editButton.css('height', requiredUlHeight + 4);
    }

    // 원그리드를 사용 시, 편집 버튼 생성
    OneGrid.prototype._init = function () {
        var self = this;

        self._createEditButton(self._panel.$element);
    };

    // 편집 모드로 진입 시, 패널을 클론
    OneGrid.prototype._clonePanel = function (panel) {
        var self = this;
        var clonePanel = panel.clone();

        clonePanel.data('dews-control', self);

        panel.before(clonePanel);
        panel.css('display', 'none');

        return clonePanel;
    };

    // 패널에 편집 버튼 생성
    OneGrid.prototype._createEditButton = function ($panel) {
        var self = this;
        var $editButton = $('<button class="dews-condition-edit-button">Edit</button>');

        self._$editButton = $editButton;
        $panel.find('form.dews-condition-panel-form').prepend($editButton);
        self._$editButton.on('click', self, this.enterEditMode);
    };

    // 아이템에 삭제 버튼 생성
    OneGrid.prototype._createItemDelButton = function ($item) {
        var self = this;
        var $delButton = $('<button type = "button" class="drag-del">닫기</button>');
        self._$delButton = $delButton;

        $item.append($delButton);

        self._$delButton.on('click', function (e) {
            var $self = $(e.target).closest('li.drag');
            var $panel = self._$clone;

            $panel.find('.hide-area').append($self);
            $self.find('.drag-del').remove();

            if ($panel.find('.transparency')) {
                $panel.find('.transparency').remove();
            }
            appendTransparencyLi($panel);

            $panel.find('.drag-txt').css('display', 'none');
        });
    };

    // 편집 모드로 진입
    OneGrid.prototype.enterEditMode = function (e) {
        var self = e.data;
        var orgPanel = self._panel.$element;
        var panel = self._clonePanel(orgPanel);
        var $ul;

        panel.addClass('dews-condition-edit-mode');
        self._$clone = panel;
        createHiddenItemContainer(self);

        if (panel.find('.hidden').length > 0 ) {
            panel.find('.hidden').children().each(function (idx, item) {
                panel.find('.hide-area').append($(item));
                panel.find('.drag-txt').css('display', 'none');
            });
        }

        if (panel.find('.required-area, .optional-area').length > 0) {
            panel.find('.required-area, .optional-area').each(function (idx, ul) {
                $ul = $(ul);
                $ul.find('> li').not('.transparency').addClass('drag');

                $ul.find('> li').not('.transparency').each(function (index, li) {
                    if (!($(li).find('.required').length > 0) && !$ul.hasClass('hide-area')) { // 필수입력 아이템이 아니고, 숨겨진 아이템이 아닐 경우만 삭제 버튼 생성
                        self._createItemDelButton($(li));
                    }
                });
            });
        }

        if (panel.find('.transparency')) {
            panel.find('.transparency').remove();
        }

        appendTransparencyLi(panel);

        // 드래그 시작
        $('.drag').on('mousedown', function (e) {
            var $self = $(e.target).closest('li');
            var liTop = $self.offset().top;
            var liLeft = $self.offset().left;

            self.startY = e.clientY - liTop;
            self.startX = e.clientX - liLeft;

            $(document.body).on('mousemove', $self, doDrag);
            $(document.body).on('mouseup', $self, stopDrag);

            e.preventDefault();
            e.stopPropagation();
        });

        // 드래그 중
        function doDrag(e) {
            if (e.which === 1 && (e.clientX !== self.startX || e.clientY !== self.startY)) {
                var $self = e.data;
                var panel, panelTop, panelLeft;
                var findTarget = [], $findTarget, beforeNode;
                var hideAreaFlag = false, optionalAreaFlag = false;
                var requiredUlTop, optionalUlTop, ulTop = 0;
                var beforeNodeLeft, beforeNodeTop, beforeNodeWidth, beforeNodeHeight;
                var beforeAfter, dropAreaLi;

                panel = $self.closest('*[class^=dews-ui-]').data('dews-control')._$clone;
                panelTop = $(panel).offset().top;
                panelLeft = $(panel).offset().left;

                if ($self.parent().hasClass('hide-area')) {
                    requiredUlTop = $(panel).find('.required-area').height();
                    optionalUlTop = $(panel).find('.optional-area').height();
                    ulTop = requiredUlTop + optionalUlTop + ($self.height() / 2);
                } else if ($self.parent().hasClass('optional-area')) {
                    requiredUlTop = $(panel).find('.required-area').height();
                    ulTop = requiredUlTop + ($self.height() / 2);
                }

                $self.css("position", 'absolute');
                $self.css("top", e.clientY - self.startY - panelTop - ulTop + 'px');
                $self.css("left", e.clientX - self.startX - panelLeft + 'px');
                $self.css("z-index", 50);
                $self.addClass('drag-move');
                $self.removeClass('drag');

                $self.parent('ul').append($self);

                if ($(panel).find('.drop-area').length < 1) {
                    appendDropAreaLi($self, getColNum($self), e);
                }

                if ((navigator.appName === 'Netscape' && navigator.userAgent.toLowerCase().indexOf('trident') !== -1)
                    || (navigator.userAgent.toLowerCase().indexOf('msie') !== -1)) {
                    var nodeList = document.msElementsFromPoint(e.clientX, e.clientY);
                    findTarget = Array.prototype.slice.call(nodeList);
                } else {
                    findTarget = document.elementsFromPoint(e.clientX, e.clientY);
                }

                for (var i = 0; i < findTarget.length; i++) {
                    $findTarget = $(findTarget[i]);

                    if ($(panel).has($findTarget).length > 0) {
                        if (($findTarget.not('.transparency') && $findTarget.prop('tagName') === 'LI')) {
                            beforeNode = findTarget[i];
                        } else if ($findTarget.closest('.hide-area').length > 0) {
                            hideAreaFlag = true;
                            beforeNode = findTarget[i];
                            $(beforeNode).next('p.drag-txt').css('display', 'none');
                        } else if ($(panel).find('.optional-area').not('.hide-area').children().length < 1 && $findTarget.prop('tagName') === 'UL') {
                            optionalAreaFlag = true;
                        }

                        if ($(beforeNode).length > 0) {
                            beforeNodeLeft = $(beforeNode).offset().left;
                            beforeNodeTop = $(beforeNode).offset().top;
                            beforeNodeWidth = $(beforeNode).width();
                            beforeNodeHeight = $(beforeNode).height();
                        }
                    }
                }

                if ($(beforeNode).hasClass('drag')) {
                    if ($self.find('.required').length > 0 && ($(beforeNode).parent().hasClass('optional-area') || $(beforeNode).parent().hasClass('hide-area'))) { // 필수입력 컨트롤은 옵션영역이나, 숨김영역으로 이동 불가

                    } else {
                        if ($self.get(0) !== beforeNode && (beforeNodeLeft + beforeNodeWidth / 2 > e.clientX || beforeNodeTop + beforeNodeHeight / 2 > e.clientY)) {
                            beforeAfter = 'before';
                        } else if ($self.get(0) !== beforeNode && (beforeNodeLeft + beforeNodeWidth / 2 < e.clientX || beforeNodeTop + beforeNodeHeight / 2 < e.clientY)) {
                            beforeAfter = 'after';
                        }

                        if ($self.parent().hasClass('hide-area') || !$(beforeNode).parent().hasClass('hide-area')) {
                            $(panel).find('.drag-txt').css('display', 'none');
                        }

                        if ($(panel).find('.drop-area').length > 0) {
                            dropAreaLi = $(panel).find('.drop-area');

                            if (beforeAfter === 'before') {
                                $(beforeNode).before(dropAreaLi);
                            } else if (beforeAfter === 'after') {
                                $(beforeNode).after(dropAreaLi);
                            }
                        } else if ($(panel).find('.drop-area').length < 1) {
                            appendDropAreaLi(beforeNode, getColNum($self), e);
                        }
                    }
                } else if (optionalAreaFlag) { // 빈 옵션영역으로 옮길때
                    if ($self.find('.required').length > 0) {

                    } else if ($(panel).find('.drop-area').length > 0) {
                        dropAreaLi = $(panel).find('.drop-area');
                        $(panel).find('.optional-area').not('.hide-area').append(dropAreaLi);
                    } else {
                        appendDropAreaLi(beforeNode, getColNum($self), e);
                    }

                    optionalAreaFlag = false;
                } else if (hideAreaFlag && ($self.find('.required').length < 1)) { // 숨긴 아이템 영역으로 옮길때
                    panel.find('.hide-area').append(panel.find('.drop-area'));

                    $(beforeNode).next('p.drag-txt').removeClass('empty');
                    $(beforeNode).next('p.drag-txt').css('display', 'inline-block');
                }

                if ($(panel).find('.transparency')) {
                    $(panel).find('.transparency').remove();
                }

                appendTransparencyLi(panel);
            }

            e.stopPropagation();
        }

        // 드래그 종료
        function stopDrag(e) {
            var self = e.data.closest('*[class^=dews-ui-]').data('dews-control');
            var $self = $(e.data).closest('li');
            var $clonePanel = self._$clone;

            $self.css('position', '');
            $self.removeClass('drag-move');
            $self.addClass('drag');

            if ($clonePanel.find('.drop-area') && $clonePanel.find('.drop-area').length > 0) {
                $clonePanel.find('.drop-area').before($self);
                $clonePanel.find('.drop-area').remove();
            }

            $clonePanel.find('.required-area, .optional-area').find('.drag').not('.transparency').each(function (index, li) {
                var $li = $(li);

                if (!($li.find('.required').length > 0) && ($li.find('.drag-del').length < 1)) { // 필수입력 아이템이 아닐 경우만..
                    self._createItemDelButton($li);
                }
            });

            if ($clonePanel.find('.hide-area').children().length > 0) {
                $clonePanel.find('.drag-txt').css('display', 'none');
                $clonePanel.find('.hide-area').find('.drag-del').remove();
            } else {
                $clonePanel.find('.drag-txt').addClass('empty');
                $clonePanel.find('.drag-txt').css('display', 'inline-block');
            }

            if ($clonePanel.find('.transparency')) {
                $clonePanel.find('.transparency').remove();
            }

            appendTransparencyLi($clonePanel);

            initCss($self);

            // mousemove, mouseup 이벤트 제거
            $(document.body).off('mousemove', doDrag);
            $(document.body).off('mouseup', stopDrag);

            e.stopPropagation();
        }
    };

    // 편집 모드 종료
    OneGrid.prototype.endEditMode = function () {
        var self = this;
        var $clonePanel = self._$clone;
        var $orgPanel = self._panel.$element;
        var orgData = self.orgData; // load 했을 때의 데이터
        var conId, $li;

        if (orgData) {
            orgData.items.sort(function (a, b) {
                return (a.groupIndex > b.groupIndex);
            });

            for (var i = 0; i < orgData.items.length; i++) {
                conId = orgData.items[i].itemId;
                $li = $orgPanel.find('#' + conId).parents('li');

                if (orgData.panelType.toUpperCase() === 'CONDITION') {
                    $orgPanel.find('.' + orgData.items[i].groupType.toLowerCase() + '-area').eq(orgData.items[i].groupIndex).append($li);
                }

                $li.removeClass('drag');
            }

            if ($orgPanel.find('.transparency')) {
                $orgPanel.find('.transparency').remove();
            }

            appendTransparencyLi($orgPanel);

            $('.drag').off('mousedown');
            $clonePanel.remove();
            $orgPanel.css('display', '');

            showHideExpandButton($orgPanel);
        }
    };


    // 현재 보이는 item을 모두 반환
    OneGrid.prototype.getVisibleItems = function () {

    };

    // 현재 숨겨져있는 item을 모두 반환
    OneGrid.prototype.getHiddenItems = function () {

    };

    //저장하기 전 상태로 되돌림
    OneGrid.prototype.reset = function (panel, data) {
        var $panel = panel._$clone;
        var conId, li;

        if (data) {
            data.items.sort(function (a, b) {
                return (a.index > b.index);
            });

            for (var i = 0; i < data.items.length; i++) {
                conId = data.items[i].itemId;
                li = $panel.find('#' + conId).parents('li');

                if (data.panelType.toUpperCase() === 'CONDITION') {
                    $panel.find('.' + data.items[i].groupType.toLowerCase() + '-area').eq(data.items[i].groupIndex).append(li);
                }
            }

            if ($panel.find('.hidden').length > 0 ) {
                $panel.find('.hidden').children().each(function (idx, item) {
                    $panel.find('.hide-area').append($(item));
                    $(item).addClass('drag');
                    $panel.find('.drag-txt > span').css('display', 'none');
                });
            }

            if ($panel.find('.transparency')) {
                $panel.find('.transparency').remove();
            }

            appendTransparencyLi($panel);
        } else {
            var event = new $.Event('onegridReset');
            dews.ui.page.$content.trigger(event);
        }
    };

    //변경된 내용을 저장
    OneGrid.prototype.save = function (page) {
        var self = this,
            $clonePanel = self._$clone,
            obj = {
                "moduleId": page.menu.module,
                "menuId": page.menu.id,
                "panelId": "",
                "panelType": "CONDITION",
                "items": []
            };

        $clonePanel.find('.required-area, .optional-area').each(function (idx, ul) {
            var $ul = $(ul);

            $ul.find('> li.drag').not('.transparency').each(function (index, li) {
                var controlsData = {};

                controlsData.itemId = $(li).find('*[class^=dews-ui-].dews-form-control').attr('id');

                if ($ul.hasClass('required-area')) {
                    controlsData.groupType = 'REQUIRED';
                    controlsData.groupIndex = 0;
                } else if ($ul.hasClass('hide-area')){
                    controlsData.groupType = 'HIDDEN';
                    controlsData.groupIndex = 0;
                } else if ($ul.hasClass('optional-area')){
                    controlsData.groupType = 'OPTIONAL';
                    controlsData.groupIndex = idx - 1;
                }

                controlsData.index = index;
                obj.items.push(controlsData);
            });
        });

        var parameter = {
            'panelData': obj,
            'page': dews.ui.page
        };

        dews.confirm('저장하시겠습니까?').yes(function () {
            var panel;
            var $panel,$li;

            var event = new $.Event('onegridSave', parameter);
            page.$content.trigger(event);

            if (parameter.panelData.panelId) {
                $panel = page.$content.find('#' + parameter.panelData.panelId);
            } else {
                $panel = page.$content.find('.dews-ui-condition-panel').not('.dews-condition-edit-mode');
            }

            panel = $panel.data('dews-control');

            for (var i = 0; i < parameter.panelData.items.length; i++) {
                var conId = parameter.panelData.items[i].itemId;

                $li = $panel.find('#' + conId).parents('li');

                if (parameter.panelData.panelType.toUpperCase() === 'CONDITION') {
                    if (parameter.panelData.items[i].groupType.toUpperCase() === 'HIDDEN') {
                        if (panel.$element.find('.hidden').length > 0 ) {
                            panel.$element.find('.hidden').append($li);
                        }
                    } else {
                        panel.$element.find('.' + parameter.panelData.items[i].groupType.toLowerCase() + '-area').eq(parameter.panelData.items[i].groupIndex).append($li);
                    }
                }
                $li.off('mousedown');
                $li.removeClass('drag');
            }

            if (panel.$element.find('.transparency')) {
                panel.$element.find('.transparency').remove();
            }

            appendTransparencyLi(panel.$element);

            panel.onegrid._$clone.remove();
            panel.$element.find('.drag-del').remove();
            panel.$element.css('display', '');

            showHideExpandButton(panel.$element);
        }).no(function () {

        });
    };

    // 컨디션패널의 버튼을 숨기거나 보여줌
    function showHideExpandButton($panel) {
        var flag = false;

        $panel.find('.optional-area').not('.hide-area').each(function(index, item) {
            if ($(item).children().length <= 0) {
                $(item).css('display', 'none');
            } else {
                flag = true;
            }
        });

        if (flag) {
            $panel.find('.dews-condition-panel-expand-button').css('display', '');
        } else {
            $panel.find('.dews-condition-panel-expand-button').css('display', 'none');
        }
    }

    // 저장된 내용을 불러옴
    OneGrid.prototype.load = function (panel, data) {
        var $panel = panel.$element;
        var conId, li, $hiddenItems = $('<div class="hidden"></div>');
        var hiddenContainer = [];

        data.items.sort(function (a, b) {
            return (a.index > b.index);
        });

        if ($panel.length > 0) {
            if (panel.$element.find('div.hidden').length <= 0) {
                panel.$element.find('form').after($hiddenItems);
            }

            for (var i = 0; i < data.items.length; i++) {
                conId = data.items[i].itemId;
                li = $panel.find('#' + conId).parents('li');

                if (data.panelType.toUpperCase() === 'CONDITION') {
                    if (data.items[i].groupType.toUpperCase() !== 'HIDDEN') {
                        $panel.find('.' + data.items[i].groupType.toLowerCase() + '-area').eq(data.items[i].groupIndex).append(li);
                    }
                }

                if (data.items[i].groupType.toUpperCase() === 'HIDDEN') {
                    var $li = $panel.find('#' + data.items[i].itemId).parents('li');
                    $li.addClass('drag');
                    panel.$element.find('div.hidden').append($li);
                    hiddenContainer.push($li);
                }
            }

            if (panel.$element.find('.hidden').length <= 0) {
                panel.$element.find('form').after($hiddenItems);
                panel.onegrid.hiddenItems = hiddenContainer;
            }

            $hiddenItems.css('display', 'none');

            if ($panel.find('.transparency')) {
                $panel.find('.transparency').remove();
            }
        }

        appendTransparencyLi(panel.$element);
        showHideExpandButton(panel.$element);
    };

    $.extend(true, dews, {
        ui : {
            Onegrid: function (element, conditionPanel) {
                var oneGrid = new OneGrid(conditionPanel);

                oneGrid._init();

                return oneGrid;
            }
        }
    });
})(jQuery, window.dews);




/*
 * 패널바
 */
(function ($, dews, kendo) {
    var defaultOption = {
        expandMode: 'single'
    };

    $.extend(true, dews, {
        ui: {
            panelbar: function (selector, options) {
                var $el,
                    panelbar;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control,
                        opt;

                    control = $this.data('dews-control');

                    if (!control) {
                        opt = $.extend(true, {}, defaultOption, options);

                        if (!$this.hasClass('dews-ui-panelbar')) {
                            $this.addClass('dews-ui-panelbar');
                        }

                        $this.kendoPanelBar(opt);
                        control = $this.data('kendoPanelBar');

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', control);
                    }

                    panelbar = control;
                });

                return panelbar;
            }
        }
    });

    dews.ui.addControlInitializer('panelbar', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.panelbar($('ul.dews-ui-panelbar', $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 기간피커
 */
(function ($, dews, kendo) {

    var defaultOptions = {
        buttons: true,
        startDate: null,
        endDate: null,
        format: dews._environments.formats.dateFormat,
        valueFormat: dews._environments.formats.dateValueFormat
    };

    var PeriodPicker = function (element, options) {
        var self = this,
            $element = $(element), buttons;
        var opt;

        if ($.type($element.data('dews-buttons')) !== 'boolean' || $element.data('dews-buttons') === true) {
            buttons = true;
        } else if ($element.data('dews-buttons') === false){
            buttons = $element.data('dews-buttons');
        }

        opt = $.extend({}, defaultOptions , {
            buttons: buttons && defaultOptions.buttons,
            startDate: $element.data('dews-start-date') || defaultOptions.startDate,
            endDate: $element.data('dews-end-date') || defaultOptions.endDate
        });

        if (options && options.format && !options.valueFormat) {
            options.valueFormat = options.format.replace(/[^(a-z)]/gi,"");
        }

        self.options = getOptions($element, opt, options);

        self.container = null;
        self.wrapper = null;
        self.startInput = null;
        self.endInput = null;
        self.button = null;
        self.calendars = null;
        self.periodcalendars = null;
        self.startCalendar = null;
        self.endCalendar = null;
        self.buttons = null;
        self.periodDate = null;
        self.okButton = null;
        self.option = null;
        self.todayButton = null;
        self.yesterdayButton = null;
        self.weekButton = null;
        self.lastWeekButton = null;
        self.monthButton = null;
        self.lastMonthButton = null;
        self.upToNowButton = null;
        self.oneQuearterButton = null;
        self.twoQuearterButton = null;
        self.threeQuearterButton = null;
        self.fourQuearterButton = null;
        self.firstHalfButton = null;
        self.secondHalfButton = null;
        self.disableButton = false;

        self._element = element;
    };

    PeriodPicker.prototype._createContainer = function () {
        var self = this,
            $el = $(self._element),
            $container,
            width;

        $container = $("<span/>").addClass("dews-periodpicker-container");

        if ($el.attr('style')) {
            var matches = $el.attr('style').match(/width:([^;]+);?/i);

            if (matches) {
                width = $.trim(matches[1]);
                $container.width(width);
            }
        }

        if ($el.attr("id") !== undefined) {
            $container.attr("id", $el.attr("id") + "_container");
        }

        $el.css("display","inline-block");

        $el.wrap($container);

        if (!$el.hasClass("dews-ui-periodpicker")) {
            $el.addClass("dews-ui-periodpicker");
        }

        if ($container.width() < 188) {
            $container.width(188);
        }

        self.container = $container;
    };

    PeriodPicker.prototype._createWrapper = function () {
        var self = this,
            $el = $(self._element),
            $wrapper;

        $wrapper = $("<span/>").addClass("dews-periodpicker-wrapper")
            .addClass("k-picker-wrap").addClass('k-state-default');

        if ($el.hasClass('readonly')) {
            $wrapper.addClass('dews-state-readonly');
            self.disableButton = true;
        }
        if ($el.hasClass('disabled')) {
            $wrapper.addClass('dews-state-disabled');
            self.disableButton = true;
        }
        if ($el.hasClass('required')) {
            $wrapper.addClass('dews-state-required');
        }
        if ($el.hasClass('etc1')) {
            $wrapper.addClass('dews-state-etc1');
        }
        if ($el.hasClass('etc2')) {
            $wrapper.addClass('dews-state-etc2');
        }
        if ($el.hasClass('etc3')) {
            $wrapper.addClass('dews-state-etc3');
        }

        self.wrapper = $wrapper;
        $el.append($wrapper);
    };

    PeriodPicker.prototype._createStartInput = function () {
        var self = this,
            $el = $(self._element),
            $startInput;

        $startInput = $("<input/>").addClass("dews-periodpicker-input dews-periodpicker-startDate k-textbox k-space-right");

        if ($el.attr("id") !== undefined) {
            $startInput.attr("id", $el.attr("id") + "_startinput");
        }

        if ($el.hasClass('readonly')) {
            $startInput.addClass('dews-state-readonly');
            $startInput.attr("readonly","readonly");
        }
        if ($el.hasClass('disabled')) {
            $startInput.addClass('dews-state-disabled');
            $startInput.attr("disabled","disabled");
        }
        if ($el.hasClass('required')) {
            $startInput.addClass('dews-state-required');
        }
        if ($el.hasClass('etc1')) {
            $startInput.addClass('dews-state-etc1');
        }
        if ($el.hasClass('etc2')) {
            $startInput.addClass('dews-state-etc2');
        }
        if ($el.hasClass('etc3')) {
            $startInput.addClass('dews-state-etc3');
        }

        setMask($startInput, self.options.format);
        setEvent($startInput, self.options);

        self.startInput = $startInput;
        self.wrapper.append($startInput);

    };

    PeriodPicker.prototype._createEndInput = function () {
        var self = this,
            $el = $(self._element),
            $endInput, $span, opt;

        $endInput = $("<input/>").addClass("dews-periodpicker-input dews-periodpicker-endDate k-textbox k-space-right");
        $span = $("<span>~</span>").addClass("dews-periodpicker-span");

        if ($el.attr("id") !== undefined) {
            $endInput.attr("id", $el.attr("id") + "_endinput");
        }

        if ($el.hasClass('readonly')) {
            $endInput.addClass('dews-state-readonly');
            $endInput.attr("readonly","readonly");
        }
        if ($el.hasClass('disabled')) {
            $endInput.addClass('dews-state-disabled');
            $endInput.attr("disabled","disabled");
        }
        if ($el.hasClass('required')) {
            $endInput.addClass('dews-state-required');
        }
        if ($el.hasClass('etc1')) {
            $endInput.addClass('dews-state-etc1');
        }
        if ($el.hasClass('etc2')) {
            $endInput.addClass('dews-state-etc2');
        }
        if ($el.hasClass('etc3')) {
            $endInput.addClass('dews-state-etc3');
        }

        setMask($endInput, self.options.format);
        setEvent($endInput, self.options);

        self.endInput = $endInput;
        self.wrapper.append($span);
        self.wrapper.append($endInput);

    };

    PeriodPicker.prototype.setPeriod = function (first, last) {
        var self = this;
        var calendar = self.startCalendar;
        var calendar2 = self.endCalendar;

        var firstday = first;
        var lastday = last;

        var startDate = kendo.parseDate(firstday, dews._environments.formats.dateValueFormat,  kendo.getCulture());
        var endDate = kendo.parseDate(lastday, dews._environments.formats.dateValueFormat,  kendo.getCulture());

        var textStartDate = kendo.toString(startDate, self.options.format, kendo.getCulture());
        var textEndDate = kendo.toString(endDate, self.options.format, kendo.getCulture());

        if (textStartDate > textEndDate) {
            self.startInput.val("");
            self.endInput.val("");
        } else {
            calendar.value(startDate);
            calendar2.value(endDate);

            self.startInput.val(textStartDate);
            self.endInput.val(textEndDate);

            self.periodDate.text(textStartDate+"~"+textEndDate);
        }
    };

    PeriodPicker.prototype.setWeek = function () {
        var self = this;

        var weeks = new Date();
        var firstday = new Date(weeks.setDate(weeks.getDate() - weeks.getDay()));
        var lastday = new Date(weeks.setDate(weeks.getDate() - weeks.getDay()+6));

        self.setPeriod(firstday, lastday);
    };

    PeriodPicker.prototype.setMonth = function () {
        var self = this;

        var today = new Date();
        var firstday = new Date(today.getFullYear(), today.getMonth(), 1);
        var lastday = new Date(today.getFullYear(), today.getMonth() + 1, 0);

        self.setPeriod(firstday, lastday);
    };

    PeriodPicker.prototype.setupToday = function () {
        var self = this;

        var today = new Date();
        var firstday = new Date(today.getFullYear(), today.getMonth(), 1);
        var lastday = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));

        self.setPeriod(firstday, lastday);
    };

    PeriodPicker.prototype.setEarlyYears = function () {
        var self = this;

        var today = new Date();
        var firstday = new Date(today.getFullYear(), 0, 1);
        var lastday = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));

        self.setPeriod(firstday, lastday);
    };

    PeriodPicker.prototype.setStartDate = function (value) {
        var self = this;
        if (!isNaN(value)) {
            var calendar = self.startCalendar,
                calendar2 = self.endCalendar,
                date, textDate;

            if ($.type(value) === 'date') {
                date = value;
            } else if (value){
                date = kendo.parseDate(value.toString(), dews._environments.formats.dateValueFormat, kendo.getCulture());
            }
            textDate = kendo.toString(date, self.options.format, kendo.getCulture());

            if ((self.endInput.val() && date > calendar2.value()) || !date) {
                self.startInput.val("");
            } else {
                calendar.value(date);
                self.startInput.val(textDate);

                if (self.endInput.val()) {
                    self.periodDate.text(textDate+"~"+self.endInput.val());
                }

                self.okButton.prop("disabled", false);
                self.okButton.removeClass('k-state-disabled');
            }
        } else {
            self.startInput.val('');
        }
    };

    PeriodPicker.prototype.setEndDate = function (value) {
        var self = this;
        if (!isNaN(value)) {
            var calendar = self.startCalendar,
                calendar2 = self.endCalendar,
                date, textDate;

            if ($.type(value) === 'date') {
                date = value;
            } else if (value) {
                date = kendo.parseDate(value.toString(), dews._environments.formats.dateValueFormat, kendo.getCulture());
            }
            textDate = kendo.toString(date, self.options.format, kendo.getCulture());

            if ((self.startInput.val() && calendar.value() > date) || !date) {
                self.endInput.val("");
            } else {
                calendar2.value(date);
                self.endInput.val(textDate);

                if (self.startInput.val()) {
                    self.periodDate.text(self.startInput.val() + "~" + textDate);
                }

                self.okButton.prop("disabled", false);
                self.okButton.removeClass('k-state-disabled');
            }
        } else {
            self.endInput.val('');
        }
    };

    PeriodPicker.prototype.getStartDate = function () {
        var self = this;

        if (self.startInput.val()) {
            var date = kendo.parseDate(self.startInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.dateValueFormat) || '';
        } else {
            return '';
        }
    };

    PeriodPicker.prototype.getStartText = function () {
        var self = this;

        if (self.startInput.val()) {
            var date = kendo.parseDate(self.startInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.dateFormat) || '';
        } else {
            return '';
        }
    };

    PeriodPicker.prototype.getEndDate = function () {
        var self = this;

        if (self.endInput.val()) {
            var date = kendo.parseDate(self.endInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.dateValueFormat) || '';
        } else {
            return '';
        }
    };

    PeriodPicker.prototype.getEndText = function () {
        var self = this;

        if (self.endInput.val()) {
            var date = kendo.parseDate(self.endInput.val(), self.options.format, kendo.getCulture());
            return kendo.toString(date, dews._environments.formats.dateFormat) || '';
        } else {
            return '';
        }
    };

    PeriodPicker.prototype._createButton = function () {
        var self = this,
            $button, $img;

        $button = $("<span/>").addClass("k-select");
        $img = $("<span/>").addClass("k-icon k-i-calendar");

        self.wrapper.append($button);
        $button.append($img);
        self.button = $button;
    };

    PeriodPicker.prototype._createCalendars = function () {
        var self = this,
            $el = $(self._element),
            $calendars;

        $calendars = $("<div/>").addClass("dews-periodpicker-calendars");

        $calendars.attr("aria-hidden", true).css("display", "none").css("overflow", "hidden");

        if ($el.attr("id") !== undefined) {
            $calendars.attr("id", $el.attr("id") + "_calendars");
        }

        $(document.body).append($calendars);
        self.calendars = $calendars;
    };

    PeriodPicker.prototype._createOptions = function () {
        var self = this, $el = $(self._element),
            $option;

        $option = $("<div/>").addClass("dews-periodpicker-option");

        if (self.options.buttons === false) {
            $option.css({'display':'none'});
        } else {
            $option.css({'display':'inline-block'});
        }

        self.calendars.empty().append($option);
        self.option = $option;
    };

    PeriodPicker.prototype._createOptionButtons = function () {
        var self = this,
            $todayButton, $yesterdayButton, $weekButton, $lastWeekButton, $monthButton, $lastMonthButton, $upToNowButton, $oneQuearterButton, $twoQuearterButton,
            $threeQuearterButton, $fourQuearterButton, $firstHalfButton, $secondHalfButton, $januaryButton, $februaryButton, $marchButton, $aprilButton, $mayButton,
            $juneButton, $julyButton, $augustButton, $septemberButton, $octoberButton, $novemberButton, $decemberButton;

        $todayButton = $("<button type='button'>"+ dews.localize.get('오늘', 'dews_오늘') +"</button>").addClass("dews-period-button dews-period-day dews-period-today");
        $yesterdayButton = $("<button type='button'>"+ dews.localize.get('어제', 'dews_어제') +"</button>").addClass("dews-period-button dews-period-day dews-period-yesterday");
        $weekButton = $("<button type='button'>"+ dews.localize.get('주간', 'dews_주간') +"</button>").addClass("dews-period-button dews-period-weeks dews-period-week");
        $lastWeekButton = $("<button type='button'>"+ dews.localize.get('전주', 'dews_전주') +"</button>").addClass("dews-period-button dews-period-weeks dews-period-lastweek");
        $monthButton = $("<button type='button'>"+ dews.localize.get('당월', 'dews_당월') +"</button>").addClass("dews-period-button dews-period-month dews-period-thismonth");
        $lastMonthButton = $("<button type='button'>"+ dews.localize.get('전월', 'dews_전월') +"</button>").addClass("dews-period-button dews-period-month dews-period-lastmonth");
        $upToNowButton = $("<button type='button'>"+ dews.localize.get('오늘까지', 'dews_오늘까지') +"</button>").addClass("dews-period-button dews-period-uptonow");
        $oneQuearterButton = $("<button type='button'>"+ dews.localize.get('1/4분기', 'dews_1/4분기') +"</button>").addClass("dews-period-button dews-period-quearter dews-period-onequearter");
        $twoQuearterButton = $("<button type='button'>"+ dews.localize.get('2/4분기', 'dews_2/4분기') +"</button>").addClass("dews-period-button dews-period-quearter dews-period-twoquearter");
        $threeQuearterButton = $("<button type='button'>"+ dews.localize.get('3/4분기', 'dews_3/4분기') +"</button>").addClass("dews-period-button dews-period-quearter dews-period-threequearter");
        $fourQuearterButton = $("<button type='button'>"+ dews.localize.get('4/4분기', 'dews_4/4분기') +"</button>").addClass("dews-period-button dews-period-quearter dews-period-fourquearter");
        $firstHalfButton = $("<button type='button'>"+ dews.localize.get('상반기', 'dews_상반기') +"</button>").addClass("dews-period-button dews-period-half dews-period-onehalf");
        $secondHalfButton = $("<button type='button'>"+ dews.localize.get('하반기', 'dews_하반기') +"</button>").addClass("dews-period-button dews-period-half dews-period-twohalf");
        $januaryButton = $("<button type='button'>"+ dews.localize.get('1월', 'dews_1월') +"</button>").addClass("dews-period-button dews-period-months dews-period-january");
        $februaryButton = $("<button type='button'>"+ dews.localize.get('2월', 'dews_2월') +"</button>").addClass("dews-period-button dews-period-months dews-period-february");
        $marchButton = $("<button type='button'>"+ dews.localize.get('3월', 'dews_3월') +"</button>").addClass("dews-period-button dews-period-months dews-period-march");
        $aprilButton = $("<button type='button'>"+ dews.localize.get('4월', 'dews_4월') +"</button>").addClass("dews-period-button dews-period-months dews-period-april");
        $mayButton = $("<button type='button'>"+ dews.localize.get('5월', 'dews_5월') +"</button>").addClass("dews-period-button dews-period-months dews-period-may");
        $juneButton = $("<button type='button'>"+ dews.localize.get('6월', 'dews_6월') +"</button>").addClass("dews-period-button dews-period-months dews-period-june");
        $julyButton = $("<button type='button'>"+ dews.localize.get('7월', 'dews_7월') +"</button>").addClass("dews-period-button dews-period-months dews-period-july");
        $augustButton = $("<button type='button'>"+ dews.localize.get('8월', 'dews_8월') +"</button>").addClass("dews-period-button dews-period-months dews-period-august");
        $septemberButton = $("<button type='button'>"+ dews.localize.get('9월', 'dews_9월') +"</button>").addClass("dews-period-button dews-period-months dews-period-september");
        $octoberButton = $("<button type='button'>"+ dews.localize.get('10월', 'dews_10월') +"</button>").addClass("dews-period-button dews-period-months dews-period-october");
        $novemberButton = $("<button type='button'>"+ dews.localize.get('11월', 'dews_11월') +"</button>").addClass("dews-period-button dews-period-months dews-period-november");
        $decemberButton = $("<button type='button'>"+ dews.localize.get('12월', 'dews_12월') +"</button>").addClass("dews-period-button dews-period-months dews-period-december");

        if (dews.localize.getLanguage() === 'en') {
            $('.dews-period-button').css({
                'letter-spacing':'-1px',
                'font-weight': '200'
            });
        }

        self.option.append($todayButton);
        self.option.append($yesterdayButton);
        self.option.append($weekButton);
        self.option.append($lastWeekButton);
        self.option.append($monthButton);
        self.option.append($lastMonthButton);
        self.option.append($upToNowButton);
        self.option.append($oneQuearterButton);
        self.option.append($twoQuearterButton);
        self.option.append($threeQuearterButton);
        self.option.append($fourQuearterButton);
        self.option.append($firstHalfButton);
        self.option.append($secondHalfButton);
        self.option.append($januaryButton);
        self.option.append($februaryButton);
        self.option.append($marchButton);
        self.option.append($aprilButton);
        self.option.append($mayButton);
        self.option.append($juneButton);
        self.option.append($julyButton);
        self.option.append($augustButton);
        self.option.append($septemberButton);
        self.option.append($octoberButton);
        self.option.append($novemberButton);
        self.option.append($decemberButton);

        self.todayButton = $todayButton;
        self.yesterdayButton = $yesterdayButton;
        self.weekButton = $weekButton;
        self.lastWeekButton = $lastWeekButton;
        self.monthButton = $monthButton;
        self.lastMonthButton = $lastMonthButton;
        self.upToNowButton = $upToNowButton;
        self.oneQuearterButton = $oneQuearterButton;
        self.twoQuearterButton = $twoQuearterButton;
        self.threeQuearterButton = $threeQuearterButton;
        self.fourQuearterButton = $fourQuearterButton;
        self.firstHalfButton = $firstHalfButton;
        self.secondHalfButton = $secondHalfButton;
    };

    PeriodPicker.prototype._createPeriodCalendar = function () {
        var self = this,
            $periodcalendars;

        $periodcalendars = $("<span/>").addClass("dews-periodpicker-periodcalendars");

        self.calendars.append($periodcalendars);
        self.periodcalendars = $periodcalendars;
    };

    PeriodPicker.prototype._createStartCalendar = function () {
        var self = this,
            $startCalendar;

        $startCalendar = $("<div/>").addClass("dews-periodpicker-calendar");

        $startCalendar.kendoCalendar({
            animation: false,
            footer: false
        });

        self.periodcalendars.append($startCalendar);
        self.startCalendar = $startCalendar.data('kendoCalendar');
    };

    PeriodPicker.prototype._createEndCalendar = function () {
        var self = this,
            $endCalendar;

        $endCalendar = $("<div/>").addClass("dews-periodpicker-calendar");

        $endCalendar.kendoCalendar({
            animation: false,
            footer: false
        });

        self.periodcalendars.append($endCalendar);
        self.endCalendar = $endCalendar.data('kendoCalendar');
    };

    PeriodPicker.prototype._createButtons = function () {
        var self = this,
            $buttons;

        $buttons = $("<div/>").addClass("dews-periodpicker-buttons");

        self.calendars.append($buttons);
        self.buttons = $buttons;
    };

    PeriodPicker.prototype._createPeriodDate = function () {
        var self = this,
            $periodDate, $periodSelect;

        $periodSelect = $("<p>"+ dews.localize.get('선택한 기간', 'dews_선택한 기간') +":</p>").addClass("dews-periodpicker-periodSelect");
        $periodDate = $("<strong/>").addClass("dews-periodpicker-periodDate");

        self.buttons.append($periodSelect);
        $periodSelect.append($periodDate);

        self.periodDate = $periodDate;
    };

    PeriodPicker.prototype._createOkButton = function () {
        var self = this,
            $okButton;

        $okButton = $("<button type='button'>"+ dews.localize.get('적용하기', 'dews_적용하기') +"</button>").addClass("dews-ui-button primary dews-periodpicker-ok k-button small");

        self.buttons.append($okButton);
        self.okButton = $okButton;
    };

    PeriodPicker.prototype.enable = function (value) {
        var self = this,
            $el = $(self._element),
            enabled;

        enabled = !$el.hasClass("disabled");

        if (typeof value !== 'undefined') {
            if (value === true) {
                $el.removeClass("disabled");
                self.wrapper.removeClass("dews-state-disabled");
                self.startInput.removeAttr("disabled", "disabled");
                self.endInput.removeAttr("disabled", "disabled");
                self.startInput.removeClass("dews-state-disabled");
                self.endInput.removeClass("dews-state-disabled");
                enabled = !value;
            } else if (value === false) {
                $el.addClass("disabled");
                self.wrapper.addClass("dews-state-disabled");
                self.startInput.attr("disabled", "disabled");
                self.endInput.attr("disabled", "disabled");
                self.startInput.addClass("dews-state-disabled");
                self.endInput.addClass("dews-state-disabled");
                enabled = !value;
            }
        }

        return enabled;
    };

    PeriodPicker.prototype.readonly = function (value) {
        var self = this,
            $el = $(self._element),
            readonly;

        readonly = $el.hasClass("readonly");

        if (typeof value !== 'undefined') {
            if (value === false) {
                $el.removeClass("readonly");
                self.wrapper.removeClass("dews-state-readonly");
                self.startInput.removeAttr("readonly", "readonly");
                self.endInput.removeAttr("readonly", "readonly");
                self.startInput.removeClass("dews-state-readonly");
                self.endInput.removeClass("dews-state-readonly");
                self.disableButton = false;
                readonly = !value;
            } else if (value === true) {
                $el.addClass("readonly");
                self.wrapper.addClass("dews-state-readonly");
                self.startInput.attr("readonly", "readonly");
                self.endInput.attr("readonly", "readonly");
                self.startInput.addClass("dews-state-readonly");
                self.endInput.addClass("dews-state-readonly");
                self.disableButton = true;
                readonly = !value;
            }
        }

        return readonly;
    };

    PeriodPicker.prototype.focus = function (options) {
        var self = this;

        if (options === "start") {
            self.startInput.focus();
        } else if (options === "end") {
            self.endInput.focus();
        } else if (options === undefined) {
            if (self.startInput.val()) {
                self.endInput.focus();
            } else {
                self.startInput.focus();
            }
        }
    };

    PeriodPicker.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $(self._element).on.apply($(self._element), arguments);
    };

    PeriodPicker.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        self.container.off.apply(self.container, arguments);
    };

    PeriodPicker.prototype._bindEvents = function () {
        var self = this,
            $el = $(self._element);

        var toggle = true;

        var today = new Date(),
            now = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate()));
        var $position = 0;

        if ($el.hasClass('readonly')) {
            self.disableButton = true;
        }

        self.startInput.on("focus",function (e) {
            self.wrapper.addClass('dews-periodpicker-focus');
            self.button.addClass('dews-periodpicker-focus');
            e.stopPropagation();
        });

        self.endInput.on("focus",function (e) {
            self.wrapper.addClass('dews-periodpicker-focus');
            self.button.addClass('dews-periodpicker-focus');
            e.stopPropagation();
        });

        self.startInput.on("blur",function (e) {
            self.wrapper.removeClass('dews-periodpicker-focus');
            self.button.removeClass('dews-periodpicker-focus');
            e.stopPropagation();
        });

        self.endInput.on("blur",function (e) {
            self.wrapper.removeClass('dews-periodpicker-focus');
            self.button.removeClass('dews-periodpicker-focus');
            e.stopPropagation();
        });

        function selectedPeriod () {
            if ((startCalendar.value() && endCalendar.value()) && (startCalendar.value() <= endCalendar.value())) {
                var startDays = kendo.toString(startCalendar.value(), self.options.format, kendo.getCulture());
                var endDays = kendo.toString(endCalendar.value(), self.options.format, kendo.getCulture());

                self.periodDate.text(startDays+"~"+endDays);
                self.okButton.prop('disabled', false);
                self.okButton.removeClass('k-state-disabled');
            } else if ((startCalendar.value() && endCalendar.value()) && (startCalendar.value() >= endCalendar.value())) {
                self.periodDate.text('');
                self.okButton.prop('disabled', true);
                self.okButton.addClass('k-state-disabled');
            } else if (startCalendar.value() || endCalendar.value()){
                self.periodDate.text('');
                self.okButton.prop('disabled', false);
                self.okButton.removeClass('k-state-disabled');
            } else {
                self.periodDate.text('');
                self.okButton.prop('disabled', true);
                self.okButton.addClass('k-state-disabled');
            }
        }

        var popoverClose = function (e) {
            if((e.type === "scroll" && (!$(e.target).parents('.dews-periodpicker-calendars')[0])) || (e.type === "keyup" && e.keyCode === 27)) {
                close();
                clear();
                $(e.target).focus();
                if (self.startInput.val() === "") {
                    startCalendar.value("");
                    self.periodDate.text("");
                } else if (self.endInput.val() === "") {
                    endCalendar.value("");
                    self.periodDate.text("");
                }
            }
        };

        self.okButton.on("click", function (e) {
            var startDay, endDay,
                preStartDay,
                preEndDay;

            self.okButton.prop("disabled", false);
            self.okButton.removeClass('k-state-disabled');

            if ((startCalendar.value() && endCalendar.value()) && (startCalendar.value() > endCalendar.value())) {
                self.okButton.prop('disabled', true);
                self.okButton.addClass('k-state-disabled');
            }

            close();

            if (startCalendar.value()) {
                preStartDay = self.startInput.val();
                startDay = kendo.toString(startCalendar.value(), self.options.format, kendo.getCulture());
                self.startInput.val(startDay);
            }
            if (endCalendar.value()) {
                preEndDay = self.endInput.val();
                endDay = kendo.toString(endCalendar.value(), self.options.format, kendo.getCulture());
                self.endInput.val(endDay);
            }

            if (self.firstClickItem !== null && self.secondClickItem === null) {
                self.secondClickItem = self.firstClickItem;
            }

            if (startDay !== preStartDay || endDay !== preEndDay) {
                $(self._element).trigger('_change');
            }

            e.stopPropagation();
        });

        self.button.on("click", function (e) {
            if (!self.disableButton) {
                self.startCalendar.navigate(startCalendar.value(),"month");
                self.endCalendar.navigate(endCalendar.value(),"month");

                self.okButton.prop('disabled', false);
                self.okButton.removeClass('k-state-disabled');

                if (toggle) {
                    bindCloseEvent();

                    var c_position = $el.offset();
                    var zIndex = dews.ui.getDialogMaxZIndex();

                    if (zIndex > parseInt(self.calendars.css('zIndex'), 10)) {
                        self.calendars.css('zIndex', zIndex+2);
                    }

                    self.calendars.css({
                        'left': parseFloat(c_position.left) + 'px'
                    });

                    if ($(window).height() < $(this).offset().top - $position + self.calendars.height() + 24) {
                        self.calendars.css("top", parseFloat(c_position.top) - self.calendars.height() - 1);
                        if (($(this).offset().top - $position) < self.calendars.height()) {
                            self.calendars.css("top", parseFloat(c_position.top) + 23);
                        }
                    } else {
                        self.calendars.css("top", parseFloat(c_position.top) + self.wrapper.height() + 1);
                    }
                    if ($(window).width()-(self.wrapper.offset().left + self.calendars.width()) < 0) {
                        var right_width = self.button.offset().left + 22.7969 - self.calendars.width();
                        self.calendars.css("left", right_width);
                        if ($(window).width() < self.calendars.width()) {
                            self.calendars.css("left", parseFloat(c_position.left) + 1);
                        }
                    }
                    self.container.addClass("dews-state-active");
                    self.wrapper.addClass('dews-periodpicker-focus');
                    self.button.addClass('dews-periodpicker-focus');
                    self.calendars.attr("aria-hidden", false).css("display", "block").css("overflow", "visible");
                    toggle = false;

                    if (self.startInput.val() === "") {
                        startCalendar.value("");
                        self.periodDate.text("");
                    } else if (self.endInput.val() === "") {
                        endCalendar.value("");
                        self.periodDate.text("");
                    }

                    clear();
                } else {
                    close();
                    clear();
                    if (self.startInput.val() === "") {
                        startCalendar.value("");
                        self.periodDate.text("");
                    } else if (self.endInput.val() === "") {
                        endCalendar.value("");
                        self.periodDate.text("");
                    }
                }
            }
            e.stopPropagation();
        });

        $(window).scroll(function() {
            $position = $(this).scrollTop();
        });

        $(window).resize(function() {
            var c_position = $el.offset();
            self.calendars.css({
                'left': parseFloat(c_position.left) + 'px',
                'top': parseFloat(c_position.top) + 23 + 'px'
            });

            if ($(window).height() < $('span.k-select',$el).offset().top - $position + self.calendars.height() + 24) {
                self.calendars.css("top", parseFloat(c_position.top) - self.calendars.height() - 2);
                if (($('span.k-select',$el).offset().top - $position) < self.calendars.height()) {
                    self.calendars.css("top", parseFloat(c_position.top) + 23);
                }
            } else {
                self.calendars.css("top", parseFloat(c_position.top) + 24);
            }
            if ($(window).width()-(self.wrapper.offset().left + self.calendars.width()) < 0) {
                var right_width = self.button.offset().left + 22.7969 - self.calendars.width();
                self.calendars.css("left", right_width);
                if ($(window).width() < self.calendars.width()) {
                    self.calendars.css("left", parseFloat(c_position.left) + 1);
                }
            }
        });

        function bindCloseEvent() {
            window.addEventListener('scroll', popoverClose, true);
            window.addEventListener('keyup', popoverClose, true);

            // 버튼, 달력창 영역을 제외한 나머지 부분 클릭시 달력창 닫기
            $(window).on("click", function (e) {
                if(!$(e.target).parents('.dews-periodpicker-calendars')[0] && !$(e.target).parents('table.k-content')[0] && $(e.target).closest('.dews-ui-msgbox').length === 0) {
                    close();
                    var startSet = self.startInput.val(),
                        endSet = self.endInput.val();

                    if (startSet && endSet) {
                        formats(startSet, endSet);
                    }
                    if (startSet === "") {
                        startCalendar.value("");
                        self.periodDate.text("");
                    }
                    if (endSet === "") {
                        endCalendar.value("");
                        self.periodDate.text("");
                    }
                }
                e.stopPropagation();
            });
        }

        // 달력에 시작날짜와 종료날짜를 셋팅해준다
        function formats(startSet, endSet) {
            var firstday, lastday;

            if (($.type(startSet) === 'date' || ($.type(endSet) === 'date'))) {
                firstday = kendo.toString(startSet, dews._environments.formats.dateFormat, kendo.getCulture());
                lastday = kendo.toString(endSet, dews._environments.formats.dateFormat, kendo.getCulture());
            } else {
                firstday = kendo.parseDate(startSet.replace(/[^(0-9)]/gi,""), self.options.valueFormat, kendo.getCulture());
                lastday = kendo.parseDate(endSet.replace(/[^(0-9)]/gi,""), self.options.valueFormat, kendo.getCulture());
                firstday = kendo.toString(firstday, dews._environments.formats.dateFormat, kendo.getCulture());
                lastday = kendo.toString(lastday, dews._environments.formats.dateFormat, kendo.getCulture());
            }

            self.startCalendar.navigate(firstday,"month");
            self.endCalendar.navigate(lastday,"month");
            startCalendar.value(firstday);
            endCalendar.value(lastday);
            selectedPeriod();
        }

        function close() {
            self.container.removeClass("dews-state-active");
            self.wrapper.removeClass('dews-periodpicker-focus');
            self.button.removeClass('dews-periodpicker-focus');
            self.calendars.attr("aria-hidden", true).css({"display": "none", "overflow" : "hidden", "zIndex" : ""});
            toggle = true;
            window.removeEventListener('scroll', popoverClose, true);
            window.removeEventListener('keyup', popoverClose, true);
            $(window).off("click");
        }

        var startCalendar = self.startCalendar;
        startCalendar.bind('change',selectedPeriod);

        var endCalendar = self.endCalendar;
        endCalendar.bind('change',selectedPeriod);

        if (self.options.startDate !== null) {
            self.setStartDate(self.options.startDate);
        }

        if (self.options.endDate !== null) {
            self.setEndDate(self.options.endDate);
        }

        // periodpicker 길이가 길어질 경우 endInput 이후 영역 클릭스 포커스 설정
        self.wrapper.on('click', function (e) {
            var top = parseInt(self.endInput.offset().top - 5);
            var left = parseInt(self.endInput.offset().left) + self.endInput.width();
            var right = parseInt($('.k-select', $el).offset().left);
            var bottom = top + 24;
            if ((left <= e.pageX && e.pageX <= right) && (top <= e.pageY && e.pageY <= bottom)) {
                self.focus();
            }
            e.stopPropagation();
        });

        self.startInput.on("keyup", function (e) {
            var key = e.key, regex = /[0-9]/; // 입력된 키 값이 숫자인지 매칭
            var preStartDate, currStartDate;
            var startInput = self.startInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preStartDate = $('.dews-periodpicker-startDate', self.wrapper).attr('val');
                currStartDate = self.startInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self.startInput.val() && self.startInput.val().indexOf("_") === -1) {
                    format(self.startInput);
                    if (!(self.endInput.val())) {
                        endCalendar.value("");
                        self.periodDate.text("");
                    }

                    $('.dews-periodpicker-startDate', self.wrapper).attr('val', $('.dews-periodpicker-startDate', self.wrapper).val());

                    if(preStartDate !== currStartDate) {
                        self.startInput.trigger('_change');
                    }
                    if (regex.test(key)) {
                        self.endInput.focus();
                    }
                }

                if (self.startInput.val().indexOf("_") === 0) {
                    if(preStartDate !== currStartDate) {
                        self.startInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self.startInput.val().indexOf("_") === 0) {
                    startCalendar.value("");
                    self.periodDate.text("");
                    endCalendar.min(new Date(1900,0,1));
                }
            }
            e.stopPropagation();
        });

        self.endInput.on("keyup", function (e) {
            var key = e.key, regex = /[0-9]/; // 입력된 키 값이 숫자인지 매칭
            var preEndDate, currEndDate;
            var endInput = self.endInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preEndDate = $('.dews-periodpicker-endDate', self.wrapper).attr('val');
                currEndDate = self.endInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self.endInput.val() && self.endInput.val().indexOf("_") === -1) {
                    format(self.endInput);
                    if (!(self.startInput.val())) {
                        startCalendar.value("");
                        self.periodDate.text("");
                    }
                    $('.dews-periodpicker-endDate', self.wrapper).attr('val', $('.dews-periodpicker-endDate', self.wrapper).val());

                    if(preEndDate !== currEndDate) {
                        self.endInput.trigger('_change');
                    }
                }

                if (self.endInput.val().indexOf("_") === 0) {
                    if(preEndDate !== currEndDate) {
                        self.endInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self.endInput.val().indexOf("_") === 0) {
                    endCalendar.value("");
                    self.periodDate.text("");
                    startCalendar.max(new Date(2099,11,31));
                    self.startInput.focus();
                }
            }
            e.stopPropagation();
        });

        // 시작일이나 종료일을 입력 중인 경우 이벤트 버블링을 막음
        $el.on("keydown", function (e){
            if(e.keyCode === 13 && (self.startInput.is(":focus") || self.endInput.is(":focus"))) {
                e.stopPropagation();
            } else if (e.keyCode === 115 && self.calendars.css('display') === 'none') {
                self.button.click();
                e.stopPropagation();
                e.preventDefault();
            }
        });

        function format(option) {
            var dateValue = $(option).val(), date, day,
                newDate = kendo.parseDate(dateValue, self.options.format, kendo.getCulture()),
                yyyy, MM, dd;

            if (newDate) {
                yyyy = newDate.getFullYear();
                MM = newDate.getMonth() + 1;
                dd = newDate.getDate();
            }

            if (parseInt(yyyy) >= 2100 || parseInt(yyyy) <= 1900) {
                yyyy = now.toISOString().substring(0, 4);
            }

            if (parseInt(MM) >= 13 || parseInt(MM) <= 0) {
                MM = now.toISOString().substring(5, 7);
            }

            switch (MM) {
                case '01': case '03': case '05': case '07': case '08': case '10': case '12':
                if (dd > 31 || dd <= 0) {
                    dd = now.toISOString().substring(8, 10);
                }
                break;
                case '02':
                    if (yyyy % 4 === 0) {
                        if (dd > 29 || dd <= 0) {
                            dd = now.toISOString().substring(8, 10);
                        }
                    } else {
                        if (dd > 28 || dd <= 0) {
                            dd = now.toISOString().substring(8, 10);
                        }
                    }
                    break;
                case '04': case '06': case '09': case '11':
                if (dd > 30 || dd <= 0) {
                    dd = now.toISOString().substring(8, 10);
                }
                break;
                default:
                    break;
            }

            if (yyyy && MM && dd) {
                date = new Date(yyyy, MM - 1,dd);
                day = kendo.toString(date, self.options.format, kendo.getCulture());
            }

            $(option).val(day);

            var startSet = self.startInput.val(),
                endSet = self.endInput.val();

            var startMax = startSet.replace(/[^(0-9)]/gi, ""),
                endMax = endSet.replace(/[^(0-9)]/gi, "");

            if (startMax) {
                var startDate = kendo.parseDate(startMax, self.options.valueFormat, kendo.getCulture());
                var getStartTime = startDate.getTime();
            }

            if (endMax) {
                var endDate = kendo.parseDate(endMax, self.options.valueFormat, kendo.getCulture());
                var getEndTime = endDate.getTime();
            }

            if (getStartTime > getEndTime) {
                if (!getEndTime) {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = "";
                } else {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                }
            } else {
                if (!getStartTime) {
                    startSet = kendo.toString(endDate, self.options.format, kendo.getCulture());
                    endSet = "";
                } else {
                    startSet = kendo.toString(startDate, self.options.format, kendo.getCulture());
                    endSet = kendo.toString(endDate, self.options.format, kendo.getCulture());
                }
            }

            if (startMax !== "" && endMax  !== "") {
                self.startInput.val(startSet);
                self.endInput.val(endSet);
            }

            if(!startMax) {
                self.startInput.val("");
            }

            if(!endMax) {
                self.endInput.val("");
            }

            if (option === self.startInput) {
                formats(startSet, endSet);
            } else {
                formats(startSet, endSet);
            }

        }

        // 달력창 내부의 기간 버튼을 클릭했을때 이벤트들
        self.todayButton.on("click", function (e) {
            clear();
            formats(now, now);
            e.stopPropagation();
        });

        self.yesterdayButton.on("click", function (e) {
            clear();
            var yester = new Date(Date.UTC(today.getFullYear(), today.getMonth(), today.getDate() - 1));
            formats(yester, yester);
            e.stopPropagation();
        });

        self.weekButton.on("click", function (e) {
            clear();
            var weeks = new Date();
            var firstday = new Date(weeks.setDate(weeks.getDate() - weeks.getDay()));
            var lastday = new Date(weeks.setDate(weeks.getDate() - weeks.getDay()+6));
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.lastWeekButton.on("click", function (e) {
            clear();
            var lastweeks = new Date();
            var previousweek= new Date(lastweeks.getTime() - 7 * 24 * 60 * 60 * 1000);
            var firstday = new Date(previousweek.setDate(previousweek.getDate() - previousweek.getDay()));
            var lastday = new Date(previousweek.setDate(previousweek.getDate() - previousweek.getDay()+6));
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.monthButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), today.getMonth(), 1);
            var lastday = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.lastMonthButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            var lastday = new Date(today.getFullYear(), today.getMonth(), 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.upToNowButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), today.getMonth(), 1);
            var lastday = now;
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.oneQuearterButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 0, 1);
            var lastday = new Date(today.getFullYear(), 3, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.twoQuearterButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 3, 1);
            var lastday = new Date(today.getFullYear(), 6, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.threeQuearterButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 6, 1);
            var lastday = new Date(today.getFullYear(), 9, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.fourQuearterButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 9, 1);
            var lastday = new Date(today.getFullYear(), 12, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.firstHalfButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 0, 1);
            var lastday = new Date(today.getFullYear(), 6, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        self.secondHalfButton.on("click", function (e) {
            clear();
            var firstday = new Date(today.getFullYear(), 6, 1);
            var lastday = new Date(today.getFullYear(), 12, 0);
            formats(firstday, lastday);
            e.stopPropagation();
        });

        $("."+self.option.attr("class") + " " + '.dews-period-months',self.calendars).on("click", function (e) {
            var months=["dews-period-january","dews-period-february","dews-period-march","dews-period-april",
                "dews-period-may","dews-period-june","dews-period-july","dews-period-august",
                "dews-period-september","dews-period-october","dews-period-november","dews-period-december"];
            var temp, firstday, lastday;
            if (self.firstClickItem !== null) {
                if (self.secondClickItem !== null) {
                    clear();
                }
                self.secondClickItem = self.firstClickItem;
            }

            self.firstClickItem = $(this);

            if (self.firstClickItem !== null && self.secondClickItem !== null) {
                var idx1 = self.firstClickItem.index()-13;
                var idx2 = self.secondClickItem.index()-13;

                if (idx1>idx2) {
                    temp = idx1;
                    idx1 = idx2;
                    idx2 = temp;
                }

                for (var i = idx1; i<=idx2; i++) {
                    if ($("."+self.option.attr("class") + " " + '.dews-period-months',self.calendars).hasClass(months[i])) {
                        $("."+self.option.attr("class") + " " + '.dews-period-months'+"."+months[i],self.calendars).addClass("dews-period-select");
                    }
                }

                firstday = new Date(today.getFullYear(), idx1, 1);
                lastday = new Date(today.getFullYear(), idx2+1, 0);
                formats(firstday, lastday);
            }

            if (self.firstClickItem !== null && self.secondClickItem === null) {
                firstday = new Date(today.getFullYear(), self.firstClickItem.index()-13, 1);
                lastday = new Date(today.getFullYear(), self.firstClickItem.index()-12, 0);
                $("."+self.option.attr("class") + " " + '.dews-period-months'+"."+months[self.firstClickItem.index()-13],self.calendars).addClass("dews-period-select");
                formats(firstday, lastday);
            }
            e.stopPropagation();
        });

        function clear() {
            self.firstClickItem = null;
            self.secondClickItem = null;
            $('.dews-period-months',self.calendars).removeClass("dews-period-select");
        }
    };

    // tag 생성
    PeriodPicker.prototype._initControl = function () {
        var self = this;

        self._createContainer();
        self._createWrapper();
        self._createStartInput();
        self._createEndInput();
        self._createButton();
        self._createCalendars();
        self._createOptions();
        self._createOptionButtons();
        self._createPeriodCalendar();
        self._createStartCalendar();
        self._createEndCalendar();
        self._createButtons();
        self._createOkButton();
        self._createPeriodDate();
        self._bindEvents();

        self.setUserGuideAPI();
    };

    function getOptions($el, defaultOptions, srcOptions) {
        var inlineOptions = {},
            preDefinedFormat,
            options;

        inlineOptions = getInlineOptions($el, defaultOptions);
        preDefinedFormat = dews.getPreDefinedFormat($el);

        if(preDefinedFormat) { // 공통 포맷이 있을 때
            var vf = preDefinedFormat.replace(/[^(a-z)]/gi,"");
            preDefinedFormat = {
                format: preDefinedFormat,
                valueFormat: vf
            };
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions, preDefinedFormat);
        } else if (preDefinedFormat !== false && inlineOptions) { // 공통 포맷은 없고, 지정한 inlineOptions가 있을 때
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions);
        } else { // 공통 포맷이 없지만, 혹여나 잘못된 inlineOptions가 지정되어 있을까봐
            options = $.extend(true, {}, defaultOptions, srcOptions);
        }

        if ($el.val()) {
            options.value = kendo.parseDate($el.val(), options.valueFormat, kendo.getCulture());
        }

        return options;
    }

    /**
     * HTML 태그에 지정된 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} defaultOptions 기본 옵션
     * @returns {object} 옵션
     */
    function getInlineOptions($el, defaultOptions) {
        var options = {};

        if ($el.data('dews-max')) {
            options.max = kendo.parseDate($el.data('dews-max').toString(), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-min')) {
            options.min = kendo.parseDate($el.data('dews-min').toString(), defaultOptions.valueFormat, kendo.getCulture());
        }

        if ($el.data('dews-format')) {
            options.format = $el.data('dews-format');
            options.valueFormat = options.format.toString().replace(/[^(a-z)]/gi,"");
        }

        return options;
    }
    /**
     * 텍스트박스에 마스크를 적용합니다.
     * @param {jQuery} $el 적용할 대상 요소의 jQuery 객체
     * @param {string} format 적용 포맷
     */
    function setMask($el, format) {
        var maskJsUrl;

        // jquery.maskedinput.js 를 이용하여 마스크를 적용함
        // script 파일을 로드된 적이 없으면 동적으로 로드합니다.
        maskJsUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', 'jquery.maskedinput.js');

        if ($.mask) {
            $el.mask(format.replace(/[ymdhms]/ig, '9'));
        } else {
            $.getScript(maskJsUrl, function () {
                $el.mask(format.replace(/[ymdhms]/ig, '9'));
            });
        }
    }

    /**
     * 공통 이벤트를 설정합니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체입니다.
     * @param {object} [options] 피커의 옵션입니다.
     */
    function setEvent($el, options) {
        $el.on('click', function () {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 읽기 전용/비활성화 상태가 아니면 포커스가 오면 텍스트 전체를 선택하도록 한다.
                $this.select();
            }
        }).on('blur', function (e) {
            var $this = $(this), val;
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                if (!dews.date.validate($this.val(), options.format)) {
                    //TODO: 값이 유효하지 않을 경우 오류 표시 및 툴팁 표시
                } else {
                    //TODO: 값이 유효할 때 오류 표시가 있으면 제거
                }
            }
        });
    }

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    PeriodPicker.prototype.setUserGuideAPI = function() {
        var self = this, $element = $(self._element);

        self.startInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });

        self.endInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    };

    PeriodPicker.prototype.validate = function () {
        var self = this;
        if (self.getStartText() && self.getEndText()) {
            return true;
        } else {
            return false;
        }
    };

    PeriodPicker.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self._element);
        var startDate, endDate;

        if (data) {
            startDate = $element.data('dews-bind-startdate') || '';
            endDate = $element.data('dews-bind-enddate') || '';

            if (startDate && data.hasOwnProperty(startDate)) {
                self.setStartDate(data[startDate]);
            }

            if (endDate && data.hasOwnProperty(endDate)) {
                self.setEndDate(data[endDate]);
            }
        }
    };

    PeriodPicker.prototype.serializeForPanel = function () {
        var self = this, $element = $(self._element);
        var startDate,
            endDate,
            data = {};

        startDate = $element.data('dews-bind-startdate') || '';
        endDate = $element.data('dews-bind-enddate') || '';

        if (startDate) {
            data[startDate] = self.getStartDate();
        }

        if (endDate) {
            data[endDate] = self.getEndDate();
        }

        return data;
    };

    PeriodPicker.prototype.applyPanelFocus = function () {
        var self = this, $element = $(self._element);
        var startInput = $(self.startInput),
            endInput = $(self.endInput);

        startInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && startInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });

        endInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && endInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    PeriodPicker.prototype.canFocusable = function () {
        var self = this;
        var boolean = false;
        if ($(self.startInput).is(':enabled') && $(self.endInput).is(':enabled') && $(self.startInput).is(':visible') && $(self.endInput).is(':visible') && !$(self._element).hasClass('readonly')) {
            boolean = true;
        }
        return boolean;
    };

    /**
     * 기간피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    PeriodPicker.prototype._getPrintData = function () {
        var self = this,
            $el = $(self._element),
            data;

        if (self.getStartText() && self.getEndText()) {
            data = {
                id: $el.attr('id'),
                text: self.getStartText() + ' ~ ' + self.getEndText()
            }
        }

        return data;
    };

    dews = $.extend(true, dews, {
        ui: {
            periodpicker: function (selector, options) {
                var $el, periodpicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var picker,
                        $this = $(this);

                    picker = $this.data('dews-control');

                    if (!picker) {

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass("dews-ui-periodpicker")) {
                            $this.addClass("dews-ui-periodpicker");
                        }
                        picker = new PeriodPicker(this, options);
                        picker._initControl();

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', picker);
                    }

                    periodpicker = picker;
                });

                return periodpicker;
            }
        }
    });

    dews.ui.addControlInitializer('periodpicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.periodpicker($("span.dews-ui-periodpicker", $container));
    });
})(jQuery, window.dews, window.kendo);



(function ($, dews) {
    function getOptions (self, opt) {
        var option = {
            autoBind: true,
            display: {
                columnWidth: 100,
                columnHeight: 32,
                rowLabelWidth: 100,
                rowHeight: 32,
                rowGroupWidth: 100,
                blankFillValue: null
            },
            header: {
                titleHeight: 32
            },
            summary: {
                columnPosition: 'last',
                rowPosition: 'last'
            }
        },
        pivot = self;
        // 컬럼 옵션 설정
        if ($.type(opt.column) === 'object') {
            if ($.type(opt.column.width) === 'number') {
                option.display.columnWidth = opt.column.width;
            }
            if ($.type(opt.column.height) === 'number') {
                option.display.columnHeight = opt.column.height;
            }
            if ($.type(opt.column.totalPosition) === 'string') {
                option.summary.columnPosition = opt.column.totalPosition;
            }
            if ($.type(opt.column.totalVisible) === 'boolean') {
                option.summary.columnVisible = opt.column.totalVisible;
            }
            if ($.type(opt.column.summaryVisible) === 'boolean') {
                option.summary.columnGroupVisible = opt.column.summaryVisible;
            }
        }
        // 로우 옵션 설정
        if ($.type(opt.row) === 'object') {
            if ($.type(opt.row.width) === 'number') {
                option.display.rowLabelWidth = opt.row.width;
                option.display.rowGroupWidth = opt.row.width;
            }
            if ($.type(opt.row.height) === 'number') {
                option.display.rowHeight = opt.row.height;
            }
            if ($.type(opt.row.totalPosition) === 'string') {
                option.summary.rowPosition = opt.row.totalPosition;
            }
            if ($.type(opt.row.totalVisible) === 'boolean') {
                option.summary.rowVisible = opt.row.totalVisible;
            }
            if ($.type(opt.row.summaryVisible) === 'boolean') {
                option.summary.rowGroupVisible = opt.row.summaryVisible;
            }
        }

        $.extend(true, option, opt);
        // 필드매핑 설정
        option = customizingOption(option);

        if (option.dataSource && option.dataSource.dataProvider) {
            option.dataSource.dataProvider.setFields(option.dataSource.options.field);
            pivot._pivot.setDataProvider(option.dataSource.dataProvider);
        }

        if (option.fieldMapping) {
            pivot._pivot.setFieldMapping(option.fieldMapping);
            pivot._pivot.setPivotFields(option.pivotField);
        }

        return option;
    }
    // 옵션 설정
    function customizingOption(option) {
        var options = option,
            dataSource = options.dataSource,
            fieldMapping = option.sources,
            fieldIndex = 0,
            pivotField = {
                columns: [],
                rows: [],
                values: [],
                filter: {
                    operation: '',
                    conditions: []
                }
            };

        if ($.type(fieldMapping) !== 'undefined') {
            // 필드 매핑 설정
            $.each(fieldMapping, function (idx, item) {
                for (var i = 0; i < dataSource.options.field.length; i++) {
                    if (dataSource.options.field[i].field === item.field) {
                        fieldIndex = i;
                    }
                }
                // 필드 설정
                if (item.field) {
                    fieldMapping[idx].name = item.field;
                    fieldMapping[idx].sourceField = item.field;
                }
                // 제목설정
                if (item.title) {
                    fieldMapping[idx].fieldHeader = item.title;
                }
                // 동적 문구 설정
                if (item.displayTitle) {
                    fieldMapping[idx].displayTitle = item.displayLabels;
                }
                // 숫자 포맷 설정
                if (item.format) {
                    fieldMapping[idx].numberFormat = item.format;
                    dataSource.options.field[fieldIndex].dataType = 'number';
                }
                // 컬럼, 행 설정 가능여부
                if (item.titleEnable) {
                    fieldMapping[idx].labelEnable = item.titleEnable;
                }
                // 정렬 설정
                if (item.sort) {
                    var sort = 'ascending';
                    switch (item.sort.toLowerCase()) {
                        case 'acs':
                            sort = 'ascending';
                            break;
                        case 'des':
                            sort = 'descending';
                            break;
                    }
                    fieldMapping[idx].sortDir = sort;
                }
                // 그룹 컬럼, 로우 헤더 설정
                if (item.summrayTitle) {
                    var label = item.summrayTitle.replace(/\$\s?{\s?title\s?\}/gi,'${label}');
                    item.summrayHeader = label;
                }
                // 연산 설정
                if (item.expression) {
                    switch (item.expression.toLowerCase()) {
                        case 'count': case 'distinct':
                            break;
                        default :
                            dataSource.options.field[fieldIndex].dataType = 'number';
                            break;
                    }
                }
                // 데이터소스 포맷 설정
            });
            option.fieldMapping = fieldMapping;
        }
        // 컬럼 설정
        if (options.columns) {
            $.each(options.columns, function (idx, item) {
                pivotField.columns.push(item.field);
            });
        }
        // 로우 설정
        if (options.rows) {
            $.each(options.rows, function (idx, item) {
                pivotField.rows.push(item.field);
            });
        }
        // 값 필드 설정
        if (options.values) {
            $.each(options.values, function (idx, item) {
                pivotField.values.push({name: item.field});
            });
        }
        // 필터 필드 설정
        if (options.filter && options.filter.fields) {
            pivotField.filter.operation = options.filter.operation;
            pivotField.filter.conditions = options.filter.fields;
            $.each(options.filter.fields, function (idx, item) {
                pivotField.filter.fields[idx].name = options.filter.fields[idx].field;
            });
        }

        options.pivotField = pivotField;

        return options;
    }

    var PivotGrid = function (selector, options) {
        var self = this,
            pivotGrid,
            pivotGridID,
            option,
            id = selector.attr('ID');

        pivotGrid = $('<div></div>');
        if (dews.ui.dialogPage && selector.closest(dews.ui.dialogPage.$content).length) {
            options.$content = dews.ui.dialogPage.$content;
            pivotGridID = dews.ui.dialogPage.id+'_'+id;
        } else if (dews.ui.page && selector.closest(dews.ui.page.$content).length) {
            options.$content = dews.ui.page.$content;
            pivotGridID = dews.ui.page.id+'_'+id;
        } else {
            options.$content = $(document);
            pivotGridID = 'child_'+ id;
        }
        pivotGrid.attr('ID', pivotGridID);
        $('#'+id, options.$content).append(pivotGrid);

        if (options.height) {
            pivotGrid.css('height', options.height + 'px');
        } else {
            selector.css('height', '100%');
            pivotGrid.css('height', '100%');
        }

        self._pivot = new RealPivot(pivotGridID);
        self._pivot.name = pivotGridID;
        self.$element = $('#'+self._pivot.name);
        option = getOptions(self, options);
        self._pivot.setOptions(option);
        self.options = option;
        self.focused = false;

        dews.ready(function () {
            self._pivot.buildPivot();
            self._pivot.resetSize();
        });

        if (self.options.dataSource && self.options.autoBind) {
            self.options.dataSource.read();
            self._pivot.drawView();
        }

        self._bindEvent();

        return self;
    };
    /**
     * 피벗그리드 데이터소스 설정
     * @param dataSource 데이터소스 객체
     */
    PivotGrid.prototype.setDataSource = function (dataSource) {
        var self = this;

        self.options.dataSource = dataSource;

        self.options = getOptions(self, self.options);
        self.options.dataSource.read();
        self._pivot.drawView();
    };
    /**
     * 피벗그리드 소스필드 설정
     * @param sources 설정할 소스
     */
    PivotGrid.prototype.setSources = function (sources) {
        var self = this;

        self.options.sources = sources;
        self.options = customizingOption(self.options);

        self._pivot.setFieldMapping(self.options.fieldMapping);
    };
    /**
     * 피벗그리드 컬럼 설정
     * @param columns 컬럼에 설정할 컬럼 필드명
     */
    PivotGrid.prototype.setColumns = function (columns) {
        var self = this;

        self.options.columns = columns;
        self.options = customizingOption(self.options);

        self._pivot.setPivotFields(self.options.pivotField);
    };
    /**
     * 피벗그리드 로우 설정
     * @param rows 로우에 설정할 로우 필드명
     */
    PivotGrid.prototype.setRows = function (rows) {
        var self = this;

        self.options.rows = rows;
        self.options = customizingOption(self.options);

        self._pivot.setPivotFields(self.options.pivotField);
    };
    /**
     * 피벗그리드 데이터 바인딩 될 값 설정
     * @param values 데이터로 바인딩 될 값 필드
     */
    PivotGrid.prototype.setValues = function (values) {
        var self = this;

        self.options.values = values;
        self.options = customizingOption(self.options);

        self._pivot.setPivotFields(self.options.pivotField);
    };
    /**
     * 피벗그리드 옵션 설정
     * @param opt 설정할 옵션
     */
    PivotGrid.prototype.setOptions = function (opt) {
        var self = this,
            options = $.extend(true, self.options, opt);

        options = getOptions(self, options);
        self._pivot.setOptions(options);
    };
    /**
     * 피벗그리드 새로고침
     */
    PivotGrid.prototype.refresh = function () {
        var self = this;

        self._pivot.drawView();
    };
    /**
     * 피벗그리드 엑셀 다운로드
     * @param option 엑셀 다운로드시 설정할 옵션
     */
    PivotGrid.prototype.saveAsExcel = function (option) {
        var self = this,
            opt = {
                allPages: true,
                target: 'local'
            };

        opt = $.extend(true, opt, option);

        self._pivot.exportGrid({
            'type': 'excel',
            'target': opt.target,
            'fileName': opt.fileName,
            'allItem': opt.allPages,
            'applyDynamicStyles': true
        });
    };
    /**
     * 피벗 그리드 컨텍스트 메뉴 설정
     * @param options 컨텍스트 메뉴 설정 값
     */
    // PivotGrid.prototype.setContextMenu = function (options) {
    //     var self = this;
    // };
    /**
     * 피벗 그리드 정렬
     * @param option 정렬 할 항목 및 옵션
     */
    PivotGrid.prototype.sort = function (option) {
        var self = this,
            options = option;

        if (options.column) {
            if (options.method.toLowerCase() === 'title') {
                $.each(options.column.fields, function (idx) {
                    options.column.labels[idx].name = options.column.fields[idx].field;
                    options.column.labels[idx].direction = options.column.fields[idx].dir.toLowerCase() === 'asc'? 'ascending':'descending';
                });
            } else {
                options.column.fieldName = options.column.fields[0].field;
                options.column.direction = options.column.fields[0].dir.toLowerCase() === 'asc'? 'ascending':'descending';
            }
        }

        if (options.row) {
            if (options.method.toLowerCase() === 'title') {
                $.each(options.row.fields, function (idx) {
                    options.row.labels[idx].name = options.row.fields[idx].field;
                    options.row.labels[idx].direction = options.row.fields[idx].dir.toLowerCase() === 'asc'? 'ascending':'descending';
                });
            } else {
                options.row.fieldName = options.row.fields[0].field;
                options.row.direction = options.row.fields[0].dir.toLowerCase() === 'asc'? 'ascending':'descending';
            }
        }

        self._pivot.sort(options);
    };
    /**
     * 피벗 그리드 필터
     * @param options 필터 사용할 항목 및 옵션
     */
    PivotGrid.prototype.setFilter = function (options) {
        var self = this,
            opt = options;

        if (opt.fields) {
            opt.conditions = opt.fields;
            for (var i = 0; i < opt.conditions.length; i++) {
                opt.conditions[i].name = opt.conditions[i].field;
            }

            self._pivot.filter(opt);
        }
    };
    /**
     * 피벗그리드 focus 설정
     */
    PivotGrid.prototype.focus = function () {
        var self = this;

        self.focused = true;
        self.$element.focus();
    };
    /**
     * 피벗그리드 이벤트 등록
     */
    PivotGrid.prototype.on = function () {
        var self = this;

        self.$element.on.apply(self.$element, arguments);
    };
    /**
     * 피벗그리드 이벤트 제거
     */
    PivotGrid.prototype.off = function () {
        var self = this;

        self.$element.off.apply(self.$element, arguments);
    };
    /**
     * 피벗그리드 이벤트 정의
     * @private
     */
    PivotGrid.prototype._bindEvent = function () {
        var self = this;
    };

    dews = $.extend(true, dews, {
        ui: {
            /**
             * 트리 그리드 컨트롤을 생성합니다.
             *
             * @param {jQuery|String} selector 트리 그리드 생성 대상
             * @param {Object} [options] 트리 그리드 옵션
             */
            pivotgrid: function (selector, options) {
                var $el, pivotGrid, $content;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    if (dews.ui.dialogPage) {
                        $content = dews.ui.dialogPage.$content;
                    } else if (dews.ui.page) {
                        $content = dews.ui.page.$content;
                    } else {
                        $content = $(document);
                    }

                    $el = $(selector, $content);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var pivot, $this = $(this);

                    pivot = $this.data('dews-control');

                    if (!pivot) {
                        if ($.type(options) === 'undefined') {
                            options = {};
                        }

                        RealGridJS.setRootContext(dews._environments.scriptBase+'realgrid');
                        pivot = new PivotGrid($el, options);
                        $this.data('dews-control', pivot);
                    }

                    pivotGrid = pivot;
                });

                return pivotGrid;
            }
        }
    });
})(jQuery, window.dews);


/*
 * 패널바
 */
(function ($, dews, kendo) {

    var PopupItem = function (element, parent) {
        var self = this;

        self.element = $(element);
        self.parent = parent;

        return self;
    };

    PopupItem.prototype.select = function () {
        var self = this;

        self.parent.panel.find(">.dews-popup-item").css('display', 'none');
        for (var i =0; i < self.parent.items.length; i+=1) {
            if (self.element === self.parent.items[0].element) {
                self.parent.panel.find('.previous-arrow').addClass('disabled');
                self.parent.panel.find('.previous-arrow').attr('disabled', 'disabled');
            } else {
                self.parent.panel.find('.previous-arrow').removeClass('disabled');
                self.parent.panel.find('.previous-arrow').attr('disabled', false);
            }

            if (self.element === self.parent.items[self.parent.items.length-1].element) {
                self.parent.panel.find('.next-arrow').addClass('disabled');
                self.parent.panel.find('.next-arrow').attr('disabled', 'disabled');
            } else {
                self.parent.panel.find('.next-arrow').removeClass('disabled');
                self.parent.panel.find('.next-arrow').attr('disabled', false);
            }
        }
        self.element.css('display', 'block');

        // 패널 아이템 내부에 그리드가 있을 경우 사이즈 재조정, 그리드 생성 이전에는 로직 타지 않음
        if (self.element.find('> .dews-ui-grid canvas')[0]) {
            var grid = dews.ui.grid(self.element.find('> .dews-ui-grid'));
            grid._grid.resetSize();
        }
    };

    /*PopupItem.prototype.display = function (display) {
        var self = this;

        if (display === 'none') {
            self.element.css('display', 'none');
            self.element.addClass('display');
        } else {
            self.element.css('display', 'block');
            self.element.removeClass('display');
        }

        // 패널 아이템 내부에 그리드가 있을 경우 사이즈 재조정, 그리드 생성 이전에는 로직 타지 않음
        if (self.element.find('> .dews-ui-grid canvas')[0]) {
            var grid = dews.ui.grid(self.element.find('> .dews-ui-grid'));
            grid._grid.resetSize();
        }
    };*/

    function getOptions (opt, element) {
        var options,
            $element = $(element),
            defaultOptions = {
                visible: false,
                select: 0
            };

        options = $.extend(true, defaultOptions, opt);

        if ($element.data('dews-height')) {
            options.height = $element.data('dews-height');
            $element.css('height', $element.data('dews-height') + 'px');
        }

        return options;
    }

    function setStyle (panel) {
        var popup = panel, options = panel.options;

        if ($.type(options.height) !== 'undefined') {
            popup.panel.css('height', options.height + 'px');
        }

        if ($.type(options.select) === 'number') {
            popup.items[options.select].select();
        } else if ($.type(options.select) === 'string') {
            popup.items.getById(options.select).select();
        }

        if ($.type(options.visible) !== 'undefined') {
            if (options.visible) {
                popup.panel.css('display', 'block');
            } else {
                popup.panel.css('display', 'none');
            }
        }
    }

    var PopupPanel = function (el, opt) {
        var self = this, panel = el, option;

        self.panel = panel;
        option = getOptions(opt, panel);
        self.options = option;
        self.items = [];

        for (var j = 0; j < self.panel.find('>.dews-popup-item').not(".disabled").length; j+=1) {
            self.items.push(new PopupItem(self.panel.find('>.dews-popup-item').not(".disabled")[j], self));
        }

        self.items.getById = function (id) {
            var self = this;

            for (var i = 0; i < self.length; i+=1) {
                if (self[i].element.attr('ID') === id) {
                    return self[i];
                }
            }

            return null;
        };

        self._createArrowButton();
        self._createCloseButton();
        //self._bindEvent();

        if (self.items.length !== 0) {
            setStyle(self);
        }
    };

    PopupPanel.prototype._createCloseButton = function () {
        var self = this, button = $('<button class="dews-popup-close-button"></button>');

        self.panel.prepend(button);

        button.on('click', function () {
           self.hide();
        });
    };

    PopupPanel.prototype._createArrowButton = function () {
        var self = this,
            nextArrow = $('<button class="next-arrow dews-popup-arrow-button"></button>'),
            preArrow = $('<button class="previous-arrow dews-popup-arrow-button"></button>');

        self.panel.append(preArrow);
        self.panel.append(nextArrow);

        preArrow.on('click', function (e) {
            for (var i = 0; i < self.items.length; i+=1) {
                if (self.items[i].element.css('display') === 'block') {
                    self.items[i].element.css('display', 'none');
                    self.items[i-1].select();
                    break;
                }
                self.items[i].element.css('display', 'none');
            }
        });

        nextArrow.on('click', function (e) {
            for (var i = 0; i < self.items.length; i+=1) {
                if (self.items[i].element.css('display') === 'block') {
                    self.items[i].element.css('display', 'none');
                    self.items[i+1].select();
                    break;
                }
                self.items[i].element.css('display', 'none');
            }
        });
    };

    /*PopupPanel.prototype._bindEvent = function () {
        var self = this;
        $(window).on('scroll', function () {
            self.panel.css('bottom', -$(this).scrollTop() + 'px');
        });
    };*/

    PopupPanel.prototype.show = function () {
        var self = this;
        self.panel.slideDown(300 ,'linear', function () {
            self.panel.css('display', 'block');
        });
    };

    PopupPanel.prototype.hide = function () {
        var self = this;
        var e = $.Event();
        if($.type(self.options.hide) === "function"){
            self.options.hide(e);
        }
        if(!e.isDefaultPrevented()){
            self.panel.slideUp(300, 'linear' , function () {
                self.panel.css('display', 'none');
            });
        }
    };

    PopupPanel.prototype.setOptions = function (opt) {
        var self = this, option;
        option = getOptions(opt, self.panel);
        self.options = option;
        setStyle(self);
    };

    $.extend(true, dews, {
        ui: {
            popuppanel: function (selector, options) {
                var $el,
                    popuppanel;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        panel;

                    panel = $this.data('dews-control');

                    if (!panel) {
                        if (!$this.hasClass('dews-ui-popup-panel')) {
                            $this.addClass('dews-ui-popup-panel');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        panel = new PopupPanel($el, options);
                        $this.data('dews-control', panel);
                    }

                    popuppanel = panel;
                });

                return popuppanel;
            }
        }
    });

    dews.ui.addControlInitializer('popuppanel', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.popuppanel($('div.dews-ui-popup-panel', $container));
    });
})(jQuery, window.dews, window.kendo);


/*
프로그래스바
 */
(function ($, dews, kendo) {

    var defaultOptions = {
        titlebar: false,
        textTemplate: '',
        alterTextTemplate: '',
        type: '',
        byte: false,
        cancelButton: false,
        modal: false,
        current: 0,
        autoClose: true,
        change: '',
        target: window.document.body
    };

    function getOptions (options) {
        var opt = {};

        opt = $.extend({}, defaultOptions, options);

        return opt;
    }

    var Progress = function (id, opt) {
        var self = this;

        self.id = id;
        self.opt = getOptions(opt);
        self.target = $(self.opt.target);
        self.element = null;
        self.container = null;
        self.modal = null;

        self._create();

        self._initEventListener();
    };

    Progress.prototype._create = function () {
        var self = this;

        self._createProgressBar();

        self._createContainer();

        self._createWrapper();

        self._createTextTemplate();

        self._createText();

        self._createAlterTextTemplate();

        self._createTitleBar();

        self._createCancelButton();

        if (self.opt.modal) {
            self.modal = $('<div/>').addClass('dews-progress-modal');
            $(window.document.body).after(self.modal);
        }

        if ($.type(self.opt.target) !== 'object') {
            $('#'+self.container.attr('id')+'.dews-progress-container').css({
                'left' : self.target.offset().left + (self.target.outerWidth()/2),
                'top' : self.target.offset().top+ (self.target.outerHeight()/2),
                'position' : 'absolute'
            });
        }
    };

    Progress.prototype._createProgressBar = function () {
        var self = this, progress, progressbar;

        progress = $('<div/>').addClass('dews-ui-progress').attr('id',self.id);

        if (self.opt.type === 'step') {
            progressbar = $('<ul/>').addClass('dews-progress-step');

            for(var i = 0; i < 39; i++) {
                progressbar.append($('<li/>').addClass('dews-progress-steps').addClass('default'));
            }
        } else {
            progressbar = $('<div/>').addClass('dews-progress-bar');
        }

        progress.insertAfter(self.target);
        progress.append(progressbar);

        self.element = progress;
    };

    Progress.prototype._createContainer = function () {
        var self = this, container;

        container = $('<div/>').addClass('dews-progress-container').attr('id',self.id+'_container');

        self.element.wrap(container);

        self.container = $('#'+container.attr('id'));

        if (self.opt.type === 'step') {
            self.container.addClass('dews-step');
        }
    };

    Progress.prototype._createWrapper = function () {
        var self = this, wrapper;

        wrapper = $('<div/>').addClass('dews-progress-wrapper').attr('id', self.id+'_wrapper');
        self.element.wrap(wrapper);
    };

    Progress.prototype._createTextTemplate = function () {
        var self = this, textTemplate;

        if (self.opt.textTemplate.length !== 0) {
            self.container.addClass('dews-text-template');
            textTemplate = $('<span/>').addClass('dews-progress-text-template');

            self._replaceText('textTemplate');

            textTemplate.html(self.opt.textTemplate);
            self.element.before(textTemplate);
            self.container.find('.dews-progress-text').remove();
        }
    };

    Progress.prototype._createAlterTextTemplate = function () {
        var self = this, alterTextTemplate;

        if (self.opt.alterTextTemplate.length !== 0 && self.opt.textTemplate.length !== 0) {
            alterTextTemplate = $('<span/>').addClass('dews-progress-alter-textTemplate');

            self._replaceText('alterTextTemplate');

            self.container.addClass('dews-text-template');
            alterTextTemplate.html(self.opt.alterTextTemplate);
            self.element.after(alterTextTemplate);
        }
    };

    Progress.prototype._createTitleBar = function () {
        var self = this, title, titleBar, closeButton, close;

        if (self.opt.titlebar) {
            titleBar = $('<div/>').addClass('dews-progress-titlebar');
            title = $('<span/>').addClass('dews-progress-titlebar-text').html(self.opt.titlebar.text);

            self.container.prepend(titleBar);
            titleBar.append(title);

            self.container.addClass('dews-titlebar');
            self.container.addClass('dews-text-template');

            if (self.opt.cancelButton) {
                close = $('<a type="button"/>').addClass('dews-progress-close');
                closeButton = $('<span/>').addClass('dews-progress-close-button');
                titleBar.append(close);
                close.append(closeButton);
            }
        }
    };

    Progress.prototype._createCancelButton = function () {
        var self = this, buttonGroup, button;

        if (self.opt.cancelButton) {
            buttonGroup = $('<div/>').addClass('dews-progress-button-group');
            button = $('<button type="button">취소</button>').addClass('dews-ui-button primary');

            self.container.append(buttonGroup);
            buttonGroup.append(button);

            self.container.addClass('dews-cancel-button');
        }
    };

    Progress.prototype._createText = function () {
        var self = this, text, percent;

        if (self.opt.textTemplate.length === 0) {
            text = $('<span/>').addClass('dews-progress-text');
            percent = $('<span/>').addClass('dews-progress-percent');

            self.element.after(text);
            text.append(percent);
            percent.html(self.opt.current + '%');
        }
    };

    Progress.prototype._replaceText = function (text) {
        var self = this, status = null;

        if (/#=\s*progress\s*/i.test(self.opt[text])) {
            if (self.opt.byte) {
                status = byteCalculation(self.opt.current) + '/' + byteCalculation(self.opt.total);
            } else {
                status = dews.number.format(self.opt.current, 'N') + '/' + dews.number.format(self.opt.total, 'N');
            }

            self.opt[text] = self.opt[text].replace(/#=\s*progress\s*#/i, '<span class="dews-progress-status">' + status + '</span>');
        }

        if (/#=\s*percent\s*/i.test(self.opt[text])) {
            self.opt[text] = self.opt[text].replace(/#=\s*percent\s*#/i, '<span class="dews-progress-percent">' + Math.round(self.opt.current / self.opt.total *100) + '%</span>');
        }
    };

    Progress.prototype.close = function () {
        var self = this;

        if (self.opt.modal) {
            self.modal.remove();
        }

        self.container.remove();
        self.element.removeData('dews-ui-control');
    };

    Progress.prototype.setTextTemplate = function (textTemplate) {
        var self = this;

        self.opt.textTemplate = textTemplate;

        if (self.container.find('.dews-progress-text-template').length === 0) {
            self._createTextTemplate();
        } else {
            self._replaceText('textTemplate');
            self.container.find('.dews-progress-text-template').html(self.opt.textTemplate);
        }
    };

    Progress.prototype.setAlterTextTemplate = function (alterTextTemplate) {
        var self = this;

        self.opt.alterTextTemplate = alterTextTemplate;

        if (self.container.find('.dews-progress-alter-textTemplate').length === 0) {
            self._createAlterTextTemplate();
        } else {
            self._replaceText('alterTextTemplate');
            self.container.find('.dews-progress-alter-textTemplate').html(self.opt.alterTextTemplate);
        }
    };

    Progress.prototype.setTitlebarText = function (title) {
        var self = this;

        self.opt.titlebar = {
            text : title
        };

        if (self.container.find('.dews-progress-titlebar').length === 0) {
            self._createTitleBar();
        } else {
            self.container.find('.dews-progress-titlebar-text').html(self.opt.titlebar.text);
        }
    };

    Progress.prototype.getTotal = function () {
        return this.opt.total;
    };

    Progress.prototype.getCurrent = function () {
        return this.opt.current;
    };

    Progress.prototype.setTotal = function (value) {
        this.opt.total = value;
    };

    Progress.prototype.setCurrent = function (value) {
        var self = this,
            percent;

        self.opt.current = value;

        if (!isFinite(self.opt.total)) {
            self.close();
            throw 'total 값을 설정하지 않습니다.';
        }

        if (self.opt.total <= 0) {
            self.close();
            throw 'total 값이 0 또는 음수가 될수는 없습니다.';
        }

        if (self.opt.current > self.opt.total) {
            self.opt.current = self.opt.total;
        }

        percent = self.opt.current * 100 / self.opt.total;

        if (self.opt.type === 'step') {
            self._updateStep(percent);
        } else {
            $('.dews-progress-bar', self.container).css({'width': Math.round(percent)+'%'});
        }

        if (self.opt.change.length !== 0) {
            self._triggerTextChange(percent);
        }

        $('.dews-progress-percent', self.container).html(Math.round(percent)+'%');

        if (self.opt.byte) {
            $('.dews-progress-status', self.container).html(byteCalculation(self.opt.current) + '/' + byteCalculation(self.opt.total));
        } else {
            $('.dews-progress-status', self.container).html(dews.number.format(self.opt.current,'N') + '/' + dews.number.format(self.opt.total,'N'));
        }

        if (percent === 100 && self.opt.autoClose) {
            setTimeout(function() { self.close(); }, 300);
        }
    };

    Progress.prototype._initEventListener = function () {
        var self = this;

        $('.dews-progress-close', self.container).on('click', function () {
            self.close();
        });

        $('.dews-progress-button-group .dews-ui-button.primary', self.container).on('click',function () {
            self.close();
        });

        self.container.on('change', function (e) {
            if (e.current <= self.opt.current) {
                self.opt.mainText = e.text;
                self._replaceText('textTemplate');
                self.container.find('.dews-progress-text-template').html(self.opt.textTemplate);
            }
        });

        $('.dews-progress-titlebar', self.container).on('mousedown', function (ex) {
            document.onmousemove = function (e) {
                self.container.css({
                    'top': e.pageY + self.container.height()/2 - ex.offsetY,
                    'left': e.pageX + self.container.width()/2 - ex.offsetX
                });
            };

            $('.dews-progress-titlebar', self.container).bind('mouseup', function () {
                document.onmousemove = null;
            });
        });
    };

    Progress.prototype._triggerTextChange = function () {
        var self = this,
            event;

        event = new $.Event('change');

        self.opt.change.call(self, event);
        self.container.trigger(event);
    };

    function byteCalculation (value) {
        var byte = ['bytes', 'KB', 'MB', 'GB', 'TB', 'PB'],
            cal;

        if (value >=0 ) {
            cal = Math.floor(Math.log(value)/Math.log(1024));

            if (cal.toString() === '-Infinity') {
                return "0 "+byte[0];
            } else {
                if (byte[cal] === byte[0]) {
                    return dews.number.format((value/Math.pow(1024, Math.floor(cal))),'N') + " " +byte[cal];
                } else {
                    return dews.number.format((value/Math.pow(1024, Math.floor(cal))),'N2') + " " +byte[cal];
                }
            }
        }
    }


    Progress.prototype._updateStep = function (percent) {
        var self = this,
            percentStep =  parseInt((100 / 39) * 100, 10) / 100,
            completeStepCount = Math.floor(percent/ percentStep),
            completeStep = self.element.find('li.dews-progress-steps:lt(' + completeStepCount +')');

        completeStep.removeClass('default').addClass('select');
    };

    $.extend(true, dews, {
        ui: {
            progress: function (id, options) {
                var progress,
                    $element;

                if (!id) {
                    throw '프로그래스바의 ID가 지정되지 않았습니다.';
                }

                $element = $('#' + id);

                if ($element.length === 0) {
                    progress = new Progress(id, options);

                    progress.element.data('dews-control', progress);
                } else {
                    progress = $element.data('dews-control');

                    if (!progress) {
                        throw '\'' + id + '\' 는 프로그래스바의 ID가 아닙니다.';
                    }
                }
                return progress;
            }
        }
    });
})(jQuery, window.dews, window.kendo);


/*
 * QR코드
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        encoding: 'utf-8'
    };

    /**
     * QR코드 생성을 위한 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @param {object} srcOptions 소스코드에서 전달된 옵션
     * @returns {object} 옵션
     */
    function getOptions($el, srcOptions) {
        var inlineOptions, options = {};

        inlineOptions = getInlineOptions($el);

        $.extend(true, options, defaultOptions, inlineOptions, srcOptions);

        return options;
    }

    /**
     * HTML 코드 상에 설정된 옵션 정보를 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 옵션
     */
    function getInlineOptions($el) {
        var options = {},
            size,
            color,
            value,
            borderColor,
            borderWidth,
            padding;

        size = $el.data('dews-size');
        color = $el.data('dews-color');
        value = $el.data('dews-value');
        borderColor = $el.data('dews-border-color');
        borderWidth = $el.data('dews-border-width');
        padding = $el.data('dews-padding');

        if (size) {
            options.size = parseInt(size, 10);
        }
        if (color) {
            options.color = color;
        }
        if (value) {
            options.value = value;
        }
        if (borderColor || borderWidth) {
            options.border = {};
            if (borderColor) {
                options.border.color = borderColor;
            }
            if (borderWidth) {
                options.border.width = parseInt(borderWidth, 10);
            }
        }
        if (padding) {
            options.padding = parseInt(padding, 10);
        }

        return options;
    }

    $.extend(true, dews, {
        ui: {
            qrcode: function (selector, options) {
                var $ctl, qrcode;

                if (selector instanceof jQuery) {
                    $ctl = selector;
                } else if ($.type(selector) === 'string') {
                    $ctl = $(selector);
                } else {
                    throw 'QR코드를 생성할 대상이 제공되지 않았습니다.';
                }

                $ctl.each(function () {
                    var $this = $(this),
                        opt;

                    qrcode = $this.data('dews-control');

                    if (!qrcode) {
                        opt = getOptions($this, options);

                        $this.kendoQRCode(opt);

                        if (!$this.hasClass('dews-ui-qrcode')) {
                            $this.addClass('dews-ui-qrcode');
                        }
                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        qrcode = $this.data('kendoQRCode');

                        $this.data('dews-control', qrcode);
                    }
                });

                return qrcode;
            }
        }
    });

    dews.ui.addControlInitializer('qrcode', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.qrcode($('span.dews-ui-qrcode', $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 라디오 버튼
 */
(function ($, dews, kendo) {

    function RadioButton(selector){
        var self = this;
        self.target = selector;

        self._createLabel();

        self._setClass();
    }

    RadioButton.prototype._setClass = function(){
        var self = this,
            $this = self.target;


        if (!$this.hasClass('dews-control')) {
            $this.addClass('dews-control');
        }

        if (!$this.hasClass('dews-ui-radio')) {
            $this.addClass('dews-ui-radio');
        }

        if (!$this.hasClass('k-radio')) {
            $this.addClass('k-radio');
        }

        if (!$this.hasClass('dews-control-activate')) {
            $this.addClass('dews-control-activate');
        }

    };

    RadioButton.prototype._createLabel = function(){
        var self = this,
            $label = $('<label class="dews-radio-label k-radio-label"></label>');
        var $textLabel;

        self.target.wrap('<span class="dews-radio-wrapper"/>');
        self.target.after($label);

        $textLabel = self.target.parent().siblings('label[for='+self.target.attr('id') + ']');
        if($textLabel[0] && $textLabel.data('dews-localize-key')) {
            $textLabel.text(dews.localize.get($textLabel.text(), $textLabel.data('dews-localize-key'), $textLabel.data('dews-localize-lang') || null));
        }

        $label.on('click', function () {
            self.target.click();
        });
    };

    RadioButton.prototype.focus = function(){
        var self = this;

        self.target.focus();
    };

    RadioButton.prototype.on = function() {
        var self = this;

        self.target.on.apply(self.target, arguments);
    };

    RadioButton.prototype.off = function() {
        var self = this;

        self.target.off.apply(self.target, arguments);
    };

    RadioButton.prototype.applyPanelFocus = function() {
        var self = this, $element = $(self.target);

        $element.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    RadioButton.prototype.focus = function() {
        var self = this, $element = $(self.target);

        $element.focus();
    };

    RadioButton.prototype.canFocusable = function() {
        var self = this, $element = $(self.target);

        return $element.is(':enabled') && $element.is(':visible');
    };

    /**
     * 라디오버튼 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    RadioButton.prototype._getPrintData = function () {
        var self = this,
            $el = $(self.target),
            radioLabel = $el.closest('.dews-radio-wrapper').next()[0] === undefined ? '' : $el.closest('.dews-radio-wrapper').next()[0].tagName,
            data;

        if ($el.is(':checked')) {
            data = {
                id: $el.attr('id'),
                text: radioLabel.toLowerCase() === 'label' ? $el.closest('.dews-radio-wrapper').next().text() : ''
            }
        }

        return data;
    };

    $.extend(true, dews, {
        ui: {
            /**
             * 라디오버튼을 생성하거나 가져옵니다.
             * @param {string|jQuery} selector 요소를 지정하는 셀렉터 또는 jQuery 객체입니다.
             */
            radio: function (selector) {
                var $el,rdo;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                $el.each(function () {
                    var $this = $(this),
                        rdoBtn;

                    rdoBtn = $this.data('dews-control');

                    if(!rdoBtn){
                        rdoBtn = new RadioButton($this);
                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }
                        $this.data('dews-control',rdoBtn);
                    }

                    rdo = rdoBtn;
                });

                return rdo;
            }
        }
    });

    dews.ui.addControlInitializer('radio', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.radio($("input[type='radio'].dews-ui-radio", $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 라디오 버튼 그룹
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        align: "horizontal"
    };

    /**
     * 설정 값을  가져옵니다.
     * @param $el 대상 jQuery 요소
     * @param opt 라디오그룹 옵션
     * @returns {{object}} 옵션
     */
    function getOptions($el, opt) {
        var $element = $el,
            options = {},
            inlineOptions = {};

        if ($element.data('dews-align') && $element.data('dews-align') === 'vertical') {
            inlineOptions.align = "vertical";
        }

        options = $.extend(true, options, defaultOptions, inlineOptions, opt);

        return options;
    }

    /**
     * 라디오그룹 객체
     * @param $el 라디오그룹 생성 대상 요소
     * @param opt 라디오그룹 옵션
     * @constructor
     */
    function RadioGroup($el, opt) {
        var self = this, options;

        options = getOptions($el, opt);

        self._element = $el;
        self.items = [];
        self.options = options;

        self._initRadioGroup();
    }

    /**
     * 라디오그룹을 초기화합니다.
     * @private
     */
    RadioGroup.prototype._initRadioGroup = function () {
        var self = this;
        var $el = self._element;

        if (!$el.hasClass('dews-control')) {
            $el.addClass('dews-control');
        }
        if (!$el.hasClass('dews-ui-radio-group')) {
            $el.addClass('dews-ui-radio-group');
        }
        if (!$el.hasClass('dews-control-activate')) {
            $el.addClass('dews-control-activate');
        }

        // wrapper 생성
        var $wrapper = $("<span/>").addClass("dews-radio-group-wrapper");

        $el.wrap($wrapper);
        self._wrapper = $el.parent();

        if (self.options.align === "vertical") {
            self._wrapper.addClass("vertical");
        }

        // 라디오버튼 생성
        var radioName = self._element.attr("id");
        $el.find('option').each(function (index, item) {
            var radioButtonItem;
            radioButtonItem = new RadioGroupItem(item, radioName, self);

            self.items.push(radioButtonItem);
            self._wrapper.append(radioButtonItem._inputItem);
        });

        if (self._element.attr("disabled")) {
            self.disable(true);
        }

        self.setUserGuideAPI();
    };

    /**
     * 라디오그룹아이템 객체
     * @param item 라디오그룹 아이템 객체 생성 대상 요소
     * @param buttonName 라디오그룹 아이템 공통 name
     * @param radioGroup 라디오그룹 객체
     * @returns {RadioGroupItem} 라디오그룹 아이템 객체
     * @constructor
     */
    function RadioGroupItem(item, buttonName, radioGroup) {
        var self = this;
        var radioButton;
        self.radiogroup = radioGroup;
        self.buttonName = buttonName;

        radioButton = self._initRadioItem(item);
        self._optionItem = $(item);
        self._inputItem = radioButton;

        self._bindEvent();

        return self;
    }

    /**
     * 라디오그룹 아이템을 초기화합니다
     * @param item 라디오그룹 아이템 객체 대상 요소
     * @returns {*}
     * @private
     */
    RadioGroupItem.prototype._initRadioItem = function (item) {
        var self = this;
        var $radioButtonInput, $radioButton;

        var disabledOption = false;
        var selectedOption = false;
        var labelText = item.innerText;

        if ($(item).attr("disabled") || $(item).attr("disabled") === true) {
            disabledOption = true;
        }

        if ($(item).attr("selected") || $(item).attr("selected") === true) {
            selectedOption = true;
            $(item).attr("selected", true);
            self.radiogroup.checkedButton = item;
        }

        if ($(item).data('dews-localize-key')) {
            labelText = dews.localize.get(item.innerText, $(item).data('dews-localize-key'), $(item).data('dews-localize-lang') || null);
        }

        $radioButtonInput = $('<input type="radio"/>').attr({
            name: self.buttonName,
            value: $(item).attr('value'),
            disabled: disabledOption,
            checked: selectedOption
        });
        $radioButton = $('<label>').addClass('dews-radio-group-item').append($radioButtonInput, '<span/>' + '<span>' + labelText + '</span>');

        return $radioButton;
    };

    /**
     * 라디오그룹 아이템의 event를 등록합니다.
     * @private
     */
    RadioGroupItem.prototype._bindEvent = function () {
        var self = this;
        var itemValue;
        var $radioGroup = self.radiogroup._element;
        var $wrapper = self.radiogroup._wrapper;

        self._inputItem.children('input').on('click', function (e) {
            if (self._inputItem.children().attr("disabled")) {
                return;
            }
            itemValue = self._inputItem.children().attr("value");
            $radioGroup.find("option[value=" + itemValue + "]").attr("selected", true);

            if (self.radiogroup.checkedButton && itemValue !== self.radiogroup.checkedButton.value) {
                $radioGroup.find("option[value=" + self.radiogroup.checkedButton.value + "]").attr("selected", false);
                $wrapper.find("input[value=" + self.radiogroup.checkedButton.value + "]").attr("checked", false);
            }
            self.radiogroup.checkedButton = $radioGroup.find("option[value=" + itemValue + "]")[0];
            self._inputItem.trigger('_change');
        });
    };

    /**
     * 라디오버튼 그룹 버튼 아이템 추가합니다.
     * @param value 생성할 버튼 아이템의 value 설정 값
     * @param text 생성할 버튼 아이템의 text 설정 값
     */
    RadioGroup.prototype.add = function (value, text) {
        var self = this;
        var $el = self._element;
        var $wrapper = self._wrapper;
        var addButton;

        if ($.type(value) === "string" && text) {
            var addObject = $("<option value=" + value + ">" + text + "</option>");
            var buttonName = $wrapper.find('.dews-ui-radio-group').attr('id');

            addButton = new RadioGroupItem(addObject[0], buttonName, self);
        }

        if ($.type(value) === "object") {
            addButton = value;
        }
        self.items.push(addButton);

        $el.append(addButton._optionItem);
        $wrapper.append(addButton._inputItem);
    };

    /**
     * 라디오버튼 그룹 버튼 아이템 추가합니다.
     * @param index 생성할 버튼 아이템이 입력될 위치
     * @param value 생성할 버튼 아이템의 value 설정 값
     * @param text 생성할 버튼 아이템의 text 설정 값
     */
    RadioGroup.prototype.insert = function (index, value, text) {
        var self = this;
        var $el = self._element;
        var $wrapper = self._wrapper;
        var insertButton;

        if (!index) {
            return
        }

        if ($.type(value) === "string" && text) {
            var insertObject = $("<option value=" + value + ">" + text + "</option>");
            var buttonName = $wrapper.find(".dews-ui-radio-group").attr("id");

            insertButton = new RadioGroupItem(insertObject[0], buttonName, self);
        }

        if ($.type(value) === "object" && !text) {
            insertButton = value;
        }

        self.items.splice(index, 0, insertButton);

        insertButton._optionItem.insertBefore($el.find("option")[index]);
        insertButton._inputItem.insertBefore($wrapper.find(".dews-radio-group-item")[index]);
    };

    /**
     * 라디오그룹 아이템 삭제합니다.
     * @param value 삭제할 버튼 아이템의 위치
     */
    RadioGroup.prototype.remove = function (value) {
        var self = this;

        if ($.type(value) === "number") {
            self.items[value].remove();
        }

        if ($.type(value) === "object") {
            var $items = $(self.items);
            $items.each(function (index, item) {
                if (item === value) {
                    item.remove();
                }
            });
        }
    };

    /**
     * 라디오그룹 내 value에 해당하는 item 객체를 가져옵니다.
     * @param value 조회할 item 객체의 value 값
     * @returns {object} 라디오그룹 아이템 객체
     */
    RadioGroup.prototype.getByValue = function (value) {
        var self = this;
        var $el = self._element;
        var $resultItem;

        $el.find("option").each(function (index, item) {
            var $item = $(item);
            if ($item.attr("value") === value) {
                $resultItem = $item;
            }
        });

        return $resultItem;
    };

    /**
     * 라디오그룹 내 선택된 아이템의 value 값을 조회하거나 설정합니다.
     * @param value 선택된 버튼 아이템에 설정할 value 값
     * @returns {string} 선택된 버튼 아이템의 value 값
     */
    RadioGroup.prototype.value = function (value) {
        var self = this;
        var $el = self._element;
        var $wrapper = self._wrapper;
        var resultItem;

        if ($.type(value) === 'undefined') {
            $el.find("option").each(function (index, item) {
                if ($(item).attr("selected") === "selected") {
                    resultItem = $(item).attr("value");
                }
            });
            return resultItem;
        } else {
            $el.find("option:selected").attr("value", value);
            $wrapper.find("input:checked").attr("value", value);
        }
    };


    /**
     * 라디오그룹 내 아이템을 선택합니다.
     * @param index 선택할 아이템의 index 값
     */
    RadioGroup.prototype.select = function (value) {
        var self = this;

        if ($.type(value) === 'string') {
            for (var i = 0; i < self.items.length; i++) {
                if (self.items[i].value() === value) {
                    self.items[i].select();
                }
            }
        } else if ($.type(value) === 'number') {
            if (self.items.length > value) {
                self.items[value].select();
            }
        }
    };

    /**
     * 라디오그룹의 disabled 여부를 조회하거나 설정합니다.
     * @param boolean disabled를 설정할 boolean 값
     * @returns {boolean} 라디오그룹의 disabled 여부
     */
    RadioGroup.prototype.disable = function (boolean) {
        var self = this;
        var $items = $(self.items);

        if ($.type(boolean) === "undefined") {
            return self._element.attr("disabled");
        }

        if ($.type(boolean) === "boolean") {
            self._element.attr("disabled", boolean);
            $items.each(function (index, item) {
                item.disable(boolean);
            })
        }
    };

    /**
     * 라디오그룹 on 이벤트 등록합니다.
     */
    RadioGroup.prototype.on = function () {
        var self = this;
        var $wrapper = self._wrapper;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $wrapper.on.apply($wrapper, arguments);
    };

    RadioGroup.prototype.off = function () {
        var self = this;
        var $wrapper = self._wrapper;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $wrapper.off.apply($wrapper, arguments);
    };

    RadioGroup.prototype.bindFromPanel = function (data) {
        var self = this, $element = self._element;
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                var $items = $(self.items);

                $items.each(function (index, item) {
                    if (item._optionItem.attr("value") === data[column]) {
                        item._optionItem.attr("selected", true);
                        self.checkedButton = item._optionItem[0];
                    }
                    if (item._inputItem.children().attr("value") === data[column]) {
                        item._inputItem.children().attr("checked", true);
                    }
                });
            }
        }
    };

    RadioGroup.prototype.serializeForPanel = function () {
        var self = this, $element = self._element;
        var column;
        var data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = "";

            $element.find("option").each(function (index, item) {
                if ($(item).attr("selected")) {
                    data[column] = $element.find('option:selected').attr("value");
                }
            });
        }
        return data;
    };

    RadioGroup.prototype.applyPanelFocus = function () {
        var self = this, $element = self._element;

        $element.parent().on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    RadioGroup.prototype.focus = function () {
        var self = this, $element = self._element;
        $element.parent().find("input:checked").focus();
    };

    RadioGroup.prototype.canFocusable = function () {
        var self = this, $element = self._element;
        return $element.is(':enabled') && $element.closest('.dews-radio-group-wrapper').is(':visible');
    };

    RadioGroup.prototype.setUserGuideAPI = function () {
        var self = this, $element = self._element;
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    };

    /**
     * 라디오그룹 아이템 객체를 삭제합니다.
     */
    RadioGroupItem.prototype.remove = function () {
        var self = this;

        self._optionItem.remove();
        self._inputItem.remove();

        var items = self.radiogroup.items;

        $(items).each(function (index, item) {
            if (item === self) {
                items.splice(index, 1);
            }
        });
    };

    /**
     * 라디오그룹 아이템 객체를 선택합니다.
     */
    RadioGroupItem.prototype.select = function () {
        var self = this;

        self._inputItem.children('input').trigger('click');
    };

    /**
     * 라디오그룹 아이템 객체를 비활성화시킵니다.
     * @param boolean 비활성화 유무 값
     */
    RadioGroupItem.prototype.disable = function (boolean) {
        var self = this;

        if ($.type(boolean) === "undefined") {
            return self._optionItem.attr("disabled");
        }
        if ($.type(boolean) === "boolean") {
            if (boolean) {
                self._inputItem.addClass("disabled");
            } else {
                self._inputItem.removeClass("disabled");
            }
            self._optionItem.attr("disabled", boolean);
            self._inputItem.children().attr("disabled", boolean);
        }
    };

    /**
     * 라디오그룹 아이템의 value 값을 조회하거나 설정합니다.
     * @param value 아이템에 설정할 value 값
     */
    RadioGroupItem.prototype.value = function (value) {
        var self = this;

        if ($.type(value) === "undefined") {
            return self._optionItem.context.value;
        } else {
            self._optionItem.attr("value", value);
            self._inputItem.children().attr("value", value);
        }
    };

    /**
     * 라디오그룹 아이템의 text 값을 조회하거나 설정합니다.
     * @param value 아이템에 설정할 text 값
     */
    RadioGroupItem.prototype.text = function (text) {
        var self = this;

        if ($.type(text) === "undefined") {
            return self._optionItem.text();
        } else {
            self._optionItem.text(text);
            self._inputItem.find("span:last-child").text(text);
        }
    };

    /**
     * 기간피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    RadioGroup.prototype._getPrintData = function () {
        var self = this,
            $el = self._element,
            data;

        if (self.getByValue(self.value()).text()) {
            data = {
                id: $el.attr('id'),
                text: self.getByValue(self.value()).text()
            }
        }

        return data;
    };

    $.extend(true, dews, {
        ui: {
            /**
             * 라디오그룹을 생성하거나 가져옵니다
             * @param {string|jQuery} selector 요소를 지정하는 셀렉터 또는 jQuery 객체입니다.
             * @returns {*}
             */
            radiogroup: function (selector, options) {
                var $el, radiogroup;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                $el.each(function () {
                    var $this = $(this),
                        radiobuttongroup;

                    radiobuttongroup = $this.data('dews-control');

                    if (!radiobuttongroup) {
                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        radiobuttongroup = new RadioGroup($this, options);
                        $this.data('dews-control', radiobuttongroup);
                    }
                    radiogroup = radiobuttongroup;
                });
                return radiogroup;
            }
        }
    });

    dews.ui.addControlInitializer('radiogroup', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.radiogroup($("select.dews-ui-radio-group", $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 참고 박스
 */
(function ($, dews) {
    var defaultOptions = {
        title : "",
        button : false,
        closed : false
    };

    function getOptions($el) {
        var $element = $el,
            options = {
                title : $element.data('dews-title') || defaultOptions.title,
                button : $element.data('dews-button') || defaultOptions.button,
                closed : $element.data('dews-closed') || defaultOptions.closed
            };

        return options;
    }

    /**
     * 참고박스를 생성합니다.
     * @constructor
     */
    var ReferBox = function ($element) {
        var self = this;
        var options;

        options = getOptions($element);

        self.target = $element;
        self.options = options;

        if (self.options.title) {
            self._createTitle();
            self._createBtn();
            self._initEventListener();
        } else if (self.target.find('>dl').is(':only-child')) {             // 지원 중단 시 제거 조건
            self._createDtBtn();
            self._initEventListener();
        } else {
            self.target.addClass('no-title');
        }
    };

    // dt 선언 중단시 삭제 함수
    ReferBox.prototype._createDtBtn = function () {
        var self = this,
            $titleElement = self.target.find('dt');

        if($titleElement.length){
            if(!self.target.hasClass('no-button')){
                $titleElement.append('<button type="button"></button>');
            }
        }
    };

    /**
     * 타이틀을 생성합니다.
     * @private
     */
    ReferBox.prototype._createTitle = function () {
        var self = this;
        var $titleElement = $('<div></div>').addClass('dews-referbox-title');
        var titleText = self.options.title;

        if(self.target.data('dews-localize-key')) {
            titleText = dews.localize.get(titleText, self.target.data('dews-localize-key'), self.target.data('dews-localize-lang') || null);
        }

        $titleElement.text(titleText);

        self.target.wrapInner('<div class="dews-referbox-content">');
        self.target.prepend($titleElement);
    };

    /**
     * 타이틀에 버튼을 생성합니다.
     * @private
     */
    ReferBox.prototype._createBtn = function(){
        var self = this,
            $titleElement = self.target.find('.dews-referbox-title');

        if($titleElement.length){
            if(self.options.button) {
                $titleElement.append('<button type="button"></button>');
                self.target.find('.dews-referbox-content').addClass('folding');
                if(self.options.closed) {
                    self.target.addClass('closed');
                }
            }
        }
    };

    /**
     * 버튼에 열림닫힘 이벤트를 설정합니다.
     * @private
     */
    ReferBox.prototype._initEventListener = function(){
        var self = this;

        self.target.find('button').first().on('click', function(){
            self.target.toggleClass('closed');
        });
    };

    dews = $.extend(true, dews, {
        ui: {
            referbox : function(selector){
                var $control, box;

                if (selector instanceof jQuery) {
                    $control = selector;
                } else if ($.type(selector) === "string") {
                    $control = $(selector);
                } else {
                    throw "대상이 지정되지 않았습니다.";
                }

                $control.each(function () {
                    var $this = $(this),
                        referbox;

                    referbox = $this.data('dews-control');

                    if (!referbox) {
                        referbox = new ReferBox($this);
                        $this.data('dews-control', referbox);

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }
                    }

                    box = referbox;
                });
                return box;
            }
        }
    });

    dews.ui.addControlInitializer('referbox', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.referbox($('.dews-ui-referbox', $container));
    });
})(jQuery, window.dews || {});


/*
 * 필수툴팁
 */
(function ($, dews) {

    function RequiredTooltip($el, options) {
        var self = this;

        self.target = $el;
        self.options = options;
        self.tooltip = null;
    }

    RequiredTooltip.prototype._create = function () {
        var self = this, tooltip;

        // 필수 툴팁 텍스트 옵션 전달
        tooltip = dews.ui.tooltip.show(self.target, {
            type: 'required',
            text: self.options
        });

        // requiredTooltip이 있는 위치로 스크롤해준다.
        /*$('html,body').animate({scrollTop: self.target.offset().top-100}, 100);*/

        self.tooltip = tooltip;
    };

    //requiredTooltip이 존재하는 경우 삭제해준다.
    RequiredTooltip.prototype._delete = function () {
      var self = this;

      self.tooltip._delete();
    };

    dews = $.extend(true, dews, {
        ui: {
            requiredTooltip: {
                show:function (selector, options) {

                    var $el, tooltip;

                    if (selector instanceof jQuery) {
                        $el = selector;
                    } else if ($.type(selector) === "string") {
                        $el = $(selector);
                    } else {
                        throw "대상이 지정되지 않았습니다.";
                    }

                    $el.each(function (){
                        var $this = $(this);

                        tooltip = $this.data('dews-ui-requiredTooltip');
                        if(tooltip) {
                            tooltip._delete();
                        }

                        tooltip = new RequiredTooltip($this, options);
                        tooltip._create();

                        if(!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-ui-requiredTooltip', tooltip);

                    });

                    return tooltip;
                }
            }
        }
    });

})(jQuery, window.dews || {});


/*
 * 심플 페이저
 * 페이징 기능을 이용하는 그리드 및 리스트를 위한 페이저 컨트롤
 * 데이터 소스와 연동으로 페이징하는 것이 아닌 UI 요소를 그려주는 역할만 수행
 */
(function ($, dews) {

    var defaultOptions= {
        total: 1,
        current: 1,
        buttonCount: 10
    };

    /**
     * 기본 옵션과 HTML 코드에 지정된 옵션, 자바스크립트 코드에서 지정된 옵션을 합쳐서 완전한 옵션을 만듭니다.
     * @param {jQuery} $element 대상 요소
     * @param {object} options 자바스크립트 코드
     * @returns {object} 병합된 옵션
     */
    function makeOptions($element, options) {
        var inlineOptions,
            combinedOptions;

        options = options || {};
        inlineOptions = getInlineOptions($element);
        combinedOptions = $.extend(true, {}, defaultOptions, inlineOptions, options);

        return combinedOptions;
    }

    /**
     * HTML 코드에 data 로 지정된 옵션을 가져온다.
     * @param {jQuery} $element 대상 요소
     * @returns {object} 옵션
     */
    function getInlineOptions($element) {
        var options = {},
            total, current, buttonCount;

        if ($element) {
            total = $element.data('dews-total');
            current = $element.data('dews-current');
            buttonCount = $element.data('dews-button-count');

            if (/^[0-9]+$/.test(total)) {
                // 숫자로만 구성되어 있다면 HTML 코드에 전체 페이지수를 직접 입력한 것이므로 Number 형식으로 변환
                total = parseInt(total, 10);
            }

            if (typeof total !== 'undefined') {
                options.total = total;
            }

            if (/^[0-9]+$/.test(current)) {
                // 현재 페이지가 설정되어 있다면 항상 숫자
                current = parseInt(current, 10);
                options.current = current;
            }

            if (/^[0-9]+$/.test(current)) {
                // 버튼 갯수가 설정되어 있다면 항상 숫자
                current = parseInt(buttonCount, 10);
                options.buttonCount = current;
            }
        }

        return options;
    }

    /**
     * 심플 페이저의 클래스
     * @param {jQuery} element 대상 요소
     * @param {object} [options] 옵션
     * @constructor
     */
    function SimplePager(element, options) {
        var self = this;

        self.options = makeOptions(element, options);
        self.element = element;
        self._total = self._getTotalPageCount();
        self._current = self.options.current;

        // 생성자에서 초기 설정할 이후에는 설정 페이지에는
        delete self.options.current;

        // 컨트롤 생성
        self._render();

        self.element.on('change', function (e) {
            // 페이지 변경 이벤트 발생 시 버튼 등의 UI 변경 처리
            var page = e.page,
                $selected;

            if (self.element.find('.dews-simplepager-' + page.toString()).length === 0) {
                self._render();
            } else {
                $selected = self.element.find('.dews-simplepager-selected');

                if ($selected.length > 0) {
                    $selected.removeClass('dews-simplepager-selected');
                }

                $selected = self.element.find('.dews-simplepager-' + page.toString());
                $selected.addClass('dews-simplepager-selected');
            }
        });
    }

    /**
     * 전체 페이지 갯수를 가져옵니다.
     * @private
     */
    SimplePager.prototype._getTotalPageCount = function () {
        var self = this,
            value = 1;

        switch ($.type(self.options.total)) {
            case 'number':
                value = self.options.total;
                break;
            case 'string':
                dews.ajax.data(self.options.total, {
                    async: false
                }).done(function (data) {
                    // AJAX 에서 받아온 데이터를 설정
                    value = data;
                }).fail(function () {
                    console.log('## dews.ui.simplepage : 전체 페이지를 가져올 수 없습니다. ##');
                });
                break;
            case 'function':
                value = self.options.total.call(self);
                break;
        }

        return value;
    };

    /**
     * 페이지 번호를 받아서 페이징을 시작 번호를 가져옵니다.
     * @param {number} [page] 현재 페이지 번호
     * @returns {number} 페이징의 시작 번호
     * @private
     */
    SimplePager.prototype._getStartNumber = function (page) {
        var self = this,
            displayCount = self.options.buttonCount,
            start;

        if (typeof page === 'undefined') {
            page = self._current;
        }

        start = Math.floor((page - 1) / displayCount) * displayCount + 1;

        return start;
    };

    /**
     * 페이지 번호를 받아와 페이징의 끝 번호를 가져옵니다.
     * @param {number} [page] 현재 페이지 번호
     * @returns {number} 페이징의 끝 번호
     * @private
     */
    SimplePager.prototype._getEndNumber = function (page) {
        var self = this,
            displayCount = self.options.buttonCount,
            end;

        if (typeof page === 'undefined') {
            page = self._current;
        }

        end = Math.floor((page - 1) / displayCount) * displayCount + displayCount;

        if (end > self._total) {
            end = self._total;
        }

        return end;
    };

    /**
     * 처음으로 버튼의 페이지 번호를 가져옵니다.
     * @returns {number} 첫 페이지의 번호
     * @private
     */
    SimplePager.prototype._getFirstNumber = function () {
        return 1;
    };

    /**
     * 이전 버튼의 페이지 번호를 가져옵니다.
     * @param {number} [page] 현재 페이지 번호
     * @returns {number} 이전 버튼의 페이지 번호
     * @private
     */
    SimplePager.prototype._getPreviousNumber = function (page) {
        var self = this,
            displayCount = self.options.buttonCount,
            prev;

        if (typeof page === 'undefined') {
            page = self._current;
        }

        prev = (Math.floor((page - 1) / displayCount) - 1) * displayCount + 1;

        if (prev <= 0) {
            prev = 1;
        }

        return prev;
    };

    /**
     * 다음 버튼의 페이지 번호를 가져옵니다.
     * @param {number} [page] 현재 페이지 번호
     * @returns {number} 다음 버튼의 페이지 번호
     * @private
     */
    SimplePager.prototype._getNextNumber = function (page) {
        var self = this,
            displayCount = self.options.buttonCount,
            next;

        if (typeof page === 'undefined') {
            page = self._current;
        }

        next = (Math.floor((page - 1) / displayCount) + 1) * displayCount + 1;

        if (next > self._total) {
            next = self._total;
        }

        return next;
    };

    /**
     * 마지막으로 버튼의 페이지 번호를 가져옵니다.
     * @returns {number} 마지막 페이지의 번호
     * @private
     */
    SimplePager.prototype._getLastNumber = function () {
        var self = this;

        return self._total;
    };

    /**
     * 현재 페이지의 번호를 설정합니다.
     * @param {number} page 페이지 번호
     */
    SimplePager.prototype.setPage = function (page) {
        var self = this;

        if ($.type(page) === 'number') {
            page = Math.floor(page);
        } else {
            page = parseInt(page, 10);
        }

        if (page <= 0) {
            page = 1;
        } else if (page > self._total) {
            page = self._total;
        }

        if (page !== self._current) {
            self._current = page;

            // 페이지 변경 이벤트 발생
            self._triggerPageChanged(self._current);
        }
    };

    /**
     * 현재 페이지 번호를 가져옵니다.
     * @returns {number} 현재 페이지 번호
     */
    SimplePager.prototype.getPage = function () {
        return this._current;
    };

    /**
     * 페이지가 변경되었다는 이벤트를 발생시킵니다.
     * @param page 변경된 페이지 번호
     * @private
     */
    SimplePager.prototype._triggerPageChanged = function (page) {
        var self = this,
            evt;

        evt = new $.Event('change', {
            page: page
        });

        dews.log(
            '## dews-ui-simplepager : change 이벤트 발생 ##\n' +
            'e.page: ' + evt.page.toString()
        );

        self.element.trigger(evt);
    };

    /**
     * 심플 페이저 컨트롤을 그립니다.
     * @private
     */
    SimplePager.prototype._render = function () {
        var self = this,
            pageItemTemplate = '<a href="{1}" class="dews-simplepager-button" title="{0}">{0}</a>',
            $first, $prev, $next, $last;

        self.element.empty();

        $first = $(dews.string.format(pageItemTemplate, dews.localize.get('dews_처음'), '#' + self._getFirstNumber()));
        $first.data('page', self._getFirstNumber());
        $first.addClass('dews-simplepager-image');
        $first.addClass('dews-simplepager-first');

        self.element.append($first);

        $prev = $(dews.string.format(pageItemTemplate, dews.localize.get('dews_이전'), '#' + self._getPreviousNumber()));
        $prev.data('page', self._getPreviousNumber());
        $prev.addClass('dews-simplepager-image');
        $prev.addClass('dews-simplepager-prev');

        self.element.append($prev);


        for (var i = self._getStartNumber(); i <= self._getEndNumber(); i++) {
            var $btn = $(dews.string.format(pageItemTemplate, i.toString(), '#' + i.toString()));
            $btn.data('page', i);
            $btn.addClass('dews-simplepager-' + i.toString());

            if (i === self._current) {
                $btn.addClass('dews-simplepager-selected');
            }

            self.element.append($btn);
        }

        $next = $(dews.string.format(pageItemTemplate, dews.localize.get('dews_다음'), '#' + self._getNextNumber()));
        $next.data('page', self._getNextNumber());
        $next.addClass('dews-simplepager-image');
        $next.addClass('dews-simplepager-next');

        self.element.append($next);

        $last = $(dews.string.format(pageItemTemplate, dews.localize.get('dews_마지막'), '#' + self._getLastNumber()));
        $last.data('page', self._getLastNumber());
        $last.addClass('dews-simplepager-image');
        $last.addClass('dews-simplepager-last');

        self.element.append($last);


        $('.dews-simplepager-button', self.element).on('click', function (e) {
            var $btn = $(this),
                page = $btn.data('page');

            self.setPage(page);

            e.preventDefault();
        });
    };

    /**
     * 옵션을 설정합니다.
     * @param {object} options 설정할 옵션
     */
    SimplePager.prototype.setOptions = function (options) {
        var self = this, current;

        if (options.hasOwnProperty('current')) {
            // 초기화 되고 난 이후에는 옵션에 현재 페이지를 관리하면 더욱 헤깔릴 수 있으므로 current 옵션을 제거한다.
            current = options.current;
            delete  options.current;
        }

        self.options = $.extend(true, self.options, options);

        if (options.hasOwnProperty('total')) {
            // 전체 페이지 갯수를 변경해준다.
            self._total = self._getTotalPageCount();
        }

        if (typeof(current) !== 'undefined') {
            self._current = current;
        }

        self._render();
    };

    /**
     * 옵션을 가져옵니다.
     */
    SimplePager.prototype.getOptions = function () {
        return this.options;
    };

    $.extend(true, dews, {
        ui: {
            /**
             * 지정한 요소를 페이저 컨트롤로 만들거나 가져옵니다.
             * @param {string|jQuery} selector 페이저로 만들 요소의 셀렉터 또는 jQuery 객체
             * @param {object} [options] 페이저 옵션
             */
            simplepager: function (selector, options) {
                var pager, obj;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this);

                    pager = $this.data('dews-control');

                    if (!pager) {
                        if (!$this.hasClass('dews-ui-simplepager')) {
                            $this.addClass('dews-ui-simplepager');
                        }

                        pager = new SimplePager($this, options);
                        $this.data('dews-control', pager);

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }
                    }
                });

                return pager;
            }
        }
    });

    dews.ui.addControlInitializer('simplepager', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.simplepager($('div.dews-ui-simplepager', $container));
    });

})(jQuery, dews || {});


/*
 * 슬라이더
 */
(function ($, dews, kendo) {
    var defaultOption = {
    };

    /**
     * 이벤트 핸들러를 on, off 를 사용하여 등록하고 해제할 수 있도록 설정합니다.
     * @param instance kendo 컴포넌트 인스턴스
     */
    function attachEventProxy(instance) {
        instance.on = function() {
            instance.bind.apply(instance, arguments);
        };
        instance.off = function() {
            instance.unbind.apply(instance, arguments);
        };
    }

    /**
     * 추가적인 작업을 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     * @param instance DEWS 컴포넌트 인스턴스
     */
    function setAdditionalAPI($element, instance) {
        instance.validate = function () {
            return $.isNumeric(instance.value());
        };

        instance.bindFromPanel = function(data) {
            var column;

            if (data) {

                column = $element.data('dews-bind-column') || $element.attr('id');

                if (column && data.hasOwnProperty(column)) {
                    instance.value(data[column]);
                }
            }
        };

        instance.serializeForPanel = function () {
            var column, data;

            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column) {
                data = {};
                data[column] = instance.value();
            }

            return data;
        };
    }

    $.extend(true, dews, {
        ui: {
            slider: function (selector, options) {
                var $el,
                    slider;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control,
                        opt;

                    control = $this.data("dews-control");

                    if (!control) {
                        opt = $.extend(true, {}, defaultOption, options);

                        if (!$this.hasClass("dews-ui-slider")) {
                            $this.addClass("dews-ui-slider");
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass("dews-control-activate");
                        }

                        $this.kendoSlider(opt);
                        control = $this.data('kendoSlider');

                        attachEventProxy(control);
                        setAdditionalAPI($this, control);

                        $this.data('dews-control', control);
                    }

                    slider = control;
                });

                return slider;
            }
        }
    });

    dews.ui.addControlInitializer('slider', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.slider($(".dews-ui-slider", $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 토스트 메세지
 */

(function ($, dews) {
    var SnackBar = function (type, text, ico) {
        var self = this;

        self.type = type;
        self.always = [];

        if ($.type(text) === 'undefined') {
            self.text = '';
        } else{
            self.text = text;
        }

        if ($.type(ico) === 'object') {
            if ($.type(ico.ico) === 'undefined') {
                self.ico = '';
            } else {
                self.ico = ico.ico;
            }

            if ($.type(ico.exposureTime) !== 'undefined') {
                self.exposureTime = parseFloat(ico.exposureTime);
            }
        } else {
            if ($.type(ico) === 'undefined') {
                self.ico = '';
            } else{
                self.ico = ico;
            }
        }

        self._createElement();
    };

    SnackBar.prototype._createElement = function () {
        var self = this,
            div = $('<div class="dews-ui-snackbar"></div>'),
            text = $('<div class="dews-snackbar-text">'+ self.text + '</div>');

        div.addClass(self.type.toLowerCase());

        if ($.type(self.ico) === 'boolean' && !self.ico) {
            div.addClass('no-icon');
        } else if ($.type(self.ico) === 'string'){
            var icon = '';
            switch (self.ico.toLowerCase()) {
                case 'ico1': case 'success':
                    icon = 'success-icon';
                    break;
                case 'ico2': case 'warning':
                    icon = 'warning-icon';
                    break;
                case 'ico3': case 'info':
                    icon = 'info-icon';
                    break;
                case 'ico4': case 'error':
                    icon = 'error-icon';
                    break;
                case 'ico5': case 'loading':
                    icon = 'loading-icon';
                    break;
            }
            div.addClass(icon);
        }

        if (!$(document.body).find('.dews-ui-snackbar')[0]) {
            if (self.type === 'loading') {
                var loading = $('<div class="dews-loading-img"></div>');
                div.append(loading);
            } else {
                var img = $('<div class="dews-snackbar-img"></div>');
                div.append(img);
            }

            div.append(text);
            $(document.body).append(div);
            self.element = div;
            self.element.css('margin-left', -self.element.width()/2+'px');
            self._show();
        }
    };

    SnackBar.prototype._show = function () {
        var self = this, exposureTime;

        if (self.type === 'ok' || self.type === 'info' || self.type === 'loading') {
            self.exposureTime ? exposureTime = parseFloat(self.exposureTime) : exposureTime = 1000;
        } else {
            self.exposureTime ? exposureTime = parseFloat(self.exposureTime) : exposureTime = 3000;
        }

        self.element.css('display', 'none');

        self.element.slideDown(300, 'linear', function () {
            self.element.css('display', 'block');
            setTimeout(function () {
                self._hide();
            }, exposureTime);
        });
    };

    SnackBar.prototype._hide = function () {
        var self = this;

        self.element.slideUp(300, 'linear' , function () {
            self.element.remove();

            if (self.always && $.isArray(self.always) && self.always.length > 0) {
                for(var idx = 0; idx < self.always.length; idx++) {
                    self.always[idx].call(self);
                }
            }
        });
    };

    SnackBar.prototype.done = function (fn) {
        var self = this;
        self.always.push(fn);
        return self;
    };

    dews = $.extend(true, dews, {
        ui: {
            snackbar: {
                ok:function (text, ico) {
                    var snackbar = new SnackBar('ok', text, ico);

                    return snackbar;
                },
                warning: function (text, ico) {
                    var snackbar = new SnackBar('warning', text, ico);

                    return snackbar;
                },
                error: function (text, ico) {
                    var snackbar = new SnackBar('error', text, ico);

                    return snackbar;
                },
                info: function (text, ico) {
                    var snackbar = new SnackBar('info', text, ico);

                    return snackbar;
                },
                loading: function (text, ico) {
                    var snackbar = new SnackBar('loading', text, ico);

                    return snackbar;
                }

            }
        }
    });
})(jQuery, window.dews || {});


/*
 * 스플리트 드롭다운 버튼
 */

(function ($, dews) {

    function ChildButton(element) {
        var self = this;

        self.element = $(element);
        self.id = element.id;

        return self;
    }

    ChildButton.prototype.text = function (text) {
        var self = this;

        if (typeof text !== 'undefined') {
            self.element[0].innerText = text;
        } else {
            return self.element[0].innerText;
        }
    };

    ChildButton.prototype.enable = function (value) {
        var self = this,
            state;

        state = !self.element.attr('disabled');

        if (typeof value !== 'undefined') {
            if (value === true) {
                self.element.removeClass('dews-state-disabled');
                self.element.attr('disabled', false);
            } else if(value === false) {
                self.element.addClass('dews-state-disabled');
                self.element.attr('disabled', 'disabled');
            }
            state = value;
        }

        return state;
    };

    ChildButton.prototype.on = function () {
        var self = this;

        self.element.on.apply(self.element, arguments);
    };

    ChildButton.prototype.off = function () {
        var self = this;

        self.element.off.apply(self.element, arguments);
    };

    function setElement($this, options) {
        var element = $this,
            opt = options;

        if (opt) {
            if (opt.button && opt.button.length !== 0) {
                for (var i = 0; i < opt.button.length; i++) {
                    var button = $('<button type="button" id="' + opt.button[i].id +'">').text(opt.button[i].text);

                    if (typeof opt.button[i].enable === 'function') {
                        button.attr('disabled', !opt.button[i].enable());
                    }

                    $(element).append(button);
                }
            }
        }

        return $(element);
    }

    var SplitButton = function (element, options) {
        var self = this;

        self.element = setElement(element, options);
        self.buttonDiv = $('<div class="dews-splitbutton-button"/>');
        self.listDiv = $('<div class="dews-splitbutton-list"/>');
        self.arrowWrapper = $('<span class="dews-splitbutton-arrow"/>');
        self.arrow = $('<span class="dews-splitbutton-arrow-icon"/>');
        self.button = [];
        self.buttons = [];
        self.position = 0;

        self._bindButton();
        self._initControl();
        self._bindEvent();

        self.buttons.getById = function (id) {
            var self = this;

            for (var i =0; i < self.length; i+=1) {
                if (self[i].id === id) {
                    return self[i];
                }
            }
            return null;
        };
    };

    SplitButton.prototype._initControl = function () {
        var self = this;

        if (self.element.attr('disabled') === 'disabled' || self.element.attr('disabled') === true) {
            self.element.addClass('dews-state-disabled');
            self.listDiv.find('button').attr('disabled', 'disabled');
        }

        self.element.find('button[disabled]').addClass('dews-state-disabled');
    };

    // 스플리트드롭다운버튼 구조 재조정
    SplitButton.prototype._bindButton = function () {
        var self = this;

        self.element.find('button').each(function () {
            self.button.push(this);
            self.buttons.push(new ChildButton(this));
        });

        self.element.empty();

        for (var i = 0; i < self.button.length; i++) {
            if (i === 0) {
                self.buttonDiv.append(self.button[i]);
                self.arrowWrapper.append(self.arrow);
                self.buttonDiv.append(self.arrowWrapper);
                self.element.append(self.buttonDiv);
            } else {
                self.listDiv.append(self.button[i]);
            }
        }

        $('body').append(self.listDiv);
    };

    /**
     * 스플리트버튼의 폰트 사이즈를 가져옵니다.(*생략시 default사이즈)
     * @private
     */
    SplitButton.prototype._getFontSize = function () {
        var self = this;

        if (self.element.hasClass('confirm')) {
            self.listDiv.addClass('confirm');
        } else if (self.element.hasClass('small')) {
            self.listDiv.addClass('small');
        }
    };

    SplitButton.prototype._setListPosition = function () {
        var self = this;
        //스플리트버튼의 위치
        var buttonX = self.element.offset().left;
        var buttonY = self.element.offset().top;
        var buttonHeight = self.element.height();
        var buttonWidth = self.element.width();
        var margin = self.listDiv.width() - buttonWidth;
        var zIndex = dews.ui.getDialogMaxZIndex();

        if (zIndex > parseInt(self.listDiv.css('zIndex'), 10)) {
            self.listDiv.css('zIndex', zIndex+2);
        }

        //오른쪽 아래로 열릴 떄
        function openDefault () {
            self.listDiv.css({
                'min-width' : buttonWidth,
                'top': buttonY + buttonHeight,
                'left': buttonX
            });
        }

        //왼쪽 아래로 열릴 때
        function openLeftDown () {
            self.listDiv.css({
                'min-width' : buttonWidth,
                'top': buttonY + buttonHeight,
                'left': buttonX - margin + 'px'
            });
        }

        //왼쪽 위로 열릴 때
        function openLeftUp () {
            self.listDiv.css({
                'min-width' : buttonWidth,
                'top': buttonY,
                'left': buttonX - margin + 'px'
            });
        }

        //오른쪽 위로 열릴 떄
        function openRightUp () {
            self.listDiv.css({
                'min-width' : buttonWidth,
                'top': buttonY,
                'left': buttonX
            });
        }

        //리스트 잘림 현상 수정
        if (self.element.offset().top - self.position + self.listDiv.height() >= $(window).height()) { //위로 열릴 때
            if (self.element.offset().left + self.listDiv.width() >= $(window).width()) { //오른쪽을 기준으로 열릴 때
                openLeftUp();
            } else { //왼쪽을 기준으로 열릴 때
                openRightUp();
            }

            self.listPosition = 'up';

        } else { //아래로 열릴 때
            if (self.element.offset().left + self.listDiv.width() >= $(window).width()) { //오른쪽을 기준으로 열릴 때
                openLeftDown();
            } else { //왼쪽을 기준으로 열릴 때
                openDefault();
            }

            self.listPosition = 'down';
        }
    };

    /**
     * 스프리트버튼의 리스트를 닫습니다.
     * @private
     */
    SplitButton.prototype._listUp = function () {
        var self = this;

        self.arrowWrapper.removeClass('selected');
        self.listDiv.removeClass('selected');

        $(window).off('click');
    };

    /**
     * 스플리트버튼의 리스트를 내립니다.
     * @private
     */
    SplitButton.prototype._listDown = function () {
        var self = this;
        var dynamicListHeight = self.listDiv.height();

        //기존에 열려 있던 드로바운버튼 닫기
        $('.dews-splitbutton-arrow').removeClass('selected');
        $('.dews-splitbutton-list').removeClass('selected');

        self.arrowWrapper.addClass('selected');
        self.listDiv.addClass('selected');

        if (self.listPosition === 'up') {
            self.listDiv.css({
                'marginTop': -dynamicListHeight
            });
        }

        if (self.listPosition === 'down') {
            self.listDiv.css({
                'marginTop': 0
            });
        }
    };

    SplitButton.prototype._bindEvent = function () {
        var self = this;

        // 화살표 이미지 클릭시 이벤트 실행
        self.arrowWrapper.on('click', function (e) {
            e.stopPropagation();

            self._getFontSize();
            self._setListPosition();

            if (!self.element.hasClass('dews-state-disabled')) {
                if (self.arrowWrapper.hasClass('selected')) {
                    self._listUp();
                } else {
                    self._listDown();
                    documentClick();
                }
            }
        });

        // 다른 부분을 클릭시 버튼 리스트 닫기
        function documentClick () {
            $(window).on('click mousewheel DOMMouseScroll', function () {
                self._listUp();
            });
        }

        $(window).bind('resize mousewheel DOMMouseScroll',function () {
            self.position = $(this).scrollTop();
            self._initControl();
        });
    };

    SplitButton.prototype.enable = function (value) {
        var self = this,
            state;

        state = !self.buttonDiv.find('button').attr('disabled');

        if (typeof value !== 'undefined') {
            if (value === true) {
                self.element.removeClass('dews-state-disabled');
                self.buttonDiv.find('button').attr('disabled', false);
            } else if(value === false) {
                self.element.addClass('dews-state-disabled');
                self.buttonDiv.find('button').attr('disabled', true);
            }

            state = value;
        }

        return state;
    };

    $.extend(true, dews, {
        ui: {
            splitbutton: function (selector, options) {
                var $el, splitbutton;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var button,
                        $this =  $(this);

                    button = $this.data('dews-control');

                    if (!button) {
                        if (!$this.hasClass('dews-ui-splitbutton')) {
                            $this.addClass('dews-ui-splitbutton');
                        }

                        if ($this.data('dews-localize-key')) {
                            $this.find('>button[data-dews-localize-key]').each(function (idx, value) {
                                var $list = $(value);
                                $list.text(dews.localize.get($list.text(), $list.data('dews-localize-key'), $list.data('dews-localize-lang') || null));
                            });
                        }

                        button = new SplitButton(this, options);

                        if (!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-control', button);
                    }

                    splitbutton = button;
                });

                return splitbutton;
            }
        }
    });

    dews.ui.addControlInitializer('dews-ui-splitbutton', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.splitbutton($('div.dews-ui-splitbutton', $container));
    });
})(jQuery, window.dews || {});


/*
 * 스플리터
 */
(function ($, dews, kendo) {
    var defaultOption = {
    };

    $.extend(true, dews, {
        ui: {
            /**
             * 스플리터 컨트롤을 생성하거나 가져옵니다.
             *
             * @param {string} selector 셀렉터 문자열 또는 jQuery객체
             * @param {object} [options] 설정 값, 생략하면 이미 생성된 스플리터 컨트롤의 객체를 획득할 수 있습니다.
             */
            splitter: function (selector, options) {
                var $el,
                    splitter;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            control,
                            opt;

                        control = $this.data("dews-control");

                        if (!control) {
                            opt = $.extend(true, {}, defaultOption, options);

                            if (!$this.hasClass("dews-ui-splitter")) {
                                $this.addClass("dews-ui-splitter");
                            }

                            $this.addClass("dews-control-activate");

                            $this.kendoSplitter(opt);
                            control = $this.data('kendoSplitter');

                            $this.data('dews-control', control);
                        }

                        splitter = control;
                    });
                }

                return splitter;
            }
        }
    });

    dews.ui.addControlInitializer('splitter', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.splitter("div.dews-ui-splitter", $container);
    });
})(jQuery, window.dews, window.kendo);


/*
 * 탭 패널
 */

(function ($, dews) {
    function TabItem (element, tabPanel) {
        var self = this;

        self._item = $(element);
        self._tabPanel = tabPanel;
        self.options = $.extend(true, {}, getTabItemOptions(self._item));

        self._initItem();
        self._bindEvent();

        return self;
    }

    /**
     * 탭 아이템의 옵션을 얻어오는 함수
     *
     * @param $tabItem JQuery 탭 아이템 객체
     * @returns {{disabled: number, hide: number}}
     */
    function getTabItemOptions($tabItem) {
        return {
            disabled: $tabItem.data('dews-disabled') | false,
            hide: $tabItem.data('dews-hide') | false
        }
    }

    /**
     * 탭 패널 내 아이템의 Title을 설정합니다.
     * @param text
     */
    TabItem.prototype.title = function (text) {
        var self = this;

        if ($.type(text) === 'undefined') {
            return self._item.find('> span.dews-tab-item-title').text();
        } else {
            self._item.find('> span.dews-tab-item-title').text(text);
        }

        setItemStyle(self._tabPanel);
    };

    /**
     * 탭 패널에서 선택된 탭 아이템 객체
     * @returns {*} 탭 아이템 객체
     */
    TabPanel.prototype.selectedItem = function () {
        var self = this;

        return self.openItem;
    };


    /**
     * 턉 패널 내 Item의 활성화 유무 설정
     * @param value
     */
    TabItem.prototype.enable = function (value) {
        var self = this;

        if ($.type(value) === 'undefined') {
            return self._item.attr('disabled');
        } else if ($.type(value) === 'boolean') {
            if (value) {
                self._item.attr('disabled', !value);
                self._item.removeClass('dews-state-disabled');
            } else {
                self._item.attr('disabled', !value);
                self._item.addClass('dews-state-disabled');
            }
        }
    };
    /**
     * 탭 패널 내 아이템 선택
     */
    TabItem.prototype.select = function () {
        var self = this;

        self._item.find('> span.dews-tab-item-title').click();
    };
    /**
     * 해당 탭 아이템을 보여주거나 감추는 메소드
     * @param value 탭 아이템 display 여부
     */
    TabItem.prototype.hide = function (value) {
        var self = this;

        if($.type(value) === "undefined") { // 현재 상태 반환
            return self._item.css("display") === "none";
        }else if (!value) { // 아이템 보이기
            self._item.show();
        } else { // 아이템 감추기
            self._item.hide();
        }

        //탭 패널 스타일 재설정
        setItemStyle(self._tabPanel);
        return value;
    };

    /**
     * 탭 패널 내 아이템 구조 설정
     * @private
     */
    TabItem.prototype._initItem = function () {
        var self = this,
            option = self.options,
            title = self._item.find('> span.dews-tab-item-title'),
            content = self._item.find('> div.dews-tab-content'),
            contents = self._item.children();

        if (title.length === 0) {
            if ($.type(self._item.data('dews-localize-key') !== 'undefined')) {
                title = $('<span class="dews-tab-item-title">' + dews.localize.get(self._item.data('dews-title'), self._item.data('dews-localize-key'), self._item.data('dews-localize-lang') || null) + '</span>');
            } else {
                title = $('<span class="dews-tab-item-title">' + self._item.data('dews-title') + '</span>');
            }
        }

        self._item.append(title);

        if (content.length === 0) {
            content = $('<div class="dews-tab-content"/>');
            content.append(contents);
        }

        self._item.append(content);

        if (self._item.data('dews-content-id') && self._item.data('dews-content-id') !== self._item.attr('ID')) {
            content.attr('ID', self._item.data('dews-content-id'));
        }

        // 탭 아이템 비활성화 설정
        if (option.disabled) {
            self.enable(false);
        }

        // 탭 아이템 감추기 설정
        if (option.hide) {
            self.hide(true);
        }

        // 자신의 객체를 데이터로 추가
        self._item.data('dews-control-tab-item', self);
    };

    /**
     * 탭 패널 내 아이템 이벤트 설정
     * @private
     */
    TabItem.prototype._bindEvent = function () {
        var self = this;

        self._item.find('> span.dews-tab-item-title').on('click', function (e) {
            if (self !== self._tabPanel.openItem) {
                var parameter = {
                    tab: self._tabPanel,
                    openItem: self,
                    closeItem: self._tabPanel.openItem
                }, event = new $.Event('change', parameter);
                self._tabPanel.openItem._item.removeClass('on');
                self._item.addClass('on');
                self._tabPanel.openItem = self;
                self._tabPanel._element.trigger(event);
            }

        });
    };
    /**
     * 탭 패널을 작성합니다.
     * @private
     */
    function TabPanel (element, options) {
        var self = this;

        self._element = $(element);
        self.options = $.extend(true, {}, options, getTabPanelOptions(self._element));
        self.items = [];

        nthCreate(self);
        setItemStyle(self);

        self.items[0]._item.addClass('on');
        self.openItem = self.items[0];

        self.items.getById = function (id) {
            for (var i = 0; i < self.items.length; i+=1) {
                if (self.items[i]._item.attr('ID') === id) {
                    return self.items[i];
                }
            }
        };

        // 선택하도록 설정된 탭 아이템 혹은 선택할 수 있는 탭을 선택
        self._selectTabItemByOption();

        return self;
    }
    /**
     * 탭 패널의 옵션값을 얻어오는 함수
     *
     * @param $tabPanel 탭 패널 엘리먼트의 JQuery 객체
     * @returns {{selectedTab}}
     */
    function getTabPanelOptions($tabPanel) {
        return {
            selectedTab: $tabPanel.data("dews-selected-tab")
        }
    }

    /**
     * 탭 패널 이벤트 설정
     */
    TabPanel.prototype.on = function () {
        var self = this;

        self._element.on.apply(self._element, arguments);
    };
    /**
     * 팹 패널 이벤트 해제
      */
    TabPanel.prototype.off = function () {
        var self = this;

        self._element.off.apply(self._element, arguments);
    };
    /**
     * 탭 패널 활성화 유무 설정
      * @param value
     */
    TabPanel.prototype.enable = function (value) {
        var self = this;

        if ($.type(value) === 'undefined') {
            return self._element.attr('disabled');
        } else if ($.type(value) === 'boolean') {
            if (value) {
                self._element.removeClass('dews-state-disabled');
            } else {
                self._element.addClass('dews-state-disabled');
            }
        }
    };

    /**
     * 탭 패널 자식 요소 객체 생성
      * @param tab
     */
    function nthCreate (tab) {
        var self = tab;

        self._element.find('> ul > .dews-tab-item').each(function (idx) {
            self.items.push(new TabItem(self._element.find('> ul > .dews-tab-item')[idx], self));
        });
    }

    /**
     * 탭 패널 타이틀 문구 스타일 설정
      * @param tab
     */
    function setItemStyle (tab) {
        var self = tab;

        $.each(self.items, function (idx) {
            if (idx !== 0) {
                var previous = self.items[idx-1]._item.find('.dews-tab-item-title');
                self.items[idx]._item.find('.dews-tab-item-title').css('left', parseFloat(previous.css('left')) + previous.outerWidth() + 'px');
            }
        });
    }
    /**
     * 옵션으로 전달받은 선택해야 하는 탭 혹은
     * 선택할 수 있는 탭을 선택하는 메소드
     *
     * @returns {*} 선택된 탭 아이템 객체
     */
    TabPanel.prototype._selectTabItemByOption = function () {
        var self = this,
            selectedTabItem,
            selectedTab = self.options.selectedTab;

        /*
          옵션 값으로 처리
         */
        if(isNaN(selectedTab)) {
            selectedTabItem = self._element.find("#" + selectedTab).data("dews-control-tab-item");
            if(!selectedTabItem){
                selectedTabItem = self.items[0];
            }
        } else {
            selectedTabItem = self.items[selectedTab];
        }

        /*
          탭이 선택 가능한 경우는 선택,
          불가능한 경우 선택할 수 있는 가장 첫번째 탭을 선택
         */
        if(selectedTabItem && isSelectable(selectedTabItem._item)) {
            selectedTabItem.select();
        } else {
            selectedTabItem = self._element.find(".dews-tab-item")
                                           .filter(function (idx, item) {
                                                     return isSelectable($(item));
                                                   })
                                           .first()
                                           .data("dews-control-tab-item");
            if(selectedTabItem){
                selectedTabItem.select();
            }
        }

        return selectedTabItem;
    };

    /**
     * 파라미터로 입력받은 탭 아이템이 선택 가능한지 여부를 반환하는 함수
     *
     * @param $item JQuery 탭 아이템 엘리먼트
     * @returns {boolean} 선택 가능 여부
     */
    function isSelectable($item) {
        return $item.css("display") !== "none" && !$item.attr("disabled");
    }

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 탭 패널로 만들거나 가져옵니다.
             * @param {string|jQuery} selector 탭 패널로 만들 셀렉터 또는 jQuery 객체
             * @param {object} options 탭 패널 옵션
             * @returns {object|Array} 탭 패널 인스턴스
             */
            tabpanel: function (selector, options) {
                var $el, obj;

                obj = [];

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var tabpanel,
                        element = this;

                    if ($(element).data('dews-control')) {
                        tabpanel = $(element).data('dews-control');
                    } else {
                        tabpanel = new TabPanel(element, options);
                        $(element).data("dews-control", tabpanel);
                    }

                    if (!$(element).hasClass('dews-control-activate')) {
                        $(element).addClass('dews-control-activate');
                    }

                    obj.push(tabpanel);
                });

                return (obj.length == 1) ? obj[0] : obj;
            }
        }
    });

    dews.ui.addControlInitializer('tabpanel', function(target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.tabpanel($(".dews-ui-tab-panel", $container));
    });
})(jQuery, window.dews || {});


/*
 * 탭 스트립
 */
(function ($, dews, kendo) {
    var defaultOption = {
    };

    $.extend(true, dews, {
        ui: {
            tabstrip: function (selector, options) {
                var $el,
                    tabstrip;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            control,
                            opt;

                        control = $this.data("dews-control");

                        if (!control) {
                            opt = $.extend(true, {}, defaultOption, options);

                            if (!$this.hasClass("dews-ui-tabstrip")) {
                                $this.addClass("dews-ui-tabstrip");
                            }

                            $this.addClass("dews-control-activate");

                            $this.kendoTabStrip(opt);
                            control = $this.data('kendoTabStrip');

                            $this.data('dews-control', control);
                        }

                        tabstrip = control;
                    });

                    tabstrip = $el.data("kendoTabStrip");
                }

                return tabstrip;
            }
        }
    });

    dews.ui.addControlInitializer('tabstrip', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.tabstrip("div.dews-ui-tabstrip", $container);
    });
})(jQuery, window.dews, window.kendo);


/*
 * 텍스트 박스
 */

(function ($, dews) {

    /**
     * 텍스트 박스
     * @param {jQuery} element 텍스트박스로 생성할 대상 요소의 jQuery 객체
     * @constructor
     */
    var TextBox = function (element) {
        var self = this;

        self.element = element;
        self.controlType = 'input';

        self._init();
    };

    /**
     * 텍스트박스를 초기화합니다.
     * @private
     */
    TextBox.prototype._init = function () {
        var self = this,
            $ctrl = self.element;

        if (!$ctrl.hasClass("dews-ui-textbox")) {
            $ctrl.addClass("dews-ui-textbox");
        }

        if ($ctrl.get(0).tagName === 'SPAN') {
            // span 태그에 적용된 경우
            self.controlType = 'span';

            $(".dews-icon", $ctrl).each(function () {
                var $icon = $(this),
                    iconClass;

                if (!$icon.data("icon") && $icon.is(":visible")) {
                    $icon.css("display", "none");
                } else {
                    iconClass = "k-i-" + $icon.data("icon");

                    if (!$icon.hasClass(iconClass)) {
                        $icon.addClass("k-icon");
                        $icon.addClass(iconClass);
                    }

                    if ($icon.data("icon-location") === "left") {
                        if (!$ctrl.hasClass("k-space-left")) {
                            $ctrl.addClass("k-space-left");
                        }
                    } else {
                        if (!$ctrl.hasClass("k-space-right")) {
                            $ctrl.addClass("k-space-right");
                        }
                    }
                }
            });
        } else if ($ctrl.get(0).tagName === 'TEXTAREA') {
            self.controlType = 'textarea';
        }

        if($ctrl.attr('placeholder') && $ctrl.data('dews-placeholder-localize-key')) {
            $ctrl.attr('placeholder', dews.localize.get($ctrl.attr('placeholder'), $ctrl.data('dews-placeholder-localize-key'), $ctrl.data('dews-placeholder-localize-lang') || null));
        }

        if (!$ctrl.hasClass('k-textbox')) {
            $ctrl.addClass('k-textbox');
        }

        // readonly, disabled 처리
        dews.ui.util.ConvertClassAndProperty($ctrl);

        // input에 id만 있고 name이 없을 경우 name을 id와 동일하게 설정한다.
        if ($ctrl.get(0).tagName !== 'SPAN' && $ctrl.attr('id') && !($ctrl.attr('name'))) {
            $ctrl.attr('name', $ctrl.attr('id'));
        }

        if (!$ctrl.hasClass('dews-control-activate')) {
            $ctrl.addClass('dews-control-activate');
        }

        setUserGuideAPI($ctrl);
    };

    /**
     * 텍스트박스의 읽기 전용 여부를 설정하거나 가져옵니다.
     * @param {boolean} [value] 읽기 전용 여부 (생략할 경우 현재 읽기 전용 여부를 가져옵니다.)
     * @returns {boolean} 읽기 전용 상태
     */
    TextBox.prototype.readonly = function (value) {
        var self = this,
            $ctrl = self.element;

        if (typeof value === 'undefined') {
            // 값 가져가기
            value = $ctrl.hasClass('readonly');
        } else {
            // 읽기 전용 설정
            if (value) {
                if (!$ctrl.hasClass('readonly')) {
                    $ctrl.addClass('readonly');
                }
                if (!$ctrl.prop('readonly')) {
                    $ctrl.prop('readonly', true);
                }
            } else {
                if ($ctrl.hasClass('readonly')) {
                    $ctrl.removeClass('readonly');
                }
                if ($ctrl.prop('readonly')) {
                    $ctrl.prop('readonly', false);
                }
            }
        }

        return value;
    };

    /**
     * 텍스트박스의 활성화 여부를 설정하거나 가져옵니다.
     * @param {boolean} [value] 활성화 상태 (생략할 경우 현재 활성화 여부를 가져옵니다.)
     * @returns {boolean} 활성화 여부
     */
    TextBox.prototype.enable = function (value) {
        var self = this,
            $ctrl = self.element;

        if (typeof value === 'undefined') {
            // 값 가져가기
            value = !$ctrl.hasClass('disabled');
        } else {
            // 활성화 설정
            if (value) {
                if ($ctrl.hasClass('disabled')) {
                    $ctrl.removeClass('disabled');
                }
                if ($ctrl.prop('disabled')) {
                    $ctrl.prop('disabled', false);
                }
            } else {
                if (!$ctrl.hasClass('disabled')) {
                    $ctrl.addClass('disabled');
                }
                if (!$ctrl.prop('disabled')) {
                    $ctrl.prop('disabled', true);
                }
            }
        }

        return value;
    };

    /**
     * 텍스트박스의 텍스트를 설정하거나 가져옵니다.
     * @param {boolean} [value] 설정할 텍스트 (생략할 경우 현재 설정된 텍스트를 가져옵니다.)
     * @returns {string} 설정된 텍스트
     */
    TextBox.prototype.text = function (value) {
        var self = this;

        if (typeof value === 'undefined') {
            if (self.controlType === 'span') {
                value = self.element.text();
            } else {
                value = self.element.val();
            }
        } else {
            value = value || '';

            if (self.controlType === 'span') {
                self.element.text(value);
            } else {
                self.element.val(value);
            }
        }

        return value;
    };

    /**
     * 텍스트박스의 최대 입력 가능 길이를 설정합니다.
     * @param {number} length 최대 입력 가능 길이
     */
    TextBox.prototype.setMaxLength = function (length) {
        var self = this;

        if ($.isNumeric(length) && length >= 0) {
            self.element.prop('maxLength', length)
        } else {
            console.error('\'' + length + '\' 는 최대 입력 가능 길이로 설정할 수 없는 값입니다.');
        }
    };

    TextBox.prototype.success = function (value) {
        var self = this,
            $ctrl = self.element;

        // success 상태 설정
        if (value) {
            if (!$ctrl.hasClass('success')) {
                $ctrl.addClass('success');
            }
        } else {
            if ($ctrl.hasClass('success')) {
                $ctrl.removeClass('success');
            }
        }
        return value;
    };

    TextBox.prototype.error = function (value) {
        var self = this,
            $ctrl = self.element;

        // error 상태 설정
        if (value) {
            if (!$ctrl.hasClass('error')) {
                $ctrl.addClass('error');
            }
        } else {
            if ($ctrl.hasClass('error')) {
                $ctrl.removeClass('error');
            }
        }
        return value;
    };

    TextBox.prototype.warning = function (value) {
        var self = this,
            $ctrl = self.element;

        // warning 상태 설정
        if (value) {
            if (!$ctrl.hasClass('warning')) {
                $ctrl.addClass('warning');
            }
        } else {
            if ($ctrl.hasClass('warning')) {
                $ctrl.removeClass('warning');
            }
        }
        return value;
    };

    TextBox.prototype.reset = function () {
        var self = this;

        self.text('');
    };

    TextBox.prototype.focus = function () {
        var self = this;

        self.element.focus();
    };

    TextBox.prototype.on = function () {
        var self = this;

        self.element.on.apply(self.element, arguments)
    };

    TextBox.prototype.off = function () {
        var self = this;

        self.element.off.apply(self.element, arguments);
    };

    TextBox.prototype.validate = function () {
        var self = this;
        return !!self.text();
    };

    TextBox.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self.element);
        var column;

        if (data) {

            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.text(data[column]);
            }
        }
    };

    TextBox.prototype.serializeForPanel = function () {
        var self = this , $element = $(self.element);
        var column, data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = self.text();
        }

        return data;
    };

    TextBox.prototype.applyPanelFocus = function () {
        var self = this , $element = $(self.element);

        $element.on('keydown', function (e) {

            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                if (!(self.controlType === 'textarea' && e.keyCode === 13)) {
                    var evt = new $.Event('nextFocus');
                    evt.control = self;

                    $element.trigger(evt);
                }
            }
        });
    };

    TextBox.prototype.canFocusable = function () {
        var self = this , $element = $(self.element);

        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    };

    /**
     * 텍스트박스 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    TextBox.prototype._getPrintData = function () {
        var self = this,
            $el = $(self.element),
            data;

        if (self.text()) {
            data = {
                id: $el.attr('id'),
                text: self.text()
            }
        }

        return data;
    };

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    dews = $.extend(true, dews, {
        ui: {
            textbox: function (selector) {
                var $control, textbox;

                if (selector instanceof jQuery) {
                    $control = selector;
                } else if ($.type(selector) === "string") {
                    $control = $(selector);
                } else {
                    throw "대상이 지정되지 않았습니다.";
                }

                $control.each(function () {
                    var $ctrl = $(this);

                    textbox = $ctrl.data('dews-control');

                    if (!textbox) {
                        textbox = new TextBox($ctrl);
                        if (!$ctrl.hasClass('dews-form-control')) {
                            $ctrl.addClass('dews-form-control');
                        }

                        $ctrl.data('dews-control', textbox);
                    }
                });

                return textbox;
            }
        }
    });

    dews.ui.addControlInitializer('textbox', function(target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.textbox($("input[type='text'].dews-ui-textbox", $container));
        dews.ui.textbox($("input[type='password'].dews-ui-textbox", $container));
        dews.ui.textbox($("textarea.dews-ui-textbox", $container));
        dews.ui.textbox($("span.dews-ui-textbox", $container));
    });
})(jQuery, window.dews || {});


/*
 * 툴바
 */
(function ($, dews, kendo) {
    var defaultOption = {
    };

    $.extend(true, dews, {
        ui: {
            toolbar: function (selector, options) {
                var $el,
                    toolbar;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            control,
                            opt;

                        control = $this.data("dews-control");

                        if (!control) {
                            opt = $.extend(true, {}, defaultOption, options);

                            if (!$this.hasClass("dews-ui-toolbar")) {
                                $this.addClass("dews-ui-toolbar");
                            }

                            $this.addClass("dews-control-activate");

                            $this.kendoToolBar(opt);
                            control = $this.data('kendoToolBar');

                            $this.data('dews-control', control);

                        }

                        toolbar = control;
                    });
                }

                return toolbar;
            }
        }
    });

    dews.ui.addControlInitializer('toolbar', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.toolbar($("div.dews-ui-toolbar", $container));
    });
})(jQuery, window.dews, window.kendo);


(function ($, dews) {
    var defaultOptions = {
        type: 'normal',
        position: 'top',
        durationTime: 0,
        fadeOutTime : 3000,
        text: '&nbsp'
    };

    function Tooltip($el, options) {
        var selfOptions;
        var self = this;

        self.target = $el;
        self.options = options;
        self.tooltip = null;
        self.flag = false;

        selfOptions = self.getOptions(options);

        self._create(selfOptions);
    }

    Tooltip.prototype.getOptions = function (options) {
       var opt;
       var requiredOptions = {};

       // 필수 툴팁일 경우 기본 옵션 설정 변경
       if(options && options.type === 'required') {
           requiredOptions  = {
               type: 'required',
               fadeOutTime: 3000,
               text: dews.localize.get('필수 입력 항목입니다.', 'dews_필수 입력 항목입니다.')
           };
       }

       opt = $.extend(true, {}, defaultOptions, requiredOptions, options);

       return opt;
    };

    Tooltip.prototype._create = function (options) {
        var self = this;
        var tooltip;
        var temp;

        tooltip = $('<span></span>').addClass('tooltip').html(options.text);

        $(document.body).append(tooltip);

        // 필수 툴팁 스타일 적용
        if(options.type === 'required') {
            tooltip.addClass('required');
        }

        // wrapper로 감싸서 표현되는 컨트롤은 감싸고 있는 태그로 선택자를 변경한다.
        if(parseFloat(self.target.offset().left) === 0 || self.target.width() === 0) {
            temp = self.target;
            self.target = self.target.parent();
        }

        // 위치 계산
        if(options.position === 'top') {
            tooltip.css({'top' : self.target.offset().top - (self.target.height() + 10)});
            tooltip.css({'left': self.target.offset().left + (self.target.outerWidth() - $(tooltip).outerWidth())/2});

            tooltip.addClass('top');
        } else if(options.position === 'left') {
            tooltip.css({'left': self.target.offset().left - (tooltip.width() + 30)});
            tooltip.css({'top': self.target.offset().top + (self.target.height() - $(tooltip).outerHeight())/2});

            tooltip.addClass('left');
        } else if(options.position === 'right') {
            tooltip.css({'left': self.target.offset().left + self.target.outerWidth() + 10});
            tooltip.css({'top': self.target.offset().top + (self.target.height() - $(tooltip).outerHeight())/2});

            tooltip.addClass('right');
        } else {
            tooltip.css({'left': self.target.offset().left + (self.target.outerWidth() - $(tooltip).outerWidth())/2});
            tooltip.css({'top' : self.target.offset().top + self.target.height() + 10});

            tooltip.addClass('bottom');
        }

        if(temp) {
            self.target = temp;
        }
        self.tooltip = tooltip;

        // 툴팁의 fadeout만 설정 시
        if(!options.durationTime && options.fadeOutTime) {
            self.flag = true;
            tooltip.fadeOut(options.fadeOutTime).promise().done(function () {
                self._delete();
            });
        }

        // 유지시간과 fadeout 설정
        if(options.durationTime && options.fadeOutTime) {
            self.flag = true;
            tooltip.fadeTo(options.durationTime, tooltip.css('opacity')).fadeOut(options.fadeOutTime).promise().done(function () {
                self._delete();
            });
        }
    };

    Tooltip.prototype._delete = function () {
        var self = this;
        self.tooltip.remove();
        self.target.removeData('dews-ui-tooltip');
    };

    dews = $.extend(true, dews, {
        ui: {
            tooltip: {
                show: function (target, options) {
                    var $el, tooltip;

                    if (target instanceof jQuery) {
                        $el = target;
                    } else if ($.type(target) === "string") {
                        $el = $(target);
                    } else {
                        throw "대상이 지정되지 않았습니다.";
                    }

                    $el.each(function (){
                        var $this = $(this);

                        tooltip = $this.data('dews-ui-tooltip');

                        // 툴팁이 존재하면 새로 생성하지 않습니다.
                        if(tooltip) {
                            return;
                        }

                        tooltip = new Tooltip($this, options);

                        if(!$this.hasClass('dews-control-activate')) {
                            $this.addClass('dews-control-activate');
                        }

                        $this.data('dews-ui-tooltip', tooltip);

                    });

                    return tooltip;
                },
                hide: function (target) {
                    var $el, tooltip;

                    if (target instanceof jQuery) {
                        $el = target;
                    } else if ($.type(target) === "string") {
                        $el = $(target);
                    } else {
                        throw "대상이 지정되지 않았습니다.";
                    }

                    tooltip = $el.data('dews-ui-tooltip');

                    // 툴팁이 존재하는 시점에는 삭제하지 않습니다.
                    if(tooltip && !tooltip.flag) {
                        tooltip._delete();
                    }
                }
            }
        }
    });

})(jQuery, window.dews || {});


(function ($, dews, kendo) {
    // 트리 데이터소스 옵션 설정
    function setDataSourceOptions(options) {
        var defaultOptions = {
            _destroy: [],
            params: '',
            restoreMode: 'auto',
            async: true,
            childrenField: 'items'
        }, opt;
        // childrenField 설정
        if (options.schema && options.schema.model && options.schema.model.childrenField) {
            options.childrenField = options.schema.model.childrenField;
        }

        opt = $.extend(true, defaultOptions, options);

        if (opt.schema && opt.schema.model.fields) {
            var field = [];
            for (var i =0; i < opt.schema.model.fields.length; i+=1) {
                opt.schema.model.fields[i].fieldName = opt.schema.model.fields[i].field;
                if (opt.schema.model.fields[i].type) {
                    opt.schema.model.fields[i].dataType = opt.schema.model.fields[i].type;
                } else if (!opt.schema.model.fields[i].dataType) {
                    opt.schema.model.fields[i].dataType = 'text';
                }

                if ((opt.schema.model.fields[i].dataType).toLowerCase() === 'string') {
                    opt.schema.model.fields[i].dataType = 'text';
                }
                field.push(opt.schema.model.fields[i]);
            }
            opt.field = field;
        }

        return opt;
    }

    var TreeDataProvider = function (options) {
        var self = this, opt;

        var dataProvider = new RealGridJS.LocalTreeDataProvider();

        opt = setDataSourceOptions(options);
        opt.rollback = dataProvider.savePoint();
        dataProvider.setFields(opt.field);
        dataProvider.setOptions(opt);

        self.dataProvider = dataProvider;
        self.options = opt;
        self.id = opt.id;

        return self;
    };

    dews = $.extend(true, dews, {
        ui: {
            /**
             * 데이터 소스
             *
             * @param {String} id 트리데이터소스 아이디
             * @param {Object} [options] 트리데이터소스 옵션
             * @param {String|jQuery} [container] 트리데이터소스를 저장할 컨테이너
             */
            treeDataSource: function (id, options, container) {
                var dataSource, $container = $(document);
                if (options && options.hasOwnProperty('grid') && options.grid) {
                    options.id = id;
                    dataSource = new TreeDataProvider(options);
                    $container.data("dews-treedatasource-" + id, dataSource);
                } else {
                    if (options) {
                        options.id = id;
                        options = getOptions(options);

                        dataSource = new kendo.data.DataSource(options);
                        dataSource.id = id;
                        $container.data("dews-treedatasource-" + id, dataSource);
                        dews.log('## dews.ui.dataSource: ' + id + ' 생성 ##');
                        dews.log(dataSource.data());
                    } else {
                        dataSource = $container.data("dews-treedatasource-" + id);
                    }
                }

                return dataSource;
            }
        }
    });

    /**
     * 트리데이터소스 호출
     */
    TreeDataProvider.prototype.read = function () {
        var self = this,
            data = '',
            url,
            resultData = {};

        self.options._destroy = [];

        if (self.options.master) {
            for (var i = 0; i < Object.keys(self.options.master).length; i+=1) {
                self.options.master[Object.keys(self.options.master)[i]].options.lineDataSources = {};
                self.options.master[Object.keys(self.options.master)[i]].read();
            }
        }

        if (self.options.transport && self.options.transport.read.url) {
            if (self.options.transport.read.data) {
                data = $.type(self.options.transport.read.data) === 'function' ? self.options.transport.read.data() : self.options.transport.read.data;
            }

            if ($.type(self.options.transport.read.url) === 'function') {
                url = self.options.transport.read.url.call(self);
            } else {
                url = self.options.transport.read.url;
            }

            if ($.type(self.options.transport.read.type) === 'undefined' || self.options.transport.read.type.toLowerCase() === 'get') {
                dews.api.get(url, {
                    data: data,
                    async: self.options.async
                }).done(function (result) {
                    if ($.type(result) === 'object' && result.hasOwnProperty('data')) {
                        resultData[self.options.childrenField] = result.data;
                        self.options.data = resultData;
                    } else {
                        resultData[self.options.childrenField] = result;
                        self.options.data = resultData;
                    }
                    self.dataProvider.setJsonRows(resultData, self.options.childrenField, '', '');
                    self.dataProvider.clearRowStates();
                    self.options.rollback = self.dataProvider.savePoint();
                }).fail(function (e, xhr) {
                    if (self.options.error && $.type(self.options.error) === 'function') {
                        self.options.error.call(self, e.responseJSON);
                    }
                });
            } else {
                dews.api.post(url, {
                    data: data,
                    async: self.options.async
                }).done(function (result) {
                    if ($.type(result) === 'object' && result.hasOwnProperty('data')) {
                        resultData[self.options.childrenField] = result.data;
                        self.options.data = resultData;
                    } else {
                        resultData[self.options.childrenField] = result;
                        self.options.data = resultData;
                    }
                    self.dataProvider.setJsonRows(resultData, self.options.childrenField, '', '');
                    self.dataProvider.clearRowStates();
                    self.options.rollback = self.dataProvider.savePoint();
                }).fail(function (e, xhr) {
                    if (self.options.error && $.type(self.options.error) === 'function') {
                        self.options.error.call(self, e.responseJSON);
                    }
                });
            }
        } else if (self.options.data) {
            if ($.type(self.options.data) === 'array') {
                resultData[self.options.childrenField] = self.options.data;
            } else {
                resultData = self.options.data;
            }
            self.dataProvider.setJsonRows(resultData, self.options.childrenField, '', '');
            self.dataProvider.clearRowStates();
            self.options.rollback = self.dataProvider.savePoint();
        }
    };

    /**
     * 트리데이터소스 데이터 설정 또는 호출
     * @param data 설정할 데이터
     * @returns {*} 호출할 데이터
     */
    TreeDataProvider.prototype.data = function (data) {
        var self = this,
            resultData = {};

        if ($.type(data) === 'array') {
            resultData[self.options.childrenField] = data;
            self.options.data = resultData;
            self.dataProvider.setJsonRows(resultData, self.options.childrenField, '', '');
            self.options.rollback = self.dataProvider.savePoint();
            self.options._destroy = [];
        } else {
            return self.dataProvider.getJsonRows(-1, true, self.options.childrenField, '');
        }
    };

    /**
     * 트리데이터소스에서 CRUD 된 데이터를 반환 합니다.
     * @return {{Added: Array, Updated: Array, Deleted: Array}} CRUD된 데이터
     */
    TreeDataProvider.prototype.getDirtyData = function () {
        var self = this,
            currentData = {
                Added: [],
                Updated: [],
                Deleted: []
            }, i, j, k, l;

        if (self.dataProvider.getStateRows('created')) {
            for (i = 0; i < self.dataProvider.getStateRows('created').length; i+=1) {
                var createData = self.dataProvider.getJsonRow(self.dataProvider.getStateRows('created')[i]),
                    createParentId = self.dataProvider.getParent(self.dataProvider.getStateRows('created')[i]);
                createData.__parent = self.dataProvider.getJsonRow(createParentId);
                createData.__sequence;
                $.each(self.dataProvider.getChildren(createParentId), function (index, rowId) {
                    if (self.dataProvider.getStateRows('created')[i] === rowId) {
                        createData.__sequence = index;
                    }
                });
                currentData.Added.push(createData);
            }
        }

        if (self.dataProvider.getStateRows('updated')) {
            for (j = 0; j < self.dataProvider.getStateRows('updated').length; j+=1) {
                var updatedData = self.dataProvider.getJsonRow(self.dataProvider.getStateRows('updated')[j]),
                    updatedParentId = self.dataProvider.getParent(self.dataProvider.getStateRows('updated')[j]);
                updatedData.__parent = self.dataProvider.getJsonRow(updatedParentId);
                updatedData.__sequence;
                $.each(self.dataProvider.getChildren(updatedParentId), function (index, rowId) {
                   if (self.dataProvider.getStateRows('updated')[j] === rowId) {
                       updatedData.__sequence = index;
                   }
                });
                currentData.Updated.push(updatedData);
            }
        }

        for (k = 0; k < self.options._destroy.length; k+=1) {
            currentData.Deleted.push(self.options._destroy[k]);
        }

        return currentData;
    };

    /**
     * 트리데이터소스에서 CRUD 된 데이터 갯수를 반환 합니다.
     * @return {number} CRUD된 데이터 갯수
     */
    TreeDataProvider.prototype.getDirtyDataCount = function () {
        var self = this, count= 0, i, j ,k;

        if (self.dataProvider.getStateRows('created')) {
            for (i = 0; i < self.dataProvider.getStateRows('created').length; i+=1) {
                count+=1;
            }
        }

        if (self.dataProvider.getStateRows('updated')) {
            for (j = 0; j < self.dataProvider.getStateRows('updated').length; j+=1) {
                count+=1;
            }
        }

        for (k = 0; k < self.options._destroy.length; k+=1) {
            count+=1;
        }

        return count;
    };

    /**
     * 트리데이터소스에서 CRUD 된 데이터만 서버로 저장합니다.
     * @param url 저장할 서버 url
     * @param options 전송 옵션
     * @return {*} promise 객체
     */
    TreeDataProvider.prototype.batchSave = function (url, options) {
        var self = this,
            data = self.getDirtyData(),
            opt,
            batchData = {},
            dfr = $.Deferred();

        batchData[self.options.id] = data;

        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        dews.api.post(url, opt).done(function (result) {
            self.options._destroy = [];
            self.dataProvider.clearRowStates();
            dfr.resolve(result);
        }).fail(function (jqXHR, status, msg, data) {
            dfr.reject(msg);
        });

        return dfr;
    };

    /**
     * 트리데이터소스에서 전체 데이터를 서버로 보냅니다.
     * @param url 저장할 서버 url
     * @param options 전송 옵션
     * @return {*} promise 객체
     */
    TreeDataProvider.prototype.saveAll = function (url, options) {
        var self = this,
            opt,
            data = self.dataProvider.getJsonRows(-1, true, self.options.childrenField, ''),
            batchData = {},
            dfr = $.Deferred();

        batchData[self.options.id] = data;

        opt = $.extend(true, {}, {
            type: "POST",
            data: { rows: JSON.stringify(batchData) }
        }, options);

        dews.api.post(url, opt).done(function (result) {
            self.options._destroy = [];
            self.dataProvider.clearRowStates();
            dfr.resolve(result);
        }).fail(function (jqXHR, status, msg, data) {
            dfr.reject(msg);
        });

        return dfr;
    };

    /**
     * 트리데이터소스의 필드를 새로 정의합니다.
     * @param fields
     */
    TreeDataProvider.prototype.setFields = function (fields) {
        var self = this;

        self.options.schema.model.fields = fields;
        self.options = setDataSourceOptions(self.options);
        self.dataProvider.setFields(self.options.field);
    };

    /**
     * 트리데이터소스의 옵션을 정의합니다.
     * @param options 정의할 옵션
     */
    TreeDataProvider.prototype.setOptions = function (options) {
        var self = this,
            opt;

        opt = $.extend(true, self.options, options);
        self.options = opt;
        self.dataProvider.setOptions(opt);
    };

    /**
     * 트리데이터소스 변경에 따른 메인버튼 활성화/비활성화 설정
     * @param page 해당 페이지 정보
     * @private
     */
    TreeDataProvider.prototype._dataChange = function (page) {
        var self = this,
            parameter = {
                dataSource: self,
                isChange: false
            },
            event = new $.Event('dataChange', parameter);

        self.dataProvider.onRowAdded = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowDeleted = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowUpdated = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };

        self.dataProvider.onRowStatesChanged = function () {
            if (self.hasDirty(true)) {
                event.isChange = true;
            } else {
                event.isChange = false;
            }

            if ($.type(arguments[0]) === 'boolean') {
                event.isChange = arguments[0];
            }

            page.$content.trigger(event);
        };
    };

    /**
     * 마스터 디테일 구조 사용시 디테일 데이터소스 감지에 따른 메인버튼 활성화/비활성화 설정
     * @private
     */
    TreeDataProvider.prototype._detailDataChange = function () {
        var self = this;

        self.options._dataChange = true;

        self.dataProvider.onRowDeleted = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowDeleted.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowDeleted.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowUpdated = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowUpdated.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowUpdated.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowInserted = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowInserted.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource, true);
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        self.options.masterDataSource.dataProvider.onRowInserted.call(self.options.masterDataSource);
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };

        self.dataProvider.onRowStatesChanged = function () {
            if (self.options.parentDataSource) {
                self.options.parentDataSource.dataProvider.onRowStatesChanged.call(self.options.parentDataSource);
            } else {
                if (self.getDirtyDataCount() > 0) {
                    if (self.options.masterDataSource.options.grid) {
                        if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                            self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource, true);
                        } else {
                            self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource, true);
                        }
                    } else {
                        self.options.masterDataSource.trigger('change', true);
                    }
                } else {
                    if (self.options.masterDataSource.options.grid) {
                        if ($.type(self.options.masterDataSource.dataProvider.onRowStatesCleared) !== 'undefined') {
                            self.options.masterDataSource.dataProvider.onRowStatesCleared.call(self.options.masterDataSource);
                        } else {
                            self.options.masterDataSource.dataProvider.onRowStatesChanged.call(self.options.masterDataSource);
                        }
                    } else {
                        self.options.masterDataSource.trigger('change');
                    }
                }
            }
        };
    };

    /**
     * 마스터 디테일 관계 형성 시 전체 데이터 변경 유무 확인
     * @param target 자식 전체 검사 유무 (기본값: true)
     * @return {boolean} 전체 데이터 변경 유무
     */
    TreeDataProvider.prototype.hasDirty = function (target) {
        var self = this,
            range = true,
            result = false;

        if ($.type(target) === 'boolean') {
            range = target;
        }

        if (range) {
            if ($.type(self.options.detailDataSource) !== 'undefined') {
                result = self.options.detailDataSource.hasDirty(range);

                if (result) {
                    return result;
                } else if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            } else {
                if (self.getDirtyDataCount() > 0) {
                    result = true;
                }
            }
        } else {
            if (self.getDirtyDataCount() > 0) {
                result = true;
            }
        }

        return result;
    };

})(jQuery, window.dews || {}, window.kendo || {});


/*
 * 트리 그리드
 */
(function ($, dews) {
    var loadgridStyle;

    // 트리 그리드 옵션 설정
    function getOptions(self, options) {
        var treeGrid = self._grid, opt, defaultOptions = {
            "panel": {
                "visible": false
            },
            "checkBar": {
                "visible": true
            },
            "stateBar": {
                "visible": false
            },
            "header": {
                "minHeight": options.gridStyle.header.height
            },
            "footer": {
                "visible": false,
                "height": options.gridStyle.footer.height,
                "minHeight": options.gridStyle.footer.height
            },
            "indicator": {
                "visible": true,
                "headText": "No",
                "footText": " "
            },
            "edit": {
                "insertable": false,
                "appendable": false,
                "editable": false,
                "crossWhenExitLast": true,
                "showInvalidFormatMessage": false,
                "enterToTab": true,
                "checkDiff": true,
                "skipReadOnly": false
            },
            "display": {
                'fitStyle': 'fill',
                'showEmptyMessage': false,
                'emptyMessage': dews.localize.get('데이터가 없습니다.', 'dews_데이터가 없습니다.'),
                'rowHeight': options.gridStyle.body.height,
                'minHeight': options.gridStyle.body.height,
                'focusColor': options.gridStyle.selection.focusBorderColor,
                'focusBorderWidth': '2px',
                'innerFocusColor': options.gridStyle.selection.focusBorderColor,
                'showInnerFocus': true,
                'columnMovable': false,
                'columnResizable': true
            },
            "copy": {
                'singleMode': true
            },
            "paste": {
                'singleMode': true,
                'checkReadOnly': true
            },
            "select": {
                "style": "none"
            },
            "sorting": {
                "enabled": true,
                "keepFocusedRow": true
            },
            "fixed": {
                "colBarWidth": 1
            },
            "dataBounding": false,
            "rowDynamic": [],
            "autoBind": true,
            "depth": 1,
            "maxDepth": 1,
            "grouping": false,
            "groupCol": 1,
            "maxGroupCol": 1,
            "context": true,
            "editSkip": false,
            "copyMode": 'cell',
            "isVisible": true,
            "fillWidth": true,
            "images": [],
            "icons": [],
            "displayColumns": []
        };

        opt = $.extend(true, defaultOptions, options);
        // 숫자 출력 유무 설정
        if ($.type(opt.rowNo) !== 'undefined') {
            if ($.type(opt.rowNo) === 'object') {
                opt.indicator.visible = true;
                opt.indicator.headText = $.type(opt.rowNo.text) === 'undefined' ? opt.indicator.headText : opt.rowNo.text;
                opt.indicator.width = $.type(opt.rowNo.width) === 'undefined' ? 40 : opt.rowNo.width;
            } else if ($.type(opt.rowNo) === 'boolean') {
                opt.indicator.visible = opt.rowNo;
            }
        }
        // 선택 유무 설정
        if ($.type(opt.selectable) !== 'undefined') {
            if (opt.selectable) {
                opt.select.style = 'singleRow';
            }
        }
        // 정렬 유무 설정
        if ($.type(opt.sortable) !== 'undefined') {
            opt.sorting.enabled = opt.sortable;
        }
        //수정 가능 유무 설정
        if ($.type(opt.editable) !== 'undefined') {
            opt.edit.editable = opt.editable;
        }
        // 체크 바 출력 유무 설정
        if ($.type(opt.checkable) !== 'undefined') {
            opt.checkBar.visible = opt.checkable;
        }
        // 상태 바 출력 유무 설정
        if ($.type(opt.stateColumn) === 'boolean') {
            opt.stateBar.visible = opt.stateColumn;
        }
        // 읽기전용 유무 설정
        if ($.type(opt.readOnly) !== 'undefined') {
            opt.edit.readOnly = opt.readOnly;
        }
        // 셀 스킵 기능 설정
        if ($.type(opt.editSkip) === 'boolean' && opt.editSkip) {
            opt.editSkip = true;
            opt.edit.skipReadOnly = true;
        }
        // 데이터가 없을 시 메시지 출력 설정
        if ($.type(opt.noData) !== 'undefined') {
            opt.display.showEmptyMessage = opt.noData;

            if (opt.display.showEmptyMessage && $.type(opt.noDataMessage) !== 'undefined') {
                opt.display.emptyMessage = opt.noDataMessage;
            }
        }
        // 복사 붙여넣기 시 행 복사, 셀 복사 설정
        if (opt.copyMode.toLowerCase() === 'row') {
            opt.copy.singleMode = false;
            opt.paste.singleMode = false;
        }
        // 트리 그리드 너비 지정 관련 설정
        if (!opt.fillWidth) {
            opt.display.fitStyle = 'none';
        }
        // 트리 그리드 resizable 옵션 설정
        if ($.type(opt.resizable) === 'boolean') {
            opt.display.columnResizable = opt.resizable;
        }
        // 트리 그리드 스타일 지정
        opt = setStyles(treeGrid, opt);
        // 컬럼 커스터 마이징 설정
        opt = customizingColumn(opt.columns, opt, self);
        delete opt.fieldIndex;
        treeGrid.setColumns(opt.columns);
        treeGrid.setHeader({height: opt.maxDepth * opt.header.minHeight});
        treeGrid.setFooter({minHeight: opt.footer.minHeight, height: opt.footer.height});
        if (opt.grouping) {
            opt.display.rowHeight = opt.display.minHeight * opt.maxGroupCol;
        }
        // 트리 그리드 데이터소스 설정
        if (opt.dataSource && opt.dataSource.dataProvider) {
            opt.dataSource.dataProvider.setFields(opt.dataSource.options.field);
            treeGrid.setDataProvider(opt.dataSource.dataProvider);
        }
        // 아이콘 설정
        if (opt.dataSource) {
            opt.dataSource.options.imageField = opt.imageField || '';
        }

        self._grid.setTreeOptions({
            expanderWidth: 15,
            iconWidth: 0
        });

        return opt;
    }

    // 트리 그리드 컬럼 커스터마이징
    function customizingColumn(columns, opt, treeGrid) {
        if (columns && opt.dataSource && opt.dataSource.options.field) {
            var dataSource = opt.dataSource.options;
            for (var i = 0; i < columns.length; i += 1) {
                if ($.type(columns[i]) !== 'undefined') {
                    columns[i].fieldName = columns[i].field;
                    if ($.type(columns[i].field) !== 'undefined') {
                        columns[i].name = columns[i].field;
                    }
                    for (var f = 0; f < dataSource.field.length; f += 1) {
                        if (columns[i].fieldName === dataSource.field[f].fieldName) {
                            opt.fieldIndex = f;
                            break;
                        }
                    }
                    if ($.type(columns[i].styles) === 'undefined') {
                        columns[i].styles = {};
                    }
                    // 트리 그리드 포맷 및 스타일 설정
                    if ($.type(opt.fieldIndex) !== 'undefined' && $.type(dataSource.field[opt.fieldIndex].styles) === 'undefined') {
                        dataSource.field[opt.fieldIndex].styles = {};
                    }
                    // 트리 그리드 에디터 기본값 설정
                    if ($.type(columns[i].editor) === 'undefined') {
                        columns[i].editor = {
                            type: 'text'
                        };
                    }
                    // 트리 그리드 너비 지정 유무 설정
                    if ($.type(columns[i].width) === 'undefined' && opt.display.fitStyle === 'fill') {
                        columns[i].fillWidth = 1;
                    }
                    // 트리 그리드 컬럼 문구 설정
                    if (columns[i].title) {
                        columns[i].header = $.extend(true, columns[i].header, {
                            text: columns[i].title,
                            fixedHeight: opt.display.rowIndex
                        });
                    } else {
                        columns[i].header = {
                            text: ' '
                        };
                    }
                    // 트리 그리드 문자 정렬 기본값 설정
                    if ($.type(opt.styles) !== 'undefined' && $.type(opt.styles.textAlign) !== 'undefined') {
                        columns[i].align = opt.styles.textAlign;
                    } else if ($.type(columns[i].align) === 'undefined') {
                        columns[i].align = 'center';
                    }
                    // 트리 그리드 문자 정렬 설정
                    if (columns[i].align) {
                        var align;
                        if (columns[i].align === 'right') {
                            align = 'far';
                        } else if (columns[i].align === 'left') {
                            align = 'near';
                        } else {
                            align = 'center';
                        }
                        columns[i].styles.textAlignment = align;
                    }
                    // 트리 그리드 포맷 설정
                    if (columns[i].formats) {
                        if ($.type(columns[i].formats.type) === 'undefined') {
                            columns[i].formats.type = 'text';
                        }
                        switch ((columns[i].formats.type).toUpperCase()) {
                            case 'DATE':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = dews._environments.formats.dateFormat;
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].datetimeFormat =  dews._environments.formats.dateValueFormat;
                                    // dataSource.field[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.field[opt.fieldIndex].dataType = 'datetime';
                                    dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat =  dews._environments.formats.dateValueFormat;
                                    // dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'datetime';
                                }
                                columns[i].styles.datetimeFormat = $.type(columns[i].formats.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].formats.format;
                                break;
                            case 'LINK':
                                columns[i].renderer = $.extend(true, columns[i].renderer, {
                                    'type': 'link',
                                    'url': dews.url.getAbsoluteUrl('${' + columns[i].field + '}'),
                                    'showUrl': false
                                });
                                break;
                            case 'MASK':
                                var mask = columns[i].formats.format, replace = '', exp = '(', regchar = '',
                                    regcount = 1, expcount = 0;
                                for (var m = 0; m < mask.length; m += 1) {
                                    if (mask[m] !== regchar && regchar === '*') {
                                        exp += '{' + expcount + '})(';
                                        expcount = 0;
                                        regcount++;
                                    }
                                    switch (mask[m]) {
                                        case '0':
                                        case '9':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\d';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '#':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\d';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'L':
                                        case '?':
                                            if (expcount === 0) {
                                                exp += '[a-zA-Z]';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}[a-zA-Z]';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '&':
                                            if (expcount === 0) {
                                                exp += '\\S';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}\\S';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'C':
                                            if (expcount === 0) {
                                                exp += '.';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}.';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case 'A':
                                        case 'a':
                                            if (expcount === 0) {
                                                exp += '[a-zA-Z0-9]';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '}[a-zA-Z0-9]';
                                                expcount = 0;
                                            }
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        case '*':
                                            if (expcount === 0) {
                                                exp += '\\d';
                                            } else if (regchar !== mask[m]) {
                                                exp += '{' + expcount + '})(\\d';
                                                replace += '$' + regcount;
                                                expcount = 0;
                                                regcount++;
                                            }
                                            replace += '*';
                                            regchar = mask[m];
                                            expcount++;
                                            break;
                                        default:
                                            if (mask[m] !== '*') {
                                                replace += '$' + regcount + mask[m];
                                            }
                                            exp += '{' + expcount + '})(';
                                            expcount = 0;
                                            regcount++;
                                            break;
                                    }
                                    if (m === mask.length - 1) {
                                        exp += '{' + expcount + '})';
                                        if (regchar !== '*') {
                                            replace += '$' + regcount;
                                        }
                                    }
                                }
                                columns[i].displayRegExp = exp;
                                columns[i].displayReplace = replace;
                                break;
                            case 'NUMBER':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = '#,##0.##';
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].dataType = 'number';
                                    dataSource.field[opt.fieldIndex].min = columns[i].formats.min;
                                    dataSource.field[opt.fieldIndex].max = columns[i].formats.max;
                                    dataSource.field[opt.fieldIndex].styles.numberFormat = $.type(columns[i].formats.format) === 'undefined' ? '#,##0.##' : columns[i].formats.format;
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                                    dataSource.schema.model.fields[opt.fieldIndex].numberFormat = $.type(columns[i].formats.format) === 'undefined' ? '#,##0.##' : columns[i].formats.format;
                                }
                                columns[i].styles.numberFormat = columns[i].formats.format;
                                break;
                            case 'CHECK':
                                columns[i].renderer = {
                                    'type': 'check',
                                    'shape': 'box',
                                    'editable': false,
                                    'startEditOnClick': true,
                                    'trueValues': $.type(columns[i].formats.trueValue) === 'undefined' ? 'true' : columns[i].formats.trueValue,
                                    'falseValues': $.type(columns[i].formats.falseValue) === 'undefined' ? 'false' : columns[i].formats.falseValue,
                                    'trueImage': opt.gridStyle.body.checkedImg,
                                    'falseImage': opt.gridStyle.body.unCheckImg,
                                    'labelPosition': 'none',
                                    'showInnerFocus': false
                                };
                                columns[i].editable = false;
                                columns[i].styles.figureBackground = '#ff4995ff';
                                break;
                            case 'DATASOURCE':
                                var value = columns[i].formats.dataValueField,
                                    label = columns[i].formats.dataTextField;
                                columns[i].values = [];
                                columns[i].labels = [];
                                columns[i].lookupDisplay = true;
                                if (columns[i].formats.dataSource.transport.data.length > 0) {
                                    for (var k = 0; k < columns[i].formats.dataSource.transport.data.length; k += 1) {
                                        columns[i].values.push(columns[i].formats.dataSource.transport.data[k][value]);
                                        columns[i].labels.push(columns[i].formats.dataSource.transport.data[k][label]);
                                    }
                                }
                                break;
                            case 'IMAGE':
                                columns[i].editable = false;
                                columns[i].renderer = {
                                    type: 'image',
                                    smoothing: true
                                };
                                columns[i].styles.contentFit = 'auto';
                                break;
                            case 'TIME':
                                if (columns[i].formats.predefined === true) {
                                    if ($.type(columns[i].formats.preFormat) === 'undefined') {
                                        columns[i].formats.preFormat = columns[i].formats.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].formats);

                                    if (preDefinedFormat) {
                                        columns[i].formats.format = preDefinedFormat;
                                    } else {
                                        columns[i].formats.format = "HH:mm:ss";
                                    }
                                }

                                var time = columns[i].formats.format, timeReg = '';
                                if (/HH/gi.test(time)) {
                                    timeReg = time.replace(/HH/gi, '$1');
                                }
                                if (/mm/gi.test(time)) {
                                    timeReg = timeReg.replace(/mm/gi, '$2');
                                }
                                if (/ss/gi.test(time)) {
                                    timeReg = timeReg.replace(/ss/gi, '$3');
                                }

                                columns[i].displayRegExp = /([0-1]\d|2[0-3])([0-5]\d)([0-5]\d)?/gi;
                                columns[i].displayReplace = timeReg;
                                break;
                            case 'PASSWORD':
                                var format = columns[i].formats.format;

                                columns[i].displayRegExp = /([a-z0-9#?!@$%^~&*-]+)/gi;
                                columns[i].displayReplace = format;
                        }
                    }
                    // 트리 그리드 에디터 설정
                    if (columns[i].editor) {
                        var editorAlign = 'center';
                        if (columns[i].styles.textAlignment) {
                            editorAlign = columns[i].styles.textAlignment;
                        }
                        if ($.type(columns[i].editor.type) === 'undefined') {
                            columns[i].editor.type = 'string';
                        }
                        columns[i].editor.textAlignment = editorAlign;

                        switch ((columns[i].editor.type).toUpperCase()) {
                            case 'DROPDOWN':
                            case 'COMBO':
                                var values = columns[i].editor.dataValueField,
                                    labels = columns[i].editor.dataTextField,
                                    datasource = columns[i].editor.dataSource;
                                columns[i].values = [];
                                columns[i].labels = [];
                                columns[i].editButtonVisibility = 'visible';
                                if ((columns[i].editor.type).toUpperCase() === 'DROPDOWN') {
                                    columns[i].editor.textReadOnly = true;

                                    if (columns[i].editor.autoOpen) {
                                        columns[i].editor.autoOpen = true;
                                    }
                                } else {
                                    columns[i].editor.textReadOnly = false;
                                }
                                columns[i].editor.type = 'dropDown';
                                columns[i].lookupDisplay = true;
                                columns[i].editor.dropdowncount = 3;
                                columns[i].labelField = labels;
                                if ($.type(columns[i].editor.dataSource) === 'function') {
                                    datasource = columns[i].editor.dataSource.call(treeGrid, {
                                        treeGrid: treeGrid,
                                        row: {
                                            index: 0,
                                            data: {
                                                labels: '',
                                                values: ''
                                            }
                                        }
                                    });
                                }

                                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                                    for (var j = 0; j < datasource.transport.data.length; j += 1) {
                                        columns[i].values.push(datasource.transport.data[j][values]);
                                        columns[i].labels.push(datasource.transport.data[j][labels]);
                                    }
                                }
                                break;
                            case 'NUMBER':
                                if (columns[i].editor.predefined === true) {
                                    if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                        columns[i].editor.preFormat = columns[i].editor.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                    if (preDefinedFormat) {
                                        columns[i].editor.format = preDefinedFormat;
                                    } else {
                                        columns[i].editor.format = '#,##0.##';
                                    }
                                }

                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].dataType = 'number';
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                                    dataSource.field[opt.fieldIndex].min = columns[i].editor.min;
                                    dataSource.field[opt.fieldIndex].max = columns[i].editor.max;
                                }
                                columns[i].editor.editFormat = $.type(columns[i].editor.format) === 'undefined' ? '#,##0.##' : columns[i].editor.format;
                                columns[i].styles.numberFormat = $.type(columns[i].editor.format) === 'undefined' ? '#,##0.##' : columns[i].editor.format;
                                columns[i].editor.increaseValue = $.type(columns[i].editor.increaseValue) === 'undefined' ? 1000 : parseFloat(columns[i].editor.increaseValue);
                                columns[i].editor.increaseType = $.type(columns[i].editor.increaseType) === 'undefined' ? 'multiple' : columns[i].editor.increaseType;
                                break;
                            case 'STRING':
                                columns[i].editor.type = 'text';
                                break;
                            case 'DATE':
                                if (columns[i].editor.predefined === true) {
                                    if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                        columns[i].editor.preFormat = columns[i].editor.format;
                                    }
                                    var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                    if (preDefinedFormat) {
                                        columns[i].editor.format = preDefinedFormat;
                                    } else {
                                        columns[i].editor.format = dews._environments.formats.dateFormat;
                                    }
                                }

                                columns[i].editor.yearDisplayFormat = '{Y}' + dews.localize.get('년', 'dews_년Y');
                                columns[i].editor.months = dews.localize.getMonth();
                                columns[i].editor.weekDays = dews.localize.getDays();
                                columns[i].editor.minDate = new Date(1900, 0, 1);
                                columns[i].editor.maxDate = new Date(2100, 12, 0);
                                columns[i].editor.datetimeFormat = $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].editor.format;
                                columns[i].styles.datetimeFormat = $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : columns[i].editor.format;
                                columns[i].editor.mask = {
                                    editMask: $.type(columns[i].editor.format) === 'undefined' ? dews._environments.formats.dateFormat : (columns[i].editor.format).replace(/[A-z\\s]/gi, '9'),
                                    includedFormat: true
                                };
                                columns[i].editButtonVisibility = 'visible';
                                if ($.type(opt.fieldIndex) !== 'undefined') {
                                    dataSource.field[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.field[opt.fieldIndex].datetimeFormat = 'iso';
                                    dataSource.field[opt.fieldIndex].dataType = 'datetime';
                                    dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = dews._environments.formats.dateValueFormat;
                                    // dataSource.schema.model.fields[opt.fieldIndex].datetimeFormat = 'iso'; // 서버에서 date형식으로 넘어올 경우 사용해야함
                                    dataSource.schema.model.fields[opt.fieldIndex].dataType = 'datetime';
                                }
                                break;
                            case 'READONLY':
                                columns[i].readOnly = true;
                                columns[i].editable = false;
                                break;
                            case 'MASK':
                            case 'TIME':
                                var editMask = columns[i].editor.format;
                                if (editMask) {
                                    for (var em = 0; em < editMask.length; em += 1) {
                                        switch (editMask[em]) {
                                            case 'L':
                                            case '?':
                                            case '#':
                                            case '&':
                                                editMask = editMask.replace(editMask[em], 'a');
                                                break;
                                            case 'A':
                                            case 'a':
                                                editMask = editMask.replace(editMask[em], '*');
                                                break;
                                            case 'H':
                                            case 'm':
                                            case 's':
                                                editMask = editMask.replace(editMask[em], '0');
                                                break;
                                        }
                                    }
                                }
                                if (columns[i].editor.type.toUpperCase() === 'TIME') {
                                    columns[i].editor.type = 'time';
                                    if (columns[i].editor.predefined === true) {
                                        if ($.type(columns[i].editor.preFormat) === 'undefined') {
                                            columns[i].editor.preFormat = columns[i].editor.format;
                                        }
                                        var preDefinedFormat = dews.getPreDefinedFormat(columns[i].editor);

                                        if (preDefinedFormat) {
                                            editMask = preDefinedFormat;
                                        } else {
                                            editMask = "HH:mm:ss";
                                        }
                                    }
                                } else {
                                    columns[i].editor.type = 'text';
                                }
                                columns[i].editor.mask = {
                                    editMask: editMask,
                                    allowEmpty: true
                                };
                                break;
                            case 'CODEPICKER':
                                columns[i].button = 'image';
                                columns[i].buttonVisibility = 'visible';
                                columns[i].imageButtons = {
                                    'width': 24,
                                    'height': 22,
                                    'images': [{
                                        'name': 'codepickerbutton',
                                        'up': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'hover': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'down': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png'
                                    }]
                                };
                                opt._grid = true;
                                columns[i].codeOption = {
                                    field: columns[i].field,
                                    code: columns[i].editor.helpCode,
                                    codeField: columns[i].editor.codeField,
                                    textField: columns[i].editor.textField,
                                    params: columns[i].editor.helpParams,
                                    size: columns[i].editor.helpSize,
                                    title: columns[i].editor.helpTitle,
                                    mode: 'single',
                                    width: columns[i].editor.helpWidth,
                                    height: columns[i].editor.helpHeight,
                                    initData: columns[i].editor.initData,
                                    callback: columns[i].editor.callback,
                                    custom: columns[i].editor.helpCustom || false,
                                    viewUrl: columns[i].editor.helpViewUrl,
                                    apiUrl: columns[i].editor.helpApiUrl,
                                    useAjax: $.type(columns[i].editor.useAjax) === 'boolean' ? columns[i].editor.useAjax : true,
                                    validation: $.type(columns[i].editor.validation) === 'boolean' ? columns[i].editor.validation : true,
                                    value: {}
                                };
                                break;
                            case 'BUTTON':
                                columns[i].buttonVisibility = 'always';
                                columns[i].renderer = {
                                    type: 'imageButton',
                                    text: columns[i].editor.buttonText || '',
                                    width: $.type(columns[i].editor.buttonWidth) === 'undefined' ? 50 : columns[i].editor.buttonWidth,
                                    height: $.type(columns[i].editor.buttonHeight) === 'undefined' ? 25 : columns[i].editor.buttonHeight,
                                    imageUrl: columns[i].editor.basicImg,
                                    hoverUrl: columns[i].editor.hoverImg,
                                    activeUrl: columns[i].editor.clickImg
                                };
                                break;
                            case 'CHECK':
                                columns[i].renderer = {
                                    'type': 'check',
                                    'shape': 'box',
                                    'editable': true,
                                    'startEditOnClick': true,
                                    'trueValues': $.type(columns[i].editor.trueValue) === 'undefined' ? 'true' : columns[i].editor.trueValue,
                                    'falseValues': $.type(columns[i].editor.falseValue) === 'undefined' ? 'false' : columns[i].editor.falseValue,
                                    'trueImage': opt.gridStyle.body.checkedImg,
                                    'falseImage': opt.gridStyle.body.unCheckImg,
                                    'labelPosition': 'none',
                                    'showInnerFocus': false
                                };
                                columns[i].editable = false;
                                columns[i].styles.figureBackground = '#ff4995ff';
                                break;
                            case 'ZIPCODEPICKER':
                                columns[i].button = 'image';
                                columns[i].buttonVisibility = 'visible';
                                columns[i].imageButtons = {
                                    'width': 24,
                                    'height': 22,
                                    'images': [{
                                        'name': 'zipcodepickerbutton',
                                        'up': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'hover': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png',
                                        'down': 'https://dews.comet.duzon.net/dews/realgrid/assets/search_ico.png'
                                    }]
                                };
                                opt._grid = true;
                                columns[i].codeOption = {
                                    field: columns[i].field,
                                    addressType: $.type(columns[i].editor.addressType) === 'undefined' ? 'zipcode' : columns[i].editor.addressType,
                                    callback: columns[i].editor.callback
                                };
                                break;

                            case 'MULTILINE':
                                columns[i].editor.type = 'multiline';
                                columns[i].styles.textWrap = 'explicit';
                        }
                    }
                    // 트리 그리드 필수값,읽기전용 색상 설정
                    if (columns[i].attributes) {
                        if (columns[i].attributes.class === 'required') {
                            columns[i].styles.background = opt.gridStyle.body.requiredBackground;
                        } else if (columns[i].attributes.class === 'readonly') {
                            columns[i].styles.background = '#f8f7f6';
                            columns[i].readOnly = true;
                            columns[i].editable = false;
                        }
                    }
                    // 트리 그리드 푸터 사용
                    if (columns[i].footer) {
                        opt.footer.visible = true;
                        if (columns[i].footer.styles === undefined) {
                            var footerAlign = 'center';
                            if (columns[i].styles.textAlignment) {
                                footerAlign = columns[i].styles.textAlignment;
                            }
                            columns[i].footer.styles = {
                                textAlignment: footerAlign
                            };
                        }

                        if ($.type(columns[i].footer.align) !== 'undefined') {
                            switch (columns[i].footer.align.toLowerCase()) {
                                case 'left':
                                    columns[i].footer.styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    columns[i].footer.styles.textAlignment = 'far';
                                    break;
                                default:
                                    columns[i].footer.styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if (columns[i].footer.type) {
                            if ($.type(opt.fieldIndex) !== 'undefined' && columns[i].footer.type.toLowerCase() !== 'count') {
                                dataSource.field[opt.fieldIndex].dataType = 'number';
                                dataSource.schema.model.fields[opt.fieldIndex].dataType = 'number';
                            }
                            columns[i].footer.expression = columns[i].footer.type;
                            columns[i].footer.styles.numberFormat = $.type(columns[i].footer.format) === 'undefined' ? '#,##0.##' : columns[i].footer.format;

                            if (columns[i].footer.predefined === true) {
                                if ($.type(columns[i].footer.preFormat) === 'undefined') {
                                    columns[i].footer.preFormat = columns[i].footer.format;
                                }
                                var preDefinedFormat = dews.getPreDefinedFormat(columns[i].footer);

                                if (preDefinedFormat) {
                                    columns[i].footer.styles.numberFormat = preDefinedFormat;
                                } else {
                                    columns[i].footer.styles.numberFormat = '#,##0.##';
                                }
                            }
                        }

                        // 트리 그리드 푸터 접두사
                        if (columns[i].footer.prefix) {
                            columns[i].footer.styles.prefix = columns[i].footer.prefix;
                        }
                        // 트리 그리드 푸터 접미사
                        if (columns[i].footer.suffix) {
                            columns[i].footer.styles.suffix = columns[i].footer.suffix;
                        }
                    }
                    // 트리 그리드 접두사
                    if (columns[i].suffix) {
                        columns[i].styles.suffix = columns[i].suffix;
                    }
                    // 트리 그리드 접미사
                    if (columns[i].prefix) {
                        columns[i].styles.prefix = columns[i].prefix;
                    }
                    // 트리 그리드 그룹핑 사용
                    if ($.type(columns[i].grouping) === 'boolean' && columns[i].grouping) {
                        columns[i].type = 'group';
                        columns[i].orientation = 'vertical';
                        opt.grouping = true;
                        opt.groupCol = columns[i].columns.length;
                        if (opt.groupCol > opt.maxGroupCol) {
                            opt.maxGroupCol = opt.groupCol;
                        }
                    }
                    // 트리 그리드 다중 헤더 컬럼 사용시
                    if (columns[i].columns) {
                        columns[i].type = 'group';
                        if (!columns[i].hideChildHeaders) {
                            opt.depth += 1;
                        }
                        columns[i].name = '_he@der_name_' + opt.depth + '' + i + '' + parseInt(Math.random() * 1000);
                        // 그리드 헤더 컬럼 visible 설정
                        if ($.type(columns[i].visible) === 'boolean') {
                            columns[i].header.visible = columns[i].visible;
                            delete columns[i].visible;
                        }
                        customizingColumn(columns[i].columns, opt, treeGrid);
                    } else {
                        if (opt.depth > opt.maxDepth) {
                            opt.maxDepth = opt.depth;
                        }
                        opt.depth = 1;
                    }
                }
            }
            opt.columns = columns;
            opt.dataSource.options = dataSource;
            treeGrid.dataSource = opt.dataSource;
        }
        return opt;
    }

    // 트리 그리드 스타일 재정의
    function setStyles(treeGrid, options) {
        var self = treeGrid,
            opt = options;

        return opt = dews.ui.gridUtil.setStyles(self, opt);
    }

    // 해당 그리드 display: none 인지 확인
    function isVisible(treeGrid) {
        var self = treeGrid;

        return self.$element.is(':visible');
    }

    // 트리그리드 생성
    var TreeGrid = function (element, options) {
        var self = this,
            option,
            realTreeGrid,
            realTreeGridID,
            id = element.attr('ID');

        realTreeGrid = $('<div></div>');
        if (dews.ui.dialogPage && element.closest(dews.ui.dialogPage.$content).length) {
            options.$content = dews.ui.dialogPage.$content;
            realTreeGridID = dews.ui.dialogPage.id + '_' + id;
        } else if (dews.ui.page && element.closest(dews.ui.page.$content).length) {
            options.$content = dews.ui.page.$content;
            realTreeGridID = dews.ui.page.id + '_' + id;
        } else {
            options.$content = $(document);
            realTreeGridID = 'child_' + id;
        }
        realTreeGrid.attr('ID', realTreeGridID);
        $('#' + id, options.$content).append(realTreeGrid);

        if (options.height) {
            realTreeGrid.css('height', options.height + 'px');
        } else {
            realTreeGrid.css('height', '635px');
        }

        self._grid = new RealGridJS.TreeView(realTreeGridID);
        self._grid.name = realTreeGridID;
        self.$element = $('#' + self._grid.name);
        if ($.type(loadgridStyle) === 'undefined') {
            var gridTheme = 'grid.json';
            var themeUrl = $.type(dews.theme) === 'undefined' ? $('head link[data-role="dews-theme"]').attr('href') : dews.theme.getCurrentThemeUrl();
            if (themeUrl.length === 0) {
                $('head link[href*="dews."]').each(function (idx, link) {
                    if ($(link).attr('href').match(/(dews\.?[^./]*\.css.*)/) && $(link).attr('disabled') !== 'disabled') {
                        options.url = $(link).attr('href').replace(/(dews\.?[^./]*\.css.*)/, '');
                    }
                });
            } else {
                options.url = themeUrl.replace(/([^\/]*\.css$)/, '');
                var theme = $.isFunction(window.getThemes) ? window.getThemes() : '';
                if (theme && theme[0] && theme[0].colors) {
                    $.each(theme[0].colors, function (idx, item) {
                        if (themeUrl.match(item.name)) {
                            gridTheme = 'grid.' + item.name + '.json';
                        }
                    });
                }
            }

            dews.ajax.get(options.url + gridTheme, {async: false, dataType: 'json'}).done(function (style) {
                loadgridStyle = style;
                options.gridStyle = style;
            }).fail(function () {
                options.gridStyle = dews.ui.gridUtil.gridStyle;
                console.log('트리 그리드 스타일 로드 실패');
            });
        } else {
            options.gridStyle = loadgridStyle;
        }

        self._grid.setStyles(options.gridStyle);
        option = getOptions(self, options);
        self._grid.setOptions(option);
        self.options = option;
        self.focused = false;
        self.columns = {};
        if (self.options.columns) {
            dews.ui.gridUtil._setColumns(self, self.options.columns);
        }

        self._bindEvent();

        if (self.options.dataSource && self.options.autoBind) {
            self.options.dataSource.read();
        }

        // 트리그리드 컨텍스트메뉴 설정
        if (self.options.context !== false) {
            self.setContextMenu(self.options.context);
        }
        // 트리 그리드 브라우저 resize 시 다른탭 이동할 경우 트리 그리드 사라지는 문
        setInterval(function () {
            if (!self.options.isVisible && isVisible(self)) {
                self._grid.resetSize();
                self.options.isVisible = true;
            } else {
                self.options.isVisible = false;
            }
        }, 100);

        if (self.options.columns) {
            dews.ui.gridUtil.displayColumns(self, self._grid.getDisplayColumns());
            self._grid.setColumnProperty(self.options.displayColumns[0].field, 'styles', {paddingLeft: 4});
        }

        return self;
    };

    dews = $.extend(true, dews, {
        ui: {
            /**
             * 트리 그리드 컨트롤을 생성합니다.
             *
             * @param {jQuery|String} selector 트리 그리드 생성 대상
             * @param {Object} [options] 트리 그리드 옵션
             */
            treegrid: function (selector, options) {
                var $el, treeGrid, $content;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    if (dews.ui.dialogPage) {
                        $content = dews.ui.dialogPage.$content;
                    } else if (dews.ui.page) {
                        $content = dews.ui.page.$content;
                    } else {
                        $content = $(document);
                    }
                    $el = $(selector, $content);
                }

                if ($.type($el) === "undefined") {
                    return;
                }

                $el.each(function () {
                    var treeGridView, $this = $(this);

                    treeGridView = $this.data('dews-control');

                    if (!treeGridView) {
                        if ($.type(options) === 'undefined') {
                            options = {};
                        }

                        if (!$this.hasClass('dews-data-control')) {
                            $this.addClass('dews-data-control');
                        }

                        RealGridJS.setRootContext(dews._environments.scriptBase + 'realgrid');
                        treeGridView = new TreeGrid($el, options);
                        $this.data('dews-control', treeGridView);
                    }

                    treeGrid = treeGridView;
                });

                return treeGrid;
            }
        }
    });
    /**
     * 트리그리드에 이벤트를 설정합니다.
     */
    TreeGrid.prototype.on = function () {
        var self = this;

        self.$element.on.apply(self.$element, arguments);
    };
    /**
     * 트리그리드에 이벤트를 해제 합니다.
     */
    TreeGrid.prototype.off = function () {
        var self = this;

        self.$element.off.apply(self.$element, arguments);
    };
    /**
     * 트리그리드 자식 노드에 추가합니다.
     * @param index 추가할 부모 노드의 index
     * @param value 추가할 노드의 값
     */
    TreeGrid.prototype.append = function (index, value) {
        var self = this;

        if ($.type(index) === 'object' || $.type(index) === 'undefined') {
            if ($.type(index) === 'object') {
                value = index;
            }
            index = -1;
        }

        if ($.type(value) === 'undefined') {
            value = {};
        }

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            if ($.type(self.options.dataBounding) === 'boolean' && !self.options.dataBounding) {
                self.options.dataBounding = true;
            }
            self.options.add = true;
            self.options.dataSource.dataProvider.addChildRow(index, value, '', false);
        }
    };
    /**
     * 트리그리드 노드 삭제합니다.
     * @param index 삭제할 노드의 index
     */
    TreeGrid.prototype.remove = function (index) {
        var self = this,
            rows = [],
            previous = self._grid.getCurrent(),
            dataProvider = self.options.dataSource.dataProvider;

        if ($.type(index) === 'array') {
            rows = index;
        } else {
            rows.push(index);
        }

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            var parameter = {
                treegrid: self,
                row: {
                    data: self.dataItems(rows),
                    index: rows
                }
            };

            var event = new $.Event('rowRemove', parameter);
            self.$element.trigger(event);

            for (var j = rows.length - 1; j >= 0; j -= 1) {
                if (dataProvider.getRowState(rows[j]) !== 'created') {
                    var deleteData = dataProvider.getJsonRow(rows[j]),
                        parentId = dataProvider.getParent(rows[j]);
                    deleteData.__parent = dataProvider.getJsonRow(parentId);
                    deleteData.__sequence;
                    $.each(dataProvider.getChildren(parentId), function (index, rowId) {
                        if (rowId === rows[j]) {
                            deleteData.__sequence = index;
                        }
                    });

                    self.options.dataSource.options._destroy.push(deleteData);
                }
                dataProvider.removeRow(rows[j]);
            }

            if (self._grid.getCurrent().itemIndex !== -1 && self._grid.getItemCount() !== self._grid.getCurrent().itemIndex) {
                self._grid.onCurrentChanging.call(self, self._grid, previous, self._grid.getCurrent());
                self.options.rowChange = true;
                self._grid.onCurrentChanged.call(self, self._grid, self._grid.getCurrent());
            }
        }
    };
    /**
     * 트리그리드 형제 노드를 앞에 삽입합니다.
     * @param index 형제 노드 앞에 삽입할 index
     * @param value 삽입 할 값
     */
    TreeGrid.prototype.insertBefore = function (index, value) {
        var self = this;

        if ($.type(index) === 'object' || $.type(index) === 'undefined') {
            if ($.type(index) === 'object') {
                value = index;
            }
            index = -1;
        }

        if ($.type(value) === 'undefined') {
            value = {};
        }

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            var parentId = self.options.dataSource.dataProvider.getParent(index);
            var count = 0;

            $.each(self.options.dataSource.dataProvider.getChildren(parentId), function (idx, target) {
                if (index === target) {
                    count = idx;
                }
            });
            self.options.add = true;
            self.options.dataSource.dataProvider.insertChildRow(parentId, count, value, '', false);
            self._grid.onCurrentChanging.call(self, self._grid, self._grid.getCurrent(), self._grid.getCurrent());
            self._grid.onCurrentChanged.call(self, self._grid, self._grid.getCurrent());
        }
    };
    /**
     * 트리그리드 형제 노드를 뒤에 삽입합니다.
     * @param index 형제 노드 뒤에 삽입할 index
     * @param value 삽입 할 값
     */
    TreeGrid.prototype.insertAfter = function (index, value) {
        var self = this;

        if ($.type(index) === 'object' || $.type(index) === 'undefined') {
            if ($.type(index) === 'object') {
                value = index;
            }
            index = -1;
        }

        if ($.type(value) === 'undefined') {
            value = {};
        }

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            var parentId = self.options.dataSource.dataProvider.getParent(index);
            var count = 0;

            $.each(self.options.dataSource.dataProvider.getChildren(parentId), function (idx, target) {
                if (index === target) {
                    count = idx;
                }
            });
            self.options.add = true;
            self.options.dataSource.dataProvider.insertChildRow(parentId, count + 1, value, '', false);
        }
    };
    /**
     * 트리그리드에서 현재 선택된 index를 반환하거나 선택할 노드를 설정합니다.s
     * @param index 이동할 행의 index 설정
     * @param field 이동할 행의 field명 설정
     * @return index 현재 선택한 행의 index를 반환
     */
    TreeGrid.prototype.select = function (index, field) {
        var self = this,
            column = self._grid.getCurrent().column;

        if ($.type(field) !== 'undefined') {
            column = field;
        }

        if ($.type(index) !== 'undefined') {
            var parents = self.options.dataSource.dataProvider.getAncestors(index);
            if (parents.length !== 0) {
                for (var i = parents.length - 1; i >= 0; i--) {
                    self._grid.expand(self._grid.getItemIndex(parents[i]), false, false);
                }
            }
            self._grid.setCurrent({itemIndex: self._grid.getItemIndex(index), column: column});
        } else {
            return self._grid.getCurrent().dataRow;
        }
    };
    /**
     * 트리그리드 지정한 필드에서 값을 선택해서 확장 합니다.
     * @param rowId 필드명 설정
     * @param bool 자식노드 확장 여부 설정
     */
    TreeGrid.prototype.expand = function (rowId, bool) {
        var self = this,
            boolean = false,
            index = rowId;

        if ($.type(bool) === 'boolean') {
            boolean = bool;
        }

        var parents = self.options.dataSource.dataProvider.getAncestors(rowId);
        if (parents && parents.length !== 0) {
            for (var i = parents.length - 1; i >= 0; i--) {
                self._grid.expand(self._grid.getItemIndex(parents[i]), boolean, boolean);
            }
        }
        self._grid.expand(self._grid.getItemIndex(index), boolean, boolean);
    };
    /**
     * 트리그리드의 전체 노드를 펼칩니다.
     */
    TreeGrid.prototype.expandAll = function () {
        var self = this;

        self._grid.expandAll();
    };
    /**
     * 펼쳐지 노드를 닫습니다.
     * @param rowId 닫힐 노드의 rowId
     */
    TreeGrid.prototype.collapse = function (rowId) {
        var self = this;

        self._grid.collapse(self._grid.getItemIndex(rowId));
    };
    /**
     * 트리그리드의 전체 노드를 닫습니다.
     */
    TreeGrid.prototype.collapseAll = function () {
        var self = this;

        self._grid.collapseAll();
    };
    /**
     * 트리그리드에서 지정한 행의 데이터를 반환 합니다.
     * @param index 지정한 행의 index
     * @returns {*} 반환한 데이터
     */
    TreeGrid.prototype.dataItem = function (index) {
        var self = this;

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            return self.options.dataSource.dataProvider.getJsonRow(index);
        }
    };
    /**
     * 트리그리드에서 전체 데이터 혹은 지정한 행의 데이터를 반환 합니다.
     * @param index 지정한 행의 index 또는 index 배열
     * @returns {*} 반환할 데이터
     */
    TreeGrid.prototype.dataItems = function (index) {
        var self = this,
            data = [];

        if ($.type(index) !== 'undefined') {
            if ($.type(index) === 'number' && index > 0) {
                return self.options.dataSource.dataProvider.getJsonRow(index);
            } else if ($.type(index) === 'array') {
                for (var i = 0; i < index.length; i++) {
                    data.push(self.options.dataSource.dataProvider.getJsonRow(index[i]));
                }
                return data;
            }
        } else {
            return self.options.dataSource.data();
        }

    };
    /**
     * 트리그리드에서 값을 설정합니다.
     * @param index 값을 설정할 행 index
     * @param field 값을 설정할 column 명
     * @param value 설절할 값
     */
    TreeGrid.prototype.setCellValue = function (index, field, value) {
        var self = this;

        if (index === self._grid.getCurrent().dataRow) {
            index = self._grid.getItemIndex(index);
        }

        self._grid.setValue(index, field, value);

        self.options.commit = true;
        self._grid.commit();
    };
    /**
     * 트리 그리드에서 지정한 셀 값 가져오기
     * @param row (number) 값을 가져올 행 index
     * @param field (string) 값을 가져올 field 명
     */
    TreeGrid.prototype.getCellValue = function (row, field) {
        var self = this;

        return self._grid.getValue(self._grid.getItemIndex(row), field);
    };
    /**
     * 트리그리드에 데이터소스를 정의 합니다.
     * @param dataSource 정의할 트리데이터소스
     */
    TreeGrid.prototype.setDataSource = function (dataSource) {
        var self = this;

        self.options.dataSource = dataSource;
        self.options = customizingColumn(self.options.columns, self.options, self);
        delete self.options.fieldIndex;
        self.options.dataSource.dataProvider._dp.setJsonRows = setRow(self, self.options.dataSource.dataProvider._dp.setJsonRows);
        self._grid.setDataProvider(self.options.dataSource.dataProvider);
        self._grid.setColumns(self.options.columns);
        self._grid.setHeader({height: self.options.maxDepth * self.options.header.minHeight});
        if (self.options.grouping) {
            self.options.display.rowHeight = self.options.display.minHeight * self.options.maxGroupCol;
        }
        self._grid.setOptions(self.options);
    };
    /**
     * 트리그리드 컬럼을 설정합니다.
     * @param columns 재설정할 컬럼
     */
    TreeGrid.prototype.setColumns = function (columns) {
        var self = this,
            result = customizingColumn(columns, self.options, self);

        dews.ui.gridUtil.setColumns(self, result);
    };
    /**
     * 트리그리드 옵션을 설정합니다.
     * @param options 설정할 옵션
     */
    TreeGrid.prototype.setOptions = function (options) {
        var self = this;

        options = $.extend(true, {}, self.options, options);
        self.options = getOptions(self, options);
        self._grid.setOptions(self.options);
        self.columns = {};
        dews.ui.gridUtil._setColumns(self, self.options.columns);
    };

    /**
     * 헤더 체크박스 설정
     * @param bool check: true, uncheck: false
     */
    TreeGrid.prototype.setHeaderCheck = function (boolean) {
        this._grid.setAllCheck(boolean);
        this._grid.checkAll(boolean);
    };

    /**
     * 현재 체크된 행의 특정 필드의 데이터를 반환합니다.
     * @param field 필드명
     * @return {Array} 반환한 데이터
     */
    TreeGrid.prototype.getCheckedValues = function (field) {
        return dews.ui.gridUtil.getCheckedValues(this, field);
    };
    /**
     * 현재 체크된 행의 데이터를 반환합니다.
     * @returns {Array} 체크된 행의 데이터
     */
    TreeGrid.prototype.getCheckedRows = function () {
        return dews.ui.gridUtil.getCheckedRows(this);
    };
    /**
     * 현재 체크된 행의 index를 반홥합니다.
     * @return {Array} 체크된 행의 인덱스
     */
    TreeGrid.prototype.getCheckedIndex = function () {
        var self = this;

        return self._grid.getCheckedRows();
    };
    /**
     * 트리그리드에 포커스를 설정합니다.
     */
    TreeGrid.prototype.setFocus = function () {
        dews.ui.gridUtil.setFocus(this);
    };
    /**
     * 트리그리드의 수정모드로 변경합니다.
     */
    TreeGrid.prototype.editCell = function () {
        var self = this;

        self._grid.showEditor();
    };
    /**
     * 트리그리드에서 현재 수정중이 값을 적용합니다.
     */
    TreeGrid.prototype.commitCell = function () {
        var self = this;

        self._grid.commitEditor();
    };
    /**
     * 트리그리드에서 현재 수정중인 값을 이전 값으로 되돌려서 적용합니다.
     */
    TreeGrid.prototype.closeCell = function () {
        var self = this;

        self._grid.cancelEditor();
    };
    /**
     * 트리 그리드 컨텍스트 메뉴 설정
     * @param options (object)
     * excelDownload 엑셀 다운로드 설정 유무
     * items (array)
     *      text (string) 컨텍스트 메뉴에 나올 텍스트 명
     *      handler (function) 컨텍스트 메뉴 클릭 시 실행 함수
     *      display (function) 컨텍스트 메뉴 행에 따른 노출 여부
     */
    TreeGrid.prototype.setContextMenu = function (options) {
        dews.ui.gridUtil.setContextMenu(this, options);
    };
    /**
     * 트리 그리드 엑셀 저장
     * @param option (object)
     * target (string) 저장할 위치
     * fileName (string) 저장한 파일명
     * allPages (boolean) 전체 다운 유무 설정
     */
    TreeGrid.prototype.saveAsExcel = function (option) {
        dews.ui.gridUtil.saveAsExcel(this, option);
    };
    /**
     * 트리 그리드 내 정렬 설정
     * @param options (object)
     * field (string) 정렬을 설정할 필드명
     * dir (string) 오름차순, 내림차순 설정
     */
    TreeGrid.prototype.sort = function (options) {
        dews.ui.gridUtil.sort(this, options);
    };
    /**
     * 체크 바에 지정한 행을 체크 혹은 해제 합니다.
     * @param index 체크 혹은 해제 할 행의 index
     * @param value 체크 혹은 해제 할 값 boolean
     */
    TreeGrid.prototype.setCheck = function (index, value) {
        var self = this,
            row = [];

        if ($.type(index) === 'number') {
            if (index === self.select()) {
                index = self._grid.getItemIndex(index);
            }
            row.push(index);
        } else if ($.type(index) === 'array') {
            row = index;
        }

        self._grid.checkItems(row, value);
    };
    /**
     * 트리그리드 체크바 disabled 설정
     * @param index disabled 설정할 index
     * @param boolean disabled 설정 유무
     */
    TreeGrid.prototype.setDisableCheck = function (index, boolean) {
        var self = this,
            row = [],
            bool = false;

        if ($.type(index) === 'number') {
            row.push(index)
        } else if ($.type(index) === 'array') {
            row = index;
        }

        if ($.type(boolean) === 'boolean') {
            bool = !boolean;
        }

        for (var i = 0; i < row.length; i++) {
            self._grid.setCheckable(row[i], bool);
        }
    };
    /**
     * 그리드 컬럼 노출 기능
     * @param field (string) 노출할 컬럼명
     */
    TreeGrid.prototype.showColumn = function (field) {
        dews.ui.gridUtil.showColumn(this, field);
    };
    /**
     * 트리 그리드 컬럼 숨기기 기능
     * @param field (string) 숨길 컬럼명
     */
    TreeGrid.prototype.hideColumn = function (field) {
        dews.ui.gridUtil.hideColumn(this, field);
    };
    /**
     * 트리 그리드 새로 고침
     */
    TreeGrid.prototype.refresh = function () {
        var self = this;

        self._grid.refresh();
    };
    /**
     * 트리 그리드 프로그래스바 노출
     */
    TreeGrid.prototype.showProgress = function () {
        dews.ui.loading.show({
            'type': 'tiny',
            'text': '데이터 로딩 중 입니다.'
        });
    };
    /**
     * 트리그리드 프로그래스바 종료
     */
    TreeGrid.prototype.hideProgress = function () {
        dews.ui.loading.hide();
    };
    /**
     * 트리그리드 값 찾기 검색
     * @param options
     * fields (array) 검색할 fields
     * value (string) 검색할 키워드
     * startIndex (number) n번째 행부터 검색
     * wrap (boolean) 해당 글자 없으면 다시 검색 유무 설정
     * partialMatch (boolean) 문구 완벽 일치 혹은 일치 설정
     * caseSensitive (boolean) 대소문자 구분 설정
     */
    TreeGrid.prototype.searchCell = function (options) {
        var self = this, opt = {
            select: true,
            partialMatch: true,
            caseMatch: false
        };
        if ($.type(options) === 'undefined') {
            return;
        }
        opt.startItemIndex = options.startIndex === undefined ? 0 : options.startIndex;
        opt = $.extend(true, opt, options);
        opt.caseSensitive = opt.caseMatch;

        if (self._grid.searchCell(opt)) {
            return self._grid.getDataRow(self._grid.searchCell(opt).itemIndex);
        }
    };
    /**
     * 현재 focus 된 컬럼의 field명 반환
     */
    TreeGrid.prototype.getCurrentColumn = function () {
        var self = this;

        return self._grid.getCurrent().column;
    };
    /**
     * 지정한 행의 상태값 반환
     * @param index (number) 지정한 행의 index
     * @returns {string} 지정한 행의 상태 값 반환
     */
    TreeGrid.prototype.getRowState = function (index) {
        return dews.ui.gridUtil.getRowState(this, index);
    };
    /**
     * 행 상태 값을 변경합니다.
     * @param index 변경할 행의 index
     * @param state added, updated, deleted, none 중에 선택해서 값을 설정
     */
    TreeGrid.prototype.setRowState = function (index, state) {
        dews.ui.gridUtil.setRowState(this, index, state);
    };
    /**
     * 트리 그리드의 행 수정
     * @param row (index) 수정할 행의 index
     * @param data (object) 수정할 행의 데이터
     */
    TreeGrid.prototype.updateRow = function (row, data) {
        dews.ui.gridUtil.updateRow(this, row, data);
    };
    /**
     * 마스터 디테일 구조 설정
     * @param target (object) 디테일 데이터 컨트롤 객체
     */
    TreeGrid.prototype.setDetail = function (target) {
        dews.ui.gridUtil.setDetail(this, target);
    };
    /**
     * 그리드 validate 체크
     * @returns {{result: boolean, fields: Array}}
     * result (boolean) validate 체크 결과 값
     * fields (array) validate 체크 결과 후 안된 부분에 대한 field, 행 index 반환
     */
    TreeGrid.prototype.validate = function (mode) {
        var self = this,
            validate = {
                result: true,
                fields: []
            },
            gridDatas = self.options.dataSource.dataProvider._dp._rowMap.length - 1, //추가 했을 경우 _rowCount는 증가 되지 않아서 수정
            required = [],
            columns, rowData;

        for (var i = 0; i < self._grid.getColumnNames().length; i += 1) {
            columns = self.columns[self._grid.getColumnNames()[i]];

            if (columns && $.type(columns.field) !== 'undefined') { // columns 값이 없을 경우 에러 발생으로 조건 추가
                if (columns.attributes && columns.attributes.class === 'required') {
                    required.push(columns.field);
                }
            }
        }

        if (mode) {
            for (var d = self._grid.getDataRow(0); d < gridDatas + self._grid.getDataRow(0); d += 1) {
                if (self.getRowState(d) === 'updated' || self.getRowState(d) === 'added') {
                    rowData = self.options.dataSource.dataProvider.getJsonRow(d);
                    if (rowData) { // 삭제 된 rowData는 값이 null 이기 때문에 추가
                        for (var j = 0; j < required.length; j += 1) {
                            if ($.type(rowData[required[j]]) === 'number' && rowData[required[j]] === 0) {
                                // 숫자 타입이고 값이 0일때 validate에 들어가는것을 막아줌
                            } else if (!rowData[required[j]]) {
                                validate.result = false;
                                validate.fields.push({columnName: required[j], rowIndex: d, validate: 'required'});
                            }
                        }
                    }
                }
            }
        } else {
            for (var k = self._grid.getDataRow(0); k < gridDatas + self._grid.getDataRow(0); k += 1) {
                rowData = self.options.dataSource.dataProvider.getJsonRow(k);
                if (rowData) { // 삭제 된 rowData는 값이 null 이기 때문에 추가
                    for (var l = 0; l < required.length; l += 1) {
                        if ($.type(rowData[required[l]]) === 'number' && rowData[required[l]] === 0) {
                            // 숫자 타입이고 값이 0일때 validate에 들어가는것을 막아줌
                        } else if (!rowData[required[l]]) {
                            validate.result = false;
                            validate.fields.push({columnName: required[l], rowIndex: k, validate: 'required'});
                        }
                    }
                }
            }
        }
        return validate;
    };
    /**
     * 그리드 색상 적용
     * @param row (array || index) 색상을 적용할 행의 index
     * @param style (object) 적용할 스타일
     */
    TreeGrid.prototype.setRowStyle = function (row, style) {
        dews.ui.gridUtil.setRowStyle(this, row, style);
    };
    /**
     * 트리 그리드 색상 설정
     * @param styles 설절항 스타일 json
     */
    TreeGrid.prototype.setStyles = function (styles) {
        var self = this;

        self.options.styles = styles;
        self.options = setStyles(self._grid, self.options);
        self._grid.setOptions(self.options);
    };
    /**
     * 트리 그리드 행 색상 적용 취소
     * @param row (number || array) 트리 그리드 색상을 해제할 행의 index
     */
    TreeGrid.prototype.resetRowStyle = function (row) {
        dews.ui.gridUtil.resetRowStyle(this, row);
    };
    /**
     * 그리드 행에서 현재 지정된 셀이 마지막으로 수정 가능한지 검사
     * @returns {boolean} 수정 가능한 마지막 셀인지에 대한 유무 반환
     */
    TreeGrid.prototype.lastEditCell = function () {
        var self = this,
            current = self._grid.getCurrent(),
            displayColumn = self.options.displayColumns,
            displayIndex = self._grid.getColumnProperty(current.column, 'displayIndex'),
            value = false,
            editParams = {
                treegrid: self,
                row: {
                    index: current.itemIndex,
                    data: self.dataItem(self._grid.getDataRow(current.itemIndex))
                },
                cell: {
                    field: ''
                }
            };

        return dews.ui.gridUtil.lastEditCell(self, displayColumn, displayIndex, value, editParams);
    };
    /**
     * 트리 그리드 내 해당 footer 연산 값을 얻을수 있습니다.
     * @param field 연산을 하고자 하는 field 명
     * @param cal 연산을 하고자 하는 결과 (sum, avg, count, max, min)
     */
    TreeGrid.prototype.getSummary = function (field, cal) {
        var self = this,
            calculate = cal || 'SUM';

        return self._grid.getSummary(field, calculate);
    };
    /**
     * 트리 그리드 변경 내용 취소
     */
    TreeGrid.prototype.cancelChanges = function () {
        var self = this;
        self.options.dataSource.dataProvider.rollback(self.options.dataSource.options.rollback);
    };
    /**
     * 트리 그리드 현재 행 변경 취소
     */
    TreeGrid.prototype.cancelRow = function () {
        var self = this,
            data = self.options.dataSource.dataProvider,
            current = self._grid.getCurrent(),
            rowId = self._grid.getDataRow(current.itemIndex);
        // 추가된 행에 대해 cancelRow를 실행 할 시에 해당 row를 삭제 해줌
        dews.ui.gridUtil.cancelRow(self, data, rowId);
    };
    /**
     * 트리 그리드 현재 셀 변경 취소
     */
    TreeGrid.prototype.cancelCell = function () {
        var self = this,
            column = self._grid.getCurrent().column.toUpperCase(),
            row = self._grid.getDataRow(self._grid.getCurrent().itemIndex),
            dataSource = self.options.dataSource,
            fieldIndex = 0,
            originData;

        if (dataSource && dataSource.dataProvider && dataSource.dataProvider._dp._rowMap[row]) {
            fieldIndex = dataSource.dataProvider._dp._fieldNames.indexOf(column);
            originData = dataSource.dataProvider._dp._rowMap[row]._orgValues;

            if ($.type(originData) !== 'null') {
                self._grid.setValue(self._grid.getItemIndex(row), column, originData[fieldIndex]);
            } else if (dataSource.dataProvider.getRowState(row) === 'created') {
                self._grid.setValue(self._grid.getItemIndex(row), column, undefined);
            }
        }
    };
    /**
     * 트리 그리드와 폼패널 바인딩
     * @param panel 폼패널 DEWS 객체
     */
    TreeGrid.prototype.bindPanel = function (panel) {
        dews.ui.gridUtil.bindPanel(this, panel);
    };
    /**
     * 트리 그리드와 폼패널간 데이터 전송
     * @param data
     */
    TreeGrid.prototype.updateRowFromPanel = function (data) {
        var self = this;
        if (data) {
            self._grid.setValues(self._grid.getItemIndex(self.select()), data);
        }
    };
    /**
     * 트리 그리드 컬럼 반환
     */
    TreeGrid.prototype.getColumns = function () {
        var self = this;

        return self._grid.getColumns();
    };
    /**
     * 트리 그리드 높이 설정
     * @param height 설정할 높이
     */
    TreeGrid.prototype.setHeight = function (height) {
        dews.ui.gridUtil.setHeight(this, height);
    };

    /**
     * 트리 그리드 특정 cell 스타일 설정
     * @param index row index
     * @param field field index
     * @param styles 설정할 스타일
     */
    TreeGrid.prototype.setCellStyle = function (index, field, styles) {
        dews.ui.gridUtil.setCellStyle(this, index, field, styles);
    };

    /**
     * 트리 그리드 텍스트박스 maxLength 설정
     * @param field 컬럼명
     * @param length maxLength
     */
    TreeGrid.prototype.setMaxLength = function (field, length) {
        dews.ui.gridUtil.setMaxLength(this, field, length);
    };

    /**
     * 트리 그리드 헤더 체크바 노출 여부 설정
     * @param visible 노출 여부 설정
     */
    TreeGrid.prototype.setHeaderCheckVisible = function (visible) {
        dews.ui.gridUtil.setHeaderCheckVisible(this, visible);
    };

    /**
     * 트리 그리드에서 부모 데이터 컨트롤의 데이터 반환
     * @return {*} 부모 데이터 컨트롤의 데이터
     */
    TreeGrid.prototype.getParentData = function () {
        return dews.ui.gridUtil.getParentData(this);
    };

    /**
     * 트리 그리드에서 자식 데이터 컨트롤의 데이터 반환
     * @param index 가져올 행의 자식 데이터의 인덱스gr
     * @param gridId 가져올 그리드 아이디 설정
     * @return {*} 가져올 자식 데이터
     */
    TreeGrid.prototype.getChildData = function (index, gridId) {
        return dews.ui.gridUtil.getChildData(this, index, gridId);
    };

    /**
     * 그리드 엑셀 업로드 후 다운로드 가능한 URL 반환
     * @param menuName 메뉴 페이지 명
     * @private
     */
    TreeGrid.prototype._getExcelUrlForPrint = function (menuName) {
        return dews.ui.gridUtil._getExcelUrlForPrint(this, menuName);
    };

    TreeGrid.prototype._bindEvent = function () {
        var self = this;

        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            self.options.dataSource.dataProvider._dp.setJsonRows = setRow(self, self.options.dataSource.dataProvider._dp.setJsonRows);
        }
        // 그리드 내 이미지 버튼 클릭시 발생하는 함수
        self._grid.onImageButtonClicked = function (treeGrid, itemIndex, column, buttonIndex, name) {
            var parameter = {
                treegrid: self,
                row: {
                    index: self._grid.getDataRow(itemIndex),
                    data: self.dataItem(self._grid.getDataRow(itemIndex))
                },
                cell: {
                    field: column.fieldName,
                    data: self.getCellValue(self._grid.getDataRow(itemIndex), column.fieldName)
                }
            };

            dews.ui.gridUtil.onImageButtonClicked(self, itemIndex, column, parameter);
        };
        // 그리드 내 코드 피커 콜백 함수
        self.options._gridCallback = function (data, column, index) {
            dews.ui.gridUtil._gridCallback(self, data, column, index);
        };
        // 링크 포맷 사용, 링크 클릭 시 발생하는 이벤트
        self._grid.onLinkableCellClicked = function (treeGrid, index, url) {
            var linkUrl = self.options.dataSource.options.data[index.itemIndex][self.columns[index.column].formats.urlField],
                parameter = {
                    treegrid: self,
                    row: {
                        index: index.itemIndex,
                        data: self.dataItem(index.itemIndex)
                    },
                    cell: {
                        field: index.column,
                        data: self.getCellValue(index.itemIndex, index.column)
                    }
                };
            dews.ui.gridUtil.onLinkableCellClicked(self, index, linkUrl, parameter);
        };
        // 에디터 수정 발생 시 textAlign 설정 하는 이벤트
        self._grid.onShowEditor = function (id, index) {
            var parameter = {
                treegrid: self,
                row: {
                    index: index.dataRow === -1 ? index.itemIndex : index.dataRow
                },
                cell: {
                    field: index.fieldName
                }
            };

            window.addEventListener('scroll', windowScroll);
            dews.ui.gridUtil.onShowEditor(self, id, index, parameter);
        };
        // 에디터 수정 종료 시 발생하는 이벤트
        self._grid.onHideEditor = function (treeGrid, index) {
            if (!self.options.commit) {
                dews.ui.gridUtil.onHideEditor(self, treeGrid, index);
                window.removeEventListener('scroll', windowScroll);
            }
            self.options.commit = false;
        };
        // 그리드 현재 선택된 로우가 변경 되었을 경우 실행
        self._grid.onCurrentRowChanged = function (treeGrid, oldIndex, newIndex) {
            // 그리드 상하단 그리드에서 상단 그리드 change 이벤트에서 하단 그리드 datasource.read() 할때 하단 그리드 change 이벤트 발생이 안되는 문제 해결
            if (oldIndex === newIndex) {
                self._grid.onCurrentChanging.call(self, self._grid, self._grid.getCurrent(), self._grid.getCurrent());
                self.options.rowChange = true;
                self._grid.onCurrentChanged.call(self, self._grid, self._grid.getCurrent());
            }
        };
        // 트리 그리드 이전 선택한 행 적용
        self._grid.onCurrentChanging = function (treeGrid, oldIndex, newIndex) {
            var dataRow = self._grid.getDataRow(newIndex.itemIndex);
            self.options.rowChange = false;
            // 행이 변경됬는지 확인
            if (newIndex.dataRow === -1 ? oldIndex.itemIndex !== newIndex.itemIndex : oldIndex.dataRow !== newIndex.dataRow) {
                self.options.rowChange = true;
            }
            self.options.previousData = self.dataItem(self._grid.getDataRow(oldIndex.itemIndex));
            self.options.previous = oldIndex;

            // 트리그리드 포커스 설정
            if (oldIndex.dataRow !== -1 && self.focused) {
                // 코드피커 호출 시 그리드에 포커스가 가지 않고 다이얼로그 페이지에 포커스가 지정되는 코드로 주석 처리
                // if (dews.ui.dialogPage && dews.ui.dialogPage.$content && dews.ui.dialogPage.$content.find('.dews-ui-treegrid').length !== 0) {
                self.setFocus();
                // }
            }

            if (newIndex.dataRow === -1) {
                if (self._grid.getItemState(newIndex.itemIndex) === 'appending') {
                    self.commitCell();
                    dataRow = newIndex.itemIndex;
                }
            }

            var columns = self.columns[newIndex.fieldName];
            // 그리드 컬럼에서 특정 값에 따라 수정 유무 적용
            if (treeGrid.getColumnProperty(newIndex.column, 'editor') && newIndex.fieldIndex !== -1
                && self.dataItem(dataRow)) {
                if (columns && columns.editor && columns.editor.editable && self.options.dataSource) {
                    var editor, visible, parameter = {
                        treegrid: self,
                        row: {
                            index: dataRow,
                            data: self.dataItem(dataRow)
                        },
                        cell: {
                            field: newIndex.fieldName
                        }
                    };
                    // 소팅 여부 확인
                    if ($.type(treeGrid.getSortedFields()) !== 'null') {
                        parameter.row.index = newIndex.itemIndex;
                        parameter.row.data = self._grid.getValues(newIndex.itemIndex);
                    }
                    if ($.type(columns.editor.editable) === 'function') {
                        editor = columns.editor.editable.call(self, parameter);
                    } else {
                        editor = columns.editor.editable;
                    }

                    columns.editor.editResult = editor;

                    if (columns.editor.type.toLowerCase() === 'codepicker') {
                        visible = 'visible';
                        if (!editor) {
                            visible = 'hidden';
                        }
                        if (!self.options.edit.editable) {
                            visible = 'hidden';
                        }
                        columns.buttonVisibility = visible;
                        self._grid.setColumnProperty(columns.name, 'buttonVisibility', visible);
                    }

                    if (columns.editor.type.toLowerCase() === 'check') {
                        var options = self._grid.getColumnProperty(columns.name, 'renderer');
                        self._grid.setColumnProperty(columns.name, 'renderer', $.extend(true, options, {editable: editor}));
                    }

                    if (!editor) {
                        self._grid.addCellStyle('editable', {
                            editable: false
                        }, true);
                        self._grid.setCellStyles(newIndex.dataRow, newIndex.fieldName, 'editable');
                    }
                }
            }
            // 그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
            if (columns && columns.editor && columns.editor.type.toLowerCase() === 'dropdown' && $.type(columns.editor.dataSource) === 'function'
                && self.dataItem(dataRow)) {
                var col = self._grid.columnByField(columns.fieldName),
                    e = {
                        treegrid: self,
                        row: {
                            index: dataRow,
                            data: self.dataItem(dataRow)
                        }
                    },
                    datasource = columns.editor.dataSource.call(self, e);
                col.values = [];
                col.labels = [];

                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                    for (var l = 0; l < datasource.transport.data.length; l += 1) {
                        col.values.push(datasource.transport.data[l][columns.editor.dataValueField]);
                        col.labels.push(datasource.transport.data[l][columns.editor.dataTextField]);
                    }
                    col.labelField = columns.editor.dataTextField;
                    col.lookupDisplay = true;
                    self._grid.setColumn(col);
                }
            }
            // dataBound 이벤트
            if (self.options.dataBounding) {
                var column = self.options.columns,
                    dataBoundParameter = {
                        treegrid: self,
                        row: {
                            data: self.options.dataSource.data()
                        },
                        column: column
                    },
                    dataBoundEvent;

                dataBoundEvent = new $.Event('dataBound', dataBoundParameter);
                self.$element.trigger(dataBoundEvent);
                delete self.options.dataBounding;
                setBounding(self, column);
            }

            if ($.type(self.options.previousData) === 'undefined') {
                self.options.previousData = '';
            }

            if ($.type(self.options.previous) === 'undefined') {
                self.options.previous = newIndex;
            }

            if (self.dataItem(dataRow)) {
                // changing 이벤트
                var changingParameter = {
                    treegrid: self,
                    row: {
                        next: {
                            index: newIndex.dataRow,
                            data: self.dataItem(dataRow)
                        },
                        isChange: self.options.rowChange,
                        index: oldIndex.dataRow !== -1 ? oldIndex.dataRow : oldIndex.itemIndex,
                        data: self.dataItem(oldIndex.dataRow)
                    },
                    cell: {
                        next: {
                            field: newIndex.fieldName,
                            data: self._grid.getValue(dataRow, newIndex.fieldName),
                        },
                        field: oldIndex.fieldName
                    }
                };

                var event = new $.Event('changing', changingParameter);
                self.$element.trigger(event);

                if (event.isDefaultPrevented()) {
                    return false;
                }
            }
        };
        // 트리 그리드 행 이동 난 이후 적용
        self._grid.onCurrentChanged = function (treeGrid, newIndex) {
            var index = self._grid.getDataRow(newIndex.itemIndex);
            // rowAdd 이벤트
            if ($.type(self.options.add) === 'boolean' && self.options.add) {
                if (self.options.dataSource) {
                    var addParameter, addEvent;
                    addParameter = {
                        treegrid: self,
                        row: {
                            index: newIndex.dataRow,
                            data: self.dataItem(self.select())
                        }
                    };

                    addEvent = new $.Event('rowAdd', addParameter);
                    self.$element.trigger(addEvent);
                    self.options.add = false;
                }
            }

            if (self.dataItem(index)) {
                // change 이벤트
                var parameter = {
                    treegrid: self,
                    row: {
                        index: index,
                        data: self.dataItem(index),
                        isChange: self.options.rowChange,
                        previous: {
                            index: self.options.previous.dataRow,
                            data: self.dataItem(self.options.previous.dataRow)
                        }
                    },
                    cell: {
                        field: newIndex.fieldName,
                        data: self._grid.getValue(newIndex.itemIndex, newIndex.fieldName),
                        previous: {
                            field: self.options.previous.fieldName
                        }
                    }
                };

                var event = new $.Event('change', parameter);
                $('#' + treeGrid.name).trigger(event);
            }

            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && newIndex.column) {
                    dews.ui.page.focusGuideItem('#' + newIndex.column);
                }
            }

            // 드롭다운리스트에 포커스가 들어왔을 때, 자동으로 항목을 열지 말지 결정
            var column = self.columns[newIndex.fieldName];
            if (column && column.editor) {
                if (column.editor.type.toLowerCase() === 'dropdown' && column.editor.editResult && column.editor.autoOpen === true) {
                    self.editCell();
                    self._grid._gv._editController._editor.dropDown();
                    window.event.stopPropagation();
                    window.event.preventDefault();
                }
            }
        };
        // 트리 그리드 수정 후 발생
        self._grid.onCellEdited = function (treeGrid, itemIndex, dataRow, field) {
            var fields = self.options.dataSource.dataProvider.getFieldName(field);
            var column = dews.ui.gridUtil.findColumn(self.options.columns, fields);

            // 그리드 시간 포맷 수정시 값에 맞지 않는 경우 되돌리기
            if (column && column.editor && column.editor.type.toLowerCase() === 'time') {
                if (treeGrid.getEditingItem() && treeGrid.getEditingItem().values[column.fieldName]) {
                    if (!column.displayRegExp.test(treeGrid.getEditingItem().values[column.fieldName])) {
                        self.setCellValue(dataRow, column.fieldName, '');
                    }
                }
            }

            self.options.commit = true;
            self._grid.commit();
            self.editable = false;
            // 그리드 컬럼 내 특정 값에 따라 색상이 변경되는 경우
            if (column && column.style && column.cellDynamic) {
                var styles = {}, styleParameter = {
                    treegrid: self,
                    row: {
                        index: dataRow,
                        data: self.dataItem(dataRow)
                    }
                }, style;

                // 정렬시 변경되어야 할 부
                if ($.type(treeGrid.getSortedFields() !== 'null')) {
                    styleParameter.row.index = itemIndex;
                    styleParameter.row.data = self.dataItem(itemIndex);
                }

                style = column.style.call(self, styleParameter);

                if (style) {
                    if (style.color) {
                        styles.foreground = style.color;
                    }
                    if (style.textAlign) {
                        switch (style.textAlign) {
                            case 'left':
                                styles.textAlignment = 'near';
                                break;
                            case 'right':
                                styles.textAlignment = 'far';
                                break;
                            case 'center':
                                styles.textAlignment = 'center';
                                break;
                        }
                    }
                    if (style.verticalAlign) {
                        switch (style.verticalAlign.toLowerCase()) {
                            case 'top' :
                                styles.lineAlignment = 'near';
                                break;
                            case 'bottom':
                                styles.lineAlignment = 'far';
                                break;
                            case 'middle':
                                styles.lineAlignment = 'center';
                                break;
                        }
                    }

                    if (style.icon) {
                        var image;
                        if (self.options.iconImagelist) {
                            image = self.options.iconImagelist;
                        } else {
                            image = new RealGridJS.ImageList('iconImage', '');
                        }

                        if (self.options.images.indexOf(style.icon.image) === -1) {
                            self.options.images.push(style.icon.image);
                            image.addUrls(self.options.images);
                            self._grid.registerImageList(image);
                            self._grid.setColumnProperty(self._grid.columnByField(column.field), "imageList", "iconImage");
                            self._grid.setColumnProperty(self._grid.columnByField(column.field), "renderer", {type: "icon"});
                            self.options.iconImagelist = image;

                            column.cellDynamic.push({
                                criteria: "(values['" + column.field + "'] = '" + self._grid.getValue(dataRow, column.field) + "')",
                                styles: 'iconIndex=' + (self.options.images.length - 1) + ';iconOffset=0;iconPadding=5;iconAlignment=center;iconLocation=left'
                            });
                        }
                    }

                    styles = $.extend(true, styles, style);
                    column.cellDynamic.push({
                        criteria: "(values['" + self.options.dataSource.dataProvider.getFieldName(field) + "'] = '" + self._grid.getValue(dataRow, self.options.dataSource.dataProvider.getFieldName(field)) + "')",
                        styles: styles
                    });
                    self._grid.setColumnProperty(self._grid.columnByField(self.options.dataSource.dataProvider.getFieldName(field)), 'dynamicStyles', column.cellDynamic);
                }
            }
            // 그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
            if (column && column.editor && column.editor.type.toLowerCase() === 'dropdown' && $.type(column.editor.dataSource) === 'function') {
                var col = self._grid.columnByField(column.fieldName),
                    e = {
                        treegrid: self,
                        row: {
                            data: self.dataItem(dataRow),
                            index: dataRow
                        }
                    },
                    datasource = column.editor.dataSource.call(self, e);
                col.values = [];
                col.labels = [];
                // 데이터 소스가 undefined 또는 데이터 유무 체크
                if (datasource && datasource.transport && datasource.transport.data && datasource.transport.data.length > 0) {
                    var index = {
                        itemIndex: itemIndex,
                        dataRow: dataRow,
                        fieldIndex: field,
                        column: column.field,
                        fieldName: column.field
                    }, editResult = {
                        text: '',
                        value: self.getCellValue(dataRow, column.field)
                    };
                    // 데이터소스 labels, values 설정
                    for (var l = 0; l < datasource.transport.data.length; l += 1) {
                        col.values.push(datasource.transport.data[l][column.editor.dataValueField]);
                        col.labels.push(datasource.transport.data[l][column.editor.dataTextField]);
                        if (datasource.transport.data[l][column.editor.dataValueField] === editResult.value) {
                            editResult.text = datasource.transport.data[l][column.editor.dataTextField];
                        }
                    }
                    col.labelField = column.editor.dataTextField;
                    col.lookupDisplay = true;
                    self._grid.setColumn(col);

                    self._grid.onGetEditValue.call(self, self._grid, index, editResult);
                }
            }

            var event, parameter, subSave = true;

            if ($.type(arguments[4]) === 'boolean') {
                subSave = arguments[4];
            }

            parameter = {
                treegrid: self,
                row: {
                    index: itemIndex,
                    data: self.dataItem(itemIndex)
                },
                cell: {
                    field: $.type(column) === 'undefined' ? fields : column.field
                }
            };

            if ($.type(arguments[4]) === 'boolean') {
                subSave = arguments[4];
            }

            if (subSave) {
                event = new $.Event('save', parameter);
                $('#' + treeGrid.name).trigger(event);
            }
        };
        // 트리 그리드의 validation check 이벤트
        self._grid.onValidateColumn = function (treeGrid, column, inserting, value) {
            var event, parameter = {
                treegrid: self,
                cell: {
                    field: column.fieldName,
                    data: value
                },
                row: {
                    index: self._grid.getCurrent().itemIndex
                }
            };

            if (column.fieldName === treeGrid.getCurrent().fieldName) {
                event = new $.Event('validate', parameter);
                $('#' + treeGrid.name).trigger(event);
            }
        };
        // 트리 그리드 contextMenu 메뉴 출력 이벤트
        self._grid.onContextMenuPopup = function (treeGrid, x, y, elementName) {
            if (elementName === 'DataCell' && self.options.dataSource) {
                var currentCell = treeGrid.mouseToIndex(x, y), displayIndex = [], items = [],
                    dataRow = self._grid.getDataRow(currentCell.dataRow),
                    parameter = {
                        treegrid: self,
                        row: {
                            index: dataRow,
                            data: self.dataItem(dataRow)
                        },
                        cell: {
                            field: currentCell.fieldName,
                            data: treeGrid.getValue(dataRow, currentCell.fieldName)
                        }
                    };
                dews.ui.gridUtil.onContextMenuPopup(self, currentCell, parameter);
            } else {
                return false;
            }
        };
        // 트리 그리드 contextMenu click 이벤트
        self._grid.onContextMenuItemClicked = function (treeGrid, label, index) {
            if (self.options.dataSource) {
                var rowId = self._grid.getDataRow(index.itemIndex);
                var parameter = {
                    treegrid: self,
                    row: {
                        index: rowId,
                        data: self.dataItem(rowId)
                    },
                    cell: {
                        field: index.fieldName,
                        data: treeGrid.getValue(index.dataRow, index.fieldName)
                    }
                };
                dews.ui.gridUtil.onContextMenuItemClicked(self, index, label, parameter);
            }
        };
        // 트리 그리드 체크바 클릭시 발생하는 이벤트
        self._grid.onItemChecked = function (treeGrid, itemIndex, checked) {
            var event, index = self._grid.getDataRow(itemIndex), parameter = {
                treegrid: self,
                row: {
                    index: index,
                    data: self.dataItem(index)
                },
                cell: {
                    isClicked: checked,
                    header: {
                        isClicked: false
                    }
                }
            };

            event = new $.Event('selected', parameter);
            $('#' + treeGrid.name).trigger(event);
        };
        // 트리 그리드 체크바 헤더 클릭시 발생하는 이벤트
        self._grid.onItemAllChecked = function (treeGrid, checked) {
            var event, parameter = {
                treegrid: self,
                row: {
                    index: self.getCheckedIndex(),
                    data: self.dataItem(self.getCheckedIndex())
                },
                cell: {
                    isClicked: checked,
                    header: {
                        isClicked: true
                    }
                }
            };

            event = new $.Event('selected', parameter);
            $('#' + treeGrid.name).trigger(event);
        };
        // 트리 그리드 드롭다운리스트 데이터 소스 2개 사용시
        self._grid.onGetEditValue = function (treeGrid, index, editResult) {
            dews.ui.gridUtil.onGetEditValue(self, index, editResult);
        };
        // 트리 그리드 셀 클릭 이벤트
        self._grid.onDataCellClicked = function (treeGrid, index) {
            var dataRow = self._grid.getDataRow(index.itemIndex), parameter = {
                treegrid: self,
                row: {
                    index: dataRow,
                    data: self.dataItem(dataRow)
                },
                cell: {
                    field: index.fieldName,
                    data: self.getCellValue(dataRow, index.fieldName)
                }
            };

            var event = new $.Event('clicked', parameter);
            self.$element.trigger(event);
        };
        // 트리 그리드 셀 더블 클릭 이벤트
        self._grid.onDataCellDblClicked = function (treeGrid, index) {
            var dataRow = self._grid.getDataRow(index.itemIndex), dblParameter = {
                treegrid: self,
                row: {
                    index: dataRow,
                    data: self.dataItem(dataRow)
                },
                cell: {
                    field: index.fieldName,
                    data: self.getCellValue(dataRow, index.fieldName)
                }
            };

            var dblEvent = new $.Event('dblClicked', dblParameter);
            self.$element.trigger(dblEvent);
        };
        // 트리 그리드 키보드 이벤트
        self._grid.onKeyDown = function (treeGrid, key, ctrl, shift, alt) {
            var parameter = {
                    treegrid: self,
                    keyCode: key,
                    row: {
                        index: self._grid.getCurrent().itemIndex
                    },
                    cell: {
                        field: self._grid.getCurrent().column
                    },
                    ctrl: ctrl,
                    shift: shift,
                    alt: alt
                },
                event = $.Event('keyDown', parameter);

            self.$element.trigger(event);

            if (event.isDefaultPrevented()) {
                return false;
            }
            // 스페이스 바로 그리드 체크바 체크 설정
            if (self._grid.getCheckBar().visible && key === 32) {
                if (self._grid.isCheckedRow(self.select())) {
                    self._grid.checkRow(self.select(), false, false);
                } else {
                    self._grid.checkRow(self.select(), true, false);
                }

                return false;
            }
            // 그리드 셀스킵 관련 코드
            var current = self._grid.getCurrent(),
                rowIndex = self._grid.getDataRow(current.itemIndex),
                rowData = self.dataItem(rowIndex),
                editParams = {
                    grid: self,
                    row: {
                        index: rowIndex,
                        data: rowData
                    },
                    cell: {
                        field: ''
                    }
                };
            // 셀 스킵 관련 코드
            if ($.type(self.options.editSkip) !== 'undefined' && self.options.editSkip) {
                var disPlayColumn = self._grid.getDisplayColumns(),
                    columnIndex = self._grid.columnByField(current.column),
                    i = 0,
                    column,
                    index = columnIndex.displayIndex;
                // 엔터키를 이용할 경우의 셀 스킵 사용
                if (key === 13) {
                    for (var j = current.itemIndex; j < self._grid.getItemCount(); j += 1) {
                        editParams.row.index = rowIndex;
                        editParams.row.data = self.dataItem(rowIndex);
                        for (i = index + 1; i < disPlayColumn.length; i += 1) {
                            editParams.cell.field = disPlayColumn[i];
                            column = self.columns[disPlayColumn[i]];
                            if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    self._grid.setCurrent({
                                        itemIndex: j,
                                        columns: column.fieldName,
                                        dataRow: j,
                                        fieldIndex: i,
                                        fieldName: column.fieldName
                                    });
                                    return false;
                                }
                            } else if (i === disPlayColumn.length - 1 && j === self.dataItems().length - 1) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    self.commitCell();
                                    return false;
                                }
                            }
                        }
                        index = -1;
                    }
                    // 오른쪽 방향키를 사용했을 경우 셀 스킵 사용
                } else if (key === 39 && index !== disPlayColumn.length - 1) {
                    for (i = index + 1; i < disPlayColumn.length; i += 1) {
                        editParams.cell.field = disPlayColumn[i];
                        column = self.columns[disPlayColumn[i]];
                        if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                            if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                self._grid.setCurrent({
                                    itemIndex: self._grid.getCurrent().itemIndex,
                                    columns: column.fieldName,
                                    dataRow: self._grid.getCurrent().dataRow,
                                    fieldIndex: i,
                                    fieldName: column.fieldName
                                });
                                return false;
                            } else if (i === disPlayColumn.length - 1) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    return false;
                                }
                            }
                        } else if (i === disPlayColumn.length - 1) {
                            return false;
                        }
                    }
                    // 왼쪽 방향키를 눌렀을 경우 셀 스킵 사용
                } else if (key === 37 && index !== 0) {
                    for (i = index - 1; i >= 0; i -= 1) {
                        editParams.cell.field = disPlayColumn[i];
                        column = self.columns[disPlayColumn[i]];
                        if ($.type(column.editor.editable) === 'function' ? column.editor.editable.call(self, editParams) : self._grid.getColumnProperty(column.field, 'editable')) {
                            if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                self._grid.setCurrent({
                                    itemIndex: self._grid.getCurrent().itemIndex,
                                    columns: column.fieldName,
                                    dataRow: self._grid.getCurrent().dataRow,
                                    fieldIndex: i,
                                    fieldName: column.fieldName
                                });
                                return false;
                            } else if (i === 0) {
                                if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                    return false;
                                }
                            }
                        } else if (i === 0) {
                            return false;
                        }
                    }
                }
            }
            // shift+tab 관련 코드
            if (shift && key === 9) {
                if (self.options.editSkip) {
                    for (var row = self._grid.getItemIndex(rowIndex); row >= 0; row -= 1) {
                        editParams.row.index = row;
                        editParams.row.data = self.dataItem(row);
                        for (i = index - 1; i >= 0; i -= 1) {
                            editParams.cell.field = disPlayColumn[i].field;
                            column = self.columns[disPlayColumn[i]];
                            if (self._grid.getColumnProperty(column.field, 'editable')) {
                                if (column.editor && $.type(column.editor.editable) !== 'undefined' && column.editor.editable.call(self, editParams)) {
                                    if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                        self._grid.setCurrent({
                                            itemIndex: row,
                                            fieldName: column.fieldName
                                        });
                                        return false;
                                    }
                                } else if (column.editor && ($.type(column.editor.editable) === 'undefined' || column.editor.editable.call(self, editParams))) {
                                    if ($.type(column.editSkip) === 'undefined' || !column.editSkip) {
                                        self._grid.setCurrent({
                                            itemIndex: row,
                                            fieldName: column.fieldName
                                        });
                                        return false;
                                    }
                                }
                            }
                        }
                        index = self.options.displayColumns.length;
                    }
                }
            }
        };
        // 트리 확장시 에디터블 설정
        self._grid.onTreeItemExpanded = function (treeGrid, itemIndex, rowId) {
            // 그리드 컬럼에서 특정 값에 따라 수정 유무 적용
            var newIndex = self._grid.getCurrent(),
                columns = self.columns[newIndex.fieldName];
            if (treeGrid.getColumnProperty(newIndex.column, 'editor') && newIndex.fieldIndex !== -1
                && self.dataItem(self.select())) {
                if (columns && columns.editor && columns.editor.editable && self.options.dataSource) {
                    var editor, visible, parameter = {
                        treegrid: self,
                        row: {
                            index: self.select(),
                            data: self.dataItem(self.select())
                        },
                        cell: {
                            field: newIndex.fieldName
                        }
                    };
                    // 소팅 여부 확인
                    if ($.type(treeGrid.getSortedFields()) !== 'null') {
                        parameter.row.index = newIndex.itemIndex;
                        parameter.row.data = self._grid.getValues(newIndex.itemIndex);
                    }
                    if ($.type(columns.editor.editable) === 'function') {
                        editor = columns.editor.editable.call(self, parameter);
                    } else {
                        editor = columns.editor.editable;
                    }

                    if (columns.editor.type.toLowerCase() === 'codepicker') {
                        visible = 'visible';
                        if (!editor) {
                            visible = 'hidden';
                        }
                        columns.buttonVisibility = visible;
                        self._grid.setColumnProperty(columns.name, 'buttonVisibility', visible);
                    }

                    if (!editor) {
                        self._grid.addCellStyle('editable', {
                            editable: false
                        }, true);
                        self._grid.setCellStyles(newIndex.dataRow, newIndex.fieldName, 'editable');
                    }
                }
            }
        };
        // 트리 그리드 복사 붙여 넣기
        self._grid.onEditRowPasted = function (grid, itemIndex, dataRow, fields, oldValues, newValues) {
            var className = '.dews-ui-treegrid';
            dews.ui.gridUtil.onEditRowPasted(self, newValues, className);
        };
        // 트리 데이터 소스 추가시 이벤트 발생
        if (self.options.dataSource && self.options.dataSource.dataProvider) {
            self.options.dataSource.dataProvider.onRowAdded = function (dataProvider, rowId) {
                self.expand(rowId, false);
                self._grid.setCurrent({
                    itemIndex: self._grid.getItemIndex(rowId),
                    column: self._grid.getCurrent().column,
                    dataRow: rowId
                });
            };
        }

        self.$element.on('dataBound', function (e) {
            if (self.options.dataBound && $.type(self.options.dataBound) === 'function' && e.treegrid) {
                self.options.dataBound.call(self, e);
            }
        });

        self.$element.on('changing', function (e) {
            if (self.options.changing && $.type(self.options.changing) === 'function' && e.treegrid) {
                self.options.changing.call(self, e);
            }
        });

        self.$element.on('change', function (e) {
            if (self.options.change && $.type(self.options.change) === 'function' && e.treegrid) {
                self.options.change.call(self, e);
            }
        });

        self.$element.on('rowAdd', function (e) {
            if (self.options.rowAdd && $.type(self.options.rowAdd) === 'function' && e.treegrid) {
                self.options.rowAdd.call(self, e);
            }
        });

        self.$element.on('rowRemove', function (e) {
            if (self.options.rowRemove && $.type(self.options.rowRemove) === 'function' && e.treegrid) {
                self.options.rowRemove.call(self, e);
            }
        });

        self.$element.on('save', function (e) {
            if (self.options.save && $.type(self.options.save) === 'function' && e.treegrid) {
                self.options.save.call(self, e);
            }
        });

        self.$element.on('validate', function (e) {
            if (self.options.validationCheck && $.type(self.options.validationCheck) === 'function' && e.treegrid) {
                self.options.validationCheck.call(self, e);
            }
        });

        self.$element.on('cellEditing', function (e) {
            if (self.options.cellEditing && $.type(self.options.cellEditing) === 'function' && e.treegrid) {
                self.options.editValue = self.options.cellEditing.call(self, e);
            }
        });

        self.$element.on('selected', function (e) {
            if (self.options.selected && $.type(self.options.selected) === 'function' && e.treegrid) {
                self.options.selected.call(self, e);
            }
        });

        self.$element.on('clicked', function (e) {
            if (self.options.clicked && $.type(self.options.clicked) === 'function' && e.treegrid) {
                self.options.clicked.call(self, e);
            }
        });

        self.$element.on('dblClicked', function (e) {
            if (self.options.dblClicked && $.type(self.options.dblClicked) === 'function' && e.treegrid) {
                self.options.dblClicked.call(self, e);
            }
        });

        self.$element.on('keyDown', function (e) {
            if (self.options.keyDown && $.type(self.options.keyDown) === 'function' && e.treegrid) {
                self.options.keyDown.call(self, e);
            }
        });

        // 그리드 에디터 창이 열려 있을 경우 스크롤시 닫기
        function windowScroll(e) {
            if ($(e.target).closest(document.body).length !== 0) {
                self.commitCell();
            }
        }

        // 그리드 에디터 창이 열려 있을 경우에 다른 화면 클릭 시 에디터 창을 종료 하기 위한 이벤트
        $(window).on('click', function (e) {
            var target = $(e.target).closest('.dews-ui-treegrid'),
                treeGrid = self.$element.closest('.dews-ui-treegrid'),
                inTreeGrid = false;
            // 선택한 항목이 해당 그리드 내에 위치 했을 경우 종료하지 않음(datepicker 와 같은 컨트롤 때문에)
            if (treeGrid.length !== 0 && treeGrid.offset().left - window.pageXOffset < e.clientX && treeGrid.offset().left + treeGrid.width() - window.pageXOffset > e.clientX &&
                treeGrid.offset().top - window.pageYOffset < e.clientY && treeGrid.offset().top + treeGrid.height() - window.pageYOffset > e.clientY) {
                inTreeGrid = true;
            }
            if ($(e.target).closest(document.body).length === 0) {
                inTreeGrid = true;
            }
            // 그리드를 제외하고 다른 엘리먼트를 클릭했을 경우
            if (target.length === 0 && !inTreeGrid) {
                self.commitCell();
                self.editable = false;
            }
            // 다른 그리드를 클릭했을 경우 (수정중인 그리드에서 일반 그리드 클릭 시 수정중인 그리드 수정 종료)
            if (target.length !== 0 && target.children().attr('ID') !== self._grid.name) {
                self.commitCell();
                self.editable = false;
            }
        });
        // 그리드 내 빈 영역 선택시 에디터 종료
        self.$element.on('click', function (e) {
            var grid = self.options.$content.find('.dews-ui-treegrid');
            // 그리드 내 빈 영역 선택시 에디터 종료
            if (e.target.tagName !== 'INPUT' && self._grid.mouseToIndex(e.offsetX, e.offsetY).itemIndex === -1) {
                self.commitCell();
                self.editable = false;
            }
        });
        // 그리드 내 키보드 이벤트 실행
        self.$element.on('keyDown', function (e) {
            var column;
            if (self.options.columns) {
                column = self.columns[self._grid.getCurrent().fieldName];
                if (column && column.editor) {
                    // 코드피커 키보드 이벤트
                    if ((column.editor.type).toLowerCase() === 'codepicker' && self._grid.getColumnProperty(column.name, 'buttonVisibility') === 'visible') {
                        if (column.codeOption.validation) {
                            if ($.type(column.codeOption.value[self._grid.getCurrent().itemIndex]) === 'undefined') {
                                column.codeOption.value[self._grid.getCurrent().itemIndex] = {
                                    code: '',
                                    text: '',
                                    value: self._grid.getValue(self._grid.getCurrent().itemIndex, column.fieldName)
                                };
                            }
                        }

                        if (e.keyCode === 115) {
                            self._grid.onImageButtonClicked.call(self, self._grid, self._grid.getCurrent().itemIndex, column);
                            e.preventDefault();
                            e.stopPropagation();
                        }
                    }
                    // 날짜피커 키보드 이벤트
                    if (self._grid._gv._editController._editor && column.editor.type.toLowerCase() === 'date' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 115) {
                            self.editCell();
                            self._grid._gv._editController._editor.dropDown();
                            e.stopPropagation();
                            e.preventDefault();
                        }
                    }
                    // 숫자 텍스트박스 + 키 눌렀을 시 이벤트
                    if (column.editor.type.toLowerCase() === 'number' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 107) {
                            if ($.type(self._grid.getEditValue()) !== 'undefined') {
                                e.preventDefault();
                                var currentValue = self._grid.getEditValue().replace(/,/, ''),
                                    resultValue = 0;

                                if (column.editor.increaseType === 'plus') {
                                    resultValue = parseFloat(currentValue) + parseFloat(column.editor.increaseValue);
                                } else {
                                    resultValue = parseFloat(currentValue) * parseFloat(column.editor.increaseValue);
                                }
                                self.$element.find('#' + self._grid.name + '_number').val(dews.number.format(resultValue.toString(), column.editor.format));

                                self._grid._gv._editController.onEditorChange.call(self._grid._gv._editController, self._grid._gv._editController._editIndex);
                            } else {
                                e.preventDefault();
                                self._grid.showEditor();
                            }
                        }
                    }
                    // 드롭다운리스트 키보드 이벤트
                    if (self._grid._gv._editController._editor && column.editor.type.toLowerCase() === 'dropdown' && ($.type(column.editor.editResult) === 'undefined' || column.editor.editResult)) {
                        if (e.keyCode === 115) {
                            self.editCell();
                            self._grid._gv._editController._editor.dropDown();
                            e.stopPropagation();
                            e.preventDefault();
                        }

                        if (self._grid._gv._editController._editor.isVisible() && column.editor.textReadOnly) {
                            if (e.keyCode >= 49 && e.keyCode <= 57 || e.keyCode >= 97 && e.keyCode <= 105) {
                                var number = (e.keyCode >= 49 && e.keyCode <= 57) ? e.keyCode - 49 : e.keyCode - 97;

                                if (column.values.length > number) {
                                    self.setCellValue(self.select(), column.fieldName, column.values[number]);
                                    e.preventDefault();
                                }
                            }
                        }
                    }
                }
            }
        });
    };

    // 트리 그리드 데이터 뿌려주는 시점
    function setRow(treeGrid, rows) {
        return function (data, children, prop, image) {
            var self = this,
                previous = treeGrid._grid.getCurrent().itemIndex;

            treeGrid.options.dataBounding = true;
            treeGrid.options.data = data;
            rows.call(self, data, children, "", image);
            if (previous === treeGrid._grid.getCurrent().itemIndex) {
                treeGrid._grid.onCurrentChanging.call(treeGrid, treeGrid._grid, treeGrid._grid.getCurrent(), treeGrid._grid.getCurrent());
                treeGrid._grid.onCurrentChanged.call(treeGrid, treeGrid._grid, treeGrid._grid.getCurrent());
            }
        };
    }

    // 트리 그리드 데이터 바인딩 시 설정
    function setBounding(treeGrid, column) {
        var self = treeGrid,
            dataLength = self.options.dataSource.dataProvider._dp._rowCount;
        for (var k = 0; k < column.length; k += 1) {
            var columns = column[k];
            if ($.type(columns.cellDynamic) !== 'array') {
                columns.cellDynamic = [];
            }
            if (self.options.rowDynamic.length !== 0) {
                self.options.rowDynamic = [];
            }
            if (columns.columns) {
                setBounding(self, columns);
            }
            // 트리그리드 아이콘 설정
            if ($.type(self.options.imageField) !== 'undefined' && columns.field === self._grid.getDisplayColumns()[0]) {
                for (var j = self._grid.getDataRow(0); j < dataLength + self._grid.getDataRow(0); j += 1) {
                    var image = new RealGridJS.ImageList('images', ''),
                        iconIndex = 0,
                        icon = self.options.dataSource.dataProvider.getJsonRow(j)[self.options.imageField];

                    if (self.options.icons.indexOf(icon) === -1) {
                        self.options.icons.push(icon);
                        iconIndex = self.options.icons.length - 1;

                        columns.cellDynamic.push({
                            criteria: "(values['" + self.options.imageField + "'] = '" + icon + "')",
                            styles: 'iconIndex=' + iconIndex + ';iconOffset=0;iconPadding=5;iconAlignment=center;'
                        });
                    }

                    if (dataLength === j) {
                        image.addUrls(self.options.icons);
                        self._grid.registerImageList(image);
                        self._grid.setColumnProperty(self._grid.columnByField(columns.field), "imageList", "images");
                        self._grid.setColumnProperty(self._grid.columnByField(columns.field), "renderer", {type: "icon"});
                    }
                }
                self._grid.setColumnProperty(self._grid.columnByField(columns.field), 'dynamicStyles', columns.cellDynamic);
            }
            // 트리그리드 컬럼내 값에 따라 색상 변경
            if (columns.style) {
                columns.cellDynamic = [];
                for (var j = 0; j < dataLength; j += 1) {
                    var styles = {}, styleParameter = {
                        treegrid: self,
                        row: {
                            index: j,
                            data: self.dataItem(j)
                        }
                    }, style;

                    style = columns.style.call(self, styleParameter);

                    if (style) {
                        if (style.color) {
                            styles.foreground = style.color;
                        }
                        if (style.textAlign) {
                            switch (style.textAlign) {
                                case 'left':
                                    styles.textAlignment = 'near';
                                    break;
                                case 'right':
                                    styles.textAlignment = 'far';
                                    break;
                                case 'center':
                                    styles.textAlignment = 'center';
                                    break;
                            }
                        }

                        if (style.verticalAlign) {
                            switch (style.verticalAlign.toLowerCase()) {
                                case 'top' :
                                    styles.lineAlignment = 'near';
                                    break;
                                case 'bottom':
                                    styles.lineAlignment = 'far';
                                    break;
                                case 'middle':
                                    styles.lineAlignment = 'center';
                                    break;
                            }
                        }

                        if (style.icon && style.icon.image) {
                            var image,
                                iconIndex = j;

                            if (self.options.iconImagelist) {
                                image = self.options.iconImagelist;
                            } else {
                                image = new RealGridJS.ImageList('iconImage', '')
                            }

                            if (self.options.images.indexOf(style.icon.image) > -1) {
                                $.each(self.options.images, function (idx) {
                                    if (self.options.images[idx] === style.icon.image) {
                                        iconIndex = idx;
                                    }
                                });
                            } else {
                                iconIndex = self.options.images.length;
                                self.options.images.push(style.icon.image);
                            }

                            if (dataLength - 1 === j) {
                                image.addUrls(self.options.images);
                                self._grid.registerImageList(image);
                                self._grid.setColumnProperty(self._grid.columnByField(columns.field), "imageList", "iconImage");
                                self._grid.setColumnProperty(self._grid.columnByField(columns.field), "renderer", {type: "icon"});
                                self.options.iconImagelist = image;
                            }

                            if ($.type(style.icon.position) === 'undefined') {
                                style.icon.position = 'left';
                            }

                            columns.cellDynamic.push({
                                criteria: "(values['" + columns.field + "'] = '" + self._grid.getValue(j - 1, columns.field) + "')",
                                styles: 'iconIndex=' + iconIndex + ';iconOffset=0;iconPadding=5;iconAlignment=center;iconLocation=' + style.icon.position
                            });
                        }

                        styles = $.extend(true, styles, style);
                        var criteria;
                        if ($.type(self._grid.getValue(j - 1, columns.field)) === 'undefined') {
                            criteria = "values['" + columns.field + "'] = null";
                        } else {
                            criteria = "(values['" + columns.field + "'] = '" + self._grid.getValue(j - 1, columns.field) + "')";
                        }
                        columns.cellDynamic.push({
                            criteria: criteria,
                            styles: styles
                        });
                    }
                }
                self._grid.setColumnProperty(self._grid.columnByField(columns.field), 'dynamicStyles', columns.cellDynamic);
            }
            // 트리그리드 드롭다운리스트에 function으로 datasource받을 경우 사용
            if (columns && columns.editor && columns.editor.type.toLowerCase() === 'dropdown') {
                var col = self._grid.columnByField(columns.fieldName),
                    fetchData,
                    datasource = columns.editor.dataSource;

                if ($.type(columns.editor.dataSource) === 'function') {
                    // 추후 수정해야할 코드입니다.
                    for (var drop = 0; drop < dataLength; drop += 1) {
                        var e = {
                            treegrid: self,
                            row: {
                                index: drop,
                                data: self.dataItem(drop)
                            }
                        };

                        if ($.type(columns.editor.dataSource) === 'function') {
                            datasource = columns.editor.dataSource.call(self, e);
                        }

                        col.values = [];
                        col.labels = [];

                        datasource.col = col;

                        datasource.fetch(function () {
                            fetchData = this;
                        }).done(function () {
                            var dropdownColumn = self.columns[fetchData.col.fieldName];
                            $.each(fetchData.data(), function (idx, data) {
                                col.values.push(data[dropdownColumn.editor.dataValueField]);
                                col.labels.push(data[dropdownColumn.editor.dataTextField]);
                            });
                            fetchData.col.labelField = columns.editor.dataTextField;
                            fetchData.col.lookupDisplay = true;
                            self._grid.setColumn(fetchData.col);
                            delete fetchData.col;
                        });
                    }
                } else {
                    col.values = [];
                    col.labels = [];

                    datasource.col = col;

                    datasource.fetch(function () {
                        fetchData = this;
                    }).done(function () {
                        var dropdownColumn = self.columns[fetchData.col.fieldName];
                        $.each(fetchData.data(), function (idx, data) {
                            fetchData.col.values.push(data[dropdownColumn.editor.dataValueField]);
                            fetchData.col.labels.push(data[dropdownColumn.editor.dataTextField]);
                        });
                        fetchData.col.labelField = columns.editor.dataTextField;
                        fetchData.col.lookupDisplay = true;
                        self._grid.setColumn(fetchData.col);
                        delete fetchData.col;
                    });
                }
            }
        }
    }

})(jQuery, window.dews || {});


/*
 * 트리뷰
 */
(function ($, dews, kendo) {
    var defaultOption = {
        treePadding: 10,
        loadOnDemand: false
    };

    function getOptions ($el, options) {
        var opt = {};
        var inlineOptions = {};
        var paddingOption;

        if (options && options.checkboxes && !options.checkboxes.template) {
            options.checkboxes.template = "<span class='dews-checkbox-wrapper'><input type='checkbox' class='dews-ui-checkbox dews-control k-checkbox dews-control-activate'><label class='dews-checkbox-label k-checkbox-label' onclick='dews.ui.treeview.checkbox._click(this)'></label></span>";
        }

        paddingOption = $el.data('dews-tree-padding') || $el.data('dews-treeview-padding');

        if(paddingOption) {
            inlineOptions.treePadding = paddingOption;
        }

        opt = $.extend(true, {}, defaultOption, inlineOptions, options);
        return opt;
    }

    /**
     * expandTo 함수를 확장합니다..
     * @param {function} originExpandTo Kendo UI의 expandTo 함수
     */
    function expandTo(originExpandTo) {
        return function (childNode) {
            var self = this;
            var parentList = [];
            var _getExpandNodeList = function(node) {
                var parent;

                if(!self.parent(node).get(0)) {return;}

                parent = self.parent(node);
                parentList.push(parent);

                _getExpandNodeList(parent);
            };

            if(!childNode) {return;}

            if(childNode.id && ($.type(childNode.id) === ('string' || 'number'))) {
                originExpandTo.call(self, childNode);
            } else {
                _getExpandNodeList(self.findByUid(childNode.uid));

                while(parentList.length) {
                    self.expand(parentList.pop());
                }
            }
        }
    }

    /**
     * expandAll 트리뷰 모든 노드 확장
     * @param {Function} originExpand  Kendo UI의 expand 함수
     */
    function expandAll(originExpand) {
        return function () {
            var self = this;

            originExpand.call(self, '.k-item');
        }
    }

    /**
     * collapseAll 트리뷰 모든 노드 접힘
     * @param {Function} originCollapse  Kendo UI의 collapse 함수
     */
    function collapseAll(originCollapse) {
        return function () {
            var self = this;

            originCollapse.call(self, '.k-item');
        }
    }

    $.extend(true, dews, {
        ui: {
            treeview: function (selector, options) {
                var $el,
                    treeview;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else {
                    $el = $(selector);
                }

                if ($.type(selector) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var $this = $(this),
                        control,
                        opt;

                    control = $this.data("dews-control");

                    if (!control) {
                        opt = getOptions($this, options);
                        $this.css('padding', opt.treePadding);

                        if (!$this.hasClass("dews-ui-treeview")) {
                            $this.addClass("dews-ui-treeview");
                        }

                        if (!$this.hasClass('dews-data-control')) {
                            $this.addClass('dews-data-control');
                        }

                        $this.addClass("dews-control-activate");

                        $this.kendoTreeView(opt);

                        control = $this.data("kendoTreeView");

                        $this.data('dews-control', control);
                    }

                    treeview = control;
                });

                return treeview;
            }
        }
    });

    dews.ui.treeview.checkbox =  {
        _click: function (sender) {
            var $label = $(sender),
                $checkbox;

            $checkbox = $label.parent(".dews-checkbox-wrapper").find('input[type="checkbox"]');
            $checkbox.click();
        }
    };


    /**
     * expandAll 함수 정의(Kendo UI expand 함수 이용)
     */
    kendo.ui.TreeView.fn.expandAll = expandAll(kendo.ui.TreeView.fn.expand);

    /**
     * collapseAll 함수 정의(Kendo UI collapse 함수 이용)
     */
    kendo.ui.TreeView.fn.collapseAll = collapseAll(kendo.ui.TreeView.fn.collapse);

    // kendo treeview 2017.3.913 버전 expandTo 오류로 인한 재정의
    /**
     * expandTo 함수를 재정의 합니다.
     */
    kendo.ui.TreeView.fn.expandTo = expandTo(kendo.ui.TreeView.fn.expandTo);

    // getCheckedNodes 함수 추가
    kendo.ui.TreeView.fn.getCheckedNodes = function () {
        var self = this;

        return self.element.find('input[type="checkbox"]:checked').closest('li.k-item');
    };

    // 트리뷰 이벤트 설정
    kendo.ui.TreeView.fn.on = function () {
        var self = this;

        self.element.on.apply(self.element, arguments);
    };

    dews.ui.addControlInitializer('treeview', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.treeview($("ul.dews-ui-treeview", $container));
    });
})(jQuery, window.dews, window.kendo);


/*
 * 업로드 컨트롤
 */
(function ($, dews, kendo) {
    var defaultOptions,
        attachFunctions;

    defaultOptions = {
        localization: {
            select: "첨부파일",
            dropFilesHere: "여기로 드래그"
        },
        showFileList: false,
        multiple: false,
        success: function (e) {
            var self = this,
                response = e.response,
                $el = self.element,
                data;

            if (response.state === "error") {
                console.log(response);
                //alert(response.message);
            } else {
                data = response.data;

                if (data) {
                    attachFunctions.add.call(self, data);
                }
            }
        },
        remove: function (e) {
            e.preventDefault();
        }
    };

    attachFunctions = {
        /**
         * 첨부파일 추가
         */
        add: function (data, isNew) {
            var self = this,
                temp_attaches = [],
                new_attaches = [],
                attach_item,
                attach_keys = [],
                attach_names = [],
                $added;

            $added = $("#" + getControlNamePrefix(this.element) + "_added");

            if ($.type(isNew) === "undefined") {
                isNew = true;
            }

            if (data) {
                if (self.options.multiple === true) {
                    if ($added.val()) {
                        temp_attaches = $added.val().split("|");
                    }
                    if (temp_attaches.length > 0) {
                        $.each(temp_attaches, function (idx) {
                            attach_item = temp_attaches[idx].split(":");
                            attach_keys.push(attach_item[0]);
                            attach_names.push(attach_item[1]);
                        });
                    }

                    if ($added.data("new")) {
                        $.each($added.data("new").split("|"), function (idx, item) {
                            new_attaches.push(item);
                        });
                    }
                } else {
                    if ($added.data("new")) {
                        $.each($added.data("new").split("|"), function (idx, item) {
                            dews.ajax.post(self.options.async.removeUrl, {
                                data: { fileKey: item }
                            });
                        });
                    }
                }

                attach_keys.push(data.fileKey);
                attach_names.push(data.filename);
                if (isNew) {
                    new_attaches.push(data.fileKey);
                }

                temp_attaches = [];

                for (var i = 0; i < attach_keys.length; i++) {
                    temp_attaches.push(attach_keys[i] + ":" + attach_names[i]);
                }

                $added.val(temp_attaches.join("|"));
                $added.data("new", new_attaches.join("|"));

                $added.parent().find(".dews-ui-upload").trigger("added", [data]);
            }
        },
        /**
         * 첨부파일 제거
         */
        remove: function (fileKey) {
            var self = this,
                temp_attaches = [],
                new_attaches = [],
                attach_item,
                deleted = [],
                attach_keys = [],
                attach_names = [],
                $added,
                $deleted;

            $added = $("#" + getControlNamePrefix(self.element) + "_added");
            $deleted = $("#" + getControlNamePrefix(self.element) + "_deleted");

            if (fileKey) {
                if ($added.val()) {
                    temp_attaches = $added.val().split("|");
                }
                if (temp_attaches.length > 0) {
                    $.each(temp_attaches, function (idx) {
                        attach_item = temp_attaches[idx].split(":");

                        if (attach_item[0] === fileKey) {
                            deleted.push(fileKey);
                        } else {
                            attach_keys.push(attach_item[0]);
                            attach_names.push(attach_item[1]);
                        }
                    });
                }

                if ($added.data("new")) {
                    $.each($added.data("new").split("|"), function (idx, item) {
                        if (item === fileKey) {
                            dews.ajax.post(self.options.async.removeUrl, {
                                data: { fileKey: item }
                            });
                        } else {
                            new_attaches.push(item);
                        }
                    });
                }

                temp_attaches = [];

                for (var i = 0; i < attach_keys.length; i++) {
                    temp_attaches.push(attach_keys[i] + ":" + attach_names[i]);
                }

                $added.val(temp_attaches.join("|"));
                $added.data("new", new_attaches.join("|"));
                $deleted.val(deleted.join("|"));

                $added.parent().find(".dews-ui-upload").trigger("removed", [ fileKey ]);
            }
        }
    };

    // 옵션을 구성합니다.
    function configureOptions($el, userOptions) {
        var options,
            tagOptions = {};

        if ($el.data("dews-controller-url")) {
            // 컨트롤러 경로로 첨부파일 업로드 / 삭제 경로를 자동 생성
            $.extend(true, tagOptions, {
                async: {
                    saveUrl: dews.url.getAbsoluteUrl(dews.url.join("~/", $el.data("dews-controller-url"), "/UploadFile")),
                    removeUrl: dews.url.getAbsoluteUrl(dews.url.join("~/", $el.data("dews-controller-url"), "/DeleteFile"))
                }
            });
        }

        if ($el.data("dews-text")) {
            $.extend(true, tagOptions, {
                localization: {
                    select: $el.data("dews-text")
                }
            });
        }

        options = $.extend(true, options, defaultOptions, tagOptions, userOptions || {});

        return options;
    }

    // 추가적으로 필요한 컨트롤들을 추가합니다.
    function appendAdditionalControls($el) {
        var namePrefix,
            $container,
            $added, addedName,
            $deleted, deletedName,
            hiddenTemplate,
            uploadManager;

        $container = $el.closest(".k-upload").addClass("dews-ui-upload-wrapper");
        hiddenTemplate = "<input type=\"hidden\" name=\"{0}\" id=\"{0}\" />";

        namePrefix = getControlNamePrefix($el);

        addedName = namePrefix + "_added";
        deletedName = namePrefix + "_deleted";

        $added = $(dews.string.format(hiddenTemplate, addedName));
        $deleted = $(dews.string.format(hiddenTemplate, deletedName));

        $added.appendTo($container);
        $deleted.appendTo($container);
    }

    function getControlNamePrefix($el) {
        var namePrefix;

        if ($el.attr("name")) {
            namePrefix = $el.attr("name");
        } else if ($el.attr("id")) {
            namePrefix = $el.attr("id");
        } else {
            namePrefix = "file_" + $("input[type=file]").index($el).toString();
        }

        return namePrefix;
    }

    // dews 확장
    $.extend(true, dews, {
        ui: {
            /**
             * BBS 업로드 컨트롤
             *
             * @param {jQuery|String} selector 업로드 컨트롤로 만들 대상 컨트롤의 jQuery객체 또는 셀렉터
             * @param {Object} [options] 업로드 설정
             */
            upload: function (selector, options) {
                var $el,
                    upload;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === "string") {
                    $el = $(selector);
                }

                if (kendo) {
                    $el.each(function () {
                        var $this = $(this),
                            opt,
                            ctrl;

                        ctrl = $this.data("dews-control");

                        if (!ctrl) {
                            opt = configureOptions($this, options);

                            if (!$this.hasClass("dews-ui-upload")) {
                                $this.addClass("dews-ui-upload");
                            }

                            if (!$this.hasClass('dews-form-control')) {
                                $this.addClass('dews-form-control');
                            }

                            if ($this.attr("tabindex") !== "-1") {
                                $this.attr("tabindex", "-1");
                            }

                            $this.addClass("dews-control-activate");
                            $this.kendoUpload(opt);
                            $this.closest(".k-upload").addClass("dews-upload-wrapper");

                            appendAdditionalControls($this);

                            ctrl = $this.data('kendoUpload');

                            $this.data('dews-control', ctrl);
                        }

                        upload = ctrl;
                    });
                }

                return upload;
            }
        }
    });

    /**
     * 이전에 등록된 파일을 추가합니다.
     */
    kendo.ui.Upload.prototype.addFile = function (fileKey, filename) {
        attachFunctions.add.call(this, { fileKey: fileKey, filename: filename }, false);
    };

    /**
     * 파일을 제거합니다.
     */
    kendo.ui.Upload.prototype.removeFile = function (fileKey) {
        attachFunctions.remove.call(this, fileKey);
    };

    dews.ui.addControlInitializer('upload', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.upload($("input[type=file].dews-ui-upload", $container));
    });
})(jQuery, window.dews, window.kendo);


/**
 * 주기간피커
 * Created by yejin on 2018. 1. 16..
 */
(function ($, dews, kendo) {
    var defaultOptions = {
        startWeek: null,
        endWeek: null,
        max: 2100,
        min: 1900,
        format: 'yyyy-WW',
        valueFormat: 'yyyyWW'
    };

    function getOptions($el, srcOptions) {
        var inlineOptions,
            preDefinedFormat,
            options;

        inlineOptions = getInlineOptions($el);
        preDefinedFormat = dews.getPreDefinedFormat($el);

        if (preDefinedFormat) {
            var vf = preDefinedFormat.replace(/[^(a-z)]/gi,"");
            preDefinedFormat = {
                format: preDefinedFormat,
                valueFormat: vf
            };
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions, preDefinedFormat);
        } else if (preDefinedFormat !== false && inlineOptions) {
            options = $.extend(true, {}, defaultOptions, inlineOptions, srcOptions);
        } else {
            options = $.extend(true, {}, defaultOptions, srcOptions);
        }

        if ($el.val()) {
            options.value = kendo.parseDate($el.val(), options.valueFormat, kendo.getCulture());
        }
        return options;
    }

    /**
     * HTML 태그에 지정된 옵션을 가져옵니다.
     * @param {jQuery} $el 대상 요소의 jQuery 객체
     * @returns {object} 옵션
     */
    function getInlineOptions($el) {
        var options = {};

        if ($el.data('dews-format')) {
            options.format = $el.data('dews-format');
        }
        if ($el.data('dews-start-week')) {
            options.startWeek = $el.data('dews-start-week');
        }
        if ($el.data('dews-end-week')) {
            options.endWeek = $el.data('dews-end-week');
        }
        return options;
    }

    var WeekPeriodPicker = function (element, options) {
        var self = this, $element = element;
        var thisYear = new Date().getFullYear();

        self.options = getOptions($element, options);

        self._$wrapper = null;
        self._$startInput = null;
        self._$endInput = null;
        self._$calenderButton = null;
        self._$hiddenArea = null;
        self._$buttons = null;
        self._$buttons2 = null;
        self._$okButton = null;
        self.option = null;
        self.disableButton = false;
        self._thisYear = thisYear;
        self._$element = $element;
    };

    //wrapper 생성
    WeekPeriodPicker.prototype._createWrapper = function () {
        var self = this, $el = self._$element, $wrapper, width;

        $wrapper = $("<span/>").addClass("dews-weekperiodpicker-wrapper dews-control");

        if ($el.attr('style')) {
            var matches = $el.attr('style').match(/width:([^;]+);?/i);

            if (matches) {
                width = $.trim(matches[1]);
                $wrapper.width(width);
                $el.css("width", "");
            }
        }

        if ($el.hasClass('readonly')) {
            $wrapper.addClass('dews-state-readonly');
            $el.addClass('dews-state-readonly');
            self.disableButton = true;
        }
        if ($el.hasClass('disabled')) {
            $wrapper.addClass('dews-state-disabled');
            $el.addClass('dews-state-disabled');
            self.disableButton = true;
        }
        if ($el.hasClass('required')) {
            $wrapper.addClass('dews-state-required');
            $el.addClass('dews-state-required');
        }
        $el.wrap($wrapper);
        self._$wrapper = $el.parent('.dews-weekperiodpicker-wrapper');
    };

    // 시작날짜 텍스트박스 생성
    WeekPeriodPicker.prototype._createStartInput = function () {
        var self = this, $el = self._$element, $startInput, opt;

        $startInput = $("<input/>").addClass("dews-weekperiodpicker-input dews-weekperiodpicker-startDate k-textbox k-space-right");

        if ($el.hasClass('readonly')) {
            $startInput.addClass('dews-state-readonly');
            $startInput.attr("readonly", "readonly");
        }
        if ($el.hasClass('disabled')) {
            $startInput.addClass('dews-state-disabled');
            $startInput.attr("disabled", "disabled");
        }
        if ($el.hasClass('required')) {
            $startInput.addClass('dews-state-required');
        }

        opt = self.options;

        setMask($startInput, opt.format);
        setEvent($startInput, opt);

        $el.append($startInput);
        self._$startInput = $startInput;
    };

    // 종료날짜 텍스트박스 생성
    WeekPeriodPicker.prototype._createEndInput = function () {
        var self = this, $el = self._$element, $endInput, $span, opt;

        $endInput = $("<input/>").addClass("dews-weekperiodpicker-input dews-weekperiodpicker-endDate k-textbox k-space-right");
        $span = $("<span>~</span>").addClass("dews-weekperiodpicker-span");

        if ($el.hasClass('readonly')) {
            $endInput.addClass('dews-state-readonly');
            $endInput.attr("readonly", "readonly");
        }
        if ($el.hasClass('disabled')) {
            $endInput.addClass('dews-state-disabled');
            $endInput.attr("disabled", "disabled");
        }
        if ($el.hasClass('required')) {
            $endInput.addClass('dews-state-required');
        }

        opt = self.options;

        setMask($endInput, opt.format);
        setEvent($endInput, opt);

        $el.append($span);
        $el.append($endInput);
        self._$endInput = $endInput;
    };

    // 달력버튼 생성
    WeekPeriodPicker.prototype._createCalendarButton = function () {
        var self = this, $el = self._$element, $calendarButton, $img;

        $calendarButton = $("<span/>").addClass("k-select");
        $img = $("<span/>").addClass("k-icon k-i-calendar");

        $el.append($calendarButton);
        $calendarButton.append($img);
        self._$calenderButton = $calendarButton;
    };

    // 숨겨진 영역 생성
    WeekPeriodPicker.prototype._createHiddenArea = function () {
        var self = this, $hiddenArea;

        $hiddenArea = $("<div/>").addClass("dews-weekperiodpicker-calendars");

        $(document.body).append($hiddenArea);
        self._$hiddenArea = $hiddenArea;
    };

    //선택한 기간, 적용하기 버튼 영역 생성
    WeekPeriodPicker.prototype._createOkButtonArea = function () {
        var self = this, $buttons, $buttons2;

        $buttons = $("<div/>").addClass("dews-weekperiodpicker-buttons");
        $buttons2 = $("<div/>").addClass("dews-weekperiodpicker-buttons2");

        self._$hiddenArea.append($buttons).append($buttons2);
        self._$buttons = $buttons;
        self._$buttons2 = $buttons2;
    };

    //숫자텍스박스 생성
    WeekPeriodPicker.prototype._createNumericTextBox = function () {
        var self = this, $startYear, $starWeek, $endYear, $endWeek, $periodSelect;

        $periodSelect = $("<p>" + dews.localize.get('선택 기간', 'dews_선택 기간') + " :<br/></p>").addClass("dews-weekperiodpicker-periodSelect");
        $startYear = $("<input type='text' data-dews-spinners='true' max=2100 min='1900' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-weekperiodpicker-firstyear");
        $starWeek = $("<input type='text' data-dews-spinners='true' max='53' min='1' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-weekperiodpicker-firstweek");
        $endYear = $("<input type='text' data-dews-spinners='true' max='2100' min='1900' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-weekperiodpicker-secondyear");
        $endWeek = $("<input type='text' data-dews-spinners='true' max='53' min='1' data-dews-format='#'/>").addClass("dews-ui-numerictextbox dews-weekperiodpicker-secondweek");

        self._$buttons.append($periodSelect).append($startYear).append("<span class='dews-weekperiodpicker-year'>년</span>").append($starWeek).append("<span  class='dews-weekperiodpicker-week'>주</span>")
            .append("<span class=dews-weekperiodpicker-period>~</span>").append($endYear).append("<span class='dews-weekperiodpicker-year'>년</span>").append($endWeek).append("<span  class='dews-weekperiodpicker-week'>주</span>");

        self._$startYear = dews.ui.numerictextbox($startYear);
        self._$startWeek = dews.ui.numerictextbox($starWeek);
        self._$endYear = dews.ui.numerictextbox($endYear);
        self._$endWeek = dews.ui.numerictextbox($endWeek);
    };

    //선택한 기간 생성
    WeekPeriodPicker.prototype._createPeriodDate = function () {
        var self = this,
            $periodDate, $periodSelect;

        $periodSelect = $("<p>" + dews.localize.get('선택한 기간', 'dews_선택한 기간') + ":</p>").addClass("dews-weekperiodpicker-periodselect");
        $periodDate = $("<strong/>").addClass("dews-weekperiodpicker-perioddate");

        self._$buttons2.append($periodSelect);
        $periodSelect.append($periodDate);

        self._$periodDate = $periodDate;
    };

    //적용하기 버튼 생성
    WeekPeriodPicker.prototype._createOkButton = function () {
        var self = this, $okButton;

        $okButton = $("<button type='button'>" + dews.localize.get('적용하기', 'dews_적용하기') + "</button>").addClass("dews-ui-button endWeekall small primary dews-weekperiodpicker-ok k-button");

        self._$buttons2.append($okButton);
        self._$okButton = $okButton;
    };

    WeekPeriodPicker.prototype._setNumericTextBoxValue = function (startY, startW, endY, endW) {
        var self = this;

        self._$startYear.value(startY);
        self._$startWeek.value(startW);
        self._$endYear.value(endY);
        self._$endWeek.value(endW);
    };

    // 컨트롤 초기화
    WeekPeriodPicker.prototype._initControl = function () {
        var self = this;

        self._createWrapper();
        self._createStartInput();
        self._createEndInput();
        self._createCalendarButton();
        self._createHiddenArea();
        self._createOkButtonArea();
        self._createNumericTextBox();
        self._createPeriodDate();
        self._createOkButton();
        self._setNumericTextBoxValue();
        self._bindEvents();

        self.setUserGuideAPI();
    };

    //enable 설정 함수
    WeekPeriodPicker.prototype.enable = function (value) {
        var self = this,
            $el = $(self._$element),
            enabled;

        enabled = !$el.hasClass("disabled");

        if (typeof value !== 'undefined') {
            if (value === true) {
                $el.removeClass("dews-state-disabled");
                self._$wrapper.removeClass("dews-state-disabled");
                self._$startInput.removeAttr("disabled", "disabled");
                self._$endInput.removeAttr("disabled", "disabled");
                self._$startInput.removeClass("dews-state-disabled");
                self._$endInput.removeClass("dews-state-disabled");
                enabled = !value;
            } else if (value === false) {
                $el.addClass("dews-state-disabled");
                self._$wrapper.addClass("dews-state-disabled");
                self._$startInput.attr("disabled", "disabled");
                self._$endInput.attr("disabled", "disabled");
                self._$startInput.addClass("dews-state-disabled");
                self._$endInput.addClass("dews-state-disabled");
                enabled = !value;
            }
        }
        return enabled;
    };

    //readonly 설정 함수
    WeekPeriodPicker.prototype.readonly = function (value) {
        var self = this,
            $el = $(self._$element),
            readonly;

        readonly = $el.hasClass("readonly");

        if (typeof value !== 'undefined') {
            if (value === false) {
                $el.removeClass('dews-state-readonly');
                self._$wrapper.removeClass("dews-state-readonly");
                self._$startInput.removeAttr("readonly", "readonly");
                self._$endInput.removeAttr("readonly", "readonly");
                self._$startInput.removeClass("dews-state-readonly");
                self._$endInput.removeClass("dews-state-readonly");
                self.disableButton = false;
                readonly = !value;
            } else if (value === true) {
                $el.addClass('dews-state-readonly');
                self._$wrapper.addClass("dews-state-readonly");
                self._$startInput.attr("readonly", "readonly");
                self._$endInput.attr("readonly", "readonly");
                self._$startInput.addClass("dews-state-readonly");
                self._$endInput.addClass("dews-state-readonly");
                self.disableButton = true;
                readonly = !value;
            }
        }
        return readonly;
    };

    //focus 설정 함수
    WeekPeriodPicker.prototype.focus = function (options) {
        var self = this;

        if (options === "start") {
            self._$startInput.focus();
        } else if (options === "end") {
            self._$endInput.focus();
        } else if (options === undefined) {
            if (self._$startInput.val()) {
                self._$endInput.focus();
            } else {
                self._$startInput.focus();
            }
        }
    };

    //'201801' 을 '2018-01' 로. 포맷이 지정된 날짜로 설정
    WeekPeriodPicker.prototype.dateStringToFormatedString = function (year, week) {
        var self = this;
        return self.options.format.replace(/w{1,2}/gi, week).replace(/y{2,4}/gi, year);
    };

    //'2018-01' 을 '201801'로. 포맷이 지정되지 않은 날짜로 설정.
    //flag 값의 유무에 따라 year, week 값 리턴
    WeekPeriodPicker.prototype.getWeek = function (input, flag) {
        var self = this, inputValue;
        var endWithWeek
        if ($.type(input) === 'object') {
            inputValue = input.val();
        } else {
            inputValue = input;
        }
        var format = self.options.format, initValue = inputValue;
        var year, week, arrYears, arrWeeks;

        initValue = $.trim(initValue);

        if (/-|\/|~/.test(initValue)) {
            endWithWeek = /w$/gi.test(format);
        } else {
            endWithWeek = /w$/gi.test(format);
            var noFormat = true;
        }

        if (!noFormat) {
            if (endWithWeek) {
                arrYears = /^\d+/.exec(initValue);
                arrWeeks = /\d+$/.exec(initValue);
            } else {
                arrYears = /\d+$/.exec(initValue);
                arrWeeks = /^\d+/.exec(initValue);
            }
        } else {
            if (endWithWeek) {
                year = initValue.substring(0, 4);
                week = initValue.substring(4, 6);
            } else {
                year = initValue.substring(2, 6);
                week = initValue.substring(0, 2);
            }
        }

        if ($.isArray(arrWeeks) && $.isArray(arrYears)) {
            year = parseInt(arrYears[0], 10);
            week = parseInt(arrWeeks[0], 10);

            week = week < 10 ? '0' + week.toString() : week;
        }

        if (flag === 'week') {
            return week ? week : '';
        } else if (flag === 'year') {
            return year ? year : '';
        } else if (year && week) {
            return year + '' + week;
        } else {
            return '';
        }
    };

    //포맷이 지정되지 않은 시작 주차 리턴
    WeekPeriodPicker.prototype.getStartWeek = function () {
        var self = this;

        return this.getWeek(self._$startInput) || '';
    };

    //포맷이 지정되지 않은 종료 주차 리턴
    WeekPeriodPicker.prototype.getEndWeek = function () {
        var self = this;

        return this.getWeek(self._$endInput) || '';
    };

    //포맷이 지정된 시작 주차 리턴
    WeekPeriodPicker.prototype.getStartWeekText = function () {
        var self = this,
            year = this.getWeek(self._$startInput, 'year') ? this.getWeek(self._$startInput, 'year').toString() : '',
            week = this.getWeek(self._$startInput, 'week') ? this.getWeek(self._$startInput, 'week').toString() : '';

        if (year && week) {
            return dews._environments.formats.weekFormat.replace(/w{1,2}/gi, week).replace(/y{2,4}/gi, year) || '';
        } else {
            return '';
        }
    };

    //포맷이 지정된 종료 주차 리턴
    WeekPeriodPicker.prototype.getEndWeekText = function () {
        var self = this,
            year = this.getWeek(self._$endInput, 'year') ? this.getWeek(self._$endInput, 'year').toString() : '',
            week = this.getWeek(self._$endInput, 'week') ? this.getWeek(self._$endInput, 'week').toString() : '';

        if (year && week) {
            return dews._environments.formats.weekFormat.replace(/w{1,2}/gi, week).replace(/y{2,4}/gi, year) || '';
        } else {
            return '';
        }
    };

    //date 형태를 포맷이 지정된 날짜 스트링으로 리턴
    WeekPeriodPicker.prototype._dateToString = function (date) {
        return kendo.toString(date, dews._environments.formats.dateValueFormat, kendo.getCulture());
    };

    //시작 주차의 시작하는 날의 년, 월, 일을 가져옴
    WeekPeriodPicker.prototype.getStartFirstDate = function () {
        var self = this;
        var value = this.getWeek(self._$startInput);
        var startFirstDate = this._getStartDate(value);

        return this._dateToString(startFirstDate);
    };

    //시작 주차의 종료하는 날의 년, 월, 일을 가져옴
    WeekPeriodPicker.prototype.getStartLastDate = function () {
        var self = this;
        var value = this.getWeek(self._$startInput);
        var startLastDate = this._getEndDate(value);

        return this._dateToString(startLastDate);
    };

    //종료 주차의 시작하는 날의 년, 월, 일을 가져옴
    WeekPeriodPicker.prototype.getEndFirstDate = function () {
        var self = this;
        var value = this.getWeek(self._$endInput);
        var endFirstDate = this._getStartDate(value);

        return this._dateToString(endFirstDate);
    };

    //종료 주차의 종료하는 날의 년, 월, 일을 가져옴
    WeekPeriodPicker.prototype.getEndLastDate = function () {
        var self = this;
        var value = this.getWeek(self._$endInput);
        var endLastDate = this._getEndDate(value);

        return this._dateToString(endLastDate);
    };

    //설정한 날짜의 시작 날짜 리턴
    WeekPeriodPicker.prototype._getStartDate = function (value) {
        var self = this;
        var year = parseInt(value.substring(0, 4)), week = parseInt(value.substring(4, 6));
        var toDate = new Date(year, 0, 1 + (week - 1) * 7);
        var getDay = toDate.getDay(); // getDay : 요일에 해당하는 인덱스. 일요일(0), 월요일(1)...
        var startDate = toDate;

        if (getDay <= 4) { // 1일이 목요일이 넘지 않았다면 당해년도의 첫째 주
            startDate.setDate(toDate.getDate() - toDate.getDay() + 1);
        } else { // 금, 토, 일이라면 작년의 마지막 주
            startDate.setDate(toDate.getDate() + 8 - toDate.getDay());
        }
        return startDate;
    };

    //설정한 날짜의 종료 날짜 리턴
    WeekPeriodPicker.prototype._getEndDate = function (value) {
        var self = this;
        var year = parseInt(value.substring(0, 4)), week = parseInt(value.substring(4, 6));
        var toEndDate = new Date(year, 0, 1 + (week - 1) * 7);
        var getDay = toEndDate.getDay();
        var endDate = toEndDate;
        var startDate = this._getStartDate(value);
        var calEndDate = 7 - getDay;
        if (startDate) {
            if (getDay <= 4) {
                endDate.setDate(toEndDate.getDate() + calEndDate);
            } else { // 2019-01 의 시작 날짜가 20181231 일 때
                endDate.setDate(startDate.getDate() + 6);
            }
            return endDate;
        }
    };

    //date를 받아서 그에 해당하는 주차를 가져옴
    WeekPeriodPicker.prototype._checkWeekNum = function (date) {
        return kendo.date.weekInYear(date);
    };

    //시작 날짜를 설정함
    WeekPeriodPicker.prototype.setStartWeek = function (value) {
        var self = this;
        var newDate, startYear, startWeek, dateValue;

        if (!isNaN(value)) {
            if ($.type(value) === 'date') {
                var checkNum = self._checkWeekNum(value).toString();
                newDate = value;
                startYear = newDate.getFullYear();
                startWeek = checkNum < 10 ? '0' + checkNum : checkNum;
            } else if (value) {
                dateValue = value.toString();
                startYear = self.getWeek(dateValue, 'year').toString();
                startWeek = self.getWeek(dateValue, 'week').toString();
            } else {
                startYear = '';
                startWeek = '';
            }

            if (startWeek && startYear) {
                dateValue = self.options.format.replace(/w{1,2}/gi, startWeek).replace(/y{2,4}/gi, startYear);
            } else if (!startWeek && !startYear) {
                dateValue = '';
            }

            if (self._$endInput.val() && self.getWeek(self._$endInput, 'year').toString() + self.getWeek(self._$endInput, 'week').toString() < startYear + startWeek) {
                self._$startYear.value('');
                self._$startWeek.value('');

                self._$startInput.val('');
            } else {
                self._$startYear.value(startYear);
                self._$startWeek.value(startWeek);

                self._$startInput.val(dateValue);
            }
        }
    };

    //종료 날짜를 설정함
    WeekPeriodPicker.prototype.setEndWeek = function (value) {
        var self = this;
        var newDate, endYear, endWeek, dateValue;

        if (!isNaN(value)) {
            if ($.type(value) === 'date') {
                var checkNum = self._checkWeekNum(value).toString();
                newDate = value;
                endYear = newDate.getFullYear();
                endWeek = checkNum < 10 ? '0' + checkNum : checkNum;
            } else if (value) {
                dateValue = value.toString();
                endYear = self.getWeek(dateValue, 'year').toString();
                endWeek = self.getWeek(dateValue, 'week').toString();
            } else {
                endYear = '';
                endWeek = '';
            }

            if (endWeek && endYear) {
                dateValue = self.options.format.replace(/w{1,2}/gi, endWeek).replace(/y{2,4}/gi, endYear);
            } else if (!endWeek && !endYear) {
                dateValue = '';
            }

            if (self._$startInput.val() && self.getWeek(self._$startInput, 'year').toString() + self.getWeek(self._$startInput, 'week').toString() > endYear + endWeek) {
                self._$endYear.value('');
                self._$endWeek.value('');

                self._$endInput.val('');
            } else {
                self._$endYear.value(endYear);
                self._$endWeek.value(endWeek);

                self._$endInput.val(dateValue);
            }
        }
    };

    //기간을 from, to 형태로 설정함
    WeekPeriodPicker.prototype.setPeriod = function (start, end) {
        var self = this, getStartDate, getEndDate;

        if (start) {
            getStartDate = self._getStartDate(self.getWeek(start, 'year') + '' + self.getWeek(start, 'week'));
            getStartDate = kendo.toString(getStartDate, dews._environments.formats.dateFormat, kendo.getCulture());
        }

        if (end) {
            getEndDate = self._getStartDate(self.getWeek(end, 'year') + '' + self.getWeek(end, 'week'));
            getEndDate = kendo.toString(getEndDate, dews._environments.formats.dateFormat, kendo.getCulture());
        }

        if (start && end && (start <= end)) {
            this.setStartWeek(start);
            this.setEndWeek(end);
            self._$periodDate.text(getStartDate + '~' + getEndDate);
        } else if (start && end && (start > end)) {
            this.setStartWeek('');
            this.setEndWeek('');
        } else if (start && !end) {
            this.setStartWeek(start);
            this.setEndWeek('');
        } else if (!start && end) {
            this.setStartWeek('');
            this.setEndWeek(end);
        } else if (!start && !end) {
            this.setStartWeek('');
            this.setEndWeek('');
        }

        if (!(start && end && (start <= end))) {
            self._$periodDate.text('');
        }
    };

    //이벤트 처리
    WeekPeriodPicker.prototype._bindEvents = function () {
        var self = this, $el = self._$element;
        var toggle = true;
        var offset = 0;

        if ($el.hasClass('readonly')) {
            self.disableButton = true;
        }

        self._$startInput.on("focus", function (e) {
            $el.addClass('dews-weekperiodpicker-focus');
            e.stopPropagation();
        });

        self._$endInput.on("focus", function (e) {
            $el.addClass('dews-weekperiodpicker-focus');
            e.stopPropagation();
        });

        self._$startInput.on("blur", function (e) {
            $el.removeClass('dews-weekperiodpicker-focus');
            e.stopPropagation();
        });

        self._$endInput.on("blur", function (e) {
            $el.removeClass('dews-weekperiodpicker-focus');
            e.stopPropagation();
        });

        var popoverClose = function (e) {
            if ((e.type === "scroll" && (!$(e.target).parents('.dews-weekperiodpicker-calendars')[0])) || (e.type === "keyup" && e.keyCode === 27)) {
                close();
                $(e.target).focus();
                if (self._$startInput.val() === '') {
                    _setNumerictextboxValue('', self._$endInput.val());
                } else if (self._$endInput.val() === '') {
                    _setNumerictextboxValue(self._$startInput.val(), '');
                }
            }
        };

        function bindCloseEvent() {
            window.addEventListener('scroll', popoverClose, true);
            window.addEventListener('keyup', popoverClose, true);
            // 버튼, 달력창 영역을 제외한 나머지 부분 클릭시 달력창 닫기
            $(window).on('click', function (e) {
                if (!$(e.target).parents(".dews-weekperiodpicker-calendars")[0]) {
                    close();

                    var startSet = self._$startInput.val(),
                        endSet = self._$endInput.val();

                    //값을 변경하고 딴 곳을 클릭해 달력닫고, 다시 열었을 때 값 맞추기.
                    if (startSet && endSet) {
                        _setNumerictextboxValue(startSet, endSet);
                    }
                    if (startSet === '') {
                        _setNumerictextboxValue('', endSet);
                    }
                    if (endSet === '') {
                        _setNumerictextboxValue(startSet, '');
                    }
                }
                e.stopPropagation();
            });
        }

        //달력버튼 클릭 시
        self._$calenderButton.on("click", function (e) {

            if (!self.disableButton) {
                if (toggle) {
                    bindCloseEvent();
                    var el_offset = $el.offset();
                    var zIndex = dews.ui.getDialogMaxZIndex();

                    if (zIndex > parseInt(self._$hiddenArea.css('zIndex'), 10)) {
                        self._$hiddenArea.css('zIndex', zIndex + 2);
                    }

                    self._$okButton.prop("disabled", false);
                    self._$okButton.removeClass('k-state-disabled');

                    self._$hiddenArea.css({
                        'left': parseFloat(el_offset.left) + 'px'
                    });

                    if ($(window).height() < $(this).offset().top - offset + self._$hiddenArea.height() + 24) {
                        self._$hiddenArea.css("top", parseFloat(el_offset.top) - self._$hiddenArea.height() - 1);
                        if (($(this).offset().top - offset) < self._$hiddenArea.height()) {
                            self._$hiddenArea.css("top", parseFloat(el_offset.top) + 23);
                        }
                    } else {
                        self._$hiddenArea.css("top", parseFloat(el_offset.top) + self._$wrapper.height() - 1);
                    }

                    if ($(window).width() - (self._$wrapper.offset().left + self._$hiddenArea.width()) < 0) {
                        var right_width = self._$calenderButton.offset().left + 22.7969 - self._$hiddenArea.width();
                        self._$hiddenArea.css("left", right_width);
                        if ($(window).width() < self._$hiddenArea.width()) {
                            self._$hiddenArea.css("left", parseFloat(el_offset.left) + 1);
                        }
                    }

                    selectedPeriod();

                    if (self._$startInput.val() === '') {
                        _setNumerictextboxValue('', self._$endInput.val());
                    } else if (self._$endInput.val() === '') {
                        _setNumerictextboxValue(self._$startInput.val(), '');
                    } else {
                        _setNumerictextboxValue(self._$startInput.val(), self._$endInput.val());
                    }

                    self._$element.addClass('dews-weekperiodpicker-focus');
                    self._$calenderButton.addClass('dews-weekperiodpicker-focus');
                    self._$hiddenArea.addClass('opened');
                    toggle = false;
                } else {
                    close();
                }
            }
            e.stopPropagation();
        });

        //적용하기 버튼 클릭 시
        self._$okButton.on('click', function (e) {
            var startYear, endYear, startWeek, endWeek;
            var preStartDate, preEndDate, currStartDate, currEndDate;

            if (self._$startYear.value() && self._$startWeek.value()) {
                startYear = self._$startYear.value().toString();
                startWeek = self._$startWeek.value().toString() < 10 ? '0' + self._$startWeek.value().toString() : self._$startWeek.value().toString();
            }

            if (self._$endYear.value() && self._$endWeek.value()) {
                endYear = self._$endYear.value().toString();
                endWeek = self._$endWeek.value().toString() < 10 ? '0' + self._$endWeek.value().toString() : self._$endWeek.value().toString();
            }

            preStartDate = self._getStartDate(self._$startInput.val());
            preEndDate = self._getStartDate(self._$endInput.val());

            currStartDate = self._getStartDate(self._$startYear.value() + '' + startWeek);
            currEndDate = self._getStartDate(self._$endYear.value() + '' + endWeek);

            if (self._$startYear.value() && self._$startWeek.value()) {
                var formatedStartDate = self.options.format.replace(/w{1,2}/gi, startWeek).replace(/y{2,4}/gi, startYear);
                self._$startInput.val(formatedStartDate);
            }

            if (self._$endYear.value() && self._$endWeek.value()) {
                var formatedEndDate = self.options.format.replace(/w{1,2}/gi, endWeek).replace(/y{2,4}/gi, endYear);
                self._$endInput.val(formatedEndDate);
            }

            //이전 값과 새로 입력한 값이 다를 경우 change 이벤트 실행
            if (preStartDate && currStartDate) {
                if ((preStartDate.getTime() !== currStartDate.getTime())) {
                    self._$wrapper.trigger('change');
                }
            } else if (preEndDate && currEndDate) {
                if ((preEndDate.getTime() !== currEndDate.getTime())) {
                    self._$wrapper.trigger('change');
                }
            }
            close();
            e.stopPropagation();
        });

        //숨겨진 영역 닫는 함수
        function close() {
            self._$element.removeClass('dews-weekperiodpicker-focus');
            self._$calenderButton.removeClass('dews-weekperiodpicker-focus');
            self._$hiddenArea.removeClass('opened').css('zIndex', '');
            toggle = true;
            window.removeEventListener('scroll', popoverClose, true);
            window.removeEventListener('keyup', popoverClose, true);
            $(window).off("click");
        }

        //선택한 기간에 대한 출력
        function selectedPeriod() {
            var startYear, startWeek, endYear, endWeek;
            if (self._$startYear.value() && self._$startWeek.value()) {
                startYear = self._$startYear.value();
                startWeek = self._$startWeek.value() < 10 ? '0' + self._$startWeek.value().toString() : self._$startWeek.value();

                var getStartDate = self._getStartDate(startYear + '' + startWeek);

                getStartDate = kendo.toString(getStartDate, dews._environments.formats.dateFormat, kendo.getCulture());
            }

            if (self._$endYear.value() && self._$endWeek.value()) {
                endYear = self._$endYear.value();
                endWeek = self._$endWeek.value() < 10 ? '0' + self._$endWeek.value().toString() : self._$endWeek.value();
                var getEndDate = self._getEndDate(endYear + '' + endWeek);

                getEndDate = kendo.toString(getEndDate, dews._environments.formats.dateFormat, kendo.getCulture());
            }

            if (startYear && startWeek && endYear && endWeek) {
                if (startYear.toString() + startWeek.toString() <= endYear.toString() + endWeek.toString()) {
                    self._$periodDate.text(getStartDate + '~' + getEndDate);
                } else {
                    self._$periodDate.text('');
                }
            }

            if (!getStartDate || !getEndDate) {
                self._$periodDate.text('');
            }
        }

        //숫자텍스트박스 값이 변할 때마다 처리하는 함수
        function changeHandler(e) {
            var startYear = self._$startYear.value();
            var startWeek = self._$startWeek.value();
            var endYear = self._$endYear.value();
            var endWeek = self._$endWeek.value();
            var getDate, maxWeekNum;

            if (e.type = 'keyup') {
                startYear = parseInt(self._$startYear.element.val());
                endYear = parseInt(self._$endYear.element.val());
            }

            if (startYear === self.options.min) {
                self._$startYear.value(self._thisYear);
            } else if ((self._$endYear.value() === self.options.min)) {
                self._$endYear.value(self._thisYear);
            }

            if (startYear && startWeek) {
                var startWeek2 = self._$startWeek.value() < 10 ? '0' + self._$startWeek.value().toString() : self._$startWeek.value();

                getDate = self._getStartDate(startYear + '' + startWeek2);
                maxWeekNum = self._checkWeekNum(getDate);

                if (startWeek >= 53) {
                    if (maxWeekNum !== startWeek) {
                        self._$startWeek.value(52);
                    }
                }
            }

            if (endYear && endWeek) {
                var endWeek2 = self._$endWeek.value() < 10 ? '0' + self._$endWeek.value().toString() : self._$endWeek.value();

                getDate = self._getStartDate(endYear + '' + endWeek2);
                maxWeekNum = self._checkWeekNum(getDate);

                if (endWeek >= 53) {
                    if (maxWeekNum !== endWeek) {
                        self._$endWeek.value(52);
                    }
                }
            }
            selectedPeriod();

            self._$okButton.prop("disabled", false);
            self._$okButton.removeClass('k-state-disabled');

            if (!startYear && !startWeek) { //첫번째 년 주 없을때
                self._$startInput.val('');
            } else if (!endYear && !endWeek) { //두번쨔 년 주 없을때
                self._$endInput.val('');
            } else if (!startYear || !startWeek) { //첫번째 년이 없거나 주 없을때
                self._$okButton.prop('disabled', true);
                self._$okButton.addClass('k-state-disabled');
            } else if (!endYear || !endWeek) { //두번째 년이 없거나 주 없을때
                self._$okButton.prop('disabled', true);
                self._$okButton.addClass('k-state-disabled');
            } else { // 위에것들이 아닐
                if (endYear) {//종료날짜가 존재하고,
                    if (startYear > endYear) { //시작날짜의 년도가 종료날짜의 년도보다 클때
                        self._$okButton.prop('disabled', true);
                        self._$okButton.addClass('k-state-disabled');
                    } else if (!(startYear.toString().length === 4) || !(endYear.toString().length === 4)) {
                        self._$okButton.prop('disabled', true);
                        self._$okButton.addClass('k-state-disabled');
                    }
                }
                if (startYear === endYear && startWeek > endWeek) { //시작날짜와 종료날짜의 년도가 같고, 시작날짜 주가 종료날짜 주보다 클때
                    self._$okButton.prop('disabled', true);
                    self._$okButton.addClass('k-state-disabled');
                }
            }
        }

        self._$startInput.on('keyup', function (e) {
            var key = e.key, regex = /[0-9]/; // 입력된 키 값이 숫자인지 매칭
            var preStartDate, currStartDate;
            var startInput = self._$startInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preStartDate = $('.dews-weekperiodpicker-startDate', self._$wrapper).attr('val');
                currStartDate = self._$startInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self._$startInput.val() && self._$startInput.val().indexOf('_') === -1) {
                    format(self._$startInput);
                    if (!(self._$endInput.val())) {
                        self._$endYear.value('');
                        self._$endWeek.value('');
                    }

                    $('.dews-weekperiodpicker-startDate', self._$wrapper).attr('val', $('.dews-weekperiodpicker-startDate', self._$wrapper).val());

                    if (preStartDate !== currStartDate) {
                        self._$startInput.trigger('_change');
                    }

                    if (regex.test(key)) {
                        self._$endInput.focus();
                    }
                }

                if (self._$startInput.val().indexOf("_") === 0) {
                    if (preStartDate !== currStartDate) {
                        self._$startInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self._$startInput.val().indexOf('_') === 0) {
                    self._$endYear.value('');
                    self._$endWeek.value('');
                }
            }
            e.stopPropagation();
        });

        self._$endInput.on('keyup', function (e) {
            var key = e.key, regex = /[0-9]/;
            var preEndDate, currEndDate;
            var endInput = self._$endInput;

            // 숫자 혹은 backspace, delete, ctrl+v 인지 확인
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.returnValue = false;
                e.preventDefault();
            } else if (!regex.test(key) && e.keyCode !== 8 && e.keyCode !== 46 && ((e.ctrlKey === false && e.keyCode !== 91) && (e.ctrlKey === true && e.keyCode !== 86) && (e.ctrlKey === false && e.keyCode !== 17))) {
                e.returnValue = false;
                e.preventDefault();
            } else {
                preEndDate = $('.dews-weekperiodpicker-endDate', self._$wrapper).attr('val');
                currEndDate = self._$endInput.val();

                // 모든 값이 입력 되면 값 설정
                if (self._$endInput.val() && self._$endInput.val().indexOf('_') === -1) {
                    format(self._$endInput);
                    if (!(self._$startInput.val())) {
                        self._$startYear.value('');
                        self._$startWeek.value('');
                    }

                    $('.dews-weekperiodpicker-endDate', self._$wrapper).attr('val', $('.dews-weekperiodpicker-endDate', self._$wrapper).val());

                    if (preEndDate !== currEndDate) {
                        self._$endInput.trigger('_change');
                    }
                }

                if (self._$endInput.val().indexOf("_") === 0) {
                    if (preEndDate !== currEndDate) {
                        self._$endInput.trigger('_change');
                    }
                }
            }

            // backspace, delete 키를 눌렀을 경우 input에 값이 없을때
            if (e.keyCode === 8 || e.keyCode === 46) {
                if (self._$endInput.val().indexOf('_') === 0) {
                    self._$startYear.value('');
                    self._$startWeek.value('');
                    self._$startInput.focus();
                }
            }
            e.stopPropagation();
        });

        // 시작 주나 종료 주 입력 중인 경우 이벤트 버블링을 막음
        $el.on("keydown", function (e) {
            if (e.keyCode === 13 && (self._$startInput.is(":focus") || self._$endInput.is(":focus"))) {
                e.stopPropagation();
            } else if (e.keyCode === 115 && self._$hiddenArea.css('display') === 'none') {
                self._$calenderButton.click();
                e.stopPropagation();
                e.preventDefault();
            }
        });

        self._$startYear.bind("spin", changeHandler);
        self._$startWeek.bind("spin", changeHandler);
        self._$endYear.bind("spin", changeHandler);
        self._$endWeek.bind("spin", changeHandler);

        self._$startYear.bind("change", changeHandler);
        self._$startWeek.bind("change", changeHandler);
        self._$endYear.bind("change", changeHandler);
        self._$endWeek.bind("change", changeHandler);

        self._$startYear.element.on("keyup", changeHandler);
        self._$startWeek.element.on("keyup", changeHandler);
        self._$endYear.element.on("keyup", changeHandler);
        self._$endWeek.element.on("keyup", changeHandler);

        //input 박스의 값을 가져와서 숫자텍스트박스에 set하는 함수
        function _setNumerictextboxValue(startDate, endDate) {
            var startY = self.getWeek(startDate, 'year') ? self.getWeek(startDate, 'year').toString() : '';
            var startW = self.getWeek(startDate, 'week').toString()[0] === '0' ? self.getWeek(startDate, 'week').toString()[1] : self.getWeek(startDate, 'week').toString();
            var endY = self.getWeek(endDate, 'year') ? self.getWeek(endDate, 'year').toString() : '';
            var endW = self.getWeek(endDate, 'week').toString()[0] === '0' ? self.getWeek(endDate, 'week').toString()[1] : self.getWeek(endDate, 'week').toString();

            self._$startYear.value(startY);
            self._$startWeek.value(startW);
            self._$endYear.value(endY);
            self._$endWeek.value(endW);
        }

        //input 박스의 format 처리 관련 함수
        function format(input) {
            var dateValue = $(input).val(), formatedDate,
                yyyy = self.getWeek(dateValue, 'year').toString(),
                WW = self.getWeek(dateValue, 'week');
            var date = new Date();
            var now = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));

            if (parseInt(yyyy) >= 2100 || parseInt(yyyy) <= 1900) {
                yyyy = now.toISOString().substring(0, 4);
            }

            if (parseInt(WW) >= 53 || parseInt(WW) < 1) {
                WW = now.toISOString().substring(5, 7);
            }

            formatedDate = self.dateStringToFormatedString(yyyy, WW);
            $(input).val(formatedDate);

            var startSet = self._$startInput.val(),
                endSet = self._$endInput.val();

            var startText = startSet ? self.getWeek(startSet, 'year').toString() + self.getWeek(startSet, 'week').toString() : '',
                endText = endSet ? self.getWeek(endSet, 'year').toString() + self.getWeek(endSet, 'week').toString() : '';

            if (startText > endText) {
                if (endText === '') {
                    startSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$startInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$startInput, 'year'));
                    endSet = '';
                } else {
                    startSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$startInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$startInput, 'year'));
                    endSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$startInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$startInput, 'year'));
                }
            } else {
                if (startText === '') {
                    startSet = '';
                    endSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$endInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$endInput, 'year'));
                } else {
                    startSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$startInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$startInput, 'year'));
                    endSet = self.options.format.replace(/w{1,2}/gi, self.getWeek(self._$endInput, 'week')).replace(/y{2,4}/gi, self.getWeek(self._$endInput, 'year'));
                }
            }

            if (startText !== '' && endText !== '') {
                self._$startInput.val(startSet);
                self._$endInput.val(endSet);
            }

            if (!startText) {
                self._$startInput.val('');
            }

            if (!endText) {
                self._$endInput.val('');
            }

            if (input === self._$startInput) {
                _setNumerictextboxValue(startSet, endSet);
            } else {
                _setNumerictextboxValue(startSet, endSet);
            }
        }
    };

    WeekPeriodPicker.prototype.on = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }

        self._$wrapper.on.apply(self._$wrapper, arguments);
    };

    WeekPeriodPicker.prototype.off = function () {
        var self = this;

        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        self._$wrapper.off.apply(self._$wrapper, arguments);
    };

    WeekPeriodPicker.prototype.validate = function () {
        var self = this;
        if (!self.getStartWeek() || !self.getEndWeek()) {
            return false;
        } else {
            return true;
        }
    };

    WeekPeriodPicker.prototype.bindFromPanel = function (data) {
        var self = this, $element = $(self._$element);
        var startDate, endDate;

        if (data) {
            startDate = $element.data('dews-bind-startdate') || "";
            endDate = $element.data('dews-bind-enddate') || "";

            if (startDate && data.hasOwnProperty(startDate)) {
                self.setStartWeek(data[startDate]);
            }
            if (endDate && data.hasOwnProperty(endDate)) {
                self.setEndWeek(data[endDate]);
            }
        }
    };

    WeekPeriodPicker.prototype.serializeForPanel = function () {
        var self = this, $element = $(this._$element);
        var startDate, endDate;
        var data = [];

        startDate = $element.data('dews-bind-startdate') || "";
        endDate = $element.data('dews-bind-enddate') || "";

        if (startDate) {
            data[startDate] = self.getStartWeek();
        }
        if (endDate) {
            data[endDate] = self.getEndWeek();
        }
        return data;
    };

    WeekPeriodPicker.prototype.applyPanelFocus = function () {
        var self = this, $element = $(this._$element);
        var startInput = self._$startInput;
        var endInput = self._$endInput;

        startInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && startInput.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && startInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });

        endInput.on('keydown', function (e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && endInput.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                // e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && endInput.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }

                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
    };

    WeekPeriodPicker.prototype.canFocusable = function () {
        var self = this, $element = $(this._$element);
        var $start = self._$startInput;
        var $end = self._$endInput;

        if (!$element.hasClass('dews-state-readonly') && $start && $end) {
            return $start.is(':visible') && $start.is(':enabled');
        }
        else {
            return false;
        }
    };

    /**
     * 주기간피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    WeekPeriodPicker.prototype._getPrintData = function () {
        var self = this,
            $el = $(self._$element),
            data;

        if (self.getStartWeekText() && self.getEndWeekText()) {
            data = {
                id: $el.attr('id'),
                text: self.getStartWeekText() + ' ~ ' + self.getEndWeekText()
            }
        }

        return data;
    };

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    WeekPeriodPicker.prototype.setUserGuideAPI = function () {
        var self = this, $element = $(this._$element);

        self._$startInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });

        self._$endInput.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    };

    /**
     * 공통 이벤트를 설정합니다.
     * @param {jQuery} $el 대상 요소의 jQuery객체입니다.
     * @param {object} [options] 피커의 옵션입니다.
     */
    function setEvent($el, options) {
        $el.on('click', function () {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                // 읽기 전용/비활성화 상태가 아니면 포커스가 오면 텍스트 전체를 선택하도록 한다.
                $this.select();
            }
        }).on('blur', function () {
            var $this = $(this);
            if ($this.prop('readonly') === false && $this.prop('disabled') === false) {
                if (!dews.date.validate($this.val(), options.format)) {
                    //TODO: 값이 유효하지 않을 경우 오류 표시 및 툴팁 표시
                } else {
                    //TODO: 값이 유효할 때 오류 표시가 있으면 제거
                }
            }
        });
    }

    /**
     * 주기간피커 숫자텍스트박스에 마스크를 적용합니다.
     * @param {jQuery} $el 적용할 대상 요소의 jQuery 객체
     * @param {string} format 적용 포맷
     */
    function setMask($el, format) {
        var maskJsUrl;

        // jquery.maskedinput.js 를 이용하여 마스크를 적용함
        // script 파일을 로드된 적이 없으면 동적으로 로드합니다.
        maskJsUrl = dews.url.join(dews._environments.scriptBase || '/scripts/', 'jquery.maskedinput.js');

        if ($.mask) {
            $el.mask(format.replace(/[yw]/ig, '9'));
        } else {
            $.getScript(maskJsUrl, function () {
                $el.mask(format.replace(/[yw]/ig, '9'));
            });
        }
    }

    dews = $.extend(true, dews, {
        ui: {
            weekperiodpicker: function (selector, options) {
                var $el, weekperiodpicker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var picker, $this = $(this);

                    picker = $this.data('dews-control');

                    if (!picker) {
                        if (!$this.hasClass('dews-ui-weekperiodpicker')) {
                            $this.addClass('dews-ui-weekperiodpicker');
                        }

                        if (!$this.hasClass('dews-form-control')) {
                            $this.addClass('dews-form-control');
                        }

                        picker = new WeekPeriodPicker($this, options);

                        $this.data('dews-control', picker);

                        picker._initControl();

                        if (!$this.parent('.dews-weekperiodpicker-wrapper').hasClass('dews-control-activate')) {
                            $this.parent('.dews-weekperiodpicker-wrapper').addClass('dews-control-activate');
                        }
                    }

                    weekperiodpicker = picker;
                });

                return weekperiodpicker;
            }
        }
    });

    dews.ui.addControlInitializer('weekperiodpicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === "string") {
            $container = $(target);
        } else {
            $container = $(document);
        }
        dews.ui.weekperiodpicker($("span.dews-ui-weekperiodpicker", $container));
    });
})(jQuery, window.dews, window.kendo);



/**
 * 우편번호 피커
 * 기존 우편번호 피커를 기반으로 새로 작성되었습니다.
 *
 * **ZipCodePicker : 우편번호피커 메인 클래스**
 *   _ZipCodeDialog : 우편번호피커 우편번호 선택 다이얼로그 클래스
 *       open()  : 다이얼로그를 여는 메소드
 *       close() : 다이얼로그를 닫는 메소드
 *   _ZipCodePickerButtonGroup : 우편번호피커 내의 버튼 그룹 클래스
 *       showButton() : 버튼들을 보여주는 메소드
 *       hideButton() : 버튼들을 감추는 메소드
 *
 * @author 박효준
 * @since 2017.09.25
 */
(function ($, dews) {
    // 기본 옵션
    var defaultOptions = {
        addressType: 'street'
    };

    var ZipCodePicker = function (element, options) {
        var self = this;

        self.options = $.extend(true, {}, defaultOptions, options);
        self._$element = $(element);
        if (dews.ui.dialogPage) {
            self._$addressElement = $('#' + self.options.addressBind, dews.ui.dialogPage.$content);
        } else if (dews.ui.page) {
            self._$addressElement = $('#' + self.options.addressBind, dews.ui.page.$content);
        } else {
            self._$addressElement = $('#' + self.options.addressBind, $(document));
        }
        self._render();
        self._setEventHandling();
        setUserGuideAPI(self._$element);

    };

    /**
     * 우편번호피커를 그리는 메소드
     *
     * @private
     */
    ZipCodePicker.prototype._render = function () {
        var self = this,
            $element = self._$element,
            $addressElement = self._$addressElement;

        // 우편번호 입력 상자 생성
        self.inputDialog = new ZipCodePicker._ZipCodeDialog($element, $addressElement, self.options, self);

        // 컨테이너 생성
        self._$wrapper = self._createContainer();

        // 버튼 그룹 생성
        self.innerButtonGroup = new ZipCodePicker._ZipCodePickerButtonGroup($element, function () {
                                                                                self.inputDialog.open();
                                                                            }, function () {
                                                                                self.clearData();
                                                                            });
        // kendo-ui 스타일 오버라이드 클래스
        $element.addClass("k-style-override");

        // 기본 상태 설정
        self._setState();
    };
    /**
     * ZipCodePicker의 옵션을 바꾸는 메소드
     * @param options 새로운 옵션
     * @private
     */
    ZipCodePicker.prototype._changeOption = function (options) {
        var self = this,
            $element = self._$element,
            $addressElement;

        // 옵션을 재정의한다
        $.extend(self.options, options);

        if (dews.ui.dialogPage) {
            self._$addressElement = $('#' + self.options.addressBind, dews.ui.dialogPage.$content);
        } else if (dews.ui.page) {
            self._$addressElement = $('#' + self.options.addressBind, dews.ui.page.$content);
        } else {
            self._$addressElement = $('#' + self.options.addressBind, $(document));
        }

        $addressElement = self._$addressElement;

        // 우편번호 입력 상자 재생성
        self.inputDialog = new ZipCodePicker._ZipCodeDialog($element, $addressElement, self.options);
    };

    /**
     * 우편번호피커의 이벤트들을 핸들링하는 메소드
     * @return {jQuery} 우편번호피커를 감싸고 있는 JQuery 객체
     * @private
     */
    ZipCodePicker.prototype._setEventHandling = function () {
        var self = this,
            setData,
            $element = self._$element;

        // setData 이벤트 핸들링
        setData = self.options.setData;
        if (setData && $.isFunction(setData)) {
            self.on('setData', setData);
        }

        // 더블클릭 이벤트 핸들링
        $element.on('dblclick', function (e) {
            if (!$element.hasClass('readonly')) {
                self.inputDialog.open();
            }
        });

        // 단축키 이벤트 핸들링
        $element.on('keydown', function(e) {
            if (!$element.hasClass('readonly')) {
                if ($element.is(":enabled") && e.keyCode === 115) {
                    self.inputDialog.open();
                    e.stopPropagation();
                    e.preventDefault();
                }
            }

        });

        // 값 변경 시 글자 수에 따라 버튼을 변경
        $element.on('change', function (e) {
           self.innerButtonGroup.showButton();
        });

        $element.on('focusin', function (e) {
            $element.parent().addClass('dews-state-focused');
        });

        $element.on('focusout', function (e) {
            $element.parent().removeClass('dews-state-focused');
        });
    };
    /**
     * 우편번호피커의 기본 상태를 설정하는 메소드
     * @private
     */
    ZipCodePicker.prototype._setState = function () {
      var self = this,
          $el = self._$element,
          $wrapper = self._$wrapper;

        if ($el.hasClass('disabled')) {
            self.disable(true);
        }

        if ($el.hasClass('required')) {
            $wrapper.addClass('dews-state-required');
        }

        if ($el.hasClass('readonly')) {
            $wrapper.addClass('dews-state-readonly');
            self.innerButtonGroup._$searchButton.prop('disabled', true);
        }
    };
    /**
     * 우편번호피커를 감싸는 컨테이너를 만드는 메소드
     * @private
     */
    ZipCodePicker.prototype._createContainer = function () {
        var self = this,
            $el = self._$element,
            $wrapper = $("<span />").addClass('dews-zipcodepicker-wrapper dews-control k-textbox');

        if ($el.attr('style')) {
            var matches;

            matches = $el.attr('style').match(/width:([^;]+);?/i);
            if (matches && matches.length > 0) {
                $wrapper.css('width', $.trim(matches[1]));
                $el.css('width', '100%');
            }
        }

        // 클래스와 프로퍼티 일치 작업
        if ($el.prop('disabled') && !$el.hasClass('disabled')) {
            $el.addClass('disabled');
        } else if ($el.hasClass('disabled') && !$el.prop('disabled')) {
            $el.prop('disabled', true);
        }

        if ($el.prop('readonly') && !$el.hasClass('readonly')) {
            $el.addClass('readonly');
        } else if ($el.hasClass('readonly') && !$el.prop('readonly')) {
            $el.prop('readonly', true);
        }

        if ($el.attr('id')) {
            $wrapper.attr('id', $el.attr('id') + '-wrapper');
        }

        $el.wrap($wrapper);

        if (!$el.hasClass('dews-ui-zipcodepicker')) {
            $el.addClass('dews-ui-zipcodepicker');
        }

        if (!$el.attr("name") && $el.attr("id")) {
            // 코드피커 요소에 id는 지정되어 있는데 name이 지정되어 있지 않으면 name을 id와 동일하게 설정한다.
            $el.attr('name', $el.attr('id'));
        }

        $el.prop('readonly', true);

        return $el.parent('.dews-zipcodepicker-wrapper');
    };

    /**
     * @deprecated 이전 버전 호환성 코드입니다.
     * 우편번호 입력 다이얼로그를 여는 메소드
     * @private
     */
    ZipCodePicker.prototype._triggerZipCodeDialog = function () {
        var self = this;
        self.inputDialog.open();
    };
    /**
     * @deprecated 이전 버전 호환성 코드입니다.
     * 버튼을 새로 생성하는 메소드
     * @private
     */
    ZipCodePicker.prototype._createButton = function () {

    };
    /**
     * @deprecated 이전 버전 호환성 코드입니다.
     * 버튼을 제거하는 메소드
     * @private
     */
    ZipCodePicker.prototype._removeButton = function () {

    };
    /**
     * 우편번호피커의 값을 설정하거나 가져옵니다.
     * @param {string} value 설정할 우편번호 피커 값 (생략하면 현재 우편번호피커의 값을 반환합니다.)
     * @returns {string} 현재 우편번호피커 값
     */
    ZipCodePicker.prototype.value = function (value) {
        var self = this,
            $element = self._$element;

        if (value) {
            $element.val(value);
            $element.trigger('change');
        } else if (value === '') {
            $element.val('');

            if(self.options.addressBind) {
                if(($element.attr('data-dews-address-bind')) === $('input#'+self.options.addressBind).attr('id') ) {
                    self._$addressElement.val('');
                }
            }

            self.innerButtonGroup._showSearchButton();
        }

        return $element.val();
    };

    /**
     * 우편번호피커의 값을 비웁니다.
     */
    ZipCodePicker.prototype.clearData = function () {
        var self = this,
            $element = self._$element;

        // 우편번호피커 값 비움
        $element.val('');

        if(self.options.addressBind) {
            if(($element.attr('data-dews-address-bind')) === $('input#'+self.options.addressBind).attr('id') ) {
                self._$addressElement.val('');
            }
        }

        $element.trigger('change');

        self.focus();
    };
    /**
     * 우편번호피커 다이얼로그를 여는 메소드
     */
    ZipCodePicker.prototype.open = function () {
        var self = this;
        self.inputDialog.open();
    };
    /**
     * 호환성 맞춰주기 위함
     */
    ZipCodePicker.prototype.disable = function (value) {
        var self = this;

        if (typeof  value === 'boolean') {
            self.enable(!value);
        } else {
            return !self.enable();
        }
    };
    /**
     * 우편번호피커를 enable 처리하는 메소드
     *
     * @param {boolean} value disabled 여부 (기본 값 입력 시 현재 값 반환)
     * @returns {boolean} 현재 disabled 여부
     */
    ZipCodePicker.prototype.enable = function (value) {
        var self = this,
            $element = self._$element,
            enabled;

        enabled = !$element.prop('disabled');

        if(typeof value !== 'undefined') {
            if(!value) {
                self._setDisabled();
                self.innerButtonGroup.hideButton();
            } else {
                self._removeDisabled();
                self.innerButtonGroup.showButton();
            }
            enabled = !value;
        }

        return enabled;
    };

    ZipCodePicker.prototype.readonly = function (value) {
        var self = this,
            $element = self._$element;

        if (typeof value === 'undefined') {
            // 값 가져가기
            value = $element.hasClass('readonly');
        } else {
            // 읽기 전용 설정
            if (value) {
                if (!$element.hasClass('readonly')) {
                    $element.addClass('readonly');
                    $element.parent().addClass('dews-state-readonly');
                    self.innerButtonGroup._$clearButton.css('display', 'none');
                    self.innerButtonGroup._$searchButton.prop('disabled', true);
                }
                if (!$element.prop('readonly')) {
                    self.innerButtonGroup._$clearButton.css('display', 'none');
                    self.innerButtonGroup._$searchButton.prop('disabled', true);
                }
            } else {
                if ($element.hasClass('readonly')) {
                    $element.removeClass('readonly');
                    $element.parent().removeClass('dews-state-readonly');
                    self.innerButtonGroup._$searchButton.prop('disabled', false);

                    if (self.value()) {
                        self.innerButtonGroup._$clearButton.css('display', 'inline-block');
                    }
                }
                if ($element.prop('readonly')) {
                    self.innerButtonGroup._$searchButton.prop('disabled', false);

                    if (self.value()) {
                        self.innerButtonGroup._$clearButton.css('display', 'inline-block');
                    }
                }
            }
        }

        return value;
    };

    /**
     * DEWS 객체에 직접 이벤트 핸들러를 등록합니다.
     */
    ZipCodePicker.prototype.on = function () {
        var self = this;
        var $el = self._$element;
        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $el.on.apply($el, arguments);
    };
    /**
     * DEWS 객체에 직접 등록한 이벤트 핸들러를 해제합니다.
     */
    ZipCodePicker.prototype.off = function () {
        var self = this;
        var $el = self._$element;
        if (arguments[0] === 'change') {
            Array.prototype.splice.call(arguments, 0, 1, '_change');
        }
        $el.off.apply($el, arguments);
    };

    ZipCodePicker.prototype.validate = function () {
        var self = this;
        return !!self._$element.val();
    };

    ZipCodePicker.prototype.bindFromPanel = function (data) {
        var self = this, $element = self._$element;
        var column;

        if (data) {
            column = $element.data('dews-bind-column') || $element.attr('id');

            if (column && data.hasOwnProperty(column)) {
                self.value(data[column] || '');
            }
        }
    };

    ZipCodePicker.prototype.serializeForPanel = function () {
        var self = this, $element = self._$element;
        var column, data;

        column = $element.data('dews-bind-column') || $element.attr('id');

        if (column) {
            data = {};
            data[column] = self.value();
        }

        return data;
    };

    ZipCodePicker.prototype.applyPanelFocus = function () {
        var self = this, $element = self._$element;

        $element.on('keydown', function(e) {
            if (e.keyCode === 13 && (e.shiftKey || e.ctrlKey || e.altKey) && $element.is(':enabled')) {
                e.preventDefault();
            } else if (e.keyCode === 9 && e.shiftKey) {
                e.preventDefault();

                var evt = new $.Event('beforeFocus');
                evt.control = self;

                $element.trigger(evt);
            } else if (e.keyCode === 9 || e.keyCode === 13 && $element.is(':enabled')) {
                if (e.keyCode === 9) { //tab키 기본동작 막기
                    e.preventDefault();
                }
                var evt = new $.Event('nextFocus');
                evt.control = self;

                $element.trigger(evt);
            }
        });
        $element.on('setData', function() {
            var evt = new $.Event('nextFocus');
            evt.control = self;

            $element.trigger(evt);
        });
    };

    ZipCodePicker.prototype.focus = function () {
        var self = this, $element = self._$element;
        $element.focus();
    };

    ZipCodePicker.prototype.canFocusable = function () {
        var self = this, $element = self._$element;
        return !$element.hasClass('readonly') && $element.is(':visible') && $element.is(':enabled');
    };

    /**
     * 컨트롤을 비활성화 상태로 만듭니다.
     * @private
     */
    ZipCodePicker.prototype._setDisabled = function () {
        var self = this,
            $el = self._$element,
            $wrapper = self._$wrapper;


        if (!$wrapper.hasClass('dews-state-disabled')) {
            $wrapper.addClass('dews-state-disabled');
        }
        if (!$wrapper.hasClass('disabled')) {
            $wrapper.addClass('disabled');
        }

        $el.prop('disabled', true);

        if (!$el.hasClass('dews-state-disabled')) {
            $el.addClass('dews-state-disabled');
        }
        if (!$el.hasClass('disabled')) {
            $el.addClass('disabled');
        }
    };
    /**
     * 컨트롤을 활성화 상태로 돌립니다.
     * @private
     */
    ZipCodePicker.prototype._removeDisabled = function () {
        var self = this,
            $el = self._$element,
            $wrapper = self._$wrapper;

        if ($wrapper.hasClass('dews-state-disabled')) {
            $wrapper.removeClass('dews-state-disabled');
        }
        if ($wrapper.hasClass('disabled')) {
            $wrapper.removeClass('disabled');
        }

        $el.prop('disabled', false);

        if ($el.hasClass('dews-state-disabled')) {
            $el.removeClass('dews-state-disabled');
        }
        if ($el.hasClass('disabled')) {
            $el.removeClass('disabled');
        }

        // 비우기 버튼 다시그림
        $el.trigger('change');

    };
    /**
     * 우편번호피커 컨트롤을 활성화 시킵니다.
     * @private
     */
    ZipCodePicker.prototype._activate = function () {
        var self = this,
            $wrapper = self._$wrapper;

        if (!$wrapper.hasClass('dews-control-activate')) {
            $wrapper.addClass('dews-control-activate');
        }
    };


    /**
     * 우편번호피커 선택 다이얼로그
     *
     * @param $zipCodePicker 우편번호피커 우편번호의 JQuery 객체
     * @param $zipCodePickerAddress 우편번호피커 주소의 JQuery 객체
     * @param options 우편번호피커의 옵션
     * @constructor
     */
    ZipCodePicker._ZipCodeDialog = function ($zipCodePicker, $zipCodePickerAddress, options, zipCodePicker) {
        var self = this,
            $postCodeWrapper,
            $postCodeTitle,
            $postCodeContent,
            $closeButton;


        // 우편번호 다이얼로그 생성
        $postCodeWrapper = $('<div />').attr('id', 'zipcodepicker-dialog')
                                       .addClass('postcode-wrapper');
        $postCodeTitle = $('<div><span>우편번호 서비스</span><span class="close-btn"></span></div>')
                                .addClass('postcode-title');
        $postCodeContent = $('<div />').addClass('postcode-content');
        $closeButton = $postCodeTitle.find('.close-btn');

        $postCodeWrapper.append($postCodeTitle);
        $postCodeWrapper.append($postCodeContent);

        self.zipCodePicker = zipCodePicker;
        self.options = options;
        self._$zipCodePicker = $zipCodePicker;
        self._$zipCodePickerAddress = $zipCodePickerAddress;
        self._$postCodeWrapper = $postCodeWrapper;
        self._$postCodeContent = $postCodeContent;
        self._$closeButton = $closeButton;

    };
    /**
     * 우편번호피커 다이얼로그를 보여주는 메소드
     */
    ZipCodePicker._ZipCodeDialog.prototype.open = function () {
        var self = this;

        // 이미 우편번호 설정 다이얼로그가 열려있으면 처리하지 않음
        if($('#zipcodepicker-dialog').length > 0) {
            return;
        }

        $('body').append(self._$postCodeWrapper);

        var zIndex = dews.ui.getDialogMaxZIndex();

        if (zIndex > parseInt(self._$postCodeWrapper.css('zIndex'), 10)) {
            self._$postCodeWrapper.css('zIndex', zIndex + 2);
        }

        // 닫기 버튼 핸들링
        self._$closeButton.on('click', function () {
            self.close();
            self._$postCodeWrapper.css('zIndex', '');
        });

        self._setPosition();
        self._openDaumPostCodeDialog();
    };
    /**
     * 우편번호피커 다이얼로그를 닫는 메소드
     */
    ZipCodePicker._ZipCodeDialog.prototype.close = function () {
        var self = this;
        self._$postCodeWrapper.detach();
        self._$zipCodePicker.focus();
    };
    /**
     * 우편번호피커 다이얼로그의 위치를 조정하는 메소드
     * @private
     */
    ZipCodePicker._ZipCodeDialog.prototype._setPosition = function () {
      var self = this,
          $wrapper = self._$postCodeWrapper,
          windowWidth,
          windowHeight,
          dialogWidth,
          dialogHeight;

      windowWidth = window.innerWidth || document.documentElement.clientWidth;
      windowHeight = window.innerHeight || document.documentElement.clientHeight;
      dialogWidth = parseInt($wrapper.css('width'));
      dialogHeight = parseInt($wrapper.css('height'));

        $wrapper.css({
           left : Math.ceil((windowWidth - dialogWidth) / 2),
           top :  Math.ceil((windowHeight - dialogHeight) / 2)
        });
    };
    /**
     * 다음 API를 이용해 우편번호 다이얼로그를 여는 메소드
     * @private
     */
    ZipCodePicker._ZipCodeDialog.prototype._openDaumPostCodeDialog = function () {
        var self = this,
            $zipCodePicker = self._$zipCodePicker,
            $zipCodePickerAddress = self._$zipCodePickerAddress,
            options = self.options,
            fullAddress,
            extraAddress,
            setDataEvent;

        new daum.Postcode({
            oncomplete: function(data) {
                // 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
                // 각 주소의 노출 규칙에 따라 주소를 조합한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                fullAddress = data.address; // 최종 주소 변수
                extraAddress = ''; // 조합형 주소 변수

                // 기본 주소가 도로명 타입일때 조합한다.
                if(data.addressType === 'R'){
                    //법정동명이 있을 경우 추가한다.
                    if(data.bname !== ''){
                        extraAddress += data.bname;
                    }
                    // 건물명이 있을 경우 추가한다.
                    if(data.buildingName !== ''){
                        extraAddress += (extraAddress !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                    // 조합형주소의 유무에 따라 양쪽에 괄호를 추가하여 최종 주소를 만든다.
                    fullAddress += (extraAddress !== '' ? ' ('+ extraAddress +')' : '');
                }

                /*** 우편번호와 주소 정보를 해당 필드에 넣는 부분. ***/

                // 5글자의 새 우편번호
                $zipCodePicker.val(data.zonecode);

                // 주소 필드가 있는 경우 주소 정보를 입력
                if($zipCodePickerAddress) {
                    if(options.addressType === 'street') {
                        $zipCodePickerAddress.val(fullAddress);
                    } else if(options.addressType === 'jibun') {
                        $zipCodePickerAddress.val(data.jibunAddress);
                    }
                }

                // change 이벤트
                $zipCodePicker.trigger('_change');
                $zipCodePicker.trigger('change');

                // // setData 이벤트
                data.zipcode = data.zonecode;
                data.jibun = data.jibunAddress;
                data.street = fullAddress;

                setDataEvent = new $.Event('setData', data);
                $zipCodePicker.trigger(setDataEvent);

                // 창 닫기
                self.close();
            },
            width: '100%',
            height: '100%',
            maxSuggestItems : 5
        }).embed(self._$postCodeContent[0]);
    };



    /**
     * 우편번호피커에 포함된 버튼 그룹 객체
     * @param $zipCodePicker 버튼 그룹을 가지는 우편번호 피커 JQuery 객체
     * @param searchButtonCallback 검색 버튼을 눌렀을 때 실행될 함수
     * @param clearButtonCallback 비우기 버튼을 눌렀을 때 실행될 함수
     * @private
     */
    ZipCodePicker._ZipCodePickerButtonGroup = function ($zipCodePicker,
                                                        searchButtonCallback,
                                                        clearButtonCallback) {
        var self = this;

        self._$zipCodePicker = $zipCodePicker;
        self._searchButtonCallback = searchButtonCallback;
        self._clearButtonCallback = clearButtonCallback;
        self._createButtons();

        // 기본 버튼 노출 처리
        self.showButton();
    };
    /**
     * 우편번호피커의 버튼들을 생성하는 함수
     * @private
     */
    ZipCodePicker._ZipCodePickerButtonGroup.prototype._createButtons = function () {
        var self = this,
            $zipCodePicker = self._$zipCodePicker,
            $searchButton,
            $clearButton;

        // 검색 버튼
        $searchButton = $('<button type="button"></button>')
            .addClass('dews-zipcodepicker-button icon-search');

        // 우편번호피커 Input박스 뒤에 버튼을 추가
        $zipCodePicker.after($searchButton);
        self._$searchButton = $searchButton;

        $searchButton.on('click', function (e) {
            self._searchButtonCallback();
        });

        // 비우기 버튼
        $clearButton = $('<button type="button"></button>')
            .addClass('dews-zipcodepicker-button icon-clear');

        $zipCodePicker.after($clearButton);
        self._$clearButton = $clearButton;

        $clearButton.on('click', function (e) {
            self._clearButtonCallback();
        });
    };
    /**
     * 비우기 버튼을 보여주는 메소드
     */
    ZipCodePicker._ZipCodePickerButtonGroup.prototype._showClearButton = function () {
        var self = this;
        self._$clearButton.show();
        self._$searchButton.hide();
    };
    /**
     * 검색 버튼을 보여주는 메소드
     */
    ZipCodePicker._ZipCodePickerButtonGroup.prototype._showSearchButton = function () {
        var self = this;
        self._$searchButton.show();
        self._$clearButton.hide();
    };
    /**
     * 모든 버튼을 감추는 메소드
     */
    ZipCodePicker._ZipCodePickerButtonGroup.prototype.hideButton = function () {
        var self = this;
        self._$searchButton.hide();
        self._$clearButton.hide();
    };
    /**
     * 현재 상태에 따라 검색/비우기 버튼을 보여주는 메소드
     */
    ZipCodePicker._ZipCodePickerButtonGroup.prototype.showButton = function () {
        var self = this;

        if(self._$zipCodePicker.prop('disabled') ) {
            self.hideButton();
        } else {
            if(self._$zipCodePicker.val().length > 0) {
                self._showClearButton();
            } else {
                self._showSearchButton();
            }
        }
    };

    /**
     * 주기간피커 컨트롤 자동화 인쇄 관련 데이터 추출
     * @return {*} 값이 설정 된 경우 Object 반환, 없는 경우 undefined 반환
     * @private
     */
    ZipCodePicker.prototype._getPrintData = function () {
        var self = this,
            $el = $(self._$element),
            data;

        if (self.value()) {
            data = {
                id: $el.attr('id'),
                text: self.value()
            }
        }

        return data;
    };

    /**
     * 시용자 가이드를 위한 API 를 추가합니다.
     * @param $element 대상 jQuery 요소
     */
    function setUserGuideAPI($element) {
        $element.on('focus', function () {
            if (dews.ui.page && dews.ui.page.hasUserGuide) {
                if ($.isFunction(dews.ui.page.focusGuideItem) && $element.attr('id')) {
                    dews.ui.page.focusGuideItem('#' + $element.attr('id'));
                }
            }
        });
    }

    /**
     * 우편번호피커 HTML에 설정되어 있는 옵션을 얻어오는 함수
     * @param $element 우편번호 피커 JQuery 객체
     * @returns {{addressType, addressBind}}
     */
    function getZipCodePickerOptions($element) {
        return {
            addressType: $element.data('dews-address-type'),
            addressBind: $element.data('dews-address-bind')
        };
    }

    $.extend(true, dews, {
        /**
         * @namespace
         */
        ui: {
            /**
             * 지정한 요소를 우편번호피커로 만들거나 가져옵니다.
             * @param {string|jQuery} selector 우편번호피커로 만들 셀렉터 또는 jQuery 객체
             * @param {object} options 우편번호피커 옵션
             * @returns {object|Array} 우편번호피커 인스턴스
             */
            zipcodepicker: function (selector, options) {
                var $el,
                    picker;

                if (selector instanceof jQuery) {
                    $el = selector;
                } else if ($.type(selector) === 'string') {
                    $el = $(selector);
                }

                if ($.type($el) === 'undefined') {
                    return;
                }

                $el.each(function () {
                    var element = this,
                        $element = $(element),
                        option;

                    if ($element.data('dews-control')) {
                        picker = $element.data('dews-control');

                        if(options) {
                            picker._changeOption(options);
                        }

                    } else {
                        if (!$element.hasClass('dews-ui-zipcodepicker')) {
                            $element.addClass('dews-ui-zipcodepicker');
                        }
                        if (!$element.hasClass('dews-form-control')) {
                            $element.addClass('dews-form-control');
                        }

                        option = $.extend(true, {}, getZipCodePickerOptions($element), options);

                        picker = new ZipCodePicker(element, option);

                        $element.data("dews-control", picker);
                    }
                });

                return picker;
            }
        }
    });

    dews.ui.addControlInitializer('zipcodepicker', function (target) {
        var $container;

        if (target instanceof jQuery) {
            $container = target;
        } else if ($.type(target) === 'string') {
            $container = $(target);
        } else {
            $container = $(document);
        }

        dews.ui.zipcodepicker($(".dews-ui-zipcodepicker", $container));
    });
})(jQuery, window.dews);